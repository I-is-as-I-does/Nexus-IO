{"version":3,"file":"js/NxIOEdit.js","mappings":"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","sources":["webpack://nexus-io/./src/editor/NxEditStarters.js","webpack://nexus-io/./src/editor/NxEditComps.js","webpack://nexus-io/./src/editor/NxEditPrc.js","webpack://nexus-io/./src/editor/NxEditMenu.js","webpack://nexus-io/./src/editor/NxEdit.js","webpack://nexus-io/./src/editor/NxEditor.js","webpack://nexus-io/./src/editor/NxEditSwitch.js"],"sourcesContent":["import {\r\n  randomInt,\r\n  randomString,\r\n} from \"@i-is-as-i-does/jack-js/src/modules/Help.js\"\r\nimport { appUrl } from \"@i-is-as-i-does/nexus-core/src/validt/NxSpecs.js\"\r\n\r\nexport function newData() {\r\n  var randomId = randomString(10)\r\n  return {\r\n    nexus: appUrl,\r\n    author: {\r\n      handle: \"Anonymous-\" + randomInt(100, 999),\r\n      about: \"\",\r\n      url: \"http://\",\r\n    },\r\n    threads: [newThread(randomId)],\r\n    index: [randomId],\r\n  }\r\n}\r\n\r\nexport function newThread(randomId) {\r\n  return {\r\n    id: randomId,\r\n    title: randomId,\r\n    description: \"...\",\r\n    content: {\r\n      timestamp: new Date().toISOString().substring(0, 16),\r\n      main: \"...\",\r\n      aside: \"\",\r\n      media: {\r\n        url: \"\",\r\n        type: \"\",\r\n        caption: \"\",\r\n      },\r\n    },\r\n    linked: [],\r\n  }\r\n}\r\n","import { getTxt } from \"@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js\"\r\nimport { registerTranslElm } from \"@i-is-as-i-does/nexus-core/src/transl/NxElmTranslate.js\"\r\nimport { itemsMinMax } from \"@i-is-as-i-does/nexus-core/src/validt/NxSpecs\"\r\n\r\nimport { getElm, iconImage } from \"../shared/NxCommons.js\"\r\nimport { invalidB64 } from \"../shared/NxIcons.js\"\r\nexport function textInput(val) {\r\n  var inp = getElm(\"INPUT\", \"nx-edit-text\")\r\n  inp.type = \"text\"\r\n  inp.value = val\r\n  return inp\r\n}\r\n\r\nexport function textareaInput(val) {\r\n  var inp = getElm(\"TEXTAREA\", \"nx-edit-textarea\")\r\n  inp.textContent = val\r\n  return inp\r\n}\r\nexport function dateInput(val) {\r\n  var inp = getElm(\"INPUT\", \"nx-edit-date\")\r\n  inp.type = \"datetime-local\"\r\n  inp.value = val\r\n  return inp\r\n}\r\n\r\nexport function baseLabel(field) {\r\n  var lb = getElm(\"LABEL\", \"nx-edit-label\")\r\n  lb.for = field\r\n  var title = getElm(\"SPAN\", \"nx-edit-title\")\r\n  title.textContent = getTxt(field)\r\n  registerTranslElm(title, field)\r\n  lb.append(title)\r\n  return lb\r\n}\r\n\r\nexport function deleteLinkBtn() {\r\n  var btn = getElm(\"BUTTON\", \"nx-delete-link\")\r\n  btn.type = \"button\"\r\n  btn.textContent = \"-\"\r\n  return btn\r\n}\r\n\r\nexport function addBtn() {\r\n  var btn = getElm(\"BUTTON\", \"nx-add-link\")\r\n  btn.type = \"button\"\r\n  btn.textContent = \"+\"\r\n  return btn\r\n}\r\n\r\nexport function invalidSp() {\r\n  var sp = getElm(\"SPAN\", \"nx-edit-feedback\")\r\n  sp.append(iconImage(invalidB64))\r\n  return sp\r\n}\r\n\r\nexport function toggleAddBtn(btn, haystack, itemsKey) {\r\n  var disabled = false\r\n  if (itemsMinMax[itemsKey][1] <= haystack.length) {\r\n    disabled = true\r\n  }\r\n  if (btn.disabled !== disabled) {\r\n    btn.classList.toggle(\"nx-disabled\")\r\n    btn.disabled = disabled\r\n  }\r\n}\r\n","import { replaceDiacritics } from \"@i-is-as-i-does/jack-js/src/modules/Help.js\"\r\nimport { supportedOembedMedia } from \"@i-is-as-i-does/nexus-core/src/validt/NxSpecs\"\r\nimport { invalidB64, validB64 } from \"../shared/NxIcons\"\r\nimport { getEditState } from \"./NxEdit\"\r\n\r\nconst guessMap = {\r\n  image: [\"jpg\", \"jpeg\", \"gif\", \"svg\", \"png\", \"webp\"],\r\n  video: [\"mp4\", \"webm\"],\r\n  audio: [\"mp3\"],\r\n}\r\n\r\nexport function resolveMediaType(val) {\r\n  for (var p = 0; p < supportedOembedMedia.length; p++) {\r\n    if (val.includes(supportedOembedMedia[p])) {\r\n      return supportedOembedMedia[p]\r\n    }\r\n  }\r\n  var ext = val.split(\".\").pop()\r\n  for (let [type, exts] of Object.entries(guessMap)) {\r\n    if (exts.includes(ext)) {\r\n      return type\r\n    }\r\n  }\r\n\r\n  return \"page\"\r\n}\r\n\r\nexport function convertToId(title) {\r\n  return replaceDiacritics(title)\r\n    .trim()\r\n    .replace(/[^A-Za-z0-9]+/g, \"-\")\r\n    .replace(/(^-|-$)+/g, \"\")\r\n}\r\n\r\nexport function newState(data, url = \"nexus-tmp\", id = \"/\", idx = -1) {\r\n  return {\r\n    dataUrl: url,\r\n    srcData: data,\r\n    threadId: id,\r\n    threadIndex: idx,\r\n  }\r\n}\r\n\r\nexport function toggleBtn(btn, disabled = false) {\r\n  var hasDisbClass = btn.classList.contains(\"nx-disabled\")\r\n  if (!disabled && hasDisbClass) {\r\n    btn.classList.remove(\"nx-disabled\")\r\n  } else if (disabled && !hasDisbClass) {\r\n    btn.classList.add(\"nx-disabled\")\r\n  }\r\n}\r\n\r\nexport function isUnique(haystack, needle, excludeIdx) {\r\n  if (haystack.indexOf(needle) !== -1) {\r\n    for (var c = 0; c < haystack.length; c++) {\r\n      if (c !== excludeIdx && haystack[c] === needle) {\r\n        return false\r\n      }\r\n    }\r\n  }\r\n  return true\r\n}\r\n\r\nexport function uniqueId(id, idx) {\r\n  id = convertToId(id)\r\n  var editState = getEditState()\r\n  if (!isUnique(editState.srcData.index, id, idx)) {\r\n    var sp = id.split(\"-\")\r\n    var last = sp.pop()\r\n    var incr\r\n    if (!isNaN(last)) {\r\n      incr = parseInt(last)\r\n      incr++\r\n    } else {\r\n      sp.push(last)\r\n      incr = 1\r\n    }\r\n    id = sp.join(\"-\")\r\n    while (editState.srcData.index.includes(id + \"-\" + incr)) {\r\n      incr++\r\n    }\r\n    id += \"-\" + incr\r\n  }\r\n  return id\r\n}\r\n\r\nexport function setFeedbackIcon(fdbck, valid) {\r\n  var icsrc = invalidB64\r\n  if (valid) {\r\n    icsrc = validB64\r\n  }\r\n  fdbck.firstChild.src = icsrc\r\n}\r\n","import {\r\n  getThreadsList,\r\n  loadSrcFile,\r\n} from \"@i-is-as-i-does/nexus-core/src/load/NxSrc\"\r\nimport { logErr } from \"@i-is-as-i-does/nexus-core/src/logs/NxLog\"\r\nimport { registerEditData } from \"@i-is-as-i-does/nexus-core/src/storg/NxMemory\"\r\nimport { validData } from \"@i-is-as-i-does/nexus-core/src/validt/NxStamper\"\r\nimport {\r\n  getElm,\r\n  iconImage,\r\n  setHistoryControls,\r\n  toggleNavEnd,\r\n} from \"../shared/NxCommons.js\"\r\nimport {\r\n  downloadB64,\r\n  newB64,\r\n  openB64,\r\n  redoB64,\r\n  resetB64,\r\n  saveB64,\r\n  undoB64,\r\n} from \"../shared/NxIcons.js\"\r\nimport { getEditState, getHostElm, getOriginData, resetData } from \"./NxEdit.js\"\r\nimport { getTxt } from \"@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate\"\r\nimport { splitFlap } from \"@i-is-as-i-does/valva/src/modules/aliases\"\r\nimport { toggleBtn } from \"./NxEditPrc.js\"\r\nimport { newData } from \"./NxEditStarters.js\"\r\n\r\nvar actionFdbck\r\nvar feedbackrun\r\n\r\nvar saveBtn\r\nvar resetBtn\r\nvar editMenu\r\n\r\nvar actCtrls = {\r\n  ctrls: {\r\n    prev: { symbol: undoB64, elm: null },\r\n    next: { symbol: redoB64, elm: null },\r\n  },\r\n  position: 0,\r\n  count: 1,\r\n}\r\n\r\nvar resetting = false\r\nvar lastAction\r\n\r\nfunction setActionFeedback() {\r\n  actionFdbck = getElm(\"SPAN\", \"nx-action-feedback\")\r\n}\r\n\r\nfunction downloadBtn() {\r\n  var dlBtn = getElm(\"A\", \"nx-download\")\r\n  dlBtn.append(iconImage(downloadB64, 20))\r\n  dlBtn.addEventListener(\"click\", function () {\r\n    var data = Object.assign({}, getEditState().srcData)\r\n    delete data.index\r\n    var check = validData(data)\r\n    if (!check) {\r\n      displayFeedback(\"Invalid Nexus data\")\r\n    }\r\n    data = JSON.stringify(data, undefined, 2)\r\n    var dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(data)\r\n    var anchor = getElm(\"A\")\r\n    anchor.setAttribute(\"href\", dataStr)\r\n    anchor.setAttribute(\"download\", \"nexus.json\")\r\n    getHostElm().appendChild(anchor)\r\n    anchor.click()\r\n    anchor.remove()\r\n  })\r\n  return dlBtn\r\n}\r\n\r\nfunction newDocumenBtn() {\r\n  var newBtn = getElm(\"A\", \"nx-new\")\r\n  newBtn.append(iconImage(newB64, 20))\r\n  newBtn.addEventListener(\"click\", function () {\r\n    resetData(newData())\r\n  })\r\n  return newBtn\r\n}\r\n\r\nfunction openBtn() {\r\n  var inp = fileInput()\r\n  var btn = getElm(\"A\", \"nx-open-file\")\r\n  btn.append(iconImage(openB64, 20))\r\n  btn.addEventListener(\"click\", function () {\r\n    inp.click()\r\n  })\r\n  var wrap = getElm(\"SPAN\")\r\n  wrap.append(inp, btn)\r\n  return wrap\r\n}\r\n\r\nfunction fileInput() {\r\n  var inp = getElm(\"INPUT\")\r\n  inp.type = \"file\"\r\n  inp.accept = \"application/json\"\r\n  inp.addEventListener(\"change\", function (evt) {\r\n    loadSrcFile(evt, true)\r\n      .then((fdata) => {\r\n        fdata.index = getThreadsList(fdata)\r\n        resetData(fdata)\r\n      })\r\n      .catch((err) => {\r\n        logErr(err.message)\r\n        displayFeedback(\"Invalid source\")\r\n      })\r\n    inp.value = \"\"\r\n  })\r\n  inp.style.display = \"none\"\r\n  return inp\r\n}\r\n\r\nfunction setSaveBtn() {\r\n  saveBtn = getElm(\"A\", \"nx-save\")\r\n  saveBtn.append(iconImage(saveB64, 20))\r\n  toggleBtn(saveBtn, true)\r\n  saveBtn.addEventListener(\"click\", function () {\r\n    if (!saveBtn.classList.contains(\"nx-disabled\")) {\r\n      var editState = getEditState()\r\n      registerEditData(editState.dataUrl, editState.srcData)\r\n      displayFeedback(\"saved\")\r\n      toggleBtn(saveBtn, true)\r\n      setResetStatus()\r\n    }\r\n  })\r\n}\r\n\r\nfunction setResetStatus() {\r\n  if (getOriginData() !== JSON.stringify(getEditState().srcData)) {\r\n    toggleBtn(resetBtn, false)\r\n  } else {\r\n    toggleBtn(resetBtn, true)\r\n  }\r\n}\r\n\r\nfunction setResetBtn() {\r\n  resetBtn = getElm(\"A\", \"nx-reset\")\r\n  resetBtn.append(iconImage(resetB64, 20))\r\n\r\n  setResetStatus()\r\n  resetBtn.addEventListener(\"click\", function () {\r\n    if (!resetBtn.classList.contains(\"nx-disabled\")) {\r\n      resetData(JSON.parse(getOriginData()))\r\n      toggleBtn(resetBtn, true)\r\n    }\r\n  })\r\n}\r\n\r\nfunction editNav() {\r\n  var wrp = getElm(\"DIV\", \"nx-edit-nav\")\r\n  setActionFeedback()\r\n  setResetBtn()\r\n  setSaveBtn()\r\n\r\n  var links = getElm(\"DIV\")\r\n\r\n  links.append(resetBtn, newDocumenBtn(), openBtn(), saveBtn, downloadBtn())\r\n  wrp.append(actionFdbck, links)\r\n  return wrp\r\n}\r\n\r\nfunction triggerUndoRedo(ctrl) {\r\n  lastAction(ctrl === \"next\")\r\n  toggleSaveBtn(false)\r\n}\r\n\r\nfunction editActions() {\r\n  var wrp = getElm(\"DIV\", \"nx-edit-actions nx-history-nav\")\r\n  setHistoryControls(actCtrls, triggerUndoRedo, true)\r\n  wrp.append(actCtrls.ctrls[\"prev\"].elm, actCtrls.ctrls[\"next\"].elm)\r\n  return wrp\r\n}\r\n\r\nexport function setEditMenu() {\r\n  editMenu = getElm(\"DIV\", \"nx-edit-menu\")\r\n  editMenu.append(editNav(), editActions())\r\n}\r\n\r\nexport function displayFeedback(msg) {\r\n  var txt = getTxt(msg)\r\n  if (feedbackrun) {\r\n    clearTimeout(feedbackrun)\r\n  }\r\n  splitFlap(actionFdbck, txt, 25)\r\n  feedbackrun = setTimeout(function () {\r\n    splitFlap(actionFdbck, \"\", 25)\r\n  }, 1500 + txt.length * 20)\r\n}\r\n\r\nexport function toggleSaveBtn(disabled = false) {\r\n  toggleBtn(saveBtn, disabled)\r\n}\r\n\r\nexport function setLastAction(callback, bypass = false) {\r\n  if (!resetting || bypass) {\r\n    lastAction = callback\r\n    actCtrls.count = 2\r\n    actCtrls.position = 1\r\n    toggleNavEnd(actCtrls)\r\n    toggleSaveBtn(false)\r\n  }\r\n}\r\n\r\nexport function setResetting(bool) {\r\n  resetting = bool\r\n}\r\n\r\nexport function getEditMenu() {\r\n  return editMenu\r\n}\r\n","import {\r\n  charMinMax,\r\n  idPattern,\r\n  supportedMediaTypes,\r\n  urlPattern,\r\n} from \"@i-is-as-i-does/nexus-core/src/validt/NxSpecs.js\"\r\nimport {\r\n  landmarkElm,\r\n  baseViewLink,\r\n  blockWrap,\r\n  getElm,\r\n  selectDropDown,\r\n  iconImage,\r\n} from \"../shared/NxCommons.js\"\r\nimport {\r\n  insertDiversion,\r\n  easeIn,\r\n  easeOut,\r\n} from \"@i-is-as-i-does/valva/src/modules/aliases.js\"\r\nimport { randomString } from \"@i-is-as-i-does/jack-js/src/modules/Help.js\"\r\nimport { getAltState } from \"../shared/NxState.js\"\r\nimport {\r\n  getStoredEditData,\r\n  registerEditData,\r\n} from \"@i-is-as-i-does/nexus-core/src/storg/NxMemory.js\"\r\nimport { isValidUrl } from \"@i-is-as-i-does/nexus-core/src/validt/NxStamper.js\"\r\nimport { newData, newThread } from \"./NxEditStarters.js\"\r\nimport {\r\n  getSrcData,\r\n  getThreadsList,\r\n} from \"@i-is-as-i-does/nexus-core/src/load/NxSrc.js\"\r\nimport {\r\n  dateInput,\r\n  baseLabel,\r\n  textareaInput,\r\n  textInput,\r\n  invalidSp,\r\n  deleteLinkBtn,\r\n  addBtn,\r\n  toggleAddBtn,\r\n} from \"./NxEditComps.js\"\r\nimport {\r\n  isUnique,\r\n  newState,\r\n  resolveMediaType,\r\n  setFeedbackIcon,\r\n  uniqueId,\r\n  toggleBtn,\r\n} from \"./NxEditPrc.js\"\r\nimport { getQuery } from \"@i-is-as-i-does/nexus-core/src/base/NxHost.js\"\r\nimport { downB64, upB64 } from \"../shared/NxIcons.js\"\r\nimport {\r\n  setEditMenu,\r\n  setLastAction,\r\n  setResetting,\r\n  toggleSaveBtn,\r\n} from \"./NxEditMenu.js\"\r\n\r\nvar hostElm\r\nvar editState = {\r\n  dataUrl: \"nexus-tmp\",\r\n  srcData: null,\r\n  threadId: \"/\",\r\n  threadIndex: -1,\r\n}\r\nvar originData = null\r\n\r\nvar threadChange = new CustomEvent(\"editThreadChange\")\r\nvar upDownEvent = new CustomEvent(\"IndexChange\")\r\n\r\nvar editIndex = null\r\nvar editLocal = null\r\nvar editDistant = null\r\nvar authorForm\r\nvar btnSrc = {\r\n  up: upB64,\r\n  down: downB64,\r\n}\r\nvar addThreadBtn\r\n\r\nvar threadsMap = {}\r\n// @doc originIdx: { id: currentId, idx: currentIdx, linked :{}}\r\n\r\nfunction moveItem(ident, siblingIdent, up = false) {\r\n  var from = threadsMap[ident].idx\r\n  var to = from + 1\r\n  if (up) {\r\n    to = from - 1\r\n  }\r\n  editState.srcData.index.splice(\r\n    to,\r\n    0,\r\n    editState.srcData.index.splice(from, 1)[0]\r\n  )\r\n  editState.srcData.threads.splice(\r\n    to,\r\n    0,\r\n    editState.srcData.threads.splice(from, 1)[0]\r\n  )\r\n  threadsMap[ident].idx = to\r\n  threadsMap[siblingIdent].idx = from\r\n}\r\n\r\nfunction toggleActiveBtn(ident, btn) {\r\n  if (threadsMap[ident].idx === 0) {\r\n    toggleBtn(btn[\"up\"], true)\r\n  } else {\r\n    toggleBtn(btn[\"up\"], false)\r\n  }\r\n  if (threadsMap[ident].idx + 1 === editState.srcData.index.length) {\r\n    toggleBtn(btn[\"down\"], true)\r\n  } else {\r\n    toggleBtn(btn[\"down\"], false)\r\n  }\r\n}\r\n\r\nfunction permuteThread(goingUp, goingDown) {\r\n  editIndex.removeChild(goingUp)\r\n  editIndex.insertBefore(goingUp, goingDown)\r\n  goingDown.dispatchEvent(upDownEvent)\r\n  goingUp.dispatchEvent(upDownEvent)\r\n}\r\n\r\nfunction moveItemHandler(li, it, ident) {\r\n  var act = function (redo) {\r\n    var isUp = it == \"up\"\r\n    if (!redo) {\r\n      isUp = !isUp\r\n    }\r\n    var sibling\r\n    if (isUp && threadsMap[ident].idx !== 0) {\r\n      sibling = li.previousSibling\r\n      moveItem(ident, sibling.dataset.ident, true)\r\n      permuteThread(li, sibling)\r\n    } else if (\r\n      !isUp &&\r\n      threadsMap[ident].idx + 1 !== editState.srcData.index.length\r\n    ) {\r\n      sibling = li.nextSibling\r\n      moveItem(ident, sibling.dataset.ident, false)\r\n      permuteThread(sibling, li)\r\n    }\r\n  }\r\n\r\n  setLastAction(act)\r\n  act(true)\r\n}\r\n\r\nfunction setMoveBtns(li, ident) {\r\n  var dv = getElm(\"DIV\", \"nx-edit-move\")\r\n  var btn = {\r\n    up: null,\r\n    down: null,\r\n  }\r\n  li.addEventListener(\"IndexChange\", function () {\r\n    toggleActiveBtn(ident, btn)\r\n  })\r\n  Object.keys(btn).forEach((it) => {\r\n    btn[it] = getElm(\"A\", \"nx-edit-move-\" + it)\r\n    btn[it].append(iconImage(btnSrc[it], 16))\r\n    dv.append(btn[it])\r\n\r\n    btn[it].addEventListener(\"click\", function () {\r\n      moveItemHandler(li, it, ident)\r\n    })\r\n  })\r\n  toggleActiveBtn(ident, btn)\r\n  li.append(dv)\r\n}\r\n\r\nfunction threadLocalForm(ident, indexElm) {\r\n  var form = getElm(\"FORM\", \"nx-thread-local-form\")\r\n\r\n  var fieldset1 = getElm(\"FIELDSET\")\r\n  var idCallback = function (inp) {\r\n    threadsMap[ident].id = inp.value\r\n  }\r\n  var titleCallback = function (inp) {\r\n    var targ = indexElm.querySelector(\".nx-thread-title\")\r\n    if (targ.textContent !== inp.value) {\r\n      targ.textContent = inp.value\r\n    }\r\n  }\r\n  fieldset1.append(inputElm([\"threads\", ident, \"id\"], idCallback))\r\n  fieldset1.append(inputElm([\"threads\", ident, \"title\"], titleCallback))\r\n  fieldset1.append(inputElm([\"threads\", ident, \"description\"]))\r\n\r\n  var fieldset2 = getElm(\"FIELDSET\")\r\n  var fields = [\"timestamp\", \"main\", \"aside\"]\r\n  fields.forEach((field) => {\r\n    fieldset2.append(inputElm([\"threads\", ident, \"content\", field]))\r\n  })\r\n\r\n  var fieldset3 = getElm(\"FIELDSET\")\r\n\r\n  var typeInp = inputElm([\"threads\", ident, \"content\", \"media\", \"type\"])\r\n  var typeCallback = function (inp, valid) {\r\n    if (valid) {\r\n      var item = typeInp.querySelector(\r\n        \"[data-item=\" + resolveMediaType(inp.value) + \"]\"\r\n      )\r\n      if (item) {\r\n        item.click()\r\n      }\r\n    }\r\n  }\r\n  fieldset3.append(\r\n    inputElm([\"threads\", ident, \"content\", \"media\", \"url\"], typeCallback)\r\n  )\r\n  fieldset3.append(typeInp)\r\n  fieldset3.append(inputElm([\"threads\", ident, \"content\", \"media\", \"caption\"]))\r\n\r\n  form.append(\r\n    landmarkElm(\"local thread\"),\r\n    fieldset1,\r\n    landmarkElm(\"content\"),\r\n    fieldset2,\r\n    landmarkElm(\"media\", 2),\r\n    fieldset3\r\n  )\r\n  return form\r\n}\r\n\r\nfunction setAddThreadBtn() {\r\n  addThreadBtn = addBtn()\r\n  toggleAddBtn(addThreadBtn, editState.srcData.index, \"threads\")\r\n\r\n  addThreadBtn.addEventListener(\"click\", function () {\r\n    if (!addThreadBtn.disabled) {\r\n      var ident = randomString(21)\r\n      var randomId = randomString(10)\r\n      var idx = editState.srcData.index.length\r\n      threadsMap[ident] = { id: randomId, idx: idx, linked: {} }\r\n\r\n      var callb = null\r\n      if (idx - 1 !== -1) {\r\n        callb = function () {\r\n          editIndex.childNodes[idx - 1].dispatchEvent(upDownEvent)\r\n        }\r\n      }\r\n\r\n      editState.srcData.threads.push(newThread(randomId))\r\n      editState.srcData.index.push(randomId)\r\n      var map = threadElms(ident)\r\n      var ks = [\"local\", \"distant\"]\r\n\r\n      ks.forEach((k) => {\r\n        map[k].parent.append(map[k].child)\r\n      })\r\n\r\n      insertDiversion(\r\n        map.index.parent,\r\n        map.index.child,\r\n        false,\r\n        true,\r\n        200,\r\n        callb\r\n      )\r\n      toggleSaveBtn(false)\r\n      toggleAddBtn(addThreadBtn, editState.srcData.index, \"threads\")\r\n    }\r\n  })\r\n}\r\n\r\nfunction linkInput(addLinkBtn, form, ident, i) {\r\n  var lkident = randomString(21)\r\n  threadsMap[ident].linked[lkident] = { idx: i }\r\n  var linkwrap = getElm(\"DIV\", \"nx-edit-distant-link\")\r\n  var store = { linked: null }\r\n  var elm = inputElm([\"threads\", ident, \"linked\", lkident], null, store)\r\n  var dltBtn = deleteLinkBtn()\r\n  var delwrap = getElm(\"DIV\", \"nx-distant-link-action\")\r\n  delwrap.append(dltBtn)\r\n\r\n  dltBtn.addEventListener(\"click\", () => {\r\n    var act = function (redo) {\r\n      var lidx = threadsMap[ident].linked[lkident].idx\r\n      var tidx = threadsMap[ident].idx\r\n      if (redo) {\r\n        easeOut(linkwrap, 200, function () {\r\n          linkwrap.remove()\r\n        })\r\n        var isLast = lidx === editState.srcData.threads[tidx].linked.length - 1\r\n        editState.srcData.threads[tidx].linked.splice(lidx, 1)\r\n        if (!isLast) {\r\n          for (let [k, v] of Object.entries(threadsMap[ident].linked)) {\r\n            if (v.idx > lidx) {\r\n              threadsMap[ident].linked[k].idx = v.idx - 1\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        if (lidx > editState.srcData.threads[tidx].linked.length - 1) {\r\n          editState.srcData.threads[tidx].linked.push(store.linked.value)\r\n          insertDiversion(form, linkwrap, false, true, 200)\r\n        } else {\r\n          editState.srcData.threads[tidx].linked.splice(\r\n            lidx,\r\n            0,\r\n            store.linked.value\r\n          )\r\n          for (let [k, v] of Object.entries(threadsMap[ident].linked)) {\r\n            if (v.idx >= lidx && k !== lkident) {\r\n              threadsMap[ident].linked[k].idx = v.idx + 1\r\n            }\r\n          }\r\n          var nextSibling = form.childNodes[lidx]\r\n          form.insertBefore(linkwrap, nextSibling)\r\n          easeIn(linkwrap, 200)\r\n        }\r\n      }\r\n      toggleAddBtn(addLinkBtn, editState.srcData.threads[tidx].linked, \"linked\")\r\n    }\r\n    setLastAction(act)\r\n    act(true)\r\n  })\r\n  linkwrap.append(elm, delwrap)\r\n  return linkwrap\r\n}\r\n\r\nfunction threadDistantForm(ident) {\r\n  var form = getElm(\"FORM\", \"nx-thread-distant-form\")\r\n  var addLinkBtn = addBtn()\r\n  toggleAddBtn(\r\n    addLinkBtn,\r\n    editState.srcData.threads[threadsMap[ident].idx].linked,\r\n    \"linked\"\r\n  )\r\n  addLinkBtn.addEventListener(\"click\", () => {\r\n    if (!addLinkBtn.disabled) {\r\n      editState.srcData.threads[threadsMap[ident].idx].linked.push(\"\")\r\n      insertDiversion(\r\n        form,\r\n        linkInput(\r\n          addLinkBtn,\r\n          form,\r\n          ident,\r\n          editState.srcData.threads[threadsMap[ident].idx].linked.length - 1\r\n        ),\r\n        false,\r\n        true,\r\n        200\r\n      )\r\n      toggleAddBtn(\r\n        addLinkBtn,\r\n        editState.srcData.threads[threadsMap[ident].idx].linked,\r\n        \"linked\"\r\n      )\r\n    }\r\n  })\r\n\r\n  if (\r\n    !Object.prototype.hasOwnProperty.call(\r\n      editState.srcData.threads[threadsMap[ident].idx],\r\n      \"linked\"\r\n    )\r\n  ) {\r\n    editState.srcData.threads[threadsMap[ident].idx].linked = []\r\n  } else if (editState.srcData.threads[threadsMap[ident].idx].linked.length) {\r\n    var elms = []\r\n    for (\r\n      var i = 0;\r\n      i < editState.srcData.threads[threadsMap[ident].idx].linked.length;\r\n      i++\r\n    ) {\r\n      var elm = linkInput(addLinkBtn, form, ident, i)\r\n      elms.push(elm)\r\n    }\r\n    form.append(...elms)\r\n  }\r\n\r\n  var formCnt = getElm(\"DIV\")\r\n  formCnt.append(landmarkElm(\"linked threads\"), form, addLinkBtn)\r\n\r\n  return formCnt\r\n}\r\n\r\nfunction threadLi(ident) {\r\n  var li = getElm(\"LI\")\r\n\r\n  if (editState.threadId !== threadsMap[ident].id) {\r\n    li.style.display = \"none\"\r\n  }\r\n  li.addEventListener(\"editThreadChange\", function () {\r\n    if (editState.threadId === threadsMap[ident].id) {\r\n      setTimeout(function () {\r\n        easeIn(li, 200)\r\n      }, 200)\r\n    } else {\r\n      easeOut(li, 200)\r\n    }\r\n  })\r\n  return li\r\n}\r\n\r\nfunction indexLink(ident) {\r\n  var itemState = getAltState(\r\n    editState,\r\n    threadsMap[ident].id,\r\n    threadsMap[ident].idx\r\n  )\r\n  var indLk = baseViewLink(itemState, false)\r\n  if (editState.threadId === threadsMap[ident].id) {\r\n    indLk.classList.add(\"nx-on-display\")\r\n  }\r\n\r\n  indLk.addEventListener(\"click\", () => {\r\n    if (editState.threadId !== threadsMap[ident].id) {\r\n      editState.threadId = threadsMap[ident].id\r\n      editState.threadIndex = threadsMap[ident].idx\r\n      var prev = editIndex.querySelector(\".nx-on-display\")\r\n      if (prev) {\r\n        prev.classList.remove(\"nx-on-display\")\r\n      }\r\n      indLk.classList.add(\"nx-on-display\")\r\n      editLocal.childNodes.forEach((lchild) => {\r\n        lchild.dispatchEvent(threadChange)\r\n      })\r\n      editDistant.childNodes.forEach((dchild) => {\r\n        dchild.dispatchEvent(threadChange)\r\n      })\r\n    }\r\n  })\r\n\r\n  return indLk\r\n}\r\n\r\nfunction threadElms(ident) {\r\n  var map = {\r\n    index: { parent: editIndex, child: null, link: null, del: null },\r\n    local: { parent: editLocal, child: null },\r\n    distant: { parent: editDistant, child: null },\r\n  }\r\n\r\n  map.distant.child = threadLi(ident)\r\n  map.local.child = threadLi(ident)\r\n\r\n  map.index.child = getElm(\"LI\")\r\n  map.index.child.dataset.ident = ident\r\n  map.index.link = indexLink(ident)\r\n  map.index.child.append(map.index.link)\r\n  setMoveBtns(map.index.child, ident)\r\n\r\n  map.distant.child.append(threadDistantForm(ident))\r\n  map.local.child.append(threadLocalForm(ident, map.index.child))\r\n\r\n  map.index.del = deleteThreadElm(\r\n    map.local.child,\r\n    map.distant.child,\r\n    map.index.child,\r\n    ident\r\n  )\r\n  map.index.child.append(map.index.del)\r\n\r\n  return map\r\n}\r\n\r\nfunction deleteEvent(localLi, distantLi, indexLi, ident) {\r\n  var threadData = Object.assign(\r\n    {},\r\n    editState.srcData.threads[threadsMap[ident].idx]\r\n  )\r\n  var act = function (redo) {\r\n    var idx = threadsMap[ident].idx\r\n    var len = editState.srcData.index.length\r\n\r\n    if (redo) {\r\n      if (idx < len - 1) {\r\n        for (let [k, v] of Object.entries(threadsMap)) {\r\n          if (v.idx > idx) {\r\n            threadsMap[k].idx = v.idx - 1\r\n          }\r\n        }\r\n      }\r\n\r\n      editState.srcData.index.splice(idx, 1)\r\n      editState.srcData.threads.splice(idx, 1)\r\n      ;[distantLi, localLi, indexLi].forEach((elm) => {\r\n        easeOut(elm, 200, function () {\r\n          elm.remove()\r\n        })\r\n      })\r\n\r\n      if (len > 1) {\r\n        if (idx === 0) {\r\n          indexLi.nextSibling.dispatchEvent(upDownEvent)\r\n        } else if (idx === len - 1) {\r\n          indexLi.previousSibling.dispatchEvent(upDownEvent)\r\n        }\r\n      }\r\n\r\n      if (editState.threadId === threadsMap[ident].id) {\r\n        editState.threadId = \"/\"\r\n        editState.threadIndex = -1\r\n        distantLi.dispatchEvent(threadChange)\r\n        localLi.dispatchEvent(threadChange)\r\n      } else if (editState.threadIndex > idx) {\r\n        editState.threadIndex--\r\n      }\r\n    } else {\r\n      editState.srcData.index.splice(idx, 0, threadData.id)\r\n      editState.srcData.threads.splice(idx, 0, threadData)\r\n\r\n      if (idx <= len - 1) {\r\n        for (let [k, v] of Object.entries(threadsMap)) {\r\n          if (v.id !== threadData.id && v.idx >= idx) {\r\n            threadsMap[k].idx = v.idx + 1\r\n          }\r\n        }\r\n\r\n        var next = editIndex.childNodes[idx]\r\n        editIndex.insertBefore(indexLi, next)\r\n        if (idx === 0) {\r\n          next.dispatchEvent(upDownEvent)\r\n        }\r\n      } else {\r\n        editIndex.append(indexLi)\r\n        if (len > 1) {\r\n          indexLi.previousSibling.dispatchEvent(upDownEvent)\r\n        }\r\n      }\r\n\r\n      editLocal.append(localLi)\r\n      editDistant.append(distantLi)\r\n      easeIn(indexLi, 200)\r\n      indexLi.firstChild.click()\r\n    }\r\n    toggleAddBtn(addThreadBtn, editState.srcData.index, \"threads\")\r\n  }\r\n  setLastAction(act)\r\n  act(true)\r\n}\r\n\r\nfunction deleteThreadElm(localLi, distantLi, indexLi, ident) {\r\n  var btn = getElm(\"BUTTON\", \"nx-delete-thread\")\r\n  btn.type = \"button\"\r\n  btn.textContent = \"-\"\r\n\r\n  btn.addEventListener(\"click\", function () {\r\n    deleteEvent(localLi, distantLi, indexLi, ident)\r\n  })\r\n  return btn\r\n}\r\n\r\nfunction setAuthorValue(ref, value) {\r\n  if (!editState.srcData.author) {\r\n    editState.srcData.author = {}\r\n  }\r\n  editState.srcData.author[ref[1]] = value\r\n  return\r\n}\r\n\r\nfunction setThreadIndex(idx) {\r\n  if (!editState.srcData.threads) {\r\n    editState.srcData.threads = []\r\n  } else if (typeof editState.srcData.threads[idx] === \"undefined\") {\r\n    editState.srcData.threads[idx] = {}\r\n  }\r\n}\r\n\r\nfunction setThreadId(ref, idx, value) {\r\n  threadsMap[ref[1]].id = value\r\n  editState.srcData.index[idx] = value\r\n  editState.srcData.threads[idx].id = value\r\n}\r\n\r\nfunction setThreadInfo(ref, idx, value) {\r\n  editState.srcData.threads[idx][ref[2]] = value\r\n}\r\n\r\nfunction setContentValue(ref, idx, value) {\r\n  if (!editState.srcData.threads[idx].content) {\r\n    editState.srcData.threads[idx].content = {}\r\n  }\r\n  if (ref[3] !== \"media\") {\r\n    editState.srcData.threads[idx].content[ref[3]] = value\r\n    return\r\n  }\r\n  if (!editState.srcData.threads[idx].content.media) {\r\n    editState.srcData.threads[idx].content.media = {}\r\n  }\r\n  editState.srcData.threads[idx].content.media[ref[4]] = value\r\n  return\r\n}\r\n\r\nfunction setLinkedValue(ref, idx, value) {\r\n  if (!editState.srcData.threads[idx].linked) {\r\n    editState.srcData.threads[idx].linked = [value]\r\n  } else {\r\n    editState.srcData.threads[idx].linked[\r\n      threadsMap[ref[1]].linked[ref[3]].idx\r\n    ] = value\r\n  }\r\n}\r\n\r\nfunction setNewValue(ref, value) {\r\n  if (editState.srcData === null) {\r\n    editState.srcData = {}\r\n    editState.srcData.index = []\r\n  }\r\n  if (ref[0] === \"author\") {\r\n    return setAuthorValue(ref, value)\r\n  }\r\n  var idx = threadsMap[ref[1]].idx\r\n  setThreadIndex(idx)\r\n\r\n  if (ref[2] === \"id\") {\r\n    return setThreadId(ref, idx, value)\r\n  }\r\n  if (![\"linked\", \"content\"].includes(ref[2])) {\r\n    return setThreadInfo(ref, idx, value)\r\n  }\r\n\r\n  if (ref[2] === \"content\") {\r\n    return setContentValue(ref, idx, value)\r\n  }\r\n  setLinkedValue(ref, idx, value)\r\n}\r\n\r\nfunction fieldValue(ref) {\r\n  if (editState.srcData) {\r\n    if (ref[0] == \"author\") {\r\n      return editState.srcData[ref[0]][ref[1]]\r\n    }\r\n    var idx = threadsMap[ref[1]].idx\r\n    if (![\"linked\", \"content\"].includes(ref[2])) {\r\n      return editState.srcData.threads[idx][ref[2]]\r\n    }\r\n    if (ref[2] === \"content\") {\r\n      if (ref[3] !== \"media\") {\r\n        return editState.srcData.threads[idx].content[ref[3]]\r\n      }\r\n      return editState.srcData.threads[idx].content.media[ref[4]]\r\n    }\r\n    return editState.srcData.threads[idx].linked[\r\n      threadsMap[ref[1]].linked[ref[3]].idx\r\n    ]\r\n  }\r\n  return \"\"\r\n}\r\n\r\nfunction inputElm(ref, callback = null, store = null) {\r\n  var val = fieldValue(ref)\r\n\r\n  var pos = ref.length - 1\r\n  if (ref[pos - 1] === \"linked\") {\r\n    pos--\r\n  }\r\n  var field = ref[pos]\r\n  pos--\r\n  if (ref[pos - 1] === \"threads\") {\r\n    pos--\r\n  }\r\n  var parent = ref[pos]\r\n\r\n  var inp\r\n  if ([\"about\", \"description\", \"main\", \"aside\", \"caption\"].includes(field)) {\r\n    inp = textareaInput(val)\r\n  } else if (field == \"timestamp\") {\r\n    inp = dateInput(val)\r\n  } else {\r\n    inp = textInput(val)\r\n  }\r\n  inp.classList.add(\"nx-edit-input\")\r\n\r\n  var hook = ref.join(\"-\")\r\n  inp.id = hook\r\n  inp.name = hook\r\n  if (\r\n    [\r\n      \"handle\",\r\n      \"title\",\r\n      \"main\",\r\n      \"id\",\r\n      \"url\",\r\n      \"type\",\r\n      \"timestamp\",\r\n      \"linked\",\r\n    ].includes(field)\r\n  ) {\r\n    inp.required = true\r\n  }\r\n  var ident = field\r\n  if (field === \"linked\") {\r\n    ident = \"url\"\r\n  }\r\n\r\n  var lb = baseLabel(ident)\r\n  var indc = getElm(\"SPAN\", \"nx-edit-indication\")\r\n  var fdbck = invalidSp()\r\n  lb.append(indc, fdbck)\r\n\r\n  switch (field) {\r\n    case \"url\":\r\n      indc.textContent = \"[http]\"\r\n      inp.pattern = urlPattern\r\n      break\r\n    case \"linked\":\r\n      indc.textContent = \"[http]\"\r\n      inp.pattern = urlPattern\r\n      break\r\n    case \"id\":\r\n      indc.textContent = \"[A-Za-z0-9-][3-36]\"\r\n      inp.pattern = idPattern\r\n      break\r\n    case \"type\":\r\n      inp.pattern = \"(\" + supportedMediaTypes.join(\"|\") + \")\"\r\n      break\r\n    case \"timestamp\":\r\n      break\r\n    default:\r\n      var minmax = charMinMax[field]\r\n      indc.textContent = \"[\" + minmax[0] + \"-\" + minmax[1] + \"]\"\r\n      inp.setAttribute(\"maxlength\", minmax[1])\r\n      inp.setAttribute(\"minlength\", minmax[0])\r\n  }\r\n\r\n  if (store) {\r\n    store[field] = inp\r\n  }\r\n\r\n  var wrap = getElm(\"DIV\", \"nx-edit-input nx-edit-\" + parent + \"-\" + field)\r\n  wrap.append(lb)\r\n  if (field === \"type\") {\r\n    var items = supportedMediaTypes\r\n    wrap.append(selectDropDown(items, inp, null, \"nx-edit-media-type-select\"))\r\n  } else {\r\n    wrap.append(inp)\r\n  }\r\n\r\n  setInputEvt(ref, inp, fdbck, callback)\r\n  inputEvtHandler(ref, inp, fdbck, callback)\r\n\r\n  return wrap\r\n}\r\n\r\nfunction inputEvtHandler(ref, inp, fdbck, callback) {\r\n  var valid = inp.checkValidity()\r\n  var validPromise = null\r\n\r\n  if ((valid && ref.includes(\"url\")) || ref.includes(\"linked\")) {\r\n    valid = isValidUrl(inp.value)\r\n    if (valid && ref.includes(\"linked\")) {\r\n      valid = isUnique(\r\n        editState.srcData.threads[threadsMap[ref[1]].idx].linked,\r\n        inp.value,\r\n        threadsMap[ref[1]].linked[ref[3]].idx\r\n      )\r\n      if (valid) {\r\n        validPromise = getSrcData(inp.value)\r\n          .then(() => {\r\n            return true\r\n          })\r\n          .catch(() => {\r\n            return false\r\n          })\r\n      }\r\n    }\r\n  } else if (ref.includes(\"id\")) {\r\n    var nId = uniqueId(inp.value, threadsMap[ref[1]].idx)\r\n    if (nId !== inp.value) {\r\n      inp.value = nId\r\n    }\r\n    valid = true\r\n  }\r\n\r\n  if (validPromise === null) {\r\n    validPromise = Promise.resolve(valid)\r\n  }\r\n\r\n  validPromise.then((isValid) => {\r\n    setNewValue(ref, inp.value)\r\n    setFeedbackIcon(fdbck, isValid)\r\n    if (typeof callback === \"function\") {\r\n      callback(inp, isValid)\r\n    }\r\n  })\r\n}\r\n\r\nfunction setInputEvt(ref, inp, fdbck, callback) {\r\n  var c = 0\r\n  var undone = \"\"\r\n  var prev = inp.value\r\n  inp.addEventListener(\"focus\", function () {\r\n    prev = inp.value\r\n  })\r\n  inp.addEventListener(\"change\", function () {\r\n    inputEvtHandler(ref, inp, fdbck, callback)\r\n    if (c > 0) {\r\n      var act = function (redo) {\r\n        if (redo) {\r\n          inp.value = undone\r\n        } else {\r\n          undone = inp.value\r\n          inp.value = prev\r\n        }\r\n        inputEvtHandler(ref, inp, fdbck, callback)\r\n      }\r\n      setLastAction(act)\r\n    } else {\r\n      c++\r\n    }\r\n  })\r\n}\r\n\r\nfunction setAuthorForm() {\r\n  authorForm = getElm(\"FORM\", \"nx-edit-author\")\r\n  setAuthorInputs()\r\n}\r\n\r\nfunction setAuthorInputs(ease = false) {\r\n  var fields = [\"handle\", \"url\", \"about\"]\r\n  fields.forEach((field) => {\r\n    var inp = inputElm([\"author\", field])\r\n    if (ease) {\r\n      insertDiversion(authorForm, inp, false, true, 200)\r\n    } else {\r\n      authorForm.append(inp)\r\n    }\r\n  })\r\n}\r\n\r\nfunction setThreads(ease = false) {\r\n  var items = editState.srcData.index\r\n\r\n  if (items.length) {\r\n    setResetting(true)\r\n    var callb = null\r\n    for (var i = 0; i < items.length; i++) {\r\n      if (i === items.length - 1) {\r\n        callb = function () {\r\n          setResetting(false)\r\n        }\r\n      }\r\n      setThread(i, items[i], callb, ease)\r\n    }\r\n  }\r\n}\r\n\r\nfunction setThread(idx, id, callb, ease = false) {\r\n  var ident = randomString(21)\r\n  threadsMap[ident] = { id: id, idx: idx, linked: {} }\r\n\r\n  var map = threadElms(ident)\r\n\r\n  for (let [k, elmSet] of Object.entries(map)) {\r\n    if (ease && (k === \"index\" || id === editState.threadId)) {\r\n      insertDiversion(elmSet.parent, elmSet.child, false, true, 200, callb)\r\n    } else {\r\n      elmSet.parent.append(elmSet.child)\r\n      if (callb) {\r\n        callb()\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction setThreadsForms() {\r\n  editIndex = getElm(\"UL\", \"nx-edit-index\")\r\n  editLocal = getElm(\"UL\", \"nx-edit-local\")\r\n  editDistant = getElm(\"UL\", \"nx-edit-distant\")\r\n  setThreads()\r\n}\r\n\r\nexport function resetData(data) {\r\n  var prvState = JSON.stringify(editState)\r\n  if (data === null) {\r\n    data = newData()\r\n  }\r\n\r\n  var state = newState(data)\r\n  if (state.srcData.threads.length) {\r\n    state.threadIndex = 0\r\n    state.threadId = state.srcData.threads[0].id\r\n  }\r\n  var nxtState = JSON.stringify(state)\r\n  var act = function (redo) {\r\n    if (editState.srcData.threads.length) {\r\n      var parents = [authorForm, editIndex, editLocal, editDistant]\r\n      parents.forEach((parent, p) => {\r\n        var childr = Array.from(parent.childNodes)\r\n        var lastp = p === parents.length - 1\r\n        childr.forEach((child, c) => {\r\n          var prc = null\r\n          if (lastp && c === childr.length - 1) {\r\n            prc = function () {\r\n              var nstate\r\n              if (redo) {\r\n                nstate = nxtState\r\n              } else {\r\n                nstate = prvState\r\n              }\r\n              editState = Object.assign({}, JSON.parse(nstate))\r\n              setAuthorInputs(true)\r\n              setThreads(true)\r\n            }\r\n          }\r\n          easeOut(child, 200, function () {\r\n            child.remove()\r\n            if (prc) {\r\n              prc()\r\n            }\r\n          })\r\n        })\r\n      })\r\n    }\r\n  }\r\n  act(true)\r\n  setLastAction(act, true)\r\n}\r\n\r\nexport function getOriginData() {\r\n  return originData\r\n}\r\n\r\nexport function getHostElm() {\r\n  return hostElm\r\n}\r\n\r\nexport function setEditState(state, nxelm) {\r\n  hostElm = nxelm\r\n  var url = \"nexus-tmp\"\r\n  var state = state\r\n  var data\r\n\r\n  if (getQuery(\"new\")) {\r\n    data = newData()\r\n    state = null\r\n  } else {\r\n    if (state.dataUrl) {\r\n      url = state.dataUrl\r\n    }\r\n    data = getStoredEditData(url)\r\n    if (data === null) {\r\n      if (state.srcData !== null) {\r\n        data = state.srcData\r\n      } else {\r\n        data = newData()\r\n      }\r\n      registerEditData(url, data)\r\n    }\r\n  }\r\n\r\n  if (!data.index) {\r\n    data.index = getThreadsList(data)\r\n  }\r\n\r\n  if (state !== null && state.srcData !== null) {\r\n    originData = JSON.stringify(state.srcData)\r\n  } else {\r\n    originData = JSON.stringify(data)\r\n  }\r\n\r\n  var id = data.threads[0].id\r\n  var idx = 0\r\n\r\n  if (state && state.threadId !== \"/\" && data.index.includes(state.threadId)) {\r\n    id = state.threadId\r\n    idx = data.index.indexOf(state.threadId)\r\n  }\r\n\r\n  editState = newState(data, url, id, idx)\r\n\r\n  setEditMenu()\r\n  setThreadsForms()\r\n  setAuthorForm()\r\n  setAddThreadBtn()\r\n}\r\n\r\nexport function authorBlock() {\r\n  return blockWrap(\"author\", [authorForm], landmarkElm(\"author\"))\r\n}\r\nexport function editIndexBlock() {\r\n  return blockWrap(\r\n    \"threads-list\",\r\n    [editIndex, addThreadBtn],\r\n    landmarkElm(\"threads\")\r\n  )\r\n}\r\nexport function editLocalBlock() {\r\n  return blockWrap(\"local\", [editLocal], false)\r\n}\r\nexport function editDistantBlock() {\r\n  return blockWrap(\"distant\", [editDistant], false)\r\n}\r\nexport function getEditState() {\r\n  return editState\r\n}\r\n","\r\nimport { readerElms } from \"../reader/NxReader.js\"\r\nimport {\r\n  appHeaderWithLang,\r\n  getElm,\r\n  instanceWrap,\r\n  serviceWrap,\r\n} from \"../shared/NxCommons.js\"\r\nimport {\r\n  editDistantBlock,\r\n  authorBlock,\r\n  editIndexBlock,\r\n  editLocalBlock,\r\n  setEditState,\r\n  getEditState,\r\n} from \"./NxEdit.js\"\r\nimport { getEditMenu } from \"./NxEditMenu.js\"\r\nimport { instanceSwitch } from \"./NxEditSwitch.js\"\r\n\r\nexport function editorElms(seed) {\r\n  setEditState(seed.state, seed.nxelm)\r\n  var indexMain = getElm(\"DIV\", \"nx-main-block nx-index\")\r\n  indexMain.append(authorBlock(), editIndexBlock())\r\n  var threadMain = getElm(\"DIV\", \"nx-main-block nx-thread\")\r\n  threadMain.append(editLocalBlock(), editDistantBlock())\r\n\r\n  var editInst = instanceWrap(appHeaderWithLang(), [\r\n    serviceWrap([getEditMenu()], [indexMain, threadMain], [], \"edit\"),\r\n  ])\r\n\r\n  var seed = {\r\n    editMode: true,\r\n    state: Object.assign({}, getEditState()),\r\n  }\r\n  var readerInst = readerElms(seed)\r\n  readerInst.style.display = \"none\"\r\n  var switchBtn = instanceSwitch(editInst, readerInst)\r\n\r\n  var editor = getElm(\"DIV\", \"nx-editor\")\r\n  editor.append(editInst, readerInst, switchBtn)\r\n  return editor\r\n}\r\n","import { fadeOut, fadeIn } from \"@i-is-as-i-does/valva/src/modules/aliases.js\"\r\nimport {\r\n  getElm,\r\n  iconImage,\r\n} from \"../shared/NxCommons.js\"\r\nimport { editB64, previewB64 } from \"../shared/NxIcons.js\"\r\nimport { triggerUpdate } from \"../shared/NxState.js\"\r\nimport {\r\n  getEditState,\r\n} from \"./NxEdit.js\"\r\n\r\nexport function instanceSwitch(editInst, readerInst) {\r\n  var previewOn = false\r\nvar instanceBtn = getElm(\"A\", \"nx-edit-switch\")\r\n  instanceBtn.append(iconImage(previewB64, 25))\r\n\r\n  instanceBtn.addEventListener(\"click\", function () {\r\n    previewOn = !previewOn\r\n\r\n    if (previewOn) {\r\n      fadeOut(editInst, function () {\r\n        triggerUpdate(getEditState(), true, true)\r\n        instanceBtn.firstChild.src = editB64\r\n        fadeIn(readerInst)\r\n      })\r\n    } else {\r\n      fadeOut(readerInst, function () {\r\n        instanceBtn.firstChild.src = previewB64\r\n        fadeIn(editInst)\r\n      })\r\n    }\r\n  })\r\n  return instanceBtn\r\n}\r\n\r\n"],"names":["newData","randomId","nexus","author","handle","about","url","threads","newThread","index","id","title","description","content","timestamp","Date","toISOString","substring","main","aside","media","type","caption","linked","addBtn","btn","textContent","toggleAddBtn","haystack","itemsKey","disabled","length","classList","toggle","guessMap","image","video","audio","newState","data","idx","dataUrl","srcData","threadId","threadIndex","toggleBtn","hasDisbClass","contains","remove","add","isUnique","needle","excludeIdx","indexOf","c","uniqueId","trim","replace","editState","getEditState","incr","sp","split","last","pop","isNaN","push","parseInt","join","includes","actionFdbck","feedbackrun","saveBtn","resetBtn","editMenu","lastAction","hostElm","actCtrls","ctrls","prev","symbol","elm","next","position","count","resetting","downloadBtn","dlBtn","append","addEventListener","Object","assign","displayFeedback","JSON","stringify","undefined","dataStr","encodeURIComponent","anchor","setAttribute","appendChild","click","openBtn","inp","accept","evt","then","fdata","resetData","catch","err","message","value","style","display","fileInput","wrap","setResetStatus","getOriginData","editNav","wrp","parse","newBtn","links","triggerUndoRedo","ctrl","toggleSaveBtn","setEditMenu","msg","txt","clearTimeout","setTimeout","setLastAction","callback","bypass","setResetting","bool","authorForm","addThreadBtn","originData","threadChange","CustomEvent","upDownEvent","editIndex","editLocal","editDistant","btnSrc","up","down","threadsMap","moveItem","ident","siblingIdent","from","to","splice","toggleActiveBtn","permuteThread","goingUp","goingDown","removeChild","insertBefore","dispatchEvent","setMoveBtns","li","dv","keys","forEach","it","act","redo","sibling","isUp","previousSibling","dataset","nextSibling","moveItemHandler","threadLocalForm","indexElm","form","fieldset1","inputElm","targ","querySelector","fieldset2","field","fieldset3","typeInp","valid","item","val","p","ext","exts","entries","resolveMediaType","linkInput","addLinkBtn","i","lkident","linkwrap","store","dltBtn","delwrap","lidx","tidx","isLast","k","v","childNodes","threadLi","threadElms","map","parent","child","link","del","local","distant","itemState","indLk","lchild","dchild","indexLink","prototype","hasOwnProperty","call","elms","formCnt","threadDistantForm","localLi","distantLi","indexLi","threadData","len","firstChild","deleteEvent","deleteThreadElm","setNewValue","ref","setAuthorValue","setThreadIndex","setThreadId","setContentValue","setLinkedValue","setThreadInfo","fieldValue","pos","textareaInput","dateInput","textInput","hook","name","required","lb","for","baseLabel","indc","fdbck","pattern","minmax","items","undone","inputEvtHandler","setInputEvt","checkValidity","validPromise","nId","Promise","resolve","isValid","icsrc","src","setFeedbackIcon","setAuthorInputs","ease","setThreads","callb","setThread","elmSet","prvState","state","nxtState","parents","childr","Array","lastp","prc","nstate","setEditState","nxelm","editorElms","seed","indexMain","threadMain","editInst","readerInst","editMode","switchBtn","previewOn","instanceBtn","instanceSwitch","editor"],"sourceRoot":""}