{"version":3,"file":"js/NxIOLib.js","mappings":"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","sources":["webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/base/NxDefaults.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/base/NxHost.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxMedia.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxNest.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxSnippet.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxSpin.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/load/NxInit.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/base/NxRequest.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/load/NxSrc.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/load/NxStyle.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/logs/NxLog.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/storg/NxMemory.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/storg/NxStorage.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/transl/NxTranslations.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/transl/NxElmTranslate.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/validt/NxSpecs.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/validt/NxStamper.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/valva/src/modules/constants.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/valva/src/modules/aliases.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/valva/src/modules/utils.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/valva/src/modules/transitions.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Check.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Help.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Stock.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Style.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Web.js"],"sourcesContent":["/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nexport const defaultIO = 'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/js/NxIO.js'\r\nexport const defaultStyle = 'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NxIO.min.css'\r\nexport const defaultSignatureRule = '.nx-instance'\r\nexport const defaultElmId = '#Nexus'\r\nexport const defaultLang = 'en'\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nimport { toLastSlash } from '@i-is-as-i-does/jack-js/src/modules/Web'\r\nimport { splitUrlAndId } from '../validt/NxStamper.js'\r\n\r\nexport const currentUrl = window.location.href\r\nexport const baseCurrentUrl = toLastSlash(currentUrl)\r\nexport const splitCurrentUrl = splitUrlAndId(currentUrl)\r\nexport const queries = new URLSearchParams(window.location.search.slice(1))\r\n\r\nexport function getQuery (key) {\r\n  return queries.has(key)\r\n}\r\nexport function getAbsoluteUrl (url) {\r\n  if (url.length && url.substring(0, 4) !== 'http') {\r\n    return baseCurrentUrl + url.replace(/^\\.?\\/?/, '')\r\n  }\r\n  return url\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { conciseUrl, oembedLink, oembedResponse } from '@i-is-as-i-does/jack-js/src/modules/Web'\r\nimport { waitForElmInDOM } from '@i-is-as-i-does/jack-js/src/modules/Help'\r\nimport { logErr } from '../logs/NxLog'\r\n\r\nimport { registerOembedResponse, getStoredOembedResponse } from '../storg/NxMemory'\r\nimport { supportedOembedMedia } from '../validt/NxSpecs'\r\n\r\nconst mediaReadyEvent = new Event('mediaReady')\r\n\r\nexport function dispatchMediaReady (resolvedElm, parentElm) {\r\n  waitForElmInDOM(resolvedElm.tagName, parentElm).then(() => {\r\n    parentElm.dispatchEvent(mediaReadyEvent)\r\n  })\r\n}\r\n\r\nexport function placeMedia (url, parentElm, mediaElm) {\r\n  if (mediaElm.tagName !== 'A') {\r\n    var loadEvent = 'load'\r\n    var srcElm = mediaElm\r\n    if (['VIDEO', 'AUDIO'].includes(mediaElm.tagName)) {\r\n      loadEvent = 'loadedmetadata'\r\n      if (mediaElm.tagName === 'VIDEO ') {\r\n        srcElm = mediaElm.firstChild\r\n      }\r\n    }\r\n    mediaElm.addEventListener(loadEvent, function () {\r\n      dispatchMediaReady(mediaElm, parentElm)\r\n    })\r\n    srcElm.addEventListener('error', function () {\r\n      logErr('Unable to load requested media', url)\r\n      var fallback = pageElm(url)\r\n      mediaElm.replaceWith(fallback)\r\n      dispatchMediaReady(fallback, parentElm)\r\n    })\r\n    srcElm.src = url\r\n  } else {\r\n    if(!mediaElm.textContent){\r\n      mediaElm.textContent = conciseUrl(url, true)\r\n    }\r\n    dispatchMediaReady(mediaElm, parentElm)\r\n    mediaElm.href = url\r\n  }\r\n  parentElm.append(mediaElm)\r\n}\r\n\r\nexport function setMediaUrl (srcElm, attrb = 'src', url = null) {\r\n  if (url) {\r\n    srcElm.setAttribute(attrb, url)\r\n  }\r\n}\r\n\r\nexport function pageElm (url = null) {\r\n  var mediaElm = document.createElement('A')\r\n  mediaElm.target = '_blank'\r\n  if(url){\r\n    mediaElm.textContent = conciseUrl(url, true)\r\n    mediaElm.setAttribute('href', url)\r\n  }\r\n  return mediaElm\r\n}\r\n\r\nexport function videoElm (url = null) {\r\n  var mediaElm = document.createElement('VIDEO')\r\n  mediaElm.setAttribute('controls', true)\r\n  var srcElm = document.createElement('SOURCE')\r\n  mediaElm.append(srcElm)\r\n  setMediaUrl(srcElm, 'src', url)\r\n  return mediaElm\r\n}\r\n\r\nexport function audioElm (url = null) {\r\n  var mediaElm = document.createElement('AUDIO')\r\n  mediaElm.setAttribute('controls', true)\r\n  setMediaUrl(mediaElm, 'src', url)\r\n  return mediaElm\r\n}\r\n\r\nexport function imgElm (url = null) {\r\n  var mediaElm = document.createElement('IMG')\r\n  setMediaUrl(mediaElm, 'src', url)\r\n  return mediaElm\r\n}\r\n\r\nexport function iframeElm (url = null) {\r\n  var mediaElm = document.createElement('IFRAME')\r\n  mediaElm.scrolling = 'no'\r\n  mediaElm.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'\r\n  mediaElm.allowfullscreen = true\r\n  setMediaUrl(mediaElm, 'src', url)\r\n  return mediaElm\r\n}\r\n\r\nexport function mediaElm (type, url = null) {\r\n  if (supportedOembedMedia.includes(type)) {\r\n    type = 'iframe'\r\n  }\r\n  var f\r\n  switch (type) {\r\n    case 'image':\r\n      f = imgElm\r\n      break\r\n    case 'video':\r\n      f = videoElm\r\n      break\r\n    case 'audio':\r\n      f = audioElm\r\n      break\r\n    case 'iframe':\r\n      f = iframeElm\r\n      break\r\n    default:\r\n      f = pageElm\r\n  }\r\n  return f(url)\r\n}\r\n\r\nexport function resolveEmbedMediaData (url, type) {\r\n  var iframeUrl = getStoredOembedResponse(url)\r\n  var success = function () {\r\n    return { type: type, url: iframeUrl }\r\n  }\r\n  var fallback = function () {\r\n    return { type: 'page', url: url }\r\n  }\r\n  if (iframeUrl) {\r\n    return Promise.resolve(success())\r\n  }\r\n  var link = oembedLink(url, type, 720)\r\n  if (!link) {\r\n    return Promise.resolve(fallback())\r\n  }\r\n  return oembedResponse(link).then(response => {\r\n    iframeUrl = response.html.split('src=\"')[1].split('\"')[0]\r\n    registerOembedResponse(url, iframeUrl)\r\n    return success()\r\n  }).catch((err) => {\r\n    logErr('Failed to resolved oembed media', { url: url, err: err.message })\r\n    return fallback()\r\n  })\r\n}\r\n\r\nexport function resolveEmbedMedia (url, type, parentElm) {\r\n  resolveEmbedMediaData(url, type).then(result => {\r\n    placeMedia(result.url, parentElm, mediaElm(result.type))\r\n  })\r\n}\r\n\r\nexport function resolveMedia (url, type, parentElm) {\r\n  if (supportedOembedMedia.includes(type)) {\r\n    resolveEmbedMedia(url, type, parentElm)\r\n  } else {\r\n    placeMedia(url, parentElm, mediaElm(type))\r\n  }\r\n}\r\n\r\nexport function preResolveViewMedia (view) {\r\n  if(view.data.content.media.type === 'page'){\r\n    view.resolved.media = true\r\n    return Promise.resolve(view)\r\n  }\r\n  var host = document.createElement('DIV')\r\n  host.style.display = 'none'\r\n  document.body.append(host)\r\n  var handleResult = function () {\r\n    if (host.firstChild.tagName === 'A' && view.data.content.media.type !== 'page') {\r\n      view.data.content.media.type = 'page'\r\n    } else if (host.firstChild.tagName === 'IFRAME') {\r\n      view.data.content.media.url = host.firstChild.src\r\n    }\r\n    host.remove()\r\n    view.resolved.media = true\r\n    return view\r\n  }\r\n  var promise = new Promise(function (resolve) {\r\n    host.addEventListener('mediaReady', resolve)\r\n  }).then(handleResult)\r\n  resolveMedia(view.data.content.media.url, view.data.content.media.type, host)\r\n  return promise\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nimport { getStoredLinkedMaps, registerLinkedMaps } from '../storg/NxMemory.js'\r\nimport { splitUrlAndId } from '../validt/NxStamper.js'\r\nimport { getSrcData } from '../load/NxSrc.js'\r\nimport { logErr } from '../logs/NxLog.js'\r\nimport { authorAndselectedThreadsViews } from './NxViews.js'\r\n\r\nexport function buildLinkedInstances (thread, exclude = []) {\r\n  // @doc instances = {url:[...ids] }\r\n  var instances = {}\r\n\r\n  for(var i=0; i < thread.linked.length; i++){\r\n    if (!exclude.includes(thread.linked[i])) {\r\n      var split = splitUrlAndId(thread.linked[i])\r\n      if (!exclude.includes(split.url)) {\r\n        if(!Object.prototype.hasOwnProperty.call(instances, split.url)){\r\n          instances[split.url] = []\r\n        } \r\n        if(split.id){\r\n          instances[split.url].push(split.id)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return instances\r\n}\r\n\r\n\r\nexport function getLinkedInstances (src, thread, exclude = []) {\r\n  var store = { instances: getStoredLinkedMaps(src), register: false }\r\n  if (store.instances === null) {\r\n    store.instances = buildLinkedInstances(thread, exclude)\r\n    store.register = true\r\n  }\r\n  return store\r\n}\r\n\r\n\r\nexport function resolveLinkedViews (view, exclude = []) {\r\n  var store = getLinkedInstances(view.src, view.data, exclude)\r\n  var register = store.register\r\n  var confirmedInstances = {}\r\n  const promises = []\r\n  for(let [url, ids] of Object.entries(store.instances)){\r\n    var promise = getSrcData(url).then(nxdata => {\r\n      var viewstore = authorAndselectedThreadsViews(nxdata, url, ids)\r\n      if (!register && viewstore.failed.length) {\r\n        register = true\r\n        logErr('Linked threads could not be resolved', viewstore.failed.join(', '))\r\n      }\r\n      view.nested.push({views : viewstore.views, list: viewstore.list})\r\n      confirmedInstances[url] = viewstore.confirmed\r\n    }).catch(() => {\r\n      if (!register){\r\n        register = true\r\n      }\r\n      logErr('Linked source could not be resolved', url)\r\n    })\r\n    promises.push(promise)\r\n  }\r\n\r\n  return Promise.all(promises).then(() => { \r\n    if (register) {\r\n      registerLinkedMaps(view.src, confirmedInstances)\r\n    }\r\n    view.resolved.nested = true\r\n    return view\r\n  })\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { defaultIO } from '../base/NxDefaults'\r\n\r\nexport function getSnippet (src, style = null, scriptSrc = null, lang = null) {\r\n  // @doc does NOT validate arguments;\r\n  var datalang = ''\r\n  if (lang) {\r\n    datalang = ' data-lang=\"' + lang + '\"'\r\n  }\r\n  var datastyle = ''\r\n  if (style) {\r\n    datastyle = ' data-style=\"' + style + '\"'\r\n  }\r\n  if (!scriptSrc) {\r\n    scriptSrc = defaultIO\r\n  }\r\n  return `<div id=\"Nexus\" data-src=\"${src}\"${datastyle}${datalang}></div>\r\n<script src=\"${scriptSrc}\"></script>`\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nexport class Spinner {\r\n  constructor(spinContainer, spinStates = [], speed = 100) {\r\n    this.spinContainer = spinContainer\r\n    if(!spinStates.length){\r\n        spinStates = [\"\", \"/\", \"â€“\", \"\\\\\", \"|\"]\r\n    } else if(spinStates[0] !== ''){\r\n        spinStates.unshift('')\r\n    }\r\n    this.spinStates = spinStates\r\n    this.speed = speed\r\n    this.spinPosition = -1\r\n  }\r\n\r\n  endSpin() {\r\n    this.spinPosition = -1\r\n  }\r\n  \r\n  startSpin() {\r\n    this.spinPosition = 0\r\n    var f = window.setInterval(function(){\r\n        if (this.spinPosition === -1) {\r\n            this.spinContainer.textContent = ''\r\n            clearInterval(f)\r\n          } else {\r\n            this.spinContainer.textContent = this.spinStates[this.spinPosition]\r\n            if (this.spinPosition === (this.spinStates.length - 1)) {\r\n              this.spinPosition = 1\r\n            } else {\r\n              this.spinPosition++\r\n            }\r\n          }\r\n    }.bind(this), this.speed)\r\n  }\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nimport { loadAppCss } from './NxStyle.js'\r\nimport { logErr, setConsoleLog } from '../logs/NxLog.js'\r\nimport { getRequest } from '../base/NxRequest.js'\r\nimport { getQuery } from '../base/NxHost.js'\r\nimport { getSrcData } from './NxSrc.js'\r\nimport { defaultElmId } from './../base/NxDefaults.js'\r\n\r\nexport const defaultInitOptions = {\r\n  customSelector: null,\r\n  forceLog: false,\r\n  forceStyle: null,\r\n  customSignatureRule: null,\r\n  appDefaultCss: null, \r\n  appDefaultCssAliases: [],\r\n  appDefaultLang: null\r\n}\r\n\r\nexport function setCookie () {\r\n  document.cookie = 'Nx=Instance; SameSite=None; Secure'\r\n}\r\n\r\nexport function initLogger (forceLog = false) {\r\n  if (forceLog || getQuery('log')) {\r\n    setConsoleLog(true)\r\n  }\r\n}\r\n\r\nexport function retrieveNxElm (customSelector = null) {\r\n  var selectors = [defaultElmId]\r\n  if (customSelector && customSelector !== defaultElmId) {\r\n    selectors.unshift(customSelector)\r\n  }\r\n  var elm\r\n  for (var s = 0; s < 2; s++) {\r\n    elm = document.querySelector(selectors[s])\r\n    if (elm) {\r\n      return elm\r\n    }\r\n  }\r\n  elm = document.createElement('DIV')\r\n  elm.id = defaultElmId\r\n\r\n  return elm\r\n}\r\n\r\nexport function resolveTheme (request, fallbackCssUrl = null, forceStyle = null, customSignatureRule = null) {\r\n  var url = request.style\r\n  if (forceStyle) {\r\n    url = forceStyle\r\n    if(!fallbackCssUrl || fallbackCssUrl === forceStyle){\r\n      fallbackCssUrl = request.style\r\n    } \r\n  } else if(fallbackCssUrl === url){\r\n    fallbackCssUrl = null\r\n  }\r\n  return loadAppCss(url, customSignatureRule, fallbackCssUrl)\r\n}\r\n\r\nexport function resolveData (request) {\r\n  if (request.url) {\r\n    return getSrcData(request.url).then(nxdata => {\r\n      return nxdata\r\n    })\r\n  }\r\n  return Promise.reject(new Error(0))\r\n}\r\n\r\nexport function initAll (options = {}) {\r\n  var seed = {}\r\n  seed.options = Object.assign({}, defaultInitOptions, options)\r\n  setCookie()\r\n  initLogger(seed.options.forceLog)\r\n  seed.nxelm = retrieveNxElm(seed.options.customSelector)\r\n  seed.request = getRequest(seed.nxelm, seed.options.appDefaultCss, seed.options.appDefaultCssAliases, seed.options.appDefaultLang)\r\n    return resolveTheme(seed.request, seed.options.appDefaultCss, seed.options.forceStyle, seed.options.customSignatureRule)\r\n    .then((styleUrl) => {\r\n      seed.styleUrl = styleUrl\r\n      return resolveData(seed.request)\r\n    }).then(nxdata => {\r\n      seed.nxdata = nxdata\r\n      return seed\r\n    }).catch(err => {\r\n      var msg = err.message\r\n      if (!Number.isInteger(msg)) {\r\n        logErr('Nexus Init Failed', msg)\r\n        msg = 400\r\n      }\r\n      throw new Error(msg)\r\n    })\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { isValidHttpUrl } from '@i-is-as-i-does/jack-js/src/modules/Web'\r\nimport { splitUrlAndId, isValidId } from '../validt/NxStamper.js'\r\nimport { defaultLang, defaultStyle } from './NxDefaults.js'\r\nimport { getAbsoluteUrl, splitCurrentUrl } from './NxHost.js'\r\n\r\nexport function getRequest (NxElm, appDefaultCss = null, appDefaultCssAliases = [], appDefaultLang = null) {\r\n  if(!appDefaultCss){\r\n    appDefaultCss = defaultStyle\r\n  }\r\n  if(!appDefaultLang){\r\n    appDefaultLang = defaultLang\r\n  }\r\n  var request = {\r\n    url: null,\r\n    id: '',\r\n    style: appDefaultCss,\r\n    lang: appDefaultLang\r\n  }\r\n\r\n  if (NxElm && NxElm.dataset) {\r\n    if (NxElm.dataset.src) {\r\n      var split = splitUrlAndId(getAbsoluteUrl(NxElm.dataset.src))\r\n\r\n      if (split.url) {\r\n        request.url = split.url\r\n        request.id = split.id\r\n      }\r\n    }\r\n    if (NxElm.dataset.id && isValidId(NxElm.dataset.id)) {\r\n      request.id = NxElm.dataset.id // @doc: id specified in data-id trumps id contained in src url\r\n    }\r\n    if (NxElm.dataset.style && NxElm.dataset.style !== request.style && !appDefaultCssAliases.includes(NxElm.dataset.style)) {\r\n      var cssUrl = getAbsoluteUrl(NxElm.dataset.style)\r\n      if (isValidHttpUrl(cssUrl)) {\r\n        request.style = cssUrl\r\n      }\r\n    }\r\n    if (NxElm.dataset.lang) {\r\n      request.lang = NxElm.dataset.lang\r\n    }\r\n  }\r\n  if (splitCurrentUrl.id) {\r\n    request.id = splitCurrentUrl.id // @doc: id specified in url trumps all\r\n  }\r\n  return request\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { loadJson } from '@i-is-as-i-does/jack-js/src/modules/Web'\r\nimport { logErr } from '../logs/NxLog.js'\r\nimport { getStoredData, registerData } from '../storg/NxMemory.js'\r\nimport { validData } from '../validt/NxStamper.js'\r\n\r\nexport function getThreadsList (nxdata) {\r\n  var list = []\r\n  nxdata.threads.forEach((thread) => {\r\n    list.push(thread.id)\r\n  })\r\n  return list\r\n}\r\n\r\nexport function loadSrc (url) {\r\n  // @doc: src should not contain #id\r\n  return loadJson(url)\r\n\r\n    .then((nxdata) => {\r\n      nxdata = validData(nxdata)\r\n\r\n      if (nxdata) {\r\n        registerData(url, nxdata)\r\n        return nxdata\r\n      }\r\n      logErr('Invalid source', url)\r\n      return Promise.reject(new Error(400))\r\n    })\r\n    .catch((err) => {\r\n      var code = 400\r\n      if (err.message !== 400) {\r\n        code = 404\r\n        logErr('No response', err.message)\r\n      }\r\n      registerData(url, code)\r\n      return Promise.reject(new Error(code))\r\n    })\r\n}\r\n\r\nexport function prcFileSrc (readerEvent, skipValidt = false) {\r\n  var nxdata = JSON.parse(readerEvent.target.result)\r\n  if (nxdata) {\r\n    if(skipValidt){\r\n      return nxdata\r\n    }\r\n    nxdata = validData(nxdata)\r\n    if (nxdata) {\r\n      return nxdata\r\n    }\r\n  }\r\n  return false\r\n}\r\n\r\nexport function loadSrcFile (inputEvt, skipValidt = false) {\r\n  if (inputEvt.target.files.length) {\r\n    if (inputEvt.target.files[0].type === 'application/json') {\r\n      return new Promise((resolve, reject) => {\r\n        var reader = new FileReader()\r\n        reader.onload = function (event) {\r\n          var nxdata = prcFileSrc(event, skipValidt)\r\n          if (nxdata) {\r\n            resolve(nxdata)\r\n          } else {\r\n            logErr('Invalid source', inputEvt.target.files[0])\r\n            reject(new Error(400))\r\n          }\r\n        }\r\n        return reader.readAsText(inputEvt.target.files[0])\r\n      })\r\n    }\r\n    logErr('Invalid file type', inputEvt.target.files[0])\r\n    return Promise.reject(new Error(400))\r\n  }\r\n  logErr('No file selected')\r\n  return Promise.reject(new Error(400))\r\n}\r\n\r\nexport function getSrcData (url) {\r\n  // @doc: url should not contain #id\r\n  var nxdata = getStoredData(url)\r\n  if (nxdata !== null) {\r\n    if (Number.isInteger(nxdata)) {\r\n      return Promise.reject(new Error(nxdata))\r\n    }\r\n    return Promise.resolve(nxdata)\r\n  }\r\n  return loadSrc(url)\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { loadCss, pageHasSheet } from '@i-is-as-i-does/jack-js/src/modules/Web'\r\nimport { logErr } from '../logs/NxLog.js'\r\nimport { defaultSignatureRule, defaultStyle } from '../base/NxDefaults.js'\r\n\r\nexport function loadAppCss (url = null, signatureRule = null, fallbackUrl = null) {\r\n  if (!url) {\r\n    url = defaultStyle\r\n  }\r\n  if (!signatureRule) {\r\n    signatureRule = defaultSignatureRule\r\n  }\r\n  if (!fallbackUrl && url !== defaultStyle) {\r\n    fallbackUrl = defaultStyle\r\n  }\r\n  return loadCss(signatureRule, url)\r\n    .then(() => {\r\n      return Promise.resolve(url)\r\n    }).catch((err) => {\r\n      logErr('Theme not found', err.message)\r\n      if (fallbackUrl) {\r\n        return loadAppCss(fallbackUrl)\r\n      } else {\r\n        return Promise.reject(new Error(404))\r\n      }\r\n    })\r\n}\r\n\r\nexport function isCssLoaded (url = null, signatureRule = null) {\r\n  if (!url) {\r\n    url = defaultStyle\r\n  }\r\n  if (!signatureRule) {\r\n    signatureRule = defaultSignatureRule\r\n  }\r\n  return pageHasSheet(signatureRule, defaultStyle)\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nvar errors = []\r\nvar consoleLog = false\r\n\r\nexport function setConsoleLog (bool = true) {\r\n  consoleLog = bool\r\n}\r\nexport function clearErr () {\r\n  errors = []\r\n}\r\n\r\nexport function logErr (msg, detail = null) {\r\n  var entry = { msg: msg }\r\n  if (detail) {\r\n    entry.detail = detail\r\n  }\r\n  errors.push(entry)\r\n  if (consoleLog) {\r\n    console.log('Nexus/Error: ' + JSON.stringify(entry))\r\n  }\r\n}\r\n\r\nexport function getErr () {\r\n  return errors\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nimport { getStoredItem, removeItem, storeItem } from './NxStorage.js'\r\n\r\nvar visitStore = {}\r\nvar dataStore = {}\r\nvar linkedStore = {}\r\n\r\nvar oembedStore = {}\r\nconst editpsrcix = 'nx-edit#'\r\n\r\nfunction threadLastSeenDate (src) {\r\n  return getStoredItem(src, 'local', visitStore)\r\n}\r\n\r\nexport function registerEditData (url, nxdata) {\r\n  storeItem(editpsrcix + url, nxdata, 'local')\r\n}\r\n\r\nexport function getStoredEditData (url) {\r\n  return getStoredItem(editpsrcix + url, 'local')\r\n}\r\n\r\nexport function registerThreadVisit (src, timestamp) {\r\n  if (!Object.prototype.hasOwnProperty.call(visitStore, src)) {\r\n    storeItem(src, timestamp, 'local', visitStore)\r\n  }\r\n}\r\n\r\nexport function isThreadContentUnseen (src, timestamp) {\r\n  var lastKnownDate = threadLastSeenDate(src)\r\n\r\n  if (!lastKnownDate) {\r\n    return true\r\n  }\r\n  if (timestamp && lastKnownDate !== timestamp) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function clearData (url) {\r\n  removeItem(url, 'session', dataStore)\r\n}\r\n\r\nexport function registerData (url, nxdata) {\r\n  storeItem(url, nxdata, 'session', dataStore)\r\n}\r\n\r\nexport function registerLinkedMaps (src, map) {\r\n  storeItem(src + ':linked', map, 'session', linkedStore)\r\n}\r\n\r\nexport function getStoredLinkedMaps (src) {\r\n  return getStoredItem(src + ':linked', 'session', linkedStore)\r\n}\r\n\r\nexport function getStoredData (url) {\r\n  return getStoredItem(url, 'session', dataStore)\r\n}\r\n\r\nexport function registerOembedResponse (givenUrl, response) {\r\n  storeItem(givenUrl, response, 'local', oembedStore)\r\n}\r\n\r\nexport function getStoredOembedResponse (givenUrl) {\r\n  return getStoredItem(givenUrl, 'local', oembedStore)\r\n}\r\n\r\nexport function setStoredLang (lang) {\r\n  storeItem('nx-lang', lang, 'local')\r\n}\r\nexport function getStoredLang () {\r\n  return getStoredItem('nx-lang', 'local')\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport {\r\n  clearPartialStorage,\r\n  getLocalStorage,\r\n  getSessionStorage,\r\n  jsonSize\r\n} from '@i-is-as-i-does/jack-js/src/modules/Stock'\r\n\r\nconst locStorag = getLocalStorage()\r\nconst sesStorag = getSessionStorage()\r\n\r\nfunction setStorageAvailability (store) {\r\n  if (store && !store.getItem('available')) {\r\n    store.setItem('available', 5000)\r\n  }\r\n}\r\n\r\nfunction resolveStore (storage) {\r\n  if (storage === 'session') {\r\n    return sesStorag\r\n  }\r\n  return locStorag\r\n}\r\n\r\nsetStorageAvailability(locStorag)\r\nsetStorageAvailability(sesStorag)\r\n\r\nexport function storeItem (key, data, storage = 'session', instanceStore = null) {\r\n  var sdata = JSON.stringify(data)\r\n  if (instanceStore) {\r\n    instanceStore[key] = sdata\r\n  }\r\n  var store = resolveStore(storage)\r\n  if (store != null) {\r\n    var datasize = jsonSize(sdata, true, true)\r\n    if (datasize > 2000) {\r\n      return\r\n    }\r\n\r\n    var avail = store.getItem('available')\r\n    if (avail < 1000) {\r\n      avail = 5000 - clearPartialStorage(store, 2000)\r\n    }\r\n    avail -= datasize\r\n    store.setItem(key, sdata)\r\n    store.setItem('available', Math.ceil(avail))\r\n  }\r\n}\r\n\r\nexport function getStoredItem (key, storage = 'session', instanceStore = null) {\r\n  if (instanceStore !== null && Object.prototype.hasOwnProperty.call(instanceStore, key)) {\r\n    return JSON.parse(instanceStore[key])\r\n  }\r\n  var store = resolveStore(storage)\r\n  if (store) {\r\n    var sdata = store.getItem(key)\r\n    if (sdata) {\r\n      if (instanceStore) {\r\n        instanceStore[key] = sdata\r\n      }\r\n      return JSON.parse(sdata)\r\n    }\r\n  }\r\n  return null\r\n}\r\n\r\nexport function removeItem (key, storage = 'session', instanceStore = null) {\r\n  if (instanceStore & Object.prototype.hasOwnProperty.call(instanceStore, key)) {\r\n    delete instanceStore[key]\r\n  }\r\n  var store = resolveStore(storage)\r\n  if (store) {\r\n    store.removeItem(key)\r\n  }\r\n}\r\nexport function clearCache () {\r\n  [sesStorag, locStorag].forEach(store => {\r\n    if (store) {\r\n      store.clear()\r\n    }\r\n  })\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { isNonEmptyObj, isNonEmptyStr } from '@i-is-as-i-does/jack-js/src/modules/Check'\r\nimport { getStoredLang, setStoredLang } from '../storg/NxMemory.js'\r\nimport { NxTranslations } from './NxTranslations.js'\r\n\r\nvar txts = NxTranslations\r\nvar availableLangs = Object.keys(txts)\r\navailableLangs.push('en')\r\n\r\nvar storedLang = getStoredLang()\r\nif (storedLang != null && !langIsAvailable(storedLang)) {\r\n  storedLang = null\r\n  setStoredLang(null)\r\n}\r\n\r\nvar currentLang = null\r\nif (storedLang) {\r\n  currentLang = storedLang\r\n} else {\r\n  currentLang = document.querySelector('html').lang\r\n  if (!langIsAvailable(currentLang)) {\r\n    currentLang = 'en'\r\n  }\r\n}\r\n\r\nfunction updateStorage (lang) {\r\n  if (storedLang !== lang) {\r\n    setStoredLang(lang)\r\n    storedLang = lang\r\n  }\r\n}\r\n\r\nexport function setOriginLang (lang) {\r\n  // @doc lang should be seed.request.lang from NxInit, or custom one\r\n  if (!storedLang) {\r\n    setUserSelectedLang(lang)\r\n  }\r\n}\r\n\r\nexport function setAdtTranslations (translObj) {\r\n  if (isNonEmptyObj(translObj)) {\r\n    Object.assign(txts, translObj) // @todo: test if works as expected from nested props\r\n    availableLangs.push(\r\n      ...Object.keys(txts).filter(\r\n        (item) => availableLangs.indexOf(item) < 0\r\n      )\r\n    )\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function langIsAvailable (lang) {\r\n  return isNonEmptyStr(lang) && availableLangs.includes(lang)\r\n}\r\n\r\nexport function setUserSelectedLang (lang) {\r\n  if (langIsAvailable(lang) && lang !== currentLang) {\r\n    currentLang = lang\r\n    updateStorage(lang)\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function getAvailableLangs () {\r\n  return availableLangs\r\n}\r\n\r\nexport function getLang () {\r\n  return currentLang\r\n}\r\n\r\nexport function getTxt (key) {\r\n  var text = key\r\n  if (currentLang !== 'en' && txts[currentLang][key]) {\r\n    text = txts[currentLang][key]\r\n  }\r\n  return text\r\n}","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nexport const NxTranslations = {\r\n  fr: {\r\n    author: 'auteurÂ·e',\r\n    handle: 'pseudonyme',\r\n    about: 'Ã  propos',\r\n    url: 'url',\r\n    id: 'id',\r\n    title: 'titre',\r\n    description: 'description',\r\n    timestamp: 'date',\r\n    main: 'corps',\r\n    aside: 'apartÃ©',\r\n    media: 'mÃ©dia',\r\n    type: 'type',\r\n    caption: 'lÃ©gende',\r\n    index: 'index',\r\n    distant: 'distant',\r\n    local: 'local',\r\n    threads: 'fils',\r\n    linked: 'liÃ©s',\r\n    content: 'contenu',\r\n    history: 'historique',\r\n    copied: 'copiÃ©',\r\n    embed: 'intÃ©grÃ©',\r\n    source: 'source',\r\n    saved: 'sauvegardÃ©',\r\n    'local thread': 'fil local',\r\n    'linked threads': 'fils liÃ©s',\r\n    'No valid thread': 'Aucun fil valide',\r\n    'Duplicate thread id': 'Identifiant du fil en double',\r\n    'Duplicate linked thread': 'Fil liÃ© en double',\r\n    'Invalid linked thread': 'Fil liÃ© non valide',\r\n    'Invalid url': 'Url non valide',\r\n    'Invalid thread id': 'Identifiant de fil non valide',\r\n    'Invalid length': 'Longueur non valide',\r\n    'Invalid min length': 'Longueur minimale non valide',\r\n    'Invalid max length': 'Longueur maximale non valide',\r\n    'Unable to cut string': 'Impossible de raccourcir le texte',\r\n    'Invalid timestamp': 'Horodatage non valide',\r\n    'Unknown field': 'Champ inconnu',\r\n    'Invalid field type': 'Type de champ non valide',\r\n    'Field is empty': 'Le champ est vide',\r\n    'Unable to extend string': 'Impossible de prolonger le texte',\r\n    'Unknown characters limits category':\r\n    'CatÃ©gorie de limite de caractÃ¨res inconnue',\r\n    'Unknown items limits category': \"CatÃ©gorie de limite d'Ã©lÃ©ments inconnue\",\r\n    'Invalid media type': 'Type de media non valide',\r\n    'Invalid app url': \"Url de l'application non valide\",\r\n    'Too many linked threads': 'Trop de fils liÃ©s',\r\n    'Too many threads': 'Trop de fils',\r\n    'Init failed': \"L'initialisation a Ã©chouÃ©\",\r\n    'Theme not found': 'ThÃ¨me non trouvÃ©',\r\n    'No response': 'Aucune rÃ©ponse',\r\n    'Invalid source': 'Source non valide',\r\n    'Invalid Nexus data': 'DonnÃ©es Nexus non valides'\r\n  }\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { getTxt, setUserSelectedLang } from './NxCoreTranslate.js'\r\nimport { vSplitFlap } from '@i-is-as-i-does/valva/src/modules/transitions'\r\n\r\nvar translStore = {}\r\n\r\nexport function updateTextElm (elm, textkey) {\r\n  vSplitFlap(elm, getTxt(textkey), 50)\r\n}\r\n\r\nexport function triggerTranslate (lang) {\r\n  if (setUserSelectedLang(lang)) {\r\n    for (const [textkey, elms] of Object.entries(translStore)) {\r\n      elms.forEach((elm) => {\r\n        updateTextElm(elm, textkey)\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport function registerTranslElm (elm, textkey) {\r\n  if (!translStore[textkey]) {\r\n    translStore[textkey] = []\r\n  }\r\n  translStore[textkey].push(elm)\r\n}\r\n","/* eslint-disable no-useless-escape */\r\n/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nexport const appUrl = 'https://nexus-dock.github.io/'\r\nexport const typesMap = {\r\n  nxdata: 'Object',\r\n  nexus: 'String',\r\n  author: 'Object',\r\n  handle: 'String',\r\n  about: 'String',\r\n  url: 'String',\r\n  threads: 'Array',\r\n  'threads.item': 'Object',\r\n  id: 'String',\r\n  title: 'String',\r\n  description: 'String',\r\n  content: 'Object',\r\n  timestamp: 'String',\r\n  main: 'String',\r\n  aside: 'String',\r\n  media: 'Object',\r\n  type: 'String',\r\n  caption: 'String',\r\n  linked: 'Array',\r\n  'linked.item': 'String'\r\n}\r\nexport const required = ['nexus', 'author', 'threads', 'handle', 'url', 'id', 'title', 'content', 'timestamp', 'main', 'type']\r\nexport const charMinMax = {\r\n  handle: [3, 30],\r\n  about: [0, 400],\r\n  title: [3, 30],\r\n  description: [0, 400],\r\n  main: [1, 1000],\r\n  aside: [0, 400],\r\n  caption: [0, 200]\r\n}\r\nexport const itemsMinMax = {\r\n  threads: [1, 100],\r\n  linked: [0, 100]\r\n}\r\nexport const supportedOembedMedia = [\r\n  'youtube',\r\n  'vimeo',\r\n  'soundcloud'\r\n]\r\nexport const supportedBaseMedia = [\r\n  'page',\r\n  'video',\r\n  'image',\r\n  'audio'\r\n]\r\nexport const supportedMediaTypes = supportedBaseMedia.concat(supportedOembedMedia)\r\nexport const timestampPattern =\r\n    '^[0-9]{4}(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2][0-9]|3[0-1]))?((T|\\s)(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]))?)?$'\r\nexport const idPattern = '^[a-zA-Z0-9-]{3,36}$'\r\nexport const urlPattern = '^https?:\\/\\/.*'\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport {\r\n  isEmpty,\r\n  isNonEmptyObj,\r\n  seemsLikeValidDate\r\n} from '@i-is-as-i-does/jack-js/src/modules/Check'\r\nimport {\r\n  charCut\r\n} from '@i-is-as-i-does/jack-js/src/modules/Help'\r\nimport {\r\n  isValidHttpUrl\r\n} from '@i-is-as-i-does/jack-js/src/modules/Web'\r\n\r\nimport {\r\n  charMinMax,\r\n  itemsMinMax,\r\n  appUrl,\r\n  supportedMediaTypes,\r\n  timestampPattern,\r\n  idPattern,\r\n  typesMap\r\n} from './NxSpecs.js'\r\nimport { logErr } from '../logs/NxLog.js'\r\nimport { getAbsoluteUrl } from '../base/NxHost.js'\r\nimport { initLogger } from '../load/NxInit.js'\r\n\r\nexport function charLimits (catg) {\r\n  if (Object.prototype.hasOwnProperty.call(charMinMax, catg)) {\r\n    return charMinMax[catg]\r\n  }\r\n  logErr('Unknown characters limits category', catg)\r\n  return false\r\n}\r\n\r\nexport function itmLimits (catg) {\r\n  if (Object.prototype.hasOwnProperty.call(itemsMinMax, catg)) {\r\n    return itemsMinMax[catg]\r\n  }\r\n  logErr('Unknown items limits category', catg)\r\n  return false\r\n}\r\n\r\nexport function isValidMediaType (mediaType) {\r\n  if (\r\n    hasValidType(mediaType, 'type', true) &&\r\n      supportedMediaTypes.includes(mediaType)\r\n  ) {\r\n    return true\r\n  }\r\n\r\n  logErr('Invalid media type', mediaType)\r\n  return false\r\n}\r\n\r\nexport function extendString (str, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    var diff = limits[0] - str.length\r\n    if (diff > 0) {\r\n      var placeholder = '-'\r\n      str = placeholder.repeat(diff) + str\r\n    }\r\n    return str\r\n  }\r\n  logErr('Unable to extend string', catg)\r\n  return null\r\n}\r\n\r\nexport function validLenghtStr (str, catg, nonEmpty = true) {\r\n  if (!hasValidType(str, catg, nonEmpty)) {\r\n    str = ''\r\n  }\r\n  if (!strHasValidMinLength(str, catg)) {\r\n    str = extendString(str, catg)\r\n  } else if (!strHasValidMaxLength(str, catg)) {\r\n    str = cutString(str, catg)\r\n  }\r\n  return str\r\n}\r\n\r\nexport function hasValidType (item, field, nonEmpty = true) {\r\n  if (Object.prototype.hasOwnProperty.call(typesMap, field)) {\r\n    var type = typesMap[field]\r\n    if (\r\n      typeof item !== 'undefined' &&\r\n        item !== null &&\r\n        item.constructor.name === type\r\n    ) {\r\n      if (!nonEmpty || !isEmpty(item)) {\r\n        return true\r\n      }\r\n      logErr('Field is empty', field)\r\n    } else {\r\n      logErr('Invalid field type', field)\r\n    }\r\n  } else {\r\n    logErr('Unknown field', field)\r\n  }\r\n\r\n  return false\r\n}\r\n\r\nexport function validMedia (mediaObj) {\r\n  if (\r\n    hasValidType(mediaObj, 'media', true) &&\r\n      isValidUrl(mediaObj.url) &&\r\n      isValidMediaType(mediaObj.type)\r\n  ) {\r\n    var m = {}\r\n    m.url = mediaObj.url\r\n    m.type = mediaObj.type\r\n    m.caption = ''\r\n    if (mediaObj.caption) {\r\n      m.caption = validLenghtStr(mediaObj.caption, 'caption', false)\r\n    }\r\n    return m\r\n  }\r\n  return { url: '', type: '', caption: '' }\r\n}\r\n\r\nexport function isValidTimestamp (timestamp, strict = false) {\r\n  if (\r\n    hasValidType(timestamp, 'timestamp', true) &&\r\n      (timestamp.match(timestampPattern) ||\r\n        (!strict && seemsLikeValidDate(timestamp)))\r\n  ) {\r\n    return true\r\n  }\r\n  logErr('Invalid timestamp', timestamp)\r\n  return false\r\n}\r\n\r\nexport function validContent (content) {\r\n  if (\r\n    hasValidType(content, 'content', true) &&\r\n      isValidTimestamp(content.timestamp) &&\r\n      hasValidType(content.main, 'main', true)\r\n  ) {\r\n    var main = validLenghtStr(content.main, 'main')\r\n\r\n    if (main) {\r\n      var c = {}\r\n      c.timestamp = content.timestamp\r\n      c.main = main\r\n      c.aside = ''\r\n      if (content.aside) {\r\n        c.aside = validLenghtStr(content.aside, 'aside', false)\r\n      }\r\n      c.media = validMedia(content.media)\r\n      return c\r\n    }\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nexport function cutString (item, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    return charCut(item, limits[1])\r\n  }\r\n  logErr('Unable to cut string', catg)\r\n  return ''\r\n}\r\n\r\nexport function strHasValidMaxLength (item, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    if (item.length <= limits[1]) {\r\n      return true\r\n    }\r\n    logErr('Invalid max length', catg)\r\n  }\r\n  return false\r\n}\r\nexport function strHasValidMinLength (item, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    if (item.length >= limits[0]) {\r\n      return true\r\n    }\r\n    logErr('Invalid min length', catg)\r\n  }\r\n  return false\r\n}\r\n\r\nexport function hasValidLength (item, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    if (item.length >= limits[0] && item.length <= limits[1]) {\r\n      return true\r\n    }\r\n    logErr('Invalid length', catg)\r\n  }\r\n  return false\r\n}\r\n\r\nexport function splitUrlAndId (url) {\r\n  var rt = {\r\n    url: null,\r\n    id: ''\r\n  }\r\n  if (isValidHttpUrl(url)) {\r\n    rt.url = url\r\n\r\n    if (url.includes('#')) {\r\n      var sp = url.split('#')\r\n      var id = sp.pop()\r\n      rt.url = sp.join('#')\r\n      if (id && isValidId(id)) {\r\n        rt.id = id\r\n      }\r\n    }\r\n  }\r\n\r\n  return rt\r\n}\r\n\r\nexport function isValidId (id) {\r\n  if (hasValidType(id, 'id', true) && id.match(idPattern)) {\r\n    return true\r\n  }\r\n\r\n  logErr('Invalid thread id', id)\r\n  return false\r\n}\r\n\r\nexport function isValidUrl (url) {\r\n  if (isValidHttpUrl(url)) {\r\n    return true\r\n  }\r\n  logErr('Invalid url', url)\r\n  return false\r\n}\r\n\r\nexport function isValidLinkItm (link) {\r\n  if (\r\n    hasValidType(link, 'linked.item', true) &&\r\n      isValidUrl(link)\r\n  ) {\r\n    return true\r\n  }\r\n  logErr('Invalid linked thread')\r\n  return false\r\n}\r\n\r\n\r\nexport function isValidLegacyLinkItm(item){\r\n  return isNonEmptyObj(item) && isValidUrl(item.url) && (!item.id || item.id === '/' || isValidId(item.id))\r\n}\r\n\r\nexport function getValidSrcUrl (url, id) {\r\n  url = getAbsoluteUrl(url)\r\n  if (isValidUrl(url)) {\r\n    if (id && isValidId(id)) {\r\n      url += '#' + id\r\n    }\r\n    return url\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function validLinks (linked) {\r\n  var vlinked = []\r\n  if (hasValidType(linked, 'linked', false)) {\r\n    var len = linked.length\r\n    var limit = itmLimits('linked')[1]\r\n    if (len > limit) {\r\n      logErr('Too many linked threads', len + ' /' + limit)\r\n      len = limit\r\n    }\r\n    for (var i = 0; i < len; i++) {\r\n      var url = null\r\n      if (isValidLinkItm(linked[i])) {\r\n        var split = splitUrlAndId(linked[i])\r\n        url = split.url\r\n        if (split.id) {\r\n          url += '#' + split.id\r\n        }\r\n      } else if(isValidLegacyLinkItm(linked[i])){\r\n        url = linked[i].url\r\n        if (linked[i].id && linked[i].id !== '/') {\r\n          url += '#' + linked[i].id\r\n        }\r\n      }\r\n\r\n        if(url){\r\n        if (!vlinked.includes(url)) {\r\n          vlinked.push(url)\r\n        } else {\r\n          logErr('Duplicate linked thread', url)\r\n        }\r\n      }\r\n        \r\n      }\r\n    }\r\n  return vlinked\r\n}\r\n\r\nexport function validThread (thread) {\r\n  if (\r\n    hasValidType(thread, 'threads.item', true) &&\r\n      isValidId(thread.id)\r\n  ) {\r\n    var content = validContent(thread.content)\r\n    if (content != null) {\r\n      var t = {}\r\n      t.id = thread.id\r\n      t.title = validLenghtStr(thread.title, 'title')\r\n      t.description = ''\r\n      if (thread.description) {\r\n        t.description = validLenghtStr(\r\n          thread.description,\r\n          'description', false\r\n        )\r\n      }\r\n\r\n      t.content = content\r\n      t.linked = validLinks(thread.linked)\r\n      return t\r\n    }\r\n  }\r\n  return null\r\n}\r\n\r\nexport function validThreads (threads) {\r\n  var vthreads = []\r\n\r\n  if (hasValidType(threads, 'threads', true)) {\r\n    var len = threads.length\r\n    var limit = itmLimits('threads')[1]\r\n    if (len > limit) {\r\n      logErr('Too many threads', len + ' /' + limit)\r\n      len = limit\r\n    }\r\n    var ids = []\r\n    for (var i = 0; i < len; i++) {\r\n      var thread = validThread(threads[i])\r\n\r\n      if (thread !== null) {\r\n        if (!ids.includes(thread.id)) {\r\n          ids.push(thread.id)\r\n          vthreads.push(thread)\r\n          continue\r\n        }\r\n        logErr('Duplicate thread id', thread.id)\r\n      }\r\n    }\r\n\r\n    if (vthreads.length) {\r\n      return vthreads\r\n    }\r\n  }\r\n  logErr('No valid thread')\r\n  return []\r\n}\r\n\r\nexport function validAuthor (author) {\r\n  if (\r\n    hasValidType(author, 'author', true) &&\r\n      isValidUrl(author.url)\r\n  ) {\r\n    var handle = validLenghtStr(author.handle, 'handle')\r\n    if (handle) {\r\n      var a = {}\r\n      a.handle = handle\r\n      a.about = ''\r\n      if (author.about) {\r\n        a.about = validLenghtStr(author.about, 'about', false)\r\n      }\r\n      a.url = author.url\r\n      return a\r\n    }\r\n  }\r\n  return null\r\n}\r\nexport function isValidAppUrl (url) {\r\n  if (isValidUrl(url) && url === appUrl) {\r\n    return true\r\n  }\r\n  logErr('Invalid app url')\r\n  return false\r\n}\r\nexport function validAppUrl (url) {\r\n  if (!isValidAppUrl(url)) {\r\n    url = appUrl\r\n  }\r\n  return url\r\n}\r\n\r\nexport function validData (nxdata) {\r\n  if (hasValidType(nxdata, 'nxdata', true)) {\r\n    var d = {}\r\n    d.nexus = validAppUrl(nxdata.nexus)\r\n    d.author = validAuthor(nxdata.author)\r\n    if (d.author) {\r\n      d.threads = validThreads(nxdata.threads)\r\n      if (d.threads.length) {\r\n        return d\r\n      }\r\n    }\r\n  }\r\n  return null\r\n}\r\n","/* VÃ¢lvÄƒ | (c) 2021-22 I-is-as-I-does | MIT License */\r\nconst props = {\r\n    spacing: ['padding-top', 'padding-bottom', 'margin-top', 'margin-bottom'],\r\n    transitions: ['transition-duration', 'transition-timing-function', 'transition-property'],\r\n    heights: ['height', 'overflow']\r\n}\r\n\r\nconst slide = {\r\n    target: 'height, margin, padding',\r\n    toReset: ['height'].concat(props.spacing),\r\n    removeInFirst: props.spacing,\r\n    removeInThen: props.heights.concat(props.transitions),\r\n    removeOut: props.heights.concat(props.spacing, props.transitions)\r\n}\r\n\r\nconst fade = {\r\n    target: 'opacity',\r\n    toReset: ['opacity'],\r\n    removeInFirst: ['opacity'],\r\n    removeInThen: props.transitions,\r\n    removeOut: ['opacity'].concat(props.transitions)\r\n}\r\nconst ease = {\r\n    target: slide.target + ', ' + fade.target,\r\n    toReset: ['opacity'].concat(slide.toReset),\r\n    removeInFirst: props.spacing.concat(['opacity']),\r\n    removeInThen: slide.removeInThen,\r\n    removeOut: ['opacity'].concat(slide.removeOut)\r\n}\r\n\r\nexport const profl = {\r\n    slide: slide,\r\n    fade: fade,\r\n    ease: ease\r\n}\r\n\r\nexport const deflt = {\r\n    type: 'ease',\r\n    duration: 300,\r\n    callback: null,\r\n    timing: 'ease-in-out',\r\n    delay: 1000, // vTempToggle\r\n    reverse: false, // vToggleResolve\r\n    prepend: false // vPlace\r\n}","/* VÃ¢lvÄƒ | (c) 2021-22 I-is-as-I-does | MIT License */\r\n\r\nimport { vShow, vHide, vToggle, vTempToggle, vToggleResolve, vPlace, vReplace, vSplitFlap } from './transitions.js'\r\nimport { deflt } from './constants.js'\r\n\r\n// @doc: Valva v.1 support\r\n\r\nexport function easeOut(elm, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    vHide(elm, 'ease', duration, callback, timing)\r\n}\r\nexport function easeIn(elm, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    vShow(elm, 'ease', duration, callback, timing)\r\n}\r\nexport function easeToggle(elm, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    vToggle(elm, 'ease', duration, callback, timing)\r\n}\r\nexport function timedEaseToggle(elm, delay = deflt.delay, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    vTempToggle(elm, 'ease', delay, duration, callback, timing)\r\n}\r\n\r\n\r\n\r\nexport function slideUp(elm, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    vHide(elm, 'slide', duration, callback, timing)\r\n}\r\nexport function slideDown(elm, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    vShow(elm, 'slide', duration, callback, timing)\r\n}\r\nexport function slideToggle(elm, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    vToggle(elm, 'slide', duration, callback, timing)\r\n}\r\nexport function timedSlideToggle(elm, delay = deflt.delay, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    vTempToggle(elm, 'slide', delay, duration, callback, timing)\r\n}\r\n\r\n\r\n\r\nexport function fadeOut(elm, callback = null, duration = deflt.duration, timing = deflt.timing) {\r\n    vHide(elm, 'fade', duration, callback, timing)\r\n}\r\nexport function fadeIn(elm, callback = null, duration = deflt.duration, timing = deflt.timing) {\r\n    vShow(elm, 'fade', duration, callback, timing)\r\n}\r\nexport function fadeToggle(elm, callback = null, duration = deflt.duration, timing = deflt.timing) {\r\n    vToggle(elm, 'fade', duration, callback, timing)\r\n}\r\nexport function timedFadeToggle(elm, delay = deflt.delay, callback = null, duration = deflt.duration, timing = deflt.timing) {\r\n    vTempToggle(elm, 'fade', delay, duration, callback, timing)\r\n}\r\n\r\n\r\nexport function diversionToggle(elm, callback = null, ease = true, duration = deflt.duration, reverse = false, timing = deflt.timing) {\r\n    var t = ease ? 'ease' : 'slide'\r\n    vToggleResolve(elm, callback, t, duration, timing, reverse)\r\n}\r\n\r\nexport function insertDiversion(parent, child, prepend = false, ease = true, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n    var t = ease ? 'ease' : 'slide'\r\n    vPlace(parent, child, prepend, t, duration, callback, timing)\r\n}\r\n\r\nexport function replaceDiversion(oldElm, newElm, callback, duration = deflt.duration, timing = deflt.timing) {\r\n    vReplace(oldElm, newElm, duration, callback, timing)\r\n}\r\n\r\nexport function splitFlap(elm, text, speed = deflt.speed) {\r\n    vSplitFlap(elm, text, speed)\r\n}\r\n\r\n\r\nexport * from './transitions.js'","/* VÃ¢lvÄƒ | (c) 2021-22 I-is-as-I-does | MIT License */\r\n\r\nexport function isHidden(elm) {\r\n  if (!elm) return false\r\n  do {\r\n    if (!(elm instanceof Element)) continue\r\n    if (elm.hidden || !elm.offsetHeight) {\r\n      return true\r\n    }\r\n    var style = window.getComputedStyle(elm)\r\n    if (\r\n      style.width === '0' ||\r\n      style.height === '0' ||\r\n      style.opacity === '0' ||\r\n      style.display === 'none' ||\r\n      style.visibility === 'hidden'\r\n    ) {\r\n      return true\r\n    }\r\n  } while ((elm = elm.parentNode))\r\n  return false\r\n}\r\n\r\n\r\nexport function resetDisplay(elm) {\r\n  elm.style.removeProperty('display')\r\n  let display = window.getComputedStyle(elm).display\r\n  if (display === 'none') display = 'block'\r\n  elm.style.display = display\r\n}\r\n","\r\n/* VÃ¢lvÄƒ | (c) 2021-22 I-is-as-I-does | MIT License */\r\n/* eslint-disable no-unused-expressions */\r\n\r\nimport { deflt, profl } from './constants.js'\r\nimport { resetDisplay, isHidden } from './utils.js'\r\n\r\nfunction setTransition(elm, type, duration, timing) {\r\n  elm.style.setProperty('transition-property', profl[type].target)\r\n  elm.style.setProperty('transition-timing-function', timing)\r\n  elm.style.setProperty('transition-duration', duration + 'ms')\r\n}\r\n\r\nfunction resetStyle(elm, type) {\r\n  profl[type].toReset.forEach(p => {\r\n    elm.style.setProperty(p, 0)\r\n  })\r\n}\r\n\r\nfunction removeProp(elm, type, key) {\r\n\r\n  profl[type][key].forEach(p => {\r\n    elm.style.removeProperty(p)\r\n  })\r\n}\r\n\r\n\r\nfunction changeThenAct(parent, child, placeAction, placeCallBack) {\r\n  if (!(parent instanceof Element)) {\r\n    parent = document.body\r\n  }\r\n\r\n  var tmpclass = 'm' + Math.random().toString(20).substring(2)\r\n  child.classList.add(tmpclass)\r\n\r\n  return new Promise((resolve) => {\r\n    var observer = new MutationObserver(() => {\r\n      if (parent.querySelector('.' + tmpclass)) {\r\n        child.classList.remove(tmpclass)\r\n        observer.disconnect()\r\n        placeCallBack()\r\n        resolve(true)\r\n      }\r\n    })\r\n    observer.observe(parent, {\r\n      childList: true\r\n    })\r\n    placeAction()\r\n  })\r\n}\r\n\r\n\r\nexport function vHide(elm, type = deflt.type, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  setTransition(elm, type, duration, timing)\r\n  if (type !== 'fade') {\r\n    elm.style.setProperty('box-sizing', 'border-box')\r\n    elm.style.setProperty('height', elm.offsetHeight + 'px')\r\n    elm.offsetHeight\r\n    elm.style.setProperty('overflow', 'hidden')\r\n  }\r\n  resetStyle(elm, type)\r\n  window.setTimeout(() => {\r\n    elm.style.setProperty('display', 'none')\r\n    removeProp(elm, type, 'removeOut')\r\n    if (typeof callback === 'function') {\r\n      callback()\r\n    }\r\n  }, duration)\r\n}\r\n\r\nexport function vShow(elm, type = deflt.type, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  if (type === 'fade') {\r\n    resetStyle(elm, 'fade')\r\n    resetDisplay(elm)\r\n    setTransition(elm, 'fade', duration, timing)\r\n  } else {\r\n    resetDisplay(elm)\r\n    var height = elm.offsetHeight\r\n    elm.style.setProperty('overflow', 'hidden')\r\n    resetStyle(elm, type)\r\n    elm.offsetHeight\r\n    elm.style.setProperty('box-sizing', 'border-box')\r\n    setTransition(elm, type, duration, timing)\r\n    elm.style.setProperty('height', height + 'px')\r\n  }\r\n  removeProp(elm, type, 'removeInFirst')\r\n  window.setTimeout(() => {\r\n    removeProp(elm, type, 'removeInThen')\r\n    if (typeof callback === 'function') {\r\n      callback()\r\n    }\r\n  }, duration)\r\n}\r\n\r\nexport function vToggle(elm, type = deflt.type, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  if (isHidden(elm)) {\r\n    vShow(elm, type, duration, callback, timing)\r\n  } else {\r\n    vHide(elm, type, duration, callback, timing)\r\n  }\r\n}\r\nexport function vTempToggle(elm, type = deflt.type, delay = deflt.delay, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  var methods = [vHide, vShow]\r\n  if (isHidden(elm)) {\r\n    methods.reverse()\r\n  }\r\n  var transcallback = function () {\r\n    if (typeof callback === 'function') {\r\n      callback()\r\n    }\r\n    window.setTimeout(() => {\r\n      methods[1](elm, type, duration, callback, timing)\r\n    }, delay)\r\n  }\r\n\r\n  methods[0](elm, type, duration, transcallback, timing)\r\n}\r\n\r\nexport function vToggleResolve(\r\n  elm,\r\n  callback = null,\r\n  type = deflt.type,\r\n  duration = deflt.duration,\r\n  timing = deflt.timing,\r\n  reverse = false\r\n) {\r\n  if (typeof callback !== 'function') {\r\n    callback = function () { }\r\n  }\r\n  var methods = [vHide, vShow]\r\n  if (reverse) {\r\n    methods.reverse()\r\n  }\r\n  methods[0](elm, type, duration, function () {\r\n    Promise.resolve(callback()).then(() => methods[1](elm, type, duration, null, timing))\r\n  }, timing)\r\n}\r\n\r\nexport function vPlace(\r\n  parent,\r\n  child,\r\n  prepend = false,\r\n  type = deflt.type,\r\n  duration = deflt.duration,\r\n  callback = null,\r\n  timing = deflt.timing\r\n) {\r\n  child.style.setProperty('display', 'none')\r\n  var placeAction\r\n  if (prepend) {\r\n    placeAction = function () {\r\n      parent.prepend(child)\r\n    }\r\n  } else {\r\n    placeAction = function () {\r\n      parent.append(child)\r\n    }\r\n  }\r\n\r\n  var placeCallback = function () {\r\n    vShow(child, type, duration, callback, timing)\r\n  }\r\n  changeThenAct(parent, child, placeAction, placeCallback)\r\n}\r\n\r\n\r\nexport function vReplace(oldElm, newElm, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  newElm.style.opacity = 0\r\n\r\n  var parent = oldElm.parentNode\r\n  var preh = oldElm.offsetHeight\r\n  var placeAction = function () {\r\n    oldElm.replaceWith(newElm)\r\n  }\r\n  var placeCallback = function () {\r\n    vShowAdapt(newElm, preh, duration, callback, timing)\r\n  }\r\n  var transcallback = function () {\r\n    changeThenAct(parent, newElm, placeAction, placeCallback)\r\n  }\r\n  vHide(oldElm, 'fade', duration, transcallback, timing)\r\n}\r\n\r\nexport function vShowAdapt(elm, prevHeight, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  var type = 'ease'\r\n  if (elm.offsetHeight === prevHeight) {\r\n    type = 'fade'\r\n  }\r\n  vShow(elm, type, duration, callback, timing)\r\n}\r\n\r\n\r\nexport function vSplitFlap(elm, text, speed = 20) {\r\n  var ntext = elm.textContent.split('')\r\n  var stext = text.split('')\r\n  var prevLen = ntext.length\r\n  var newLen = stext.length\r\n\r\n  var l\r\n  var stop\r\n  var solve\r\n  if (prevLen > newLen) {\r\n    l = prevLen\r\n    stop = 0\r\n    solve = function () {\r\n      if (l > newLen) {\r\n        ntext.pop()\r\n      } else {\r\n        ntext[l - 1] = stext[l - 1]\r\n      }\r\n      l--\r\n    }\r\n  } else {\r\n    l = 0\r\n    stop = newLen\r\n    solve = function () {\r\n      if (l < prevLen) {\r\n        ntext[l] = stext[l]\r\n      } else {\r\n        ntext.push(stext[l])\r\n      }\r\n      l++\r\n    }\r\n  }\r\n  var repl = setInterval(function () {\r\n    solve()\r\n    elm.textContent = ntext.join('')\r\n    if (l === stop) {\r\n      clearInterval(repl)\r\n    }\r\n  }, speed)\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function isNonEmptyArr (it) {\r\n  return Array.isArray(it) && it.length\r\n}\r\nexport function isNonEmptyObj (it) {\r\n  return it && it !== null && it.constructor.name === 'Object' && Object.keys(it).length\r\n}\r\nexport function isNonEmptyStr (it) {\r\n  return (typeof it === 'string' || it instanceof String) && it.length\r\n}\r\nexport function seemsLikeValidDate (string) {\r\n  return isNonEmptyStr(string) && !isNaN(new Date(string))\r\n}\r\nexport function isElement (Obj) {\r\n  return Obj instanceof Element\r\n}\r\nexport function isEmpty (it) {\r\n  if (typeof it === 'object') {\r\n    return !Object.keys(it).length\r\n  }\r\n  return !it || !it.length\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function ucFirst (string) {\r\n  return string.charAt(0).toUpperCase() + string.slice(1)\r\n}\r\n\r\nexport function randomInt (min, max) {\r\n  return Math.floor(Math.random() * (max - min + 1) + min)\r\n}\r\n\r\nexport function charCut (string, limit, cutAnywhere = false) {\r\n  string = string.trimEnd()\r\n  if (string.length <= limit) {\r\n    return string\r\n  }\r\n    if(limit < 6){\r\n      return '(...)'\r\n    }\r\n\r\n    if(cutAnywhere || !string.match(/\\s/)){\r\n     return string.substring(0, limit - 5) + '(...)'\r\n    } \r\n      var sp = string.split(/\\s/)\r\n     for(var p = sp.length - 1; p > -1; p--){\r\n      string = string.slice(0, - (sp[p].length + 1))\r\n      if(string.length + 6 < limit){\r\n          break;\r\n      }     \r\n     }\r\n     string += ' (...)'\r\n     return string\r\n}\r\n\r\nexport function randomString (length = 10) {\r\n  var rpt = 1\r\n  if (length > 10) {\r\n    rpt += Math.ceil(length / 10)\r\n  }\r\n  var str = ''\r\n  for (var i = 0; i < rpt; i++) {\r\n    str += Math.random().toString(36).substring(2, 10)\r\n  }\r\n  return str.substring(0, length)\r\n}\r\n\r\nexport function waitForElmInDOM (elmSelector, parentElm = null) {\r\n  if (!parentElm || !(parentElm instanceof Element)) {\r\n    parentElm = document.body\r\n  }\r\n  return new Promise((resolve) => {\r\n    var elm = parentElm.querySelector(elmSelector)\r\n    if (elm) {\r\n      return resolve(elm)\r\n    }\r\n\r\n    var observer = new MutationObserver(() => {\r\n      elm = parentElm.querySelector(elmSelector)\r\n      if (elm) {\r\n        observer.disconnect()\r\n        resolve(elm)\r\n      }\r\n    })\r\n\r\n    observer.observe(parentElm, {\r\n      childList: true,\r\n      subtree: true\r\n    })\r\n  })\r\n}\r\n\r\nexport function replaceDiacritics (text) {\r\n  if (text === '' || text.length === 0) {\r\n    return ''\r\n  }\r\n  var diactricMap = {\r\n    Ã€: 'A',\r\n    Ã: 'A',\r\n    Ã‚: 'A',\r\n    Ãƒ: 'A',\r\n    Ã„: 'A',\r\n    Ã…: 'A',\r\n    Ã : 'a',\r\n    Ã¡: 'a',\r\n    Ã¢: 'a',\r\n    Ã£: 'a',\r\n    Ã¤: 'a',\r\n    Ã¥: 'a',\r\n    Äƒ: 'a',\r\n    Ä…: 'a',\r\n    Ã’: 'O',\r\n    Ã“: 'O',\r\n    Ã”: 'O',\r\n    Ã•: 'O',\r\n    Ã–: 'O',\r\n    Ã˜: 'O',\r\n    Ã²: 'o',\r\n    Ã³: 'o',\r\n    Ã´: 'o',\r\n    Ãµ: 'o',\r\n    Ã¶: 'o',\r\n    Ã¸: 'o',\r\n    Ãˆ: 'E',\r\n    Ã‰: 'E',\r\n    ÃŠ: 'E',\r\n    Ã‹: 'E',\r\n    Ã¨: 'e',\r\n    Ã©: 'e',\r\n    Ãª: 'e',\r\n    Ã«: 'e',\r\n    Ã°: 'e',\r\n    Ä™: 'e',\r\n    Ã‡: 'C',\r\n    Ã§: 'c',\r\n    Ä‡: 'c',\r\n    Ä: 'c',\r\n    Ã: 'D',\r\n    Ä‘: 'd',\r\n    ÄŸ: 'g',\r\n    ÃŒ: 'I',\r\n    Ã: 'I',\r\n    ÃŽ: 'I',\r\n    Ã: 'I',\r\n    Ã¬: 'i',\r\n    Ã­: 'i',\r\n    Ã®: 'i',\r\n    Ã¯: 'i',\r\n    Å: 'L',\r\n    Å‚: 'l',\r\n    Ã‘: 'N',\r\n    Ã±: 'n',\r\n    Å„: 'n',\r\n    Å : 'S',\r\n    Å¡: 's',\r\n    Ã™: 'U',\r\n    Ãš: 'U',\r\n    Ã›: 'U',\r\n    Ãœ: 'U',\r\n    Ã¹: 'u',\r\n    Ãº: 'u',\r\n    Ã»: 'u',\r\n    Ã¼: 'u',\r\n    Å¸: 'Y',\r\n    Ã¿: 'y',\r\n    Ã½: 'y',\r\n    Å½: 'Z',\r\n    Å¾: 'z',\r\n    Å»: 'Z',\r\n    Å¼: 'z',\r\n    É¶: 'oe',\r\n    Å’: 'OE',\r\n    Ã¦: 'ae',\r\n    Ã†: 'AE',\r\n    ÃŸ: 'ss'\r\n  }\r\n  var diactrics = Object.keys(diactricMap)\r\n  for (var diactricIndex = 0; diactricIndex < diactrics.length; diactricIndex++) {\r\n    var from = diactrics[diactricIndex]\r\n    var to = diactricMap[from]\r\n    text = text.replace(from, to)\r\n  }\r\n  return text\r\n}\r\n\r\nexport function escapeRegExp (string) {\r\n  return string.replace(/[.*+?^${}()/|[\\]\\\\]/g, '\\\\$&')\r\n}\r\n\r\nexport function splitOnLineBreaks (string) {\r\n  return string.split(/(\\r\\n|\\n|\\r)/gm)\r\n}\r\n\r\nexport function deepCopy (obj) {\r\n  return JSON.parse(JSON.stringify(obj))\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function getLocalStorage () {\r\n  if (isStorageAvailable('localStorage')) {\r\n    return localStorage\r\n  }\r\n  return null\r\n}\r\n\r\nexport function getSessionStorage () {\r\n  if (isStorageAvailable('sessionStorage')) {\r\n    return sessionStorage\r\n  }\r\n  return null\r\n}\r\n\r\nexport function sizeInBytes (s) {\r\n  return new TextEncoder().encode(s).length\r\n}\r\n\r\nexport function jsonSize (obj, inKb = true) {\r\n  var sz = sizeInBytes(JSON.stringify(obj))\r\n  if (inKb) {\r\n    sz = sz / 1000\r\n  }\r\n  return sz\r\n}\r\n\r\nexport function clearPartialStorage (store, threshold = 2000) {\r\n  var currentKb = jsonSize(store, true)\r\n  for (var i = 0; i < store.length; i++) {\r\n    if (currentKb < threshold) {\r\n      break\r\n    }\r\n    var itmkey = store.key(i)\r\n    var itemsize = jsonSize(store.getItem(itmkey), true)\r\n    store.removeItem(itmkey)\r\n    currentKb -= itemsize\r\n  }\r\n  return currentKb\r\n}\r\n\r\nexport function isStorageAvailable (type) {\r\n  var storage\r\n  try {\r\n    storage = window[type]\r\n    var x = '__storage_test__'\r\n    storage.setItem(x, x)\r\n    storage.removeItem(x)\r\n    return true\r\n  } catch (e) {\r\n    return (\r\n      e instanceof DOMException &&\r\n      (e.code === 22 ||\r\n        e.code === 1014 ||\r\n        e.name === 'QuotaExceededError' ||\r\n        e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\r\n      storage &&\r\n      storage.length !== 0\r\n    )\r\n  }\r\n}\r\n\r\nexport function copyToClipboard (content, callback) {\r\n  navigator.clipboard.writeText(content).then(() => callback())\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function nonRenderedElmHeight (elm) {\r\n  var clone = elm.cloneNode(true)\r\n  clone.style.visibility = 'hidden'\r\n  document.append(clone)\r\n  var height = clone.offsetHeight\r\n  document.removeChild(clone)\r\n  return height\r\n}\r\n\r\nexport function elmHasStyle (elm, property) {\r\n  if (\r\n    elm.getAttribute('style') &&\r\n    elm.getAttribute('style').indexOf(property + ':') !== -1\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\n// @doc: strenghts = 1,2,3\r\nexport function cssExtract (strength = 2) {\r\n  var s = {\r\n    tags: [],\r\n    ids: [],\r\n    classes: [],\r\n    combos: []\r\n  }\r\n  var fs = ''\r\n  var loopcall = function (elms, prev = ' ') {\r\n    Array.from(elms).forEach((elm) => {\r\n      var tag = elm.tagName.toLowerCase()\r\n      var nprev\r\n      if (strength > 2) {\r\n        nprev = prev + tag\r\n      }\r\n\r\n      if (!s.tags.includes(tag)) {\r\n        s.tags.push(tag)\r\n      }\r\n      if (strength > 2 && !s.tags.includes(nprev)) {\r\n        s.tags.push(nprev)\r\n      }\r\n      if (elm.id) {\r\n        s.ids.push('#' + elm.id)\r\n      }\r\n      if (elm.classList.length) {\r\n        elm.classList.forEach((classn) => {\r\n          if (!s.classes.includes('.' + classn)) {\r\n            s.classes.push('.' + classn)\r\n          }\r\n          if (strength > 1 && !s.combos.includes(tag + '.' + classn)) {\r\n            s.combos.push(tag + '.' + classn)\r\n          }\r\n          if (strength > 2 && !s.combos.includes(nprev + '.' + classn)) {\r\n            s.combos.push(nprev + '.' + classn)\r\n          }\r\n          if (elm.id && !s.combos.includes('#' + elm.id + '.' + classn)) {\r\n            s.combos.push('#' + elm.id + '.' + classn)\r\n          }\r\n        })\r\n      }\r\n      if (tag !== 'html' && elm.children.length) {\r\n        loopcall(elm.children, tag + ' ')\r\n      }\r\n    })\r\n  }\r\n\r\n  setTimeout(function () {\r\n    loopcall([document.querySelector('html'), document.body])\r\n    for (const [k, v] of Object.entries(s)) {\r\n      fs += '/*' + k + '*/\\r\\n'\r\n      v.forEach((itm) => {\r\n        fs += itm + ' {\\r\\n}\\r\\n'\r\n      })\r\n    }\r\n    var outputElm = document.createElement('TEXTAREA')\r\n    outputElm.textContent = fs\r\n    document.body.append(outputElm)\r\n  }, 3000)\r\n}\r\n\r\nexport function autoScrollToBottom (elm) {\r\n  elm.scrollIntoView({\r\n    block: 'end',\r\n    behavior: 'smooth'\r\n  })\r\n}\r\nexport function autoScrollToTop (elm) {\r\n  elm.scrollIntoView({\r\n    block: 'start',\r\n    behavior: 'smooth'\r\n  })\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function loadJs (signatureVar, url) {\r\n  if (!window[signatureVar]) {\r\n    return new Promise((resolve, reject) => {\r\n      var script = document.createElement('script')\r\n      script.type = 'text/javascript'\r\n      script.onload = () => resolve(script)\r\n      script.onerror = () => reject(new Error('unable to load ' + url))\r\n      script.src = url\r\n      document.body.append(script)\r\n    })\r\n  } else {\r\n    return Promise.resolve(true)\r\n  }\r\n}\r\n\r\nexport function isValidHttpUrl (string) {\r\n  let url\r\n  try {\r\n    url = new URL(string)\r\n  } catch (_) {\r\n    return false\r\n  }\r\n\r\n  return url.protocol === 'http:' || url.protocol === 'https:'\r\n}\r\n\r\nexport function loadJson (url) {\r\n  return fetch(url).then((response) => response.json())\r\n}\r\n\r\nexport function oembedLink (url, provider, maxwidth = null, maxheight = null) {\r\n  provider = provider.toLowerCase()\r\n  var map = {\r\n    youtube: 'https://youtube.com/oembed?url=',\r\n    vimeo: 'https://vimeo.com/api/oembed.json?url=',\r\n    soundcloud: 'https://soundcloud.com/oembed?format=json&url='\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(map, provider)) {\r\n    url = map[provider] + encodeURIComponent(url)\r\n    if (maxwidth != null) {\r\n      url += '&maxwidth=' + maxwidth\r\n    }\r\n    if (maxheight != null) {\r\n      url += '&maxheight=' + maxheight\r\n    }\r\n    return url\r\n  }\r\n\r\n  return false\r\n}\r\n\r\nexport function oembedResponse (oembedLink) {\r\n  return loadJson(oembedLink).then((response) => {\r\n    if (response && Object.prototype.hasOwnProperty.call(response, 'html')) {\r\n      return response\r\n    }\r\n\r\n    throw new Error('invalid oembed response')\r\n  })\r\n}\r\n\r\n\r\nexport function oembedIframe (oembedResponse) {\r\n    // @doc: rebuilding iframe elm for super safe dom insertion\r\n  var url = oembedResponse.html.split('src=\"')[1].split('\"')[0]\r\n  var iframe = document.createElement('IFRAME')\r\n  iframe.width = oembedResponse.width\r\n  iframe.height = oembedResponse.height\r\n  iframe.frameborder = 'no'\r\n  iframe.scrolling = 'no'\r\n  iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'\r\n  iframe.allowfullscreen = true\r\n  iframe.title = oembedResponse.title\r\n  iframe.src = url\r\n  return iframe\r\n}\r\n\r\nexport function pathBasename (path) {\r\n  return path.split(/[\\\\/]/).pop()\r\n}\r\n\r\nexport function pageHasSheet (signatureRule, url) {\r\n  if (document.styleSheets.length) {\r\n    var basename = pathBasename(url)\r\n    for (var i = 0; i < document.styleSheets.length; i++) {\r\n      var sheetUrl = document.styleSheets[i].href\r\n      if (sheetUrl) {\r\n        if (sheetUrl === url || pathBasename(sheetUrl) === basename) {\r\n          return true\r\n        }\r\n        if (sheetUrl.startsWith(window.location.origin) && Object.prototype.hasOwnProperty.call(document.styleSheets[i], 'cssRules')) {\r\n          var rules = document.styleSheets[i].cssRules\r\n\r\n          for (let i = 0; i < rules.length; i++) {\r\n            if (rules[i].selectorText === signatureRule) {\r\n              return true\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return false\r\n}\r\n\r\nexport function loadCss (signatureRule, url, shadowRootElm = null) {\r\n  if (shadowRootElm || !pageHasSheet(signatureRule, url)) {\r\n    return new Promise((resolve, reject) => {\r\n      var link = document.createElement('link')\r\n      link.rel = 'stylesheet'\r\n      link.type = 'text/css'\r\n      link.onload = resolve\r\n      link.onerror = reject\r\n      link.href = url\r\n      if (shadowRootElm) {\r\n        shadowRootElm.append(link)\r\n      } else {\r\n        document.head.append(link)\r\n      }\r\n    })\r\n  } else {\r\n    return Promise.resolve(true)\r\n  }\r\n}\r\n\r\nexport function loadPagePreviewImg (url, useCache = true) {\r\n  // @doc: this is SLOW and MUST be used with parcimony without an API key\r\n  if (isValidHttpUrl(url)) {\r\n    var callback = function (imgsrc) {\r\n      var img = document.createElement('IMG')\r\n      img.src = imgsrc\r\n      return img\r\n    }\r\n    if (useCache) {\r\n      var imgsrc = localStorage.getItem('preview-' + url)\r\n      if (imgsrc) {\r\n        return Promise.resolve(callback(imgsrc))\r\n      }\r\n    }\r\n    return loadJson(\r\n      'https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=' +\r\n        url +\r\n        '&screenshot=true'\r\n    ).then((response) => {\r\n      if (\r\n        response.lighthouseResult &&\r\n        response.lighthouseResult.audits &&\r\n        response.lighthouseResult.audits['final-screenshot'] &&\r\n        response.lighthouseResult.audits['final-screenshot'].details &&\r\n        response.lighthouseResult.audits['final-screenshot'].details.data\r\n      ) {\r\n        var imgsrc =\r\n          response.lighthouseResult.audits['final-screenshot'].details.data\r\n        if (useCache) {\r\n          localStorage.setItem('preview-' + url, imgsrc)\r\n        }\r\n        return callback(imgsrc)\r\n      }\r\n      return Promise.reject(new Error(404))\r\n    })\r\n  }\r\n  return Promise.reject(new Error(400))\r\n}\r\n\r\nexport function stripHttp (url) {\r\n  return url.replace(/^(https?:\\/\\/)?/, '')\r\n}\r\n\r\nexport function stripLastSlash (url) {\r\n  return url.replace(/\\/?$/, '')\r\n}\r\n\r\nexport function displayUrl (url) {\r\n  return stripHttp(url).replace(/\\/*$/, '')\r\n}\r\n\r\nexport function conciseUrl (string, withPath = true) {\r\n  var base = stripHttp(string).split('/')\r\n  if(!base[base.length -1]){\r\n    base.pop()\r\n  }\r\n  string = base[0]\r\n  if (withPath && base.length > 1) {\r\n    if (base.length > 2) {\r\n      string += '/...'\r\n    }\r\n    var last = base.pop()\r\n    if (last.length > 18) {\r\n      last = '...' + last.substring(-15)\r\n    }\r\n    string += '/' + last\r\n  }\r\n  return string\r\n}\r\n\r\nexport function miniUrl (string) {\r\n  var parts = string\r\n    .replace(/^(https?:\\/\\/)?(www.)?/, '')\r\n    .split(':')[0]\r\n    .split('/')[0]\r\n    .split('.')\r\n\r\n  for (var p = 0; p < parts.length; p++) {\r\n    if (parts[p].includes('-')) {\r\n      parts[p] = parts[p]\r\n        .split('-')\r\n        .map((p) => p[0])\r\n        .join('-')\r\n    } else {\r\n      var strar = parts[p].split('')\r\n      var pass = 0\r\n      for (var i = 0; i < strar.length; i++) {\r\n        if (['a', 'e', 'i', 'o', 'u', 'y'].includes(strar[i])) {\r\n          if (pass !== 0 && i !== pass + 1) {\r\n            strar[i] = ''\r\n          } else {\r\n            pass = i\r\n          }\r\n        }\r\n      }\r\n      parts[p] = strar.join('')\r\n    }\r\n  }\r\n  return parts.join('.')\r\n}\r\n\r\nexport function searchUrlParam (name) {\r\n  var results = new RegExp('[?&]' + name + '=([^&#]*)').exec(\r\n    window.location.href\r\n  )\r\n  if (results == null) {\r\n    return null\r\n  } else {\r\n    return results[1] || 0\r\n  }\r\n}\r\n\r\nexport function toLastSlash (url) {\r\n  if (url.lastIndexOf('/') < 8 && url.substring(0, 4) === 'http') {\r\n    url += '/'\r\n  }\r\n  return url.substring(0, url.lastIndexOf('/') + 1)\r\n}\r\n\r\nexport function addFinalSlash (string) {\r\n  if (string.slice(-1) !== '/') {\r\n    string += '/'\r\n  }\r\n  return string\r\n}\r\n"],"names":["defaultIO","defaultStyle","defaultSignatureRule","defaultElmId","defaultLang","currentUrl","window","location","href","baseCurrentUrl","splitCurrentUrl","queries","URLSearchParams","search","slice","getQuery","key","has","getAbsoluteUrl","url","length","substring","replace","mediaReadyEvent","Event","dispatchMediaReady","resolvedElm","parentElm","tagName","then","dispatchEvent","placeMedia","mediaElm","loadEvent","srcElm","includes","firstChild","addEventListener","fallback","pageElm","replaceWith","src","textContent","append","setMediaUrl","attrb","setAttribute","document","createElement","target","videoElm","audioElm","imgElm","iframeElm","scrolling","allow","allowfullscreen","type","f","resolveEmbedMedia","iframeUrl","success","Promise","resolve","link","response","html","split","catch","err","message","resolveEmbedMediaData","result","resolveMedia","getLinkedInstances","thread","exclude","store","instances","register","i","linked","Object","prototype","hasOwnProperty","call","id","push","buildLinkedInstances","getSnippet","style","scriptSrc","lang","datalang","datastyle","Spinner","constructor","spinContainer","spinStates","speed","this","unshift","spinPosition","endSpin","startSpin","setInterval","clearInterval","bind","defaultInitOptions","customSelector","forceLog","forceStyle","customSignatureRule","appDefaultCss","appDefaultCssAliases","appDefaultLang","retrieveNxElm","elm","selectors","s","querySelector","initAll","options","seed","assign","cookie","initLogger","nxelm","request","NxElm","dataset","cssUrl","getRequest","fallbackCssUrl","resolveTheme","styleUrl","nxdata","reject","Error","msg","Number","isInteger","getThreadsList","list","threads","forEach","loadSrcFile","inputEvt","skipValidt","files","reader","FileReader","onload","event","readerEvent","JSON","parse","prcFileSrc","readAsText","getSrcData","code","loadSrc","loadAppCss","signatureRule","fallbackUrl","isCssLoaded","errors","consoleLog","setConsoleLog","bool","logErr","detail","entry","console","log","stringify","visitStore","dataStore","linkedStore","oembedStore","editpsrcix","registerEditData","getStoredEditData","registerThreadVisit","timestamp","isThreadContentUnseen","lastKnownDate","threadLastSeenDate","registerData","registerLinkedMaps","map","getStoredLinkedMaps","getStoredData","registerOembedResponse","givenUrl","getStoredOembedResponse","setStoredLang","getStoredLang","locStorag","sesStorag","setStorageAvailability","getItem","setItem","resolveStore","storage","storeItem","data","instanceStore","sdata","datasize","avail","Math","ceil","getStoredItem","txts","fr","author","handle","about","title","description","main","aside","media","caption","index","distant","local","content","history","copied","embed","source","saved","availableLangs","keys","storedLang","langIsAvailable","currentLang","setOriginLang","setUserSelectedLang","updateStorage","getAvailableLangs","getLang","getTxt","text","translStore","updateTextElm","textkey","triggerTranslate","elms","entries","registerTranslElm","appUrl","typesMap","nexus","charMinMax","itemsMinMax","supportedOembedMedia","supportedMediaTypes","concat","timestampPattern","idPattern","urlPattern","charLimits","catg","itmLimits","validLenghtStr","str","nonEmpty","hasValidType","item","limits","strHasValidMinLength","diff","repeat","extendString","strHasValidMaxLength","cutString","field","name","validMedia","mediaObj","isValidUrl","mediaType","m","validContent","strict","match","isValidTimestamp","c","splitUrlAndId","rt","sp","pop","join","isValidId","validThread","t","vlinked","len","limit","validLinks","validAppUrl","isValidAppUrl","validData","d","a","validAuthor","vthreads","ids","validThreads","props","spacing","transitions","heights","slide","toReset","removeInFirst","removeInThen","removeOut","fade","duration","callback","timing","delay","reverse","prepend","easeOut","easeIn","fadeOut","fadeIn","timedFadeToggle","insertDiversion","parent","child","ease","replaceDiversion","oldElm","newElm","splitFlap","resetDisplay","removeProperty","display","getComputedStyle","setTransition","setProperty","resetStyle","p","removeProp","changeThenAct","placeAction","placeCallBack","Element","body","tmpclass","random","toString","classList","add","observer","MutationObserver","remove","disconnect","observe","childList","vHide","offsetHeight","setTimeout","vShow","height","vTempToggle","methods","hidden","width","opacity","visibility","parentNode","vPlace","vReplace","preh","placeCallback","prevHeight","vShowAdapt","vSplitFlap","l","stop","solve","ntext","stext","prevLen","newLen","repl","isNonEmptyObj","it","isNonEmptyStr","String","seemsLikeValidDate","string","isNaN","Date","isEmpty","randomInt","min","max","floor","charCut","cutAnywhere","trimEnd","randomString","rpt","waitForElmInDOM","elmSelector","subtree","replaceDiacritics","diactricMap","diactrics","diactricIndex","from","to","splitOnLineBreaks","getLocalStorage","isStorageAvailable","localStorage","getSessionStorage","sessionStorage","jsonSize","obj","inKb","sz","TextEncoder","encode","clearPartialStorage","threshold","currentKb","itmkey","itemsize","removeItem","x","e","DOMException","copyToClipboard","navigator","clipboard","writeText","autoScrollToBottom","scrollIntoView","block","behavior","isValidHttpUrl","URL","_","protocol","loadJson","fetch","json","oembedLink","provider","maxwidth","maxheight","toLowerCase","youtube","vimeo","soundcloud","encodeURIComponent","oembedResponse","pathBasename","path","pageHasSheet","styleSheets","basename","sheetUrl","startsWith","origin","rules","cssRules","selectorText","loadCss","shadowRootElm","rel","onerror","head","stripHttp","conciseUrl","withPath","base","last","miniUrl","parts","strar","pass","toLastSlash","lastIndexOf"],"sourceRoot":""}