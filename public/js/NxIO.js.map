{"version":3,"file":"js/NxIO.js","mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,UAAU,iBAAiB,iBAAiB,WAAW;AACxF;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA,oBAAoB,iCAAiC;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,kBAAkB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;;AC3PA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACA;AACO;AACP,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;;;ACzBA;AACO;AACA;AACA;AACA;AACA;;;ACLP;AACkF;AACzC;AACiC;AAC1E;AACO;AACP;AACA,UAAU,YAAY;AACtB;AACA;AACA,oBAAoB,oBAAoB;AACxC;AACA,8BAA8B,YAAY;AAC1C,kBAAkB,YAAY;AAC9B;AACA,SAAS,OAAO;AAChB;AACA;AACA,KAAK;AACL,MAAM,MAAM;AACZ;AACA;AACA,QAAQ;AACR;AACA;AACA,KAAK;AACL;AACA;AACO;AACP;AACA,UAAU,YAAY;AACtB;AACA;AACA,oBAAoB,oBAAoB;AACxC;AACA,SAAS,YAAY,gBAAgB,YAAY;AACjD;;;ACpCA;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;;ACtBA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,QAAQ;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,kBAAkB,SAAS;AAC3B;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,kCAAkC;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,kCAAkC;AAClC;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;;;AC7KA;AACA;AACO;AACA;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACA;AACP,YAAY,EAAE;AACP,iCAAiC,KAAK;AACtC;;;ACjEP;AACA;AACwE;AACxE;AACO;AACA,uBAAuB,WAAW;AAClC;AACP;AACO;AACP;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;;AChBA;AAKqD;AAGD;AAGD;AACnD;AAUqB;AACoB;AACS;AAClD;AACO;AACP,2CAA2C,UAAU;AACrD,WAAW,UAAU;AACrB;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP,2CAA2C,WAAW;AACtD,WAAW,WAAW;AACtB;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA;AACA,MAAM,4BAA4B;AAClC;AACA;AACA;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACO;AACP,2CAA2C,QAAQ;AACnD,eAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;AACA,wBAAwB,OAAO;AAC/B;AACA;AACA,MAAM,MAAM;AACZ,MAAM;AACN,MAAM,MAAM;AACZ;AACA,IAAI;AACJ,IAAI,MAAM;AACV;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,cAAc;AACvB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,aAAa;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,uBAAuB,gBAAgB;AACvC,oBAAoB,kBAAkB;AACtC;AACA;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA;AACA,iBAAiB,mBAAmB;AACpC,YAAY,cAAc;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA,WAAW,mBAAmB;AAC9B;AACA,qBAAqB,gBAAgB;AACrC;AACA;AACA;AACA;AACA,MAAM;AACN,MAAM,MAAM;AACZ,kBAAkB,mBAAmB;AACrC;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,WAAW,mBAAmB;AAC9B;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,WAAW,cAAc;AACzB;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,WAAW,OAAO;AAClB;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,IAAI,MAAM;AACV;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,IAAI,MAAM;AACV;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,IAAI,MAAM;AACV;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,MAAM,cAAc;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,+CAA+C,SAAS;AACxD;AACA;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA;AACA,OAAO,cAAc;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACA;AACO;AACP,SAAS,aAAa;AACtB;AACA;AACO;AACP,QAAQ,cAAc;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,MAAM,MAAM;AACZ;AACA;AACA,oBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV,UAAU,MAAM;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA,IAAI,MAAM;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,qBAAqB,YAAY;AACjC;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,WAAW,eAAe;AAC1B;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,MAAM;AACZ;AACA;AACA;AACA,oBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,aAAa,gBAAgB;AAC7B;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,WAAW,aAAa;AACxB;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,aAAa,gBAAgB;AAC7B;AACA,UAAU,aAAa;AACvB;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,iCAAiC,MAAM;AACvC;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA,UAAU,MAAM;AAChB;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACtjBA;AAC2E;AACV;AACN;AACO;AAClE;AACO,wBAAwB,aAAa,CAAC,UAAU;AAChD;AACP;AACA;AACA;AACA;AACA,kBAAkB,aAAa,CAAC,cAAc;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,SAAS;AAC/B,+FAA+F;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,cAAc;AACjC,UAAU,cAAc;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,+DAA+D,QAAQ,YAAY,QAAQ;AAC3F;AACA;AACA;AACA;AACA;AACO;AACP;AACA,oBAAoB,YAAY;AAChC;AACA;AACA,qBAAqB,WAAW;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3EA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA,kBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;;;ACjEA;AAMqD;AACrD;AACA;AACA,WAAW;AACX,UAAU;AACV,YAAY;AACZ,YAAY;AACZ;AACA;AACA;AACA,SAAS,eAAe;AACxB,WAAW,iBAAiB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,QAAQ;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,mBAAmB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACO;AACP;AACA;AACA,oBAAoB,qBAAqB;AACzC;AACA;AACA;AACA;AACA;;;ACnIA;AACA;AASuB;AACvB;AACO;AACP;AACO;AACP,EAAE,SAAS;AACX;AACA;AACO;AACP,SAAS,aAAa;AACtB;AACA;AACO;AACP,OAAO,eAAe;AACtB,IAAI,SAAS;AACb;AACA;AACA;AACO;AACP,sBAAsB,aAAa;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,EAAE,UAAU;AACZ;AACA;AACO;AACP,EAAE,SAAS;AACX;AACA;AACO;AACP,EAAE,SAAS;AACX;AACA;AACO;AACP,SAAS,aAAa;AACtB;AACA;AACO;AACP,SAAS,aAAa;AACtB;AACA;AACO;AACP,EAAE,SAAS;AACX;AACA;AACO;AACP,SAAS,aAAa;AACtB;AACA;AACO;AACP,EAAE,SAAS;AACX;AACO;AACP,SAAS,aAAa;AACtB;AACA;AACO;AACP,EAAE,mBAAmB;AACrB,EAAE,kBAAkB;AACpB;AACA;AACO;AACP,EAAE,cAAc;AAChB;AACA;AACA;AACA,GAAG;AACH;AACA;AACO;AACP,EAAE,mBAAmB;AACrB,EAAE,kBAAkB;AACpB,EAAE,cAAc;AAChB;AACA;AACA;AACA,GAAG;AACH;;;AChGA;AACqE;AAC5B;AACyB;AAChB;AAClD;AACO;AACP;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACO;AACP;AACA,SAAS,QAAQ;AACjB;AACA,eAAe,SAAS;AACxB;AACA;AACA;AACA,UAAU,YAAY;AACtB;AACA;AACA;AACA,MAAM,MAAM;AACZ;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,QAAQ,MAAM;AACd;AACA,MAAM,YAAY;AAClB;AACA,KAAK;AACL;AACA;AACO;AACP;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;AACA;AACA;AACA,EAAE;AACF,EAAE,MAAM;AACR;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,IAAI,MAAM;AACV;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA;AACO;AACP;AACA,eAAe,aAAa;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzFA;AACA;AACyC;AACe;AACP;AACL;AACU;AACF;AACqB;AACzE;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,KAAK,QAAQ;AACb,IAAI,gBAAgB;AACpB;AACA,IAAI,QAAQ;AACZ,EAAE,gBAAgB;AAClB;AACA;AACA;AACO;AACP,kCAAkC,eAAe;AACjD;AACA;AACO;AACP,kBAAkB,QAAQ;AAC1B,IAAI,aAAa;AACjB;AACA;AACA;AACO;AACP,mBAAmB,YAAY;AAC/B,2CAA2C,YAAY;AACvD;AACA;AACA;AACA,kBAAkB,OAAO;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,SAAS,UAAU;AACnB;AACA;AACO;AACP;AACA,iBAAiB,aAAa;AAC9B;AACA;AACA;AACA;AACA;AACA,WAAW,UAAU;AACrB;AACA;AACA;AACA;AACO,8BAA8B;AACrC;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA,iBAAiB,UAAU;AAC3B;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,QAAQ,MAAM;AACd;AACA;AACA;AACA,KAAK;AACL;;;AC1GA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC1DA;AAC2F;AACxB;AACf;AACpD;AACA,WAAW,cAAc;AACzB;AACA;AACA;AACA,iBAAiB,aAAa;AAC9B;AACA;AACA,EAAE,aAAa;AACf;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,aAAa;AACjB;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP,MAAM,aAAa;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,SAAS,aAAa;AACtB;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;;AC/EyF;AAIhC;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,WAAW,qBAAqB;AAChC;AACA;AACA;AACA;AACO;AACP,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACO;AACP,SAAS,UAAU;AACnB;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,MAAM,mBAAmB;AACzB;AACA;AACA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,iCAAiC;AACjC;AACA;AACA;AACA;AACA;;;AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5CA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;;AC7BA;AACA;AACA;AACA;AAC6C;AACM;AACnD;AACA;AACA,+CAA+C,KAAK;AACpD;AACA;AACA;AACA;AACA;AACA,EAAE,KAAK;AACP;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,EAAE,KAAK;AACP;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACO,2BAA2B,UAAU,aAAa,cAAc,4BAA4B,YAAY;AAC/G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACO,2BAA2B,UAAU,aAAa,cAAc,4BAA4B,YAAY;AAC/G;AACA;AACA,IAAI,YAAY;AAChB;AACA,IAAI;AACJ,IAAI,YAAY;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACO,6BAA6B,UAAU,aAAa,cAAc,4BAA4B,YAAY;AACjH,MAAM,QAAQ;AACd;AACA,IAAI;AACJ;AACA;AACA;AACO,iCAAiC,UAAU,UAAU,WAAW,aAAa,cAAc,4BAA4B,YAAY;AAC1I;AACA,MAAM,QAAQ;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,SAAS,UAAU;AACnB,aAAa,cAAc;AAC3B,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA,SAAS,UAAU;AACnB,aAAa,cAAc;AAC3B;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,6CAA6C,cAAc,4BAA4B,YAAY;AAC1G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,gDAAgD,cAAc,4BAA4B,YAAY;AAC7G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;;ACvOA;AACkE;AACW;AAC7E;AACA;AACA;AACO;AACP,EAAE,UAAU,MAAM,MAAM;AACxB;AACA;AACO;AACP,MAAM,mBAAmB;AACzB;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;;ACzB4E;AACX;AAID;AAKC;AACQ;AACM;AACF;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,OAAO;AAC9B;AACA,IAAI,iBAAiB;AACrB;AACA;AACA,MAAM,gBAAgB;AACtB,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA,uBAAuB,MAAM;AAC7B,EAAE,iBAAiB;AACnB;AACA;AACA;AACO;AACP;AACA,MAAM,WAAW;AACjB;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACO;AACP,iCAAiC,eAAe;AAChD,EAAE,iBAAiB;AACnB;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA,IAAI,iBAAiB;AACrB;AACA,MAAM,UAAU;AAChB,KAAK;AACL;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,aAAa,iBAAiB;AAC9B;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;;ACxSmG;AAClB;AACb;AACM;AAC1E;AACA;AACA;AACA;AACA;AACA,0BAA0B,OAAO;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,SAAS,aAAa;AAC1B;AACA;AACA;AACA;AACA;AACO;AACP,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA,IAAI,iBAAiB;AACrB,MAAM,UAAU;AAChB,KAAK;AACL;AACA;AACA;AACA;AACO;AACP,mBAAmB,MAAM;AACzB;AACA;AACA,GAAG;AACH,eAAe,MAAM;AACrB;AACA;AACA,GAAG;AACH,aAAa,MAAM;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,iBAAiB;AACrB;AACA,MAAM,UAAU;AAChB,KAAK;AACL;AACA;AACA;AACA;AACO;AACP,gBAAgB,MAAM;AACtB;AACA,EAAE,iBAAiB;AACnB;AACA,GAAG;AACH;AACA;AACO;AACP,eAAe,YAAY;AAC3B;AACA,IAAI,kBAAkB;AACtB;AACA;AACA;AACA;AACA,IAAI,aAAa;AACjB,GAAG;AACH;AACA;AACA;AACO;AACP,aAAa,MAAM;AACnB;AACA;AACA,iBAAiB,WAAW;AAC5B,EAAE,kBAAkB;AACpB;AACA;AACA,IAAI,aAAa;AACjB,GAAG;AACH;AACA;AACA;;;ACtGA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,KAAK;AAC5B,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA,GAAG;AACH;AACO;AACP;AACA;AACA;AACA,GAAG;AACH;;;AC9FuF;AAQxD;AAC0B;AACwB;AACV;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,wBAAwB;AACpC,YAAY,wBAAwB;AACpC,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,YAAY,MAAM;AAClB,EAAE,kBAAkB;AACpB;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,aAAa,MAAM;AACnB;AACA;AACA;AACA;AACA;AACA,MAAM,KAAK;AACX,MAAM;AACN;AACA;AACA,MAAM,KAAK;AACX,MAAM,kBAAkB;AACxB;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA,EAAE,iBAAiB;AACnB;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,IAAI,MAAM;AACV,MAAM,kBAAkB;AACxB,KAAK;AACL,IAAI,YAAY;AAChB;AACA;AACA;AACA;AACA,UAAU,eAAe,gBAAgB,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,YAAY;AAC3B,EAAE,kBAAkB;AACpB;AACA;AACA;AACA,IAAI,aAAa;AACjB;AACA;AACA,GAAG;AACH;AACA;AACA;AACO;AACP;AACA,SAAS,SAAS;AAClB;;;AC1HyD;AACY;AACL;AACC;AACjE;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB;AACA;AACA,EAAE,iBAAiB;AACnB,IAAI,QAAQ;AACZ,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,KAAK;AACd;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA;AACA;AACA,EAAE,iBAAiB;AACnB;AACA,GAAG;AACH;AACA;AACA;AACA,iBAAiB,WAAW;AAC5B;AACA,WAAW,MAAM;AACjB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,KAAK;AACX;AACA,OAAO;AACP;AACA,oBAAoB,WAAW;AAC/B;AACA;AACA,QAAQ,QAAQ;AAChB;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA,wBAAwB,WAAW;AACnC,MAAM,MAAM;AACZ;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB,gBAAgB,YAAY,eAAe,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA,SAAS,SAAS;AAClB;AACA;AACO;AACP,kBAAkB,MAAM;AACxB;AACA;AACA;AACA;;;ACpGA;AACiD;AACjD;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,SAAS;AACzB;AACA,sCAAsC,IAAI,GAAG,UAAU,EAAE,SAAS;AAClE,eAAe,UAAU;AACzB;;;AClBO;AACA;AACP;AACO;AACP;AACA;;;ACLO,oCAAoC;AACpC,wCAAwC;AACxC,oCAAoC;AACpC,mCAAmC;AACnC,oCAAoC;AACpC,qCAAqC;AACrC,uCAAuC;AACvC,oCAAoC;AACpC,oCAAoC;AACpC,oCAAoC;AACpC,uCAAuC;AACvC,qCAAqC;AACrC,kCAAkC;AAClC,oCAAoC;;;ACbmC;AACc;AACvB;AACsB;AACxB;AACe;AACL;AACpB;AACX;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,UAAU,SAAS;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB;AACA;AACA;AACA,EAAE,iBAAiB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,KAAK;AACX,MAAM;AACN;AACA;AACA,MAAM,KAAK;AACX;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA;AACA,EAAE,iBAAiB;AACnB;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB,eAAe,SAAS,CAAC,OAAO;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,eAAe;AACnB,MAAM,WAAW;AACjB,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,UAAU,kCAAkC,KAAK,EAAE,OAAO;AACrE;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,sBAAsB,aAAa;AACnC,IAAI,6BAA6B,aAAa;AAC9C;AACA;AACA,SAAS,SAAS;AAClB;;;AChJA;AACmG;AACtB;AACpC;AACzC;AACsF;AAC3B;AAC3D;AACA;AACA;AACO;AACP,EAAE,eAAe;AACjB;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,MAAM,MAAM;AACZ;AACA;AACA;AACA,KAAK;AACL;AACA,IAAI;AACJ;AACA,6BAA6B,UAAU;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA,2BAA2B,UAAU;AACrC;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,mCAAmC,UAAU,iBAAiB,iBAAiB,WAAW;AAC1F;AACA;AACA;AACA;AACA;AACO;AACP,MAAM,6BAA6B;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,kBAAkB,uBAAuB;AACzC;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACA;AACA,SAAS,cAAc;AACvB;AACA,IAAI,sBAAsB;AAC1B;AACA,GAAG;AACH,IAAI,MAAM,sCAAsC,4BAA4B;AAC5E;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA,GAAG;AACH;AACA;AACO;AACP,MAAM,6BAA6B;AACnC;AACA,IAAI;AACJ;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;ACnL6C;AACE;AAC8B;AAC7E;AACA;AACA,uBAAuB,MAAM;AAC7B;AACA,kBAAkB,MAAM;AACxB;AACA;AACA;AACA;AACA,iBAAiB,aAAa;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE,YAAY;AACd;AACA;AACA;AACO,SAAS,gBAAQ;AACxB,iBAAiB,MAAM;AACvB;AACA;AACA;;;ACjCA;AACO;AACP;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA,KAAK;AACL;AACA;;;AClCA;AAC2E;AACrB;AACA;AACtD;AACO;AACP;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA,aAAa,aAAa;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACO;AACP;AACA,aAAa,aAAa;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,YAAY,mBAAmB;AAC/B,KAAK,cAAc;AACnB,aAAa,aAAa;AAC1B;AACA;AACA;AACA;AACA,oCAAoC,YAAY;AAChD,MAAM;AACN,iCAAiC,YAAY;AAC7C;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,oBAAoB,OAAO;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;;ACzHA;AACA;AAC8E;AACxB;AACT;AACJ;AACmB;AAC5D;AACO;AACP,uBAAuB;AACvB;AACA;AACA,eAAe,0BAA0B;AACzC;AACA,kBAAkB,aAAa;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,gBAAgB;AAChB;AACA,sBAAsB,mBAAmB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,kBAAkB,UAAU;AAC5B,sBAAsB,6BAA6B;AACnD;AACA;AACA,QAAQ,MAAM;AACd;AACA,wBAAwB,8CAA8C;AACtE;AACA,KAAK;AACL;AACA;AACA;AACA,MAAM,MAAM;AACZ,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAM,kBAAkB;AACxB;AACA;AACA;AACA,GAAG;AACH;;;ACxE4E;AAMnB;AAC0B;AAChB;AAC5B;AAUR;AACsC;AACE;AACW;AACA;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,wBAAwB;AACpC,YAAY,wBAAwB;AACpC,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,WAAW;AAC/B;AACA;AACA;AACA;AACA,YAAY,aAAa;AACzB,gBAAgB,OAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,YAAY;AAClB;AACA;AACA,IAAI,KAAK;AACT;AACA;AACA;AACA;AACA;AACA,EAAE,KAAK;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,SAAS;AAClB;AACA;AACA;AACA;AACA,SAAS,SAAS,wBAAwB,WAAW;AACrD;AACA;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,YAAY;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,KAAK;AACX;AACA,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,QAAQ;AACd,MAAM;AACN,MAAM,MAAM;AACZ;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB,eAAe,MAAM;AACrB,EAAE,kBAAkB;AACpB,EAAE,YAAY;AACd;AACA;AACA;AACA,cAAc,eAAe,uBAAuB,SAAS;AAC7D;AACA,cAAc,QAAQ;AACtB;AACA,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,kBAAkB;AAChC;AACA;AACA;AACA;AACA;AACA,cAAc,YAAY;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,WAAW;AAC7C;AACA,cAAc;AACd;AACA,cAAc,MAAM;AACpB;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,QAAQ,MAAM;AACd,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,MAAM,kBAAkB;AACxB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,gBAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,oBAAoB,gBAAgB;AACpC;AACA;AACA,QAAQ,aAAa;AACrB;AACA,eAAe,KAAK;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB,gBAAgB,cAAc;AAC9B;AACA;AACA;AACA;AACA,iBAAiB,MAAM;AACvB;AACA;AACA;AACA;AACA;AACA;AACO;AACP,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,kBAAkB,MAAM;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,iBAAiB;AACnB;AACA;AACA,GAAG;AACH;AACA;AACA;;;ACzX6C;AACA;AACgC;AAClC;AACI;AAC/C;AACO;AACP,SAAS,YAAY,CAAC,SAAS;AAC/B,IAAI,WAAW;AACf,OAAO,YAAY;AACnB,OAAO,cAAc,cAAc,eAAe;AAClD,OAAO,WAAW;AAClB;AACA;AACA;AACA;;;ACf2E;AAC5B;AAC/C;AACO;AACP,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACO;AACP;AACA,MAAM,WAAW;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnB+E;AACK;AACpF;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACA;AACA;AACA;AACP;AACO;AACP;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACO;AACP,kBAAkB,IAAI,2BAA2B,EAAE;AACnD,qBAAqB,oBAAoB;AACzC,aAAa,oBAAoB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,SAAS,iBAAiB;AAC1B;AACA;AACA;AACA;AACA;AACO;AACP;AACA,oBAAoB,qBAAqB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,sBAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7EqF;AACZ;AACzE;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,iBAAiB,YAAY;AAC7B;AACA,WAAW,MAAM;AACjB;AACA,6BAA6B,SAAS;AACtC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;AC3CuF;AACrB;AACc;AACL;AACiB;AAS/D;AACiD;AACD;AACV;AACZ;AACvD;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,YAAY;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,cAAc;AACpB;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA,IAAI,UAAU;AACd;AACA;AACA,QAAQ,UAAU;AAClB,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB;AACA,gBAAgB,QAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA,8BAA8B,cAAc;AAC5C;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,MAAM;AAC7B;AACA;AACA;AACA;AACA,iBAAiB,MAAM;AACvB,sBAAsB,SAAS,CAAC,WAAW;AAC3C;AACA;AACA;AACA,mCAAmC;AACnC;AACA,oBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA,sCAAsC;AACtC,qBAAqB,MAAM;AAC3B;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,kBAAkB,MAAM;AACxB,uBAAuB,SAAS,CAAC,MAAM;AACvC;AACA;AACA;AACA,wBAAwB,OAAO;AAC/B,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,mBAAmB,MAAM;AACzB,wBAAwB,SAAS,CAAC,OAAO;AACzC;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,oBAAoB,MAAM;AAC1B;AACA;AACA;AACA;AACA,qBAAqB,MAAM;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,WAAW;AACnB;AACA,0BAA0B,cAAc;AACxC;AACA,WAAW;AACX;AACA,YAAY,MAAM;AAClB;AACA,WAAW;AACX;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,mBAAmB,MAAM;AACzB,wBAAwB,SAAS,CAAC,OAAO;AACzC;AACA;AACA;AACA;AACA;AACA,YAAY,gBAAgB;AAC5B;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,cAAc;AAClB;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B,yBAAyB,SAAS,CAAC,QAAQ;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,cAAc;AACxB;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,MAAM;AAC3B;AACA,mBAAmB,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA,gBAAgB,QAAQ,OAAO,aAAa;AAC5C,gBAAgB,QAAQ,OAAO,aAAa;AAC5C,OAAO;AACP;AACA;AACA;AACA,uBAAuB,MAAM;AAC7B,IAAI,kBAAkB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB;AACA;AACA;;;ACxPsE;AACQ;AACU;AAMlC;AACsB;AACL;AACf;AACJ;AACpD;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,UAAU;AAChC;AACA;AACA;AACA,sBAAsB,UAAU;AAChC;AACA;AACA;AACA,sBAAsB,SAAS;AAC/B;AACA;AACA,4BAA4B,wBAAwB;AACpD;AACA;AACA;AACA;AACA,qBAAqB,UAAU;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mBAAmB;AACnC,WAAW,cAAc;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,MAAM;AACnB;AACA,gBAAgB,MAAM;AACtB,wBAAwB,MAAM;AAC9B,IAAI,iBAAiB;AACrB;AACA;AACA;AACA;AACA;AACA,aAAa,MAAM;AACnB,cAAc,SAAS,CAAC,UAAU;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,UAAU;AACxB;AACA,gBAAgB,QAAQ;AACxB;AACA;AACA;AACA;AACA;AACA,yBAAyB,UAAU;AACnC;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,MAAM;AACN,gBAAgB,sBAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,gBAAgB,UAAU;AAC1B;AACA,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,OAAO;AACP;AACA;AACA;;;AC3PyD;AACQ;AACjE;AACO;AACP;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA;AACA;AACA;AACA,MAAM,WAAW;AACjB;AACA,MAAM,WAAW;AACjB;AACA,MAAM,WAAW;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B;AACA,kBAAkB;AAClB;AACA;AACA;AACA,0BAA0B,gBAAgB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,aAAa;AAChD;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3EuE;AAKd;AAU7B;AACsB;AACD;AAC2B;AACnC;AACG;AACO;AACM;AACzD;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,KAAK;AACf,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB,aAAa,MAAM;AACnB,aAAa,MAAM;AACnB,eAAe,MAAM;AACrB;AACA;AACA;AACA;AACA,wBAAwB,UAAU;AAClC;AACA;AACA;AACA;AACA;AACA,6BAA6B,eAAe;AAC5C,gCAAgC,kBAAkB;AAClD;AACA;AACA;AACA,wBAAwB,MAAM;AAC9B,IAAI,YAAY;AAChB;AACA;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B;AACA,qBAAqB,MAAM;AAC3B;AACA;AACA,wBAAwB,YAAY,CAAC,iBAAiB;AACtD,MAAM,WAAW;AACjB;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS,qCAAqC,WAAW;AACvE,aAAa,SAAS;AACtB;AACA;AACA,QAAQ,WAAW;AACnB;AACA,aAAa,SAAS;AACtB,eAAe,SAAS;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,KAAK;AACb;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,KAAK;AACX,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,MAAM;AACd,QAAQ;AACR;AACA;AACA;AACA;AACA,kEAAkE,SAAS;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,YAAY;AACjC;AACA,gCAAgC,SAAS;AACzC;AACA;AACA,MAAM,YAAY;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,MAAM;AACzB,kBAAkB;AAClB;AACA;AACA,kBAAkB,MAAM;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,KAAK;AACf;AACA,WAAW;AACX;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,YAAY,MAAM;AAClB,YAAY;AACZ;AACA;AACA,YAAY,KAAK;AACjB;AACA;AACA,QAAQ,YAAY;AACpB,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,eAAe,MAAM;AACrB,qBAAqB,MAAM;AAC3B,IAAI,YAAY;AAChB;AACA;AACA;AACA,QAAQ,MAAM;AACd,QAAQ,YAAY;AACpB;AACA,KAAK;AACL;AACA;AACA;AACA,sBAAsB,iBAAiB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,MAAM;AACxB,mBAAmB,WAAW;AAC9B;AACA;AACA;AACA;AACA;AACA,aAAa,MAAM;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,KAAK;AACjB,WAAW;AACX,UAAU;AACV,UAAU,KAAK;AACf;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,KAAK;AACf;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA,kCAAkC,SAAS;AAC3C;AACA;AACA;AACA;AACA;AACA,qCAAqC,eAAe;AACpD,mCAAmC,eAAe;AAClD;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA,+BAA+B,SAAS;AACxC;AACA,UAAU;AACV;AACA;AACA,qDAAqD,SAAS;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,KAAK;AACb;AACA;AACA,MAAM,YAAY;AAClB,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,YAAY;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,eAAe;AAC9C,SAAS;AACT;AACA,+BAA+B,eAAe;AAC9C,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,cAAc;AACpB,MAAM;AACN,MAAM,cAAc;AACpB;AACA;AACA,MAAM,cAAc;AACpB,MAAM;AACN,MAAM,cAAc;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,SAAS;AACrC,0BAA0B,SAAS;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,MAAM;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,gBAAgB,MAAM;AACtB,qBAAqB,SAAS;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA;AACA;;;ACnd+E;AACrB;AACA;AAC1D;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,KAAK;AACX;AACA,0CAA0C,OAAO;AACjD,UAAU,KAAK;AACf,SAAS;AACT,OAAO;AACP,MAAM;AACN,MAAM,KAAK;AACX,wCAAwC,UAAU;AAClD,QAAQ,KAAK;AACb,OAAO;AACP;AACA;AACA;AACA;AACA,qBAAqB,MAAM;AAC3B,0BAA0B,SAAS,CAAC,UAAU;AAC9C;AACA;AACA;AACA;;;AC3C0F;AACrB;AACK;AACyB;AACpD;AACK;AACpD;AACO;AACP;AACA;AACA;AACA;AACA;AACA,QAAQ,QAAQ;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,iBAAiB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR,eAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA,mBAAmB,cAAc;AACjC;AACA;AACA,MAAM,gBAAgB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,iBAAiB,QAAQ;AACzB,yBAAyB,qBAAqB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,YAAY;AAC5B,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,YAAY;AAC9B,+CAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC9ZkD;AACH;AACK;AACJ;AACI;AACN;AAC9C;AACO;AACP,sBAAsB,WAAW;AACjC,yBAAyB,cAAc;AACvC;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA,mBAAmB,UAAU;AAC7B;AACA;AACA;AACA,GAAG,aAAa;AAChB;AACA;AACA,CAAC;AACD;AACA,uBAAuB,YAAY;AACnC;AACA;AACA,eAAe,MAAM;AACrB;AACA;AACA;AACA;;;ACjCsF;AACd;AACgB;AACnB;AACI;AACrB;AACA;AACV;AACkB;AACgB;AACG;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,KAAK;AACP;AACA;AACA,IAAI,KAAK;AACT,GAAG;AACH;AACA;AACO;AACP,iBAAiB,SAAS;AAC1B;AACA;AACA,EAAE,OAAO;AACT;AACA,mBAAmB,aAAa;AAChC,0BAA0B,gBAAgB;AAC1C,GAAG;AACH;AACA,MAAM,aAAa;AACnB,mBAAmB,WAAW;AAC9B,MAAM,cAAc;AACpB;AACA;AACA,UAAU,QAAQ,YAAY,QAAQ;AACtC;AACA,eAAe,UAAU;AACzB,QAAQ;AACR,eAAe,UAAU;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,aAAa;AAClC;AACA;AACA,uBAAuB,WAAW;AAClC,UAAU,aAAa;AACvB;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL,MAAM,MAAM;AACZ,eAAe,aAAa;AAC5B,KAAK;AACL;;;;;;;UC3EA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;ACNA;AACA,IAAI,0IAA6B;AACjC;AACA,KAAK;AACL,GAAG,I","sources":["webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Web.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/logs/NxLog.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/base/NxDefaults.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/load/NxStyle.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Check.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Help.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/validt/NxSpecs.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/base/NxHost.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/validt/NxStamper.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/base/NxRequest.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Stock.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/storg/NxStorage.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/storg/NxMemory.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/load/NxSrc.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/load/NxInit.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/transl/NxTranslations.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js","webpack://nexus-io/./src/shared/NxState.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/valva/src/modules/constants.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/valva/src/modules/utils.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/valva/src/modules/transitions.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/transl/NxElmTranslate.js","webpack://nexus-io/./src/shared/NxCommons.js","webpack://nexus-io/./src/reader/NxIdent.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/jack-js/src/modules/Style.js","webpack://nexus-io/./src/reader/NxHistory.js","webpack://nexus-io/./src/reader/NxIndex.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxSnippet.js","webpack://nexus-io/./src/shared/NxCdn.js","webpack://nexus-io/./src/shared/NxIcons.js","webpack://nexus-io/./src/reader/NxSource.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxMedia.js","webpack://nexus-io/./src/reader/NxMedia.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxSpin.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxViews.js","webpack://nexus-io/./node_modules/@i-is-as-i-does/nexus-core/src/data/NxNest.js","webpack://nexus-io/./src/reader/NxThread.js","webpack://nexus-io/./src/reader/NxReader.js","webpack://nexus-io/./src/editor/NxAddBtn.js","webpack://nexus-io/./src/editor/NxEditCommons.js","webpack://nexus-io/./src/editor/NxEditStarters.js","webpack://nexus-io/./src/editor/NxEditMenu.js","webpack://nexus-io/./src/editor/NxInputsFactory.js","webpack://nexus-io/./src/editor/NxLocalFormFactory.js","webpack://nexus-io/./src/editor/NxEditInstance.js","webpack://nexus-io/./src/editor/NxEditSwitch.js","webpack://nexus-io/./src/editor/NxEditState.js","webpack://nexus-io/./src/editor/NxEditor.js","webpack://nexus-io/./src/shared/NxStart.js","webpack://nexus-io/webpack/bootstrap","webpack://nexus-io/webpack/runtime/define property getters","webpack://nexus-io/webpack/runtime/hasOwnProperty shorthand","webpack://nexus-io/webpack/runtime/make namespace object","webpack://nexus-io/./src/NxIO.js"],"sourcesContent":["/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function loadJs (signatureVar, url) {\r\n  if (!window[signatureVar]) {\r\n    return new Promise((resolve, reject) => {\r\n      var script = document.createElement('script')\r\n      script.type = 'text/javascript'\r\n      script.onload = () => resolve(script)\r\n      script.onerror = () => reject(new Error('unable to load ' + url))\r\n      script.src = url\r\n      document.body.append(script)\r\n    })\r\n  } else {\r\n    return Promise.resolve(true)\r\n  }\r\n}\r\n\r\nexport function isValidHttpUrl (string) {\r\n  let url\r\n  try {\r\n    url = new URL(string)\r\n  } catch (_) {\r\n    return false\r\n  }\r\n\r\n  return url.protocol === 'http:' || url.protocol === 'https:'\r\n}\r\n\r\nexport function loadJson (url) {\r\n  return fetch(url).then((response) => response.json())\r\n}\r\n\r\nexport function oembedLink (url, provider, maxwidth = null, maxheight = null) {\r\n  provider = provider.toLowerCase()\r\n  var map = {\r\n    youtube: 'https://youtube.com/oembed?url=',\r\n    vimeo: 'https://vimeo.com/api/oembed.json?url=',\r\n    soundcloud: 'https://soundcloud.com/oembed?format=json&url='\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(map, provider)) {\r\n    url = map[provider] + encodeURIComponent(url)\r\n    if (maxwidth != null) {\r\n      url += '&maxwidth=' + maxwidth\r\n    }\r\n    if (maxheight != null) {\r\n      url += '&maxheight=' + maxheight\r\n    }\r\n    return url\r\n  }\r\n\r\n  return false\r\n}\r\n\r\nexport function oembedResponse (oembedLink) {\r\n  return loadJson(oembedLink).then((response) => {\r\n    if (response && Object.prototype.hasOwnProperty.call(response, 'html')) {\r\n      return response\r\n    }\r\n\r\n    throw new Error('invalid oembed response')\r\n  })\r\n}\r\n\r\n\r\nexport function oembedIframe (oembedResponse) {\r\n    // @doc: rebuilding iframe elm for super safe dom insertion\r\n  var url = oembedResponse.html.split('src=\"')[1].split('\"')[0]\r\n  var iframe = document.createElement('IFRAME')\r\n  iframe.width = oembedResponse.width\r\n  iframe.height = oembedResponse.height\r\n  iframe.frameborder = 'no'\r\n  iframe.scrolling = 'no'\r\n  iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'\r\n  iframe.allowfullscreen = true\r\n  iframe.title = oembedResponse.title\r\n  iframe.src = url\r\n  return iframe\r\n}\r\n\r\nexport function pathBasename (path) {\r\n  return path.split(/[\\\\/]/).pop()\r\n}\r\n\r\nexport function pageHasSheet (signatureRule, url) {\r\n  if (document.styleSheets.length) {\r\n    var basename = pathBasename(url)\r\n    for (var i = 0; i < document.styleSheets.length; i++) {\r\n      var sheetUrl = document.styleSheets[i].href\r\n      if (sheetUrl) {\r\n        if (sheetUrl === url || pathBasename(sheetUrl) === basename) {\r\n          return true\r\n        }\r\n        if (sheetUrl.startsWith(window.location.origin) && Object.prototype.hasOwnProperty.call(document.styleSheets[i], 'cssRules')) {\r\n          var rules = document.styleSheets[i].cssRules\r\n\r\n          for (let i = 0; i < rules.length; i++) {\r\n            if (rules[i].selectorText === signatureRule) {\r\n              return true\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return false\r\n}\r\n\r\nexport function loadCss (signatureRule, url, shadowRootElm = null) {\r\n  if (shadowRootElm || !pageHasSheet(signatureRule, url)) {\r\n    return new Promise((resolve, reject) => {\r\n      var link = document.createElement('link')\r\n      link.rel = 'stylesheet'\r\n      link.type = 'text/css'\r\n      link.onload = resolve\r\n      link.onerror = reject\r\n      link.href = url\r\n      if (shadowRootElm) {\r\n        shadowRootElm.append(link)\r\n      } else {\r\n        document.head.append(link)\r\n      }\r\n    })\r\n  } else {\r\n    return Promise.resolve(true)\r\n  }\r\n}\r\n\r\nexport function loadPagePreviewImg (url, useCache = true) {\r\n  // @doc: this is SLOW and MUST be used with parcimony without an API key\r\n  if (isValidHttpUrl(url)) {\r\n    var callback = function (imgsrc) {\r\n      var img = document.createElement('IMG')\r\n      img.src = imgsrc\r\n      return img\r\n    }\r\n    if (useCache) {\r\n      var imgsrc = localStorage.getItem('preview-' + url)\r\n      if (imgsrc) {\r\n        return Promise.resolve(callback(imgsrc))\r\n      }\r\n    }\r\n    return loadJson(\r\n      'https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=' +\r\n        url +\r\n        '&screenshot=true'\r\n    ).then((response) => {\r\n      if (\r\n        response.lighthouseResult &&\r\n        response.lighthouseResult.audits &&\r\n        response.lighthouseResult.audits['final-screenshot'] &&\r\n        response.lighthouseResult.audits['final-screenshot'].details &&\r\n        response.lighthouseResult.audits['final-screenshot'].details.data\r\n      ) {\r\n        var imgsrc =\r\n          response.lighthouseResult.audits['final-screenshot'].details.data\r\n        if (useCache) {\r\n          localStorage.setItem('preview-' + url, imgsrc)\r\n        }\r\n        return callback(imgsrc)\r\n      }\r\n      return Promise.reject(new Error(404))\r\n    })\r\n  }\r\n  return Promise.reject(new Error(400))\r\n}\r\n\r\nexport function stripHttp (url) {\r\n  return url.replace(/^(https?:\\/\\/)?/, '')\r\n}\r\n\r\nexport function stripLastSlash (url) {\r\n  return url.replace(/\\/?$/, '')\r\n}\r\n\r\nexport function displayUrl (url) {\r\n  return stripHttp(url).replace(/\\/*$/, '')\r\n}\r\n\r\nexport function conciseUrl (string, withPath = true) {\r\n  var base = stripHttp(string).split('/')\r\n  if(!base[base.length -1]){\r\n    base.pop()\r\n  }\r\n  string = base[0]\r\n  if (withPath && base.length > 1) {\r\n    if (base.length > 2) {\r\n      string += '/...'\r\n    }\r\n    var last = base.pop()\r\n    if (last.length > 18) {\r\n      last = '...' + last.substring(-15)\r\n    }\r\n    string += '/' + last\r\n  }\r\n  return string\r\n}\r\n\r\nexport function miniUrl (string) {\r\n  var parts = string\r\n    .replace(/^(https?:\\/\\/)?(www.)?/, '')\r\n    .split(':')[0]\r\n    .split('/')[0]\r\n    .split('.')\r\n\r\n  for (var p = 0; p < parts.length; p++) {\r\n    if (parts[p].includes('-')) {\r\n      parts[p] = parts[p]\r\n        .split('-')\r\n        .map((p) => p[0])\r\n        .join('-')\r\n    } else {\r\n      var strar = parts[p].split('')\r\n      var pass = 0\r\n      for (var i = 0; i < strar.length; i++) {\r\n        if (['a', 'e', 'i', 'o', 'u', 'y'].includes(strar[i])) {\r\n          if (pass !== 0 && i !== pass + 1) {\r\n            strar[i] = ''\r\n          } else {\r\n            pass = i\r\n          }\r\n        }\r\n      }\r\n      parts[p] = strar.join('')\r\n    }\r\n  }\r\n  return parts.join('.')\r\n}\r\n\r\nexport function searchUrlParam (name) {\r\n  var results = new RegExp('[?&]' + name + '=([^&#]*)').exec(\r\n    window.location.href\r\n  )\r\n  if (results == null) {\r\n    return null\r\n  } else {\r\n    return results[1] || 0\r\n  }\r\n}\r\n\r\nexport function toLastSlash (url) {\r\n  if (url.lastIndexOf('/') < 8 && url.substring(0, 4) === 'http') {\r\n    url += '/'\r\n  }\r\n  return url.substring(0, url.lastIndexOf('/') + 1)\r\n}\r\n\r\nexport function addFinalSlash (string) {\r\n  if (string.slice(-1) !== '/') {\r\n    string += '/'\r\n  }\r\n  return string\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nvar errors = []\r\nvar consoleLog = false\r\n\r\nexport function setConsoleLog (bool = true) {\r\n  consoleLog = bool\r\n}\r\nexport function clearErr () {\r\n  errors = []\r\n}\r\n\r\nexport function logErr (msg, detail = null) {\r\n  var entry = { msg: msg }\r\n  if (detail) {\r\n    entry.detail = detail\r\n  }\r\n  errors.push(entry)\r\n  if (consoleLog) {\r\n    console.log('Nexus/Error: ' + JSON.stringify(entry))\r\n  }\r\n}\r\n\r\nexport function getErr () {\r\n  return errors\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nexport const defaultIO = 'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/js/NxIO.js'\r\nexport const defaultStyle = 'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NxIO.min.css'\r\nexport const defaultSignatureRule = '.nx-instance'\r\nexport const defaultElmId = '#Nexus'\r\nexport const defaultLang = 'en'\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { loadCss, pageHasSheet } from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\nimport { logErr } from '../logs/NxLog.js'\r\nimport { defaultSignatureRule, defaultStyle } from '../base/NxDefaults.js'\r\n\r\nexport function loadAppCss (url = null, signatureRule = null, fallbackUrl = null) {\r\n  if (!url) {\r\n    url = defaultStyle\r\n  }\r\n  if (!signatureRule) {\r\n    signatureRule = defaultSignatureRule\r\n  }\r\n  if (!fallbackUrl && url !== defaultStyle) {\r\n    fallbackUrl = defaultStyle\r\n  }\r\n  return loadCss(signatureRule, url)\r\n    .then(() => {\r\n      return Promise.resolve(url)\r\n    }).catch((err) => {\r\n      logErr('Theme not found', err.message)\r\n      if (fallbackUrl) {\r\n        return loadAppCss(fallbackUrl)\r\n      } else {\r\n        return Promise.reject(new Error(404))\r\n      }\r\n    })\r\n}\r\n\r\nexport function isCssLoaded (url = null, signatureRule = null) {\r\n  if (!url) {\r\n    url = defaultStyle\r\n  }\r\n  if (!signatureRule) {\r\n    signatureRule = defaultSignatureRule\r\n  }\r\n  return pageHasSheet(signatureRule, defaultStyle)\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function isNonEmptyArr (it) {\r\n  return Array.isArray(it) && it.length\r\n}\r\nexport function isNonEmptyObj (it) {\r\n  return it && it !== null && it.constructor.name === 'Object' && Object.keys(it).length\r\n}\r\nexport function isNonEmptyStr (it) {\r\n  return (typeof it === 'string' || it instanceof String) && it.length\r\n}\r\nexport function seemsLikeValidDate (string) {\r\n  return isNonEmptyStr(string) && !isNaN(new Date(string))\r\n}\r\nexport function isElement (Obj) {\r\n  return Obj instanceof Element\r\n}\r\nexport function isEmpty (it) {\r\n  if (typeof it === 'object') {\r\n    return !Object.keys(it).length\r\n  }\r\n  return !it || !it.length\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function ucFirst (string) {\r\n  return string.charAt(0).toUpperCase() + string.slice(1)\r\n}\r\n\r\nexport function randomInt (min, max) {\r\n  return Math.floor(Math.random() * (max - min + 1) + min)\r\n}\r\n\r\nexport function charCut (string, limit, cutAnywhere = false) {\r\n  string = string.trimEnd()\r\n  if (string.length <= limit) {\r\n    return string\r\n  }\r\n    if(limit < 6){\r\n      return '(...)'\r\n    }\r\n\r\n    if(cutAnywhere || !string.match(/\\s/)){\r\n     return string.substring(0, limit - 5) + '(...)'\r\n    } \r\n      var sp = string.split(/\\s/)\r\n     for(var p = sp.length - 1; p > -1; p--){\r\n      string = string.slice(0, - (sp[p].length + 1))\r\n      if(string.length + 6 < limit){\r\n          break;\r\n      }     \r\n     }\r\n     string += ' (...)'\r\n     return string\r\n}\r\n\r\nexport function randomString (length = 10) {\r\n  var rpt = 1\r\n  if (length > 10) {\r\n    rpt += Math.ceil(length / 10)\r\n  }\r\n  var str = ''\r\n  for (var i = 0; i < rpt; i++) {\r\n    str += Math.random().toString(36).substring(2, 10)\r\n  }\r\n  return str.substring(0, length)\r\n}\r\n\r\nexport function waitForElmInDOM (elmSelector, parentElm = null) {\r\n  if (!parentElm || !(parentElm instanceof Element)) {\r\n    parentElm = document.body\r\n  }\r\n  return new Promise((resolve) => {\r\n    var elm = parentElm.querySelector(elmSelector)\r\n    if (elm) {\r\n      return resolve(elm)\r\n    }\r\n\r\n    var observer = new MutationObserver(() => {\r\n      elm = parentElm.querySelector(elmSelector)\r\n      if (elm) {\r\n        observer.disconnect()\r\n        resolve(elm)\r\n      }\r\n    })\r\n\r\n    observer.observe(parentElm, {\r\n      childList: true,\r\n      subtree: true\r\n    })\r\n  })\r\n}\r\n\r\nexport function replaceDiacritics (text) {\r\n  if (text === '' || text.length === 0) {\r\n    return ''\r\n  }\r\n  var diactricMap = {\r\n    À: 'A',\r\n    Á: 'A',\r\n    Â: 'A',\r\n    Ã: 'A',\r\n    Ä: 'A',\r\n    Å: 'A',\r\n    à: 'a',\r\n    á: 'a',\r\n    â: 'a',\r\n    ã: 'a',\r\n    ä: 'a',\r\n    å: 'a',\r\n    ă: 'a',\r\n    ą: 'a',\r\n    Ò: 'O',\r\n    Ó: 'O',\r\n    Ô: 'O',\r\n    Õ: 'O',\r\n    Ö: 'O',\r\n    Ø: 'O',\r\n    ò: 'o',\r\n    ó: 'o',\r\n    ô: 'o',\r\n    õ: 'o',\r\n    ö: 'o',\r\n    ø: 'o',\r\n    È: 'E',\r\n    É: 'E',\r\n    Ê: 'E',\r\n    Ë: 'E',\r\n    è: 'e',\r\n    é: 'e',\r\n    ê: 'e',\r\n    ë: 'e',\r\n    ð: 'e',\r\n    ę: 'e',\r\n    Ç: 'C',\r\n    ç: 'c',\r\n    ć: 'c',\r\n    č: 'c',\r\n    Ð: 'D',\r\n    đ: 'd',\r\n    ğ: 'g',\r\n    Ì: 'I',\r\n    Í: 'I',\r\n    Î: 'I',\r\n    Ï: 'I',\r\n    ì: 'i',\r\n    í: 'i',\r\n    î: 'i',\r\n    ï: 'i',\r\n    Ł: 'L',\r\n    ł: 'l',\r\n    Ñ: 'N',\r\n    ñ: 'n',\r\n    ń: 'n',\r\n    Š: 'S',\r\n    š: 's',\r\n    Ù: 'U',\r\n    Ú: 'U',\r\n    Û: 'U',\r\n    Ü: 'U',\r\n    ù: 'u',\r\n    ú: 'u',\r\n    û: 'u',\r\n    ü: 'u',\r\n    Ÿ: 'Y',\r\n    ÿ: 'y',\r\n    ý: 'y',\r\n    Ž: 'Z',\r\n    ž: 'z',\r\n    Ż: 'Z',\r\n    ż: 'z',\r\n    ɶ: 'oe',\r\n    Œ: 'OE',\r\n    æ: 'ae',\r\n    Æ: 'AE',\r\n    ß: 'ss'\r\n  }\r\n  var diactrics = Object.keys(diactricMap)\r\n  for (var diactricIndex = 0; diactricIndex < diactrics.length; diactricIndex++) {\r\n    var from = diactrics[diactricIndex]\r\n    var to = diactricMap[from]\r\n    text = text.replace(from, to)\r\n  }\r\n  return text\r\n}\r\n\r\nexport function escapeRegExp (string) {\r\n  return string.replace(/[.*+?^${}()/|[\\]\\\\]/g, '\\\\$&')\r\n}\r\n\r\nexport function splitOnLineBreaks (string) {\r\n  return string.split(/(\\r\\n|\\n|\\r)/gm)\r\n}\r\n\r\nexport function deepCopy (obj) {\r\n  return JSON.parse(JSON.stringify(obj))\r\n}\r\n","/* eslint-disable no-useless-escape */\r\n/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nexport const appUrl = 'https://nexus-dock.github.io/'\r\nexport const typesMap = {\r\n  nxdata: 'Object',\r\n  nexus: 'String',\r\n  author: 'Object',\r\n  handle: 'String',\r\n  about: 'String',\r\n  url: 'String',\r\n  threads: 'Array',\r\n  'threads.item': 'Object',\r\n  id: 'String',\r\n  title: 'String',\r\n  description: 'String',\r\n  content: 'Object',\r\n  timestamp: 'String',\r\n  main: 'String',\r\n  aside: 'String',\r\n  media: 'Object',\r\n  type: 'String',\r\n  caption: 'String',\r\n  linked: 'Array',\r\n  'linked.item': 'String'\r\n}\r\nexport const required = ['nexus', 'author', 'threads', 'handle', 'url', 'id', 'title', 'content', 'timestamp', 'main', 'type']\r\n\r\nexport const fallbacks = {\r\n  handle:\"---\",\r\n  url:\"http://...\",\r\n  id:\"---\",\r\n  title:\"---\",\r\n  timestamp: \"0000-00-00\",\r\n  main: \"...\",\r\n  type: \"page\"\r\n}\r\n\r\nexport const charMinMax = {\r\n  handle: [3, 30],\r\n  about: [0, 400],\r\n  title: [3, 30],\r\n  description: [0, 400],\r\n  main: [1, 1000],\r\n  aside: [0, 400],\r\n  caption: [0, 200]\r\n}\r\nexport const itemsMinMax = {\r\n  threads: [1, 100],\r\n  linked: [0, 100]\r\n}\r\nexport const supportedOembedMedia = [\r\n  'youtube',\r\n  'vimeo',\r\n  'soundcloud'\r\n]\r\nexport const supportedBaseMedia = [\r\n  'page',\r\n  'video',\r\n  'image',\r\n  'audio'\r\n]\r\nexport const supportedMediaTypes = supportedBaseMedia.concat(supportedOembedMedia)\r\nexport const timestampPattern =\r\n    '^[0-9]{4}((-|\\s|\\.|\\/)(0[1-9]|1[0-2])((-|\\s|\\.|\\/)(0[1-9]|[1-2][0-9]|3[0-1]))?)?'\r\nexport const idPattern = '^[a-zA-Z0-9-]{3,36}$'\r\nexport const urlPattern = '^https?:\\/\\/.*'\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nimport { toLastSlash } from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\n\r\nexport const currentUrl = window.location.href\r\nexport const baseCurrentUrl = toLastSlash(currentUrl)\r\nexport const queries = new URLSearchParams(window.location.search.slice(1))\r\n\r\nexport function getQuery (key) {\r\n  return queries.has(key)\r\n}\r\nexport function getAbsoluteUrl (url) {\r\n  if (url.length && url.substring(0, 4) !== 'http') {\r\n    return baseCurrentUrl + url.replace(/^\\.?\\/?/, '')\r\n  }\r\n  return url\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport {\r\n  isEmpty,\r\n  isNonEmptyObj,\r\n  seemsLikeValidDate\r\n} from '@i-is-as-i-does/jack-js/src/modules/Check.js'\r\nimport {\r\n  charCut\r\n} from '@i-is-as-i-does/jack-js/src/modules/Help.js'\r\nimport {\r\n  isValidHttpUrl\r\n} from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\n\r\nimport {\r\n  charMinMax,\r\n  itemsMinMax,\r\n  appUrl,\r\n  supportedMediaTypes,\r\n  timestampPattern,\r\n  idPattern,\r\n  typesMap,\r\n  fallbacks\r\n} from './NxSpecs.js'\r\nimport { logErr } from '../logs/NxLog.js'\r\nimport { getAbsoluteUrl } from '../base/NxHost.js'\r\n\r\nexport function charLimits (catg) {\r\n  if (Object.prototype.hasOwnProperty.call(charMinMax, catg)) {\r\n    return charMinMax[catg]\r\n  }\r\n  logErr('Unknown characters limits category', catg)\r\n  return false\r\n}\r\n\r\nexport function itmLimits (catg) {\r\n  if (Object.prototype.hasOwnProperty.call(itemsMinMax, catg)) {\r\n    return itemsMinMax[catg]\r\n  }\r\n  logErr('Unknown items limits category', catg)\r\n  return false\r\n}\r\n\r\nexport function isValidMediaType (mediaType) {\r\n  if (\r\n    hasValidType(mediaType, 'type', true) &&\r\n      supportedMediaTypes.includes(mediaType)\r\n  ) {\r\n    return true\r\n  }\r\n\r\n  logErr('Invalid media type', mediaType)\r\n  return false\r\n}\r\n\r\nexport function extendString (str, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    var diff = limits[0] - str.length\r\n    if (diff > 0) {\r\n      var placeholder = '-'\r\n      str = placeholder.repeat(diff) + str\r\n    }\r\n    return str\r\n  }\r\n  logErr('Unable to extend string', catg)\r\n  return str\r\n}\r\n\r\nexport function validLenghtStr (str, catg, nonEmpty = true) {\r\n  if(str.length || nonEmpty){\r\n  if (!strHasValidMinLength(str, catg)) {\r\n      str = extendString(str, catg)\r\n  } else if (!strHasValidMaxLength(str, catg)) {\r\n    str = cutString(str, catg)\r\n  }\r\n}\r\n  return str\r\n}\r\n\r\nexport function hasValidType (item, field, nonEmpty = true) {\r\n  if (Object.prototype.hasOwnProperty.call(typesMap, field)) {\r\n    var type = typesMap[field]\r\n    if (\r\n      typeof item !== 'undefined' &&\r\n        item !== null &&\r\n        item.constructor.name === type\r\n    ) {\r\n      if (!nonEmpty || !isEmpty(item)) {\r\n        return true\r\n      }\r\n      logErr('Field is empty', field)\r\n    } else {\r\n      logErr('Invalid field type', field)\r\n    }\r\n  } else {\r\n    logErr('Unknown field', field)\r\n  }\r\n\r\n  return false\r\n}\r\n\r\nexport function emptyMedia(){\r\nreturn {\r\n  url:'',\r\n  type:'',\r\n  caption:''\r\n}\r\n}\r\n\r\nexport function validMediaCaption(caption){\r\n  if (caption && hasValidType(caption, 'caption', false)) {\r\n    return validLenghtStr(caption, 'caption', false)\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function validMediaType(mediaType, hasMediaUrl){\r\n  if(!hasMediaUrl){\r\n    return ''\r\n  }\r\n  if(isValidMediaType(mediaType)){\r\n    return mediaType\r\n  }\r\n  return fallbacks.type\r\n}\r\n\r\nexport function validMedia (mediaObj, lax = false) {\r\n  if (hasValidType(mediaObj, 'media', true)){\r\n    var url = null\r\n    if(isValidUrl(mediaObj.url, lax)){\r\n      url = mediaObj.url\r\n    } \r\n    if(url || lax){\r\n      var type = validMediaType(mediaObj.type, url !== null)\r\n      var caption = validMediaCaption(mediaObj.caption)\r\n      if(type || caption){\r\n        if(!url){\r\n          url = fallbacks.url\r\n        }\r\n        return {\r\n          url: url,\r\n          type: type,\r\n          caption: caption\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return emptyMedia()\r\n}\r\n\r\nexport function isValidTimestamp (timestamp, strict = false) {\r\n  if (timestamp &&\r\n    hasValidType(timestamp, 'timestamp', true) &&\r\n      (timestamp.match(timestampPattern) ||\r\n        (!strict && seemsLikeValidDate(timestamp)))\r\n  ) {\r\n    return true\r\n  }\r\n  logErr('Invalid timestamp', timestamp)\r\n  return false\r\n}\r\n\r\nexport function fallbackContent(lax = false){\r\n  if(lax){\r\n    return {\r\n      timestamp: fallbacks.timestamp,\r\n      main: fallbacks.main,\r\n      aside: '',\r\n      media: emptyMedia()\r\n    }\r\n  } \r\n    return null\r\n}\r\n\r\nexport function formatTimestamp(timestamp){\r\n  if(!timestamp){\r\n    return fallbacks.timestamp;\r\n  }\r\n  if(timestamp.match(timestampPattern+'$')){\r\n      return timestamp\r\n  }\r\n    try {\r\n      timestamp = new Date(timestamp).toISOString().split('T')[0]\r\n    } catch (e){\r\n      logErr('Invalid timestamp', timestamp)\r\n      timestamp = fallbacks.timestamp\r\n    }\r\n  return timestamp\r\n}\r\n\r\nexport function validTimestamp(timestamp, lax = false){\r\n  if(isValidTimestamp (timestamp, false)){\r\n    return formatTimestamp(timestamp)\r\n  }\r\n  if(lax){\r\n    return fallbacks.timestamp\r\n  }\r\n  return null\r\n}\r\n\r\nexport function validMainContent(main, lax = false){\r\n  if(hasValidType(main, 'main', true)){\r\n    return validLenghtStr(main, 'main', true)\r\n  }\r\n  if(lax){\r\n    return fallbacks.main\r\n  }\r\n  return null\r\n}\r\n\r\nexport function validAsideContent(aside){\r\n  if(aside && hasValidType(aside,'aside', false)){\r\n    return validLenghtStr(aside, 'aside', false)\r\n  } \r\n    return '' \r\n}\r\n\r\nexport function validContent(content, lax = false) {\r\n  if (!hasValidType(content, 'content', true)) {\r\n    return fallbackContent(lax)\r\n  }\r\n  var timestamp = validTimestamp(content.timestamp, lax)\r\n  if(!timestamp){\r\n    return null\r\n  }\r\n  var main = validMainContent(content.main, lax)\r\n  if(!main){\r\n    return null\r\n  }\r\n  var c = {}\r\n  c.timestamp = timestamp\r\n  c.main = main\r\n  c.aside = validAsideContent(content.aside)\r\n  c.media = validMedia(content.media, lax)\r\n  return c\r\n}\r\n\r\nexport function cutString (item, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    return charCut(item, limits[1])\r\n  }\r\n  logErr('Unable to cut string', catg)\r\n  return ''\r\n}\r\n\r\nexport function strHasValidMaxLength (item, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    if (item.length <= limits[1]) {\r\n      return true\r\n    }\r\n    logErr('Invalid max length', catg)\r\n  }\r\n  return false\r\n}\r\nexport function strHasValidMinLength (item, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    if (item.length >= limits[0]) {\r\n      return true\r\n    }\r\n    logErr('Invalid min length', catg)\r\n  }\r\n  return false\r\n}\r\n\r\nexport function hasValidLength (item, catg) {\r\n  var limits = charLimits(catg)\r\n  if (limits !== false) {\r\n    if (item.length >= limits[0] && item.length <= limits[1]) {\r\n      return true\r\n    }\r\n    logErr('Invalid length', catg)\r\n  }\r\n  return false\r\n}\r\n\r\nexport function splitUrlAndId (url) {\r\n  var rt = {\r\n    url: null,\r\n    id: ''\r\n  }\r\n  if (isValidHttpUrl(url)) {\r\n    rt.url = url\r\n\r\n    if (url.includes('#')) {\r\n      var sp = url.split('#')\r\n      var id = sp.pop()\r\n      rt.url = sp.join('#')\r\n      if (id && isValidId(id)) {\r\n        rt.id = id\r\n      }\r\n    }\r\n  }\r\n\r\n  return rt\r\n}\r\n\r\nexport function isValidId (id) {\r\n  if (hasValidType(id, 'id', true) && id.match(idPattern)) {\r\n    return true\r\n  }\r\n\r\n  logErr('Invalid thread id', id)\r\n  return false\r\n}\r\n\r\nexport function isValidUrl (url, lax = false) {\r\n  var pass = false\r\n  if (url && hasValidType(url, 'url', true)) {\r\n    if(isValidHttpUrl(url)){\r\n      return true\r\n    }\r\n    if(lax){\r\n      pass = true\r\n    }\r\n  }\r\n  logErr('Invalid url')\r\n  return pass\r\n}\r\n\r\nexport function isValidLinkItm (link) {\r\n  if (\r\n   link && hasValidType(link, 'linked.item', true) &&\r\n      isValidUrl(link)\r\n  ) {\r\n    return true\r\n  }\r\n  logErr('Invalid linked thread')\r\n  return false\r\n}\r\n\r\n\r\nexport function isValidLegacyLinkItm(item){\r\n  return isNonEmptyObj(item) && isValidUrl(item.url) && (!item.id || item.id === '/' || isValidId(item.id))\r\n}\r\n\r\nexport function getValidSrcUrl (url, id) {\r\n  url = getAbsoluteUrl(url)\r\n  if (isValidUrl(url)) {\r\n    if (id && isValidId(id)) {\r\n      url += '#' + id\r\n    }\r\n    return url\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function validLinks (linked) {\r\n  var vlinked = []\r\n  if (hasValidType(linked, 'linked', false)) {\r\n    var len = linked.length\r\n    var limit = itmLimits('linked')[1]\r\n    if (len > limit) {\r\n      logErr('Too many linked threads', len + ' /' + limit)\r\n      len = limit\r\n    }\r\n    for (var i = 0; i < len; i++) {\r\n      var url = null\r\n      if (isValidLinkItm(linked[i])) {\r\n        var split = splitUrlAndId(linked[i])\r\n        url = split.url\r\n        if (split.id) {\r\n          url += '#' + split.id\r\n        }\r\n      } else if(isValidLegacyLinkItm(linked[i])){\r\n        url = linked[i].url\r\n        if (linked[i].id && linked[i].id !== '/') {\r\n          url += '#' + linked[i].id\r\n        }\r\n      }\r\n\r\n        if(url){\r\n        if (!vlinked.includes(url)) {\r\n          vlinked.push(url)\r\n        } else {\r\n          logErr('Duplicate linked thread', url)\r\n        }\r\n      }\r\n        \r\n      }\r\n    }\r\n  return vlinked\r\n}\r\n\r\nexport function uniqueId(id, previousThreadsIds){\r\n  if (previousThreadsIds.includes(id)) {       \r\n    logErr('Duplicate thread id', id)\r\n    var adt = 2\r\n    while(previousThreadsIds.includes(id+ '-'+ adt)){\r\n      adt++\r\n    }\r\n   id += '-'+ adt\r\n  }\r\n  return id\r\n}\r\n\r\nexport function validThreadId(id, previousThreadsIds = [], lax = false){\r\n  if(isValidId(id)){\r\n    return uniqueId(id, previousThreadsIds)\r\n  }\r\n    if(lax){\r\n     return uniqueId(fallbacks.id, previousThreadsIds)\r\n    }\r\n    return null\r\n}\r\n\r\nexport function validThreadTitle(title, lax = false){\r\n\r\n  if(hasValidType(title,'title', true)){\r\n    return validLenghtStr(title, 'title', true)\r\n  } \r\n  if(lax){\r\n    return fallbacks.title\r\n  }\r\n  return null\r\n}\r\n\r\nexport function validThreadDescription(description){\r\n  if(description && hasValidType(description,'description', false)){\r\n    return validLenghtStr(description, 'description', false)\r\n  } \r\n    return '' \r\n}\r\n\r\nexport function validThread (thread, previousThreadsIds = [], lax = false) {\r\n  if (!hasValidType(thread, 'threads.item', true)) {\r\n    return null\r\n  }\r\n  var id = validThreadId(thread.id, previousThreadsIds, lax)\r\n  if(!id){\r\n    return null\r\n  }\r\n  var title = validThreadTitle(thread.title, lax)\r\n  if(!title){\r\n    return null\r\n  }\r\n  var content = validContent(thread.content, lax)\r\n  if(!content){\r\n    return null\r\n  }\r\n  var t = {}\r\n  t.id = id\r\n  t.title = title\r\n  t.description = validThreadDescription(thread.description)\r\n  t.content = content\r\n  t.linked = validLinks(thread.linked)\r\n  return t\r\n}\r\n\r\nexport function validThreads (threads, lax = false) {\r\n  var vthreads = []\r\n\r\n  if (hasValidType(threads, 'threads', true)) {\r\n    var len = threads.length\r\n    var limit = itmLimits('threads')[1]\r\n    if (len > limit) {\r\n      logErr('Too many threads', len + ' /' + limit)\r\n      len = limit\r\n    }\r\n    var ids = []\r\n    for (var i = 0; i < len; i++) {\r\n      var thread = validThread(threads[i], ids, lax)\r\n\r\n      if (thread !== null) {   \r\n        ids.push(thread.id)\r\n        vthreads.push(thread)\r\n      }\r\n    }\r\n\r\n    if (vthreads.length) {\r\n      return vthreads\r\n    }\r\n  }\r\n  logErr('No valid thread')\r\n  return []\r\n}\r\n\r\n\r\nexport function validAuthorHandle(handle, lax = false){\r\n  if(hasValidType(handle, 'handle', true)){  \r\n    return validLenghtStr(handle, 'handle', true)\r\n  }\r\n  if(lax){\r\n      return fallbacks.handle\r\n    }    \r\n  return null\r\n}\r\n\r\nexport function validAuthorUrl(url, lax = false){\r\n  if(isValidUrl(url,  lax)){\r\n   return url\r\n  } \r\n  if(lax){\r\n    return fallbacks.url\r\n  }\r\n  return null\r\n}\r\n\r\nexport function validAuthorAbout(about){\r\n  if (about && hasValidType(about, 'about', false)) {\r\n    return validLenghtStr(about, 'about', false)\r\n    } \r\n    return ''\r\n}\r\n\r\nexport function fallbackAuthor(lax = false){\r\n  if(lax){\r\n    return {\r\n      handle:fallbacks.handle,\r\n      about: '',\r\n      url:fallbacks.url\r\n    }\r\n  } \r\n    return null\r\n}\r\n\r\nexport function validAuthor (author, lax = false) {\r\n\r\n  if (!hasValidType(author, 'author', true)) {\r\n   return fallbackAuthor(lax)\r\n  }\r\n  var handle = validAuthorHandle(author.handle, lax)\r\n  if(!handle){\r\n    return null\r\n  }\r\n  var url = validAuthorUrl(author.url, lax)\r\n  if(!url){\r\n    return null\r\n  }\r\n  var a = {}\r\n  a.handle = handle\r\n  a.about = validAuthorAbout(author.about)\r\n  a.url = url\r\nreturn a\r\n}\r\n\r\nexport function isValidAppUrl (url) {\r\n  if (isValidUrl(url) && url === appUrl) {\r\n    return true\r\n  }\r\n  logErr('Invalid app url')\r\n  return false\r\n}\r\n\r\nexport function validAppUrl (url) {\r\n  if (!isValidAppUrl(url)) {\r\n    url = appUrl\r\n  }\r\n  return url\r\n}\r\n\r\nexport function validData (nxdata, lax = false) {\r\n  if (hasValidType(nxdata, 'nxdata', true)) {\r\n    var d = {}\r\n    d.nexus = validAppUrl(nxdata.nexus)\r\n    d.author = validAuthor(nxdata.author, lax)\r\n    if (d.author) {\r\n      d.threads = validThreads(nxdata.threads, lax)\r\n      if (lax || d.threads.length) {\r\n        return d\r\n      }\r\n    }\r\n  }\r\n  return null\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { isValidHttpUrl } from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\nimport { splitUrlAndId, isValidId } from '../validt/NxStamper.js'\r\nimport { defaultLang, defaultStyle } from './NxDefaults.js'\r\nimport { getAbsoluteUrl, getQuery, currentUrl } from './NxHost.js'\r\n\r\nexport const splitCurrentUrl = splitUrlAndId(currentUrl)\r\nexport const appModes = ['reader', 'editor']\r\n\r\nfunction solveUrlAndId(request, dataset){\r\n  if(dataset){\r\n    if (dataset.src) {\r\n      var split = splitUrlAndId(getAbsoluteUrl(dataset.src))\r\n  \r\n      if (split.url) {\r\n        request.url = split.url\r\n        request.id = split.id\r\n      }\r\n    }\r\n    if (dataset.id && isValidId(dataset.id)) {\r\n      request.id = dataset.id // @doc: id specified in data-id trumps id contained in src url; legacy support\r\n    }\r\n  }\r\n\r\n  if (splitCurrentUrl.id) {\r\n    request.id = splitCurrentUrl.id // @doc: id specified in url trumps all\r\n  }\r\n}\r\n\r\nfunction solveStyle(request, dataset, appDefaultCssAliases){\r\n    if (dataset && dataset.style && dataset.style !== request.style && !appDefaultCssAliases.includes(dataset.style)) {\r\n      var cssUrl = getAbsoluteUrl(dataset.style)\r\n      if (isValidHttpUrl(cssUrl)) {\r\n        request.style = cssUrl\r\n      }\r\n    }\r\n}\r\n\r\nfunction solveMode(request, dataset){\r\n  if((dataset && dataset.mode && dataset.mode === 'editor') || getQuery('edit') || getQuery('new')){\r\n    request.mode = 'editor'\r\n  }\r\n}\r\n\r\n\r\nexport function getRequest (NxElm, appDefaultCss = null, appDefaultCssAliases = [], appDefaultLang = null) {\r\n  if(!appDefaultCss){\r\n    appDefaultCss = defaultStyle\r\n  }\r\n  if(!appDefaultLang){\r\n    appDefaultLang = defaultLang\r\n  }\r\n  var request = {\r\n    srcdoc: null,\r\n    url: '',\r\n    id: '',\r\n    style: appDefaultCss,\r\n    lang: appDefaultLang,\r\n    mode: 'reader'\r\n  }\r\n  var dataset = null\r\n  if (NxElm && NxElm.dataset) {\r\n    dataset = NxElm.dataset\r\n    if (dataset.lang) {\r\n      request.lang = dataset.lang\r\n    }\r\n    if(dataset.srcdoc){\r\n      request.srcdoc = dataset.srcdoc\r\n    } \r\n    solveStyle(request, dataset, appDefaultCssAliases)\r\n  }\r\n  solveUrlAndId(request, dataset)\r\n  solveMode(request, dataset)\r\n\r\n  return request\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function getLocalStorage () {\r\n  if (isStorageAvailable('localStorage')) {\r\n    return localStorage\r\n  }\r\n  return null\r\n}\r\n\r\nexport function getSessionStorage () {\r\n  if (isStorageAvailable('sessionStorage')) {\r\n    return sessionStorage\r\n  }\r\n  return null\r\n}\r\n\r\nexport function sizeInBytes (s) {\r\n  return new TextEncoder().encode(s).length\r\n}\r\n\r\nexport function jsonSize (obj, inKb = true) {\r\n  var sz = sizeInBytes(JSON.stringify(obj))\r\n  if (inKb) {\r\n    sz = sz / 1000\r\n  }\r\n  return sz\r\n}\r\n\r\nexport function clearPartialStorage (store, threshold = 2000) {\r\n  var currentKb = jsonSize(store, true)\r\n  for (var i = 0; i < store.length; i++) {\r\n    if (currentKb < threshold) {\r\n      break\r\n    }\r\n    var itmkey = store.key(i)\r\n    var itemsize = jsonSize(store.getItem(itmkey), true)\r\n    store.removeItem(itmkey)\r\n    currentKb -= itemsize\r\n  }\r\n  return currentKb\r\n}\r\n\r\nexport function isStorageAvailable (type) {\r\n  var storage\r\n  try {\r\n    storage = window[type]\r\n    var x = '__storage_test__'\r\n    storage.setItem(x, x)\r\n    storage.removeItem(x)\r\n    return true\r\n  } catch (e) {\r\n    return (\r\n      e instanceof DOMException &&\r\n      (e.code === 22 ||\r\n        e.code === 1014 ||\r\n        e.name === 'QuotaExceededError' ||\r\n        e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\r\n      storage &&\r\n      storage.length !== 0\r\n    )\r\n  }\r\n}\r\n\r\nexport function copyToClipboard (content, callback) {\r\n  navigator.clipboard.writeText(content).then(() => callback())\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport {\r\n  clearPartialStorage,\r\n  getLocalStorage,\r\n  getSessionStorage,\r\n  jsonSize,\r\n} from '@i-is-as-i-does/jack-js/src/modules/Stock.js'\r\n\r\nvar instStores = {\r\n  visit: {},\r\n  data: {},\r\n  linked: {},\r\n  oembed: {},\r\n}\r\n\r\nvar brwsrStores = {\r\n  local: getLocalStorage(),\r\n  session: getSessionStorage(),\r\n}\r\n\r\nObject.values(brwsrStores).forEach((store) => {\r\n  if (store && !store.getItem('available')) {\r\n    store.setItem('available', 5000)\r\n  }\r\n})\r\n\r\nexport function getBrowserStore(storage) {\r\n  if (storage === 'local') {\r\n    return brwsrStores.local\r\n  }\r\n  return brwsrStores.session\r\n}\r\n\r\nexport function getInstStore(instanceStore){\r\n  if(instStoreExists(instanceStore)){\r\n    return instStores[instanceStore]\r\n  }\r\n  return null\r\n}\r\n\r\nexport function instStoreExists(instanceStore) {\r\n  return instanceStore && Object.prototype.hasOwnProperty.call(instStores, instanceStore)\r\n}\r\n\r\nexport function instStoreHasKey(instanceStore, key) {\r\n  return (\r\n    instStoreExists(instanceStore) &&\r\n    Object.prototype.hasOwnProperty.call(instStores[instanceStore], key)\r\n  )\r\n}\r\n\r\nexport function storeItem(key, data, storage = 'session', instanceStore = null) {\r\n  var sdata = JSON.stringify(data)\r\n  if (instStoreExists(instanceStore)) {\r\n    instStores[instanceStore][key] = sdata\r\n  }\r\n  if(storage){\r\n  var store = getBrowserStore(storage)\r\n  if (store) {\r\n    var datasize = jsonSize(sdata, true, true)\r\n    if (datasize > 2000) {\r\n      return\r\n    }\r\n\r\n    var avail = store.getItem('available')\r\n    if (avail < 1000) {\r\n      avail = 5000 - clearPartialStorage(store, 2000)\r\n    }\r\n    avail -= datasize\r\n    store.setItem(key, sdata)\r\n    store.setItem('available', Math.ceil(avail))\r\n  }\r\n}\r\n}\r\n\r\nexport function getStoredItem(key, storage = 'session', instanceStore = null) {\r\n  if (instStoreHasKey(instanceStore, key)) {\r\n    return JSON.parse(instStores[instanceStore][key])\r\n  }\r\n  if(storage){\r\n  var store = getBrowserStore(storage)\r\n  if (store) {\r\n    var sdata = store.getItem(key)\r\n    if (sdata) {\r\n      if (instStoreExists(instanceStore)) {\r\n        instStores[instanceStore][key] = sdata\r\n      }\r\n      return JSON.parse(sdata)\r\n    }\r\n  }\r\n}\r\n  return null\r\n}\r\n\r\nexport function removeItem(key, storage = 'session', instanceStore = null) {\r\n  if (instStoreHasKey(instanceStore, key)) {\r\n    delete instStores[instanceStore][key]\r\n  }\r\n  if(storage){\r\n  var store = getBrowserStore(storage)\r\n  if (store) {\r\n    store.removeItem(key)\r\n  }\r\n}\r\n}\r\n\r\nexport function clearInstanceStores(excludeStores = []) {\r\n  Object.keys(instStores).forEach((instanceStore) => {\r\n    if (!excludeStores.includes(instanceStore)) {\r\n      instStores[instanceStore] = {}\r\n    }\r\n  })\r\n}\r\n\r\nexport function clearBrowserStores(excludeStore = null) {\r\n  Object.keys(brwsrStores).forEach((name) => {\r\n    if (brwsrStores[name] && excludeStore !== name) {\r\n      brwsrStores[name].clear()\r\n    }\r\n  })\r\n}\r\n\r\n\r\nexport function walkLocalStore(callback){\r\n  var locStore = getBrowserStore('local')\r\n  if (locStore && locStore.length) {\r\n    for (var i = 0; i < locStore.length; i++) {\r\n      var key = locStore.key(i)\r\n      callback(locStore, key)\r\n    }\r\n  }\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nimport {\r\n  clearBrowserStores,\r\n  clearInstanceStores,\r\n  getStoredItem,\r\n  instStoreHasKey,\r\n  removeItem,\r\n  storeItem,\r\n  walkLocalStore,\r\n} from './NxStorage.js'\r\n\r\nexport const editPrefix = 'nx-edit#'\r\n\r\nexport function registerEditData(url, nxdata) {\r\n  storeItem(editPrefix + url, nxdata, 'local')\r\n}\r\n\r\nexport function getStoredEditData(url) {\r\n  return getStoredItem(editPrefix + url, 'local')\r\n}\r\n\r\nexport function registerThreadVisit(src, timestamp) {\r\n  if (!instStoreHasKey('visit', src)) {\r\n    storeItem(src, timestamp, 'local', 'visit')\r\n  }\r\n}\r\n\r\nexport function isThreadContentUnseen(src, timestamp) {\r\n  var lastKnownDate = getStoredItem(src, 'local', 'visit')\r\n\r\n  if (!lastKnownDate) {\r\n    return true\r\n  }\r\n  if (timestamp && lastKnownDate !== timestamp) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function clearData(url) {\r\n  removeItem(url, null, 'data')\r\n}\r\n\r\nexport function registerData(url, nxdata) {\r\n  storeItem(url, nxdata, null, 'data')\r\n}\r\n\r\nexport function registerLinkedMaps(src, map) {\r\n  storeItem(src + ':linked', map, null, 'linked')\r\n}\r\n\r\nexport function getStoredLinkedMaps(src) {\r\n  return getStoredItem(src + ':linked', null, 'linked')\r\n}\r\n\r\nexport function getStoredData(url) {\r\n  return getStoredItem(url, null, 'data')\r\n}\r\n\r\nexport function registerOembedResponse(givenUrl, response) {\r\n  storeItem(givenUrl, response, 'local', 'oembed')\r\n}\r\n\r\nexport function getStoredOembedResponse(givenUrl) {\r\n  return getStoredItem(givenUrl, 'local', 'oembed')\r\n}\r\n\r\nexport function setStoredLang(lang) {\r\n  storeItem('nx-lang', lang, 'local')\r\n}\r\nexport function getStoredLang() {\r\n  return getStoredItem('nx-lang', 'local')\r\n}\r\n\r\nexport function clearAllCache() {\r\n  clearInstanceStores()\r\n  clearBrowserStores()\r\n}\r\n\r\nexport function eraseReaderSaves() {\r\n  walkLocalStore(function(locStore, key){\r\n    if (key.indexOf(editPrefix) === 0) {\r\n      locStore.removeItem(key)\r\n    }\r\n  })\r\n}\r\n\r\nexport function clearReaderCache() {\r\n  clearInstanceStores()\r\n  clearBrowserStores('local')\r\n  walkLocalStore(function(locStore, key){\r\n    if (key.indexOf(editPrefix) !== 0) {\r\n      locStore.removeItem(key)\r\n    }\r\n  })\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { loadJson } from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\nimport { logErr } from '../logs/NxLog.js'\r\nimport { getStoredData, registerData } from '../storg/NxMemory.js'\r\nimport { validData } from '../validt/NxStamper.js'\r\n\r\nexport function getThreadsList (nxdata) {\r\n  var list = []\r\n  nxdata.threads.forEach((thread) => {\r\n    list.push(thread.id)\r\n  })\r\n  return list\r\n}\r\n\r\nexport function loadSrc (url, lax = false) {\r\n  // @doc: src should not contain #id\r\n  return loadJson(url)\r\n    .then((nxdata) => {\r\n      nxdata = validData(nxdata, lax)\r\n\r\n      if (nxdata) {\r\n        if(!lax){\r\n          registerData(url, nxdata)\r\n        }\r\n        return nxdata\r\n      }\r\n      logErr('Invalid source', url)\r\n      return Promise.reject(new Error(400))\r\n    })\r\n    .catch((err) => {\r\n      var code = 400\r\n      if (err.message !== 400) {\r\n        code = 404\r\n        logErr('No response', err.message)\r\n      }\r\n      registerData(url, code)\r\n      return Promise.reject(new Error(code))\r\n    })\r\n}\r\n\r\nexport function getSrcDocData(jsonData, lax = false) {\r\n  var nxdata = null\r\n  try {\r\n    var nxdata = JSON.parse(jsonData)\r\n    if(nxdata){\r\n      nxdata = validData(nxdata, lax)\r\n    }\r\n    if(!nxdata){\r\n      throw new Error('Invalid Nexus data')\r\n    }\r\n} catch (err) {\r\n  logErr('Invalid source', err.message)\r\n}\r\nreturn nxdata\r\n}\r\n\r\nexport function loadSrcFile (inputEvt, lax = false) {\r\n  if (inputEvt.target.files.length) {\r\n    if (inputEvt.target.files[0].type === 'application/json') {\r\n      return new Promise((resolve, reject) => {\r\n        var reader = new FileReader()\r\n        reader.onload = function (event) {\r\n          var nxdata = getSrcDocData(event.target.result, lax)\r\n          if (nxdata) {\r\n            resolve(nxdata)\r\n          } else {\r\n            reject(new Error(400))\r\n          }\r\n        }\r\n        return reader.readAsText(inputEvt.target.files[0])\r\n      })\r\n    }\r\n    logErr('Invalid file type', inputEvt.target.files[0])\r\n    return Promise.reject(new Error(400))\r\n  }\r\n  logErr('No file selected')\r\n  return Promise.reject(new Error(400))\r\n}\r\n\r\nexport function getSrcData (url, lax = false) {\r\n  // @doc: url should not contain #id\r\n  var nxdata = getStoredData(url)\r\n  if (nxdata !== null) {\r\n    if (Number.isInteger(nxdata)) {\r\n      return Promise.reject(new Error(nxdata))\r\n    }\r\n    return Promise.resolve(nxdata)\r\n  }\r\n  return loadSrc(url, lax)\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nimport { loadAppCss } from './NxStyle.js'\r\nimport { logErr, setConsoleLog } from '../logs/NxLog.js'\r\nimport { getRequest } from '../base/NxRequest.js'\r\nimport { getQuery } from '../base/NxHost.js'\r\nimport { getSrcData, getSrcDocData } from './NxSrc.js'\r\nimport { defaultElmId } from '../base/NxDefaults.js'\r\nimport { eraseReaderSaves, clearReaderCache } from '../storg/NxMemory.js'\r\n\r\nexport const defaultInitOptions = {\r\n  customSelector: null,\r\n  forceLog: false,\r\n  forceStyle: null,\r\n  customSignatureRule: null,\r\n  appDefaultCss: null, \r\n  appDefaultCssAliases: [],\r\n  appDefaultLang: null\r\n}\r\n\r\nexport function checkCacheRequests(){\r\n  if(getQuery('clear')){\r\n    clearReaderCache()\r\n  }\r\n if(getQuery('erase')){\r\n  eraseReaderSaves()\r\n  }\r\n}\r\n\r\nexport function setCookie () {\r\n  document.cookie = 'Nx=Instance; SameSite=None; Secure'\r\n}\r\n\r\nexport function initLogger (forceLog = false) {\r\n  if (forceLog || getQuery('log')) {\r\n    setConsoleLog(true)\r\n  }\r\n}\r\n\r\nexport function retrieveNxElm (customSelector = null) {\r\n  var selectors = [defaultElmId]\r\n  if (customSelector && customSelector !== defaultElmId) {\r\n    selectors.unshift(customSelector)\r\n  }\r\n  var elm\r\n  for (var s = 0; s < 2; s++) {\r\n    elm = document.querySelector(selectors[s])\r\n    if (elm) {\r\n      return elm\r\n    }\r\n  }\r\n  elm = document.createElement('DIV')\r\n  elm.id = defaultElmId\r\n\r\n  return elm\r\n}\r\n\r\nexport function resolveTheme (request, fallbackCssUrl = null, forceStyle = null, customSignatureRule = null) {\r\n  var url = request.style\r\n  if (forceStyle) {\r\n    url = forceStyle\r\n    if(!fallbackCssUrl || fallbackCssUrl === forceStyle){\r\n      fallbackCssUrl = request.style\r\n    } \r\n  } else if(fallbackCssUrl === url){\r\n    fallbackCssUrl = null\r\n  }\r\n  return loadAppCss(url, customSignatureRule, fallbackCssUrl)\r\n}\r\n\r\nexport function resolveData (request) {\r\n  if(request.srcdoc){\r\n    var nxdata = getSrcDocData(request.srcdoc, request.mode === 'editor')\r\n    if(nxdata){\r\n      return Promise.resolve(nxdata)\r\n    }\r\n  }\r\n  if (request.url) {\r\n    return getSrcData(request.url)\r\n  }\r\n  return Promise.reject(new Error(0))\r\n}\r\n\r\nexport function initAll (options = {}) {\r\n  var seed = {}\r\n  seed.options = Object.assign({}, defaultInitOptions, options)\r\n  checkCacheRequests()\r\n  setCookie()\r\n  initLogger(seed.options.forceLog)\r\n  seed.nxelm = retrieveNxElm(seed.options.customSelector)\r\n  seed.request = getRequest(seed.nxelm, seed.options.appDefaultCss, seed.options.appDefaultCssAliases, seed.options.appDefaultLang)\r\n    return resolveTheme(seed.request, seed.options.appDefaultCss, seed.options.forceStyle, seed.options.customSignatureRule)\r\n    .then((styleUrl) => {\r\n      seed.styleUrl = styleUrl\r\n      return resolveData(seed.request)\r\n    }).then(nxdata => {\r\n      seed.nxdata = nxdata\r\n      return seed\r\n    }).catch(err => {\r\n      var msg = err.message\r\n      if (!Number.isInteger(msg)) {\r\n        logErr('Nexus Init Failed', msg)\r\n        msg = 400\r\n      }\r\n      throw new Error(msg)\r\n    })\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nexport const NxTranslations = {\r\n  fr: {\r\n    author: 'auteur·e',\r\n    handle: 'pseudonyme',\r\n    about: 'à propos',\r\n    url: 'url',\r\n    id: 'id',\r\n    title: 'titre',\r\n    description: 'description',\r\n    timestamp: 'date',\r\n    main: 'corps',\r\n    aside: 'aparté',\r\n    media: 'média',\r\n    type: 'type',\r\n    caption: 'légende',\r\n    index: 'index',\r\n    distant: 'distant',\r\n    local: 'local',\r\n    threads: 'fils',\r\n    linked: 'liés',\r\n    content: 'contenu',\r\n    history: 'historique',\r\n    copied: 'copié',\r\n    embed: 'intégré',\r\n    source: 'source',\r\n    saved: 'sauvegardé',\r\n    'local thread': 'fil local',\r\n    'linked threads': 'fils liés',\r\n    'No valid thread': 'Aucun fil valide',\r\n    'Duplicate thread id': 'Identifiant du fil en double',\r\n    'Duplicate linked thread': 'Fil lié en double',\r\n    'Invalid linked thread': 'Fil lié non valide',\r\n    'Invalid url': 'Url non valide',\r\n    'Invalid thread id': 'Identifiant de fil non valide',\r\n    'Invalid length': 'Longueur non valide',\r\n    'Invalid min length': 'Longueur minimale non valide',\r\n    'Invalid max length': 'Longueur maximale non valide',\r\n    'Unable to cut string': 'Impossible de raccourcir le texte',\r\n    'Invalid timestamp': 'Horodatage non valide',\r\n    'Unknown field': 'Champ inconnu',\r\n    'Invalid field type': 'Type de champ non valide',\r\n    'Field is empty': 'Le champ est vide',\r\n    'Unable to extend string': 'Impossible de prolonger le texte',\r\n    'Unknown characters limits category':\r\n    'Catégorie de limite de caractères inconnue',\r\n    'Unknown items limits category': \"Catégorie de limite d'éléments inconnue\",\r\n    'Invalid media type': 'Type de media non valide',\r\n    'Invalid app url': \"Url de l'application non valide\",\r\n    'Too many linked threads': 'Trop de fils liés',\r\n    'Too many threads': 'Trop de fils',\r\n    'Init failed': \"L'initialisation a échoué\",\r\n    'Theme not found': 'Thème non trouvé',\r\n    'No response': 'Aucune réponse',\r\n    'Invalid source': 'Source non valide',\r\n    'Invalid Nexus data': 'Données Nexus non valides'\r\n  }\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { isNonEmptyObj, isNonEmptyStr } from '@i-is-as-i-does/jack-js/src/modules/Check.js'\r\nimport { getStoredLang, setStoredLang } from '../storg/NxMemory.js'\r\nimport { NxTranslations } from './NxTranslations.js'\r\n\r\nvar txts = NxTranslations\r\nvar availableLangs = Object.keys(txts)\r\navailableLangs.push('en')\r\n\r\nvar storedLang = getStoredLang()\r\nif (storedLang != null && !langIsAvailable(storedLang)) {\r\n  storedLang = null\r\n  setStoredLang(null)\r\n}\r\n\r\nvar currentLang = null\r\nif (storedLang) {\r\n  currentLang = storedLang\r\n} else {\r\n  currentLang = document.querySelector('html').lang\r\n  if (!langIsAvailable(currentLang)) {\r\n    currentLang = 'en'\r\n  }\r\n}\r\n\r\nfunction updateStorage (lang) {\r\n  if (storedLang !== lang) {\r\n    setStoredLang(lang)\r\n    storedLang = lang\r\n  }\r\n}\r\n\r\nexport function setOriginLang (lang) {\r\n  // @doc lang should be seed.request.lang from NxInit, or custom one\r\n  if (!storedLang) {\r\n    setUserSelectedLang(lang)\r\n  }\r\n}\r\n\r\nexport function setAdtTranslations (translObj) {\r\n  if (isNonEmptyObj(translObj)) {\r\n    Object.assign(txts, translObj) // @todo: test if works as expected from nested props\r\n    availableLangs.push(\r\n      ...Object.keys(txts).filter(\r\n        (item) => availableLangs.indexOf(item) < 0\r\n      )\r\n    )\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function langIsAvailable (lang) {\r\n  return isNonEmptyStr(lang) && availableLangs.includes(lang)\r\n}\r\n\r\nexport function setUserSelectedLang (lang) {\r\n  if (langIsAvailable(lang) && lang !== currentLang) {\r\n    currentLang = lang\r\n    updateStorage(lang)\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function getAvailableLangs () {\r\n  return availableLangs\r\n}\r\n\r\nexport function getLang () {\r\n  return currentLang\r\n}\r\n\r\nexport function getTxt (key) {\r\n  var text = key\r\n  if (currentLang !== 'en' && txts[currentLang][key]) {\r\n    text = txts[currentLang][key]\r\n  }\r\n  return text\r\n}","import { getSrcData, getThreadsList } from '@i-is-as-i-does/nexus-core/src/load/NxSrc.js'\r\nimport {\r\n  isThreadContentUnseen,\r\n  registerThreadVisit,\r\n} from '@i-is-as-i-does/nexus-core/src/storg/NxMemory.js'\r\n\r\nvar currentState = {\r\n  dataUrl: null,\r\n  srcData: null,\r\n  threadId: '/',\r\n  threadIndex: -1,\r\n}\r\n\r\nvar updateStore = { onChange: [], onSrcChange: [] }\r\n\r\nfunction triggerCallbacks(state, triggerAll, skipHistoryUpdate, forceTrigger) {\r\n  var ks = ['onChange']\r\n  if (triggerAll) {\r\n    ks.push('onSrcChange')\r\n  }\r\n\r\n  ks.forEach((k) => {\r\n    if (updateStore[k].length) {\r\n      updateStore[k].forEach((callback) => {\r\n        callback(state, skipHistoryUpdate, forceTrigger)\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nexport function concatSrc(state) {\r\n  var src = state.dataUrl\r\n  if (state.threadId !== '/') {\r\n    src += '#' + state.threadId\r\n  }\r\n  return src\r\n}\r\n\r\nexport function getTimestamp(state) {\r\n  if (state.threadIndex !== -1 && state.srcData.threads && state.threadIndex < state.srcData.threads.length) {\r\n    return state.srcData.threads[state.threadIndex].content.timestamp\r\n  }\r\n  return null\r\n}\r\n\r\nexport function isStateUnseen(state) {\r\n  var timestamp = getTimestamp(state)\r\n  if(timestamp){\r\n    return isThreadContentUnseen(concatSrc(state), timestamp)\r\n  }\r\n  return false\r\n}\r\n\r\nexport function dataToState(dataUrl, threadId, data, acceptNoId = false) {\r\n  data.index = getThreadsList(data)\r\n  var state = {\r\n    dataUrl: dataUrl,\r\n    threadId: threadId,\r\n    srcData: data,\r\n    threadIndex: data.index.indexOf(threadId),\r\n  }\r\n\r\n  if (state.threadIndex === -1) {\r\n    if (acceptNoId) {\r\n      if (state.threadId !== '/') {\r\n        state.threadId = '/'\r\n      }\r\n    } else {\r\n      setDefaultThread(state)\r\n    }\r\n  }\r\n  return state\r\n}\r\n\r\nexport function setDefaultThread(state) {\r\n  state.threadIndex = 0\r\n  state.threadId = state.srcData.index[0]\r\n}\r\n\r\nexport function resolveState(dataUrl, threadId, acceptNoId = false) {\r\n  return getSrcData(dataUrl).then((data) => {\r\n    return dataToState(dataUrl, threadId, data, acceptNoId)\r\n  })\r\n}\r\n\r\nexport function registerUpdateEvt(callback, onSrcChange = false) {\r\n  var k = 'onChange'\r\n  if (onSrcChange) {\r\n    k = 'onSrcChange'\r\n  }\r\n  updateStore[k].push(callback)\r\n}\r\n\r\nexport function triggerUpdate(state, skipHistoryUpdate = false, forceTrigger = false) {\r\n  var srcChanged = state.dataUrl != currentState.dataUrl\r\n\r\n  if (forceTrigger || srcChanged || state.threadId != currentState.threadId) {\r\n    if (!skipHistoryUpdate) {\r\n      registerThreadVisit(concatSrc(currentState), getTimestamp(currentState))\r\n    }\r\n\r\n    var resetIndex = srcChanged || forceTrigger\r\n    currentState = Object.assign({}, state)\r\n\r\n    triggerCallbacks(state, resetIndex, skipHistoryUpdate, forceTrigger)\r\n  }\r\n}\r\n\r\nexport function getCurrentState() {\r\n  return currentState\r\n}\r\n\r\nexport function setOriginState(state) {\r\n  if (!currentState.dataUrl) {\r\n    currentState = state\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function getAltState(state, nId, nIndex) {\r\n  var altState = Object.assign({}, state)\r\n\r\n  altState.threadId = nId\r\n  altState.threadIndex = nIndex\r\n  return altState\r\n}\r\n","/* Vâlvă | (c) 2021-22 I-is-as-I-does | MIT License */\r\nconst props = {\r\n    spacing: ['padding-top', 'padding-bottom', 'margin-top', 'margin-bottom'],\r\n    transitions: ['transition-duration', 'transition-timing-function', 'transition-property'],\r\n    heights: ['height', 'overflow']\r\n}\r\n\r\nconst slide = {\r\n    target: 'height, margin, padding',\r\n    toReset: ['height'].concat(props.spacing),\r\n    removeInFirst: props.spacing,\r\n    removeInThen: props.heights.concat(props.transitions),\r\n    removeOut: props.heights.concat(props.spacing, props.transitions)\r\n}\r\n\r\nconst fade = {\r\n    target: 'opacity',\r\n    toReset: ['opacity'],\r\n    removeInFirst: ['opacity'],\r\n    removeInThen: props.transitions,\r\n    removeOut: ['opacity'].concat(props.transitions)\r\n}\r\nconst ease = {\r\n    target: slide.target + ', ' + fade.target,\r\n    toReset: ['opacity'].concat(slide.toReset),\r\n    removeInFirst: props.spacing.concat(['opacity']),\r\n    removeInThen: slide.removeInThen,\r\n    removeOut: ['opacity'].concat(slide.removeOut)\r\n}\r\n\r\nexport const profl = {\r\n    slide: slide,\r\n    fade: fade,\r\n    ease: ease\r\n}\r\n\r\nexport const deflt = {\r\n    type: 'ease',\r\n    duration: 300,\r\n    callback: null,\r\n    timing: 'ease-in-out',\r\n    delay: 1000, // vTempToggle\r\n    reverse: false, // vToggleResolve\r\n    prepend: false // vPlace\r\n}","/* Vâlvă | (c) 2021-22 I-is-as-I-does | MIT License */\r\n\r\nexport function isHidden(elm) {\r\n  if (!elm) return false\r\n  do {\r\n    if (!(elm instanceof Element)) continue\r\n    if (elm.hidden || !elm.offsetHeight) {\r\n      return true\r\n    }\r\n    var style = window.getComputedStyle(elm)\r\n    if (\r\n      style.width === '0' ||\r\n      style.height === '0' ||\r\n      style.opacity === '0' ||\r\n      style.display === 'none' ||\r\n      style.visibility === 'hidden'\r\n    ) {\r\n      return true\r\n    }\r\n  } while ((elm = elm.parentNode))\r\n  return false\r\n}\r\n\r\n\r\nexport function resetDisplay(elm) {\r\n  elm.style.removeProperty('display')\r\n  let display = window.getComputedStyle(elm).display\r\n  if (display === 'none') display = 'block'\r\n  elm.style.display = display\r\n}\r\n","\r\n/* Vâlvă | (c) 2021-22 I-is-as-I-does | MIT License */\r\n/* eslint-disable no-unused-expressions */\r\n\r\nimport { deflt, profl } from './constants.js'\r\nimport { resetDisplay, isHidden } from './utils.js'\r\n\r\nfunction setTransition(elm, type, duration, timing) {\r\n  elm.style.setProperty('transition-property', profl[type].target)\r\n  elm.style.setProperty('transition-timing-function', timing)\r\n  elm.style.setProperty('transition-duration', duration + 'ms')\r\n}\r\n\r\nfunction resetStyle(elm, type) {\r\n  profl[type].toReset.forEach(p => {\r\n    elm.style.setProperty(p, 0)\r\n  })\r\n}\r\n\r\nfunction removeProp(elm, type, key) {\r\n\r\n  profl[type][key].forEach(p => {\r\n    elm.style.removeProperty(p)\r\n  })\r\n}\r\n\r\n\r\nfunction changeThenAct(parent, child, placeAction, placeCallBack) {\r\n  if (!(parent instanceof Element)) {\r\n    parent = document.body\r\n  }\r\n\r\n  var tmpclass = 'm' + Math.random().toString(20).substring(2)\r\n  child.classList.add(tmpclass)\r\n\r\n  return new Promise((resolve) => {\r\n    var observer = new MutationObserver(() => {\r\n      if (parent.querySelector('.' + tmpclass)) {\r\n        child.classList.remove(tmpclass)\r\n        observer.disconnect()\r\n        placeCallBack()\r\n        resolve(true)\r\n      }\r\n    })\r\n    observer.observe(parent, {\r\n      childList: true\r\n    })\r\n    placeAction()\r\n  })\r\n}\r\n\r\n\r\nexport function vHide(elm, type = deflt.type, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  setTransition(elm, type, duration, timing)\r\n  if (type !== 'fade') {\r\n    elm.style.setProperty('box-sizing', 'border-box')\r\n    elm.style.setProperty('height', elm.offsetHeight + 'px')\r\n    elm.offsetHeight\r\n    elm.style.setProperty('overflow', 'hidden')\r\n  }\r\n  resetStyle(elm, type)\r\n  window.setTimeout(() => {\r\n    elm.style.setProperty('display', 'none')\r\n    removeProp(elm, type, 'removeOut')\r\n    if (typeof callback === 'function') {\r\n      callback()\r\n    }\r\n  }, duration)\r\n}\r\n\r\nexport function vShow(elm, type = deflt.type, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  if (type === 'fade') {\r\n    resetStyle(elm, 'fade')\r\n    resetDisplay(elm)\r\n    setTransition(elm, 'fade', duration, timing)\r\n  } else {\r\n    resetDisplay(elm)\r\n    var height = elm.offsetHeight\r\n    elm.style.setProperty('overflow', 'hidden')\r\n    resetStyle(elm, type)\r\n    elm.offsetHeight\r\n    elm.style.setProperty('box-sizing', 'border-box')\r\n    setTransition(elm, type, duration, timing)\r\n    elm.style.setProperty('height', height + 'px')\r\n  }\r\n  removeProp(elm, type, 'removeInFirst')\r\n  window.setTimeout(() => {\r\n    removeProp(elm, type, 'removeInThen')\r\n    if (typeof callback === 'function') {\r\n      callback()\r\n    }\r\n  }, duration)\r\n}\r\n\r\nexport function vToggle(elm, type = deflt.type, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  if (isHidden(elm)) {\r\n    vShow(elm, type, duration, callback, timing)\r\n  } else {\r\n    vHide(elm, type, duration, callback, timing)\r\n  }\r\n}\r\nexport function vTempToggle(elm, type = deflt.type, delay = deflt.delay, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  var methods = [vHide, vShow]\r\n  if (isHidden(elm)) {\r\n    methods.reverse()\r\n  }\r\n  var transcallback = function () {\r\n    if (typeof callback === 'function') {\r\n      callback()\r\n    }\r\n    window.setTimeout(() => {\r\n      methods[1](elm, type, duration, callback, timing)\r\n    }, delay)\r\n  }\r\n\r\n  methods[0](elm, type, duration, transcallback, timing)\r\n}\r\n\r\nexport function vToggleResolve(\r\n  elm,\r\n  callback = null,\r\n  type = deflt.type,\r\n  duration = deflt.duration,\r\n  timing = deflt.timing,\r\n  reverse = false\r\n) {\r\n  if (typeof callback !== 'function') {\r\n    callback = function () { }\r\n  }\r\n  var methods = [vHide, vShow]\r\n  if (reverse) {\r\n    methods.reverse()\r\n  }\r\n  methods[0](elm, type, duration, function () {\r\n    Promise.resolve(callback()).then(() => methods[1](elm, type, duration, null, timing))\r\n  }, timing)\r\n}\r\n\r\nexport function vPlace(\r\n  parent,\r\n  child,\r\n  prepend = false,\r\n  type = deflt.type,\r\n  duration = deflt.duration,\r\n  callback = null,\r\n  timing = deflt.timing\r\n) {\r\n  child.style.setProperty('display', 'none')\r\n  var placeAction\r\n  if (prepend) {\r\n    placeAction = function () {\r\n      parent.prepend(child)\r\n    }\r\n  } else {\r\n    placeAction = function () {\r\n      parent.append(child)\r\n    }\r\n  }\r\n\r\n  var placeCallback = function () {\r\n    vShow(child, type, duration, callback, timing)\r\n  }\r\n  changeThenAct(parent, child, placeAction, placeCallback)\r\n}\r\n\r\n\r\nexport function vReplace(oldElm, newElm, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  newElm.style.opacity = 0\r\n\r\n  var parent = oldElm.parentNode\r\n  var preh = oldElm.offsetHeight\r\n  var placeAction = function () {\r\n    oldElm.replaceWith(newElm)\r\n  }\r\n  var placeCallback = function () {\r\n    vShowAdapt(newElm, preh, duration, callback, timing)\r\n  }\r\n  var transcallback = function () {\r\n    changeThenAct(parent, newElm, placeAction, placeCallback)\r\n  }\r\n  vHide(oldElm, 'fade', duration, transcallback, timing)\r\n}\r\n\r\nexport function vShowAdapt(elm, prevHeight, duration = deflt.duration, callback = null, timing = deflt.timing) {\r\n  var type = 'ease'\r\n  if (elm.offsetHeight === prevHeight) {\r\n    type = 'fade'\r\n  }\r\n  vShow(elm, type, duration, callback, timing)\r\n}\r\n\r\n\r\nexport function vSplitFlap(elm, text, speed = 20) {\r\n  var ntext = elm.textContent.split('')\r\n  var stext = text.split('')\r\n  var prevLen = ntext.length\r\n  var newLen = stext.length\r\n\r\n  var l\r\n  var stop\r\n  var solve\r\n  if (prevLen > newLen) {\r\n    l = prevLen\r\n    stop = 0\r\n    solve = function () {\r\n      if (l > newLen) {\r\n        ntext.pop()\r\n      } else {\r\n        ntext[l - 1] = stext[l - 1]\r\n      }\r\n      l--\r\n    }\r\n  } else {\r\n    l = 0\r\n    stop = newLen\r\n    solve = function () {\r\n      if (l < prevLen) {\r\n        ntext[l] = stext[l]\r\n      } else {\r\n        ntext.push(stext[l])\r\n      }\r\n      l++\r\n    }\r\n  }\r\n  var repl = setInterval(function () {\r\n    solve()\r\n    elm.textContent = ntext.join('')\r\n    if (l === stop) {\r\n      clearInterval(repl)\r\n    }\r\n  }, speed)\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { getTxt, setUserSelectedLang } from './NxCoreTranslate.js'\r\nimport { vSplitFlap } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\n\r\nvar translStore = {}\r\n\r\nexport function updateTextElm (elm, textkey) {\r\n  vSplitFlap(elm, getTxt(textkey), 50)\r\n}\r\n\r\nexport function triggerTranslate (lang) {\r\n  if (setUserSelectedLang(lang)) {\r\n    for (const [textkey, elms] of Object.entries(translStore)) {\r\n      elms.forEach((elm) => {\r\n        updateTextElm(elm, textkey)\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport function registerTranslElm (elm, textkey) {\r\n  if (!translStore[textkey]) {\r\n    translStore[textkey] = []\r\n  }\r\n  translStore[textkey].push(elm)\r\n}\r\n","import { isCssLoaded } from '@i-is-as-i-does/nexus-core/src/load/NxStyle.js'\r\nimport { getCurrentState, registerUpdateEvt } from './NxState.js'\r\nimport {\r\n  registerTranslElm,\r\n  triggerTranslate,\r\n} from '@i-is-as-i-does/nexus-core/src/transl/NxElmTranslate.js'\r\nimport {\r\n  getAvailableLangs,\r\n  getLang,\r\n  getTxt,\r\n} from '@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js'\r\nimport { appUrl } from '@i-is-as-i-does/nexus-core/src/validt/NxSpecs.js'\r\nimport { splitOnLineBreaks } from '@i-is-as-i-does/jack-js/src/modules/Help.js'\r\nimport { vSplitFlap } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\n\r\nfunction resolveThreadTitle(state) {\r\n  var threadTitle = '/'\r\n  if (state && state.threadIndex !== -1 && state.srcData.threads[state.threadIndex]) {\r\n    threadTitle = state.srcData.threads[state.threadIndex].title\r\n    if (threadTitle) {\r\n      return threadTitle\r\n    }\r\n  }\r\n  return threadTitle\r\n}\r\n\r\nfunction toggleOnDisplay(viewlk, givenState, newState) {\r\n  if (\r\n    newState.dataUrl &&\r\n    givenState.dataUrl === newState.dataUrl &&\r\n    givenState.threadId == newState.threadId\r\n  ) {\r\n    viewlk.classList.add('nx-on-display')\r\n  } else {\r\n    viewlk.classList.remove('nx-on-display')\r\n  }\r\n}\r\n\r\nfunction langDropDown() {\r\n  var toggle = getElm('P')\r\n  toggle.textContent = getLang()\r\n  return selectDropDown(\r\n    getAvailableLangs(),\r\n    toggle,\r\n    function (nlang) {\r\n      triggerTranslate(nlang)\r\n    },\r\n    'nx-lang-switch'\r\n  )\r\n}\r\n\r\nfunction appLink() {\r\n  var link = getElm('A', 'nx-app-link nx-external-link')\r\n  link.target = '_blank'\r\n  link.href = appUrl\r\n  link.title = 'Nexus'\r\n  link.textContent = 'Nexus'\r\n  return link\r\n}\r\n\r\nfunction appMain(serviceElms) {\r\n  var main = getElm('MAIN')\r\n  main.append(...serviceElms)\r\n  return main\r\n}\r\n\r\nexport function appHeader() {\r\n  var header = getElm('HEADER')\r\n  header.append(appLink())\r\n  return header\r\n}\r\n\r\nexport function appHeaderWithLang() {\r\n  var header = appHeader()\r\n  header.append(langDropDown())\r\n  return header\r\n}\r\n\r\nexport function getElm(tag, classList) {\r\n  var elm = document.createElement(tag)\r\n  if (classList) {\r\n    elm.className = classList\r\n  }\r\n  return elm\r\n}\r\n\r\nexport function instanceWrap(appHeader, serviceElms) {\r\n  var inst = getElm('DIV', 'nx-instance')\r\n  inst.append(appHeader, appMain(serviceElms))\r\n  return inst\r\n}\r\n\r\nexport function serviceWrap(navElms, mainElms, footerElms = [], service = 'reader') {\r\n  var wrap = getElm('DIV', 'nx-' + service)\r\n  var nav = getElm('NAV')\r\n  nav.append(...navElms)\r\n  var bd = getElm('SECTION')\r\n  bd.append(...mainElms)\r\n  wrap.append(nav, bd)\r\n  if (footerElms.length) {\r\n    var footer = getElm('FOOTER')\r\n    footer.append(...footerElms)\r\n    wrap.append(footer)\r\n  }\r\n  return wrap\r\n}\r\n\r\nexport function blockWrap(blockName, contentElms = null, landmark = null) {\r\n  var dv = getElm('DIV', 'nx-' + blockName + ' nx-block')\r\n  if (landmark) {\r\n    dv.append(landmark)\r\n  }\r\n  if (contentElms) {\r\n    dv.append(...contentElms)\r\n  }\r\n  return dv\r\n}\r\n\r\nexport function landmarkElm(name) {\r\n  var lndmrk = getElm('SPAN', 'nx-landmark nx-landmark-' + name.replace(' ', '-'))\r\n  lndmrk.textContent = getTxt(name)\r\n  registerTranslElm(lndmrk, name)\r\n  return lndmrk\r\n}\r\n\r\nexport function errorPrgr() {\r\n  var p = getElm('P')\r\n  if (isCssLoaded()) {\r\n    p.className = 'nx-error'\r\n  } else {\r\n    p.style.margin = '2vh auto'\r\n    p.style.fontFamily = '\"Courier New\", Courier, monospace'\r\n    p.style.fontSize = '13px'\r\n  }\r\n\r\n  p.textContent = '—/ — '\r\n  return p\r\n}\r\n\r\nexport function toggleNavEnd(map) {\r\n  if (map.position > 0) {\r\n    map.ctrls['prev'].elm.classList.remove('nx-nav-end')\r\n  } else {\r\n    map.ctrls['prev'].elm.classList.add('nx-nav-end')\r\n  }\r\n  if (map.position < map.count - 1) {\r\n    map.ctrls['next'].elm.classList.remove('nx-nav-end')\r\n  } else {\r\n    map.ctrls['next'].elm.classList.add('nx-nav-end')\r\n  }\r\n}\r\n\r\nexport function setHistoryControls(map, triggerCallback, imgAsSymbol = false) {\r\n  Object.keys(map.ctrls).forEach((ctrl) => {\r\n    map.ctrls[ctrl].elm = getElm('A', 'nx-nav-ctrl nx-nav-end')\r\n    if (imgAsSymbol) {\r\n      map.ctrls[ctrl].elm.append(iconImage(map.ctrls[ctrl].symbol))\r\n    } else {\r\n      map.ctrls[ctrl].elm.textContent = map.ctrls[ctrl].symbol\r\n    }\r\n    map.ctrls[ctrl].elm.addEventListener('click', function () {\r\n      if (!map.ctrls[ctrl].elm.classList.contains('nx-nav-end')) {\r\n        if (ctrl === 'next') {\r\n          map.position++\r\n        } else {\r\n          map.position--\r\n        }\r\n        triggerCallback(ctrl, map.position)\r\n        toggleNavEnd(map)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nexport function selectDropDown(list, toggleElm, actionCallback = null, switchClass = null) {\r\n  var selectedClass = 'nx-selected'\r\n  toggleElm.classList.add('nx-select-toggle')\r\n  var isInput = toggleElm.tagName == 'INPUT'\r\n  var firstValue\r\n  if (isInput) {\r\n    toggleElm.setAttribute('autocomplete', 'off')\r\n    firstValue = toggleElm.value\r\n  } else {\r\n    firstValue = toggleElm.textContent\r\n  }\r\n\r\n  var drp = getElm('UL', 'nx-select-list')\r\n\r\n  var swtch = getElm('DIV', 'nx-select')\r\n  if (switchClass) {\r\n    swtch.classList.add(switchClass)\r\n  }\r\n  swtch.append(toggleElm, drp)\r\n\r\n  toggleElm.addEventListener('click', () => {\r\n    var styl = 'none'\r\n    if (drp.style.display == styl) {\r\n      styl = 'block'\r\n    }\r\n    drp.style.display = styl\r\n  })\r\n\r\n  list.forEach((itm) => {\r\n    var li = getElm('LI')\r\n    li.textContent = itm\r\n    li.dataset.item = itm\r\n    if (itm == firstValue) {\r\n      li.classList.add(selectedClass)\r\n    }\r\n\r\n    drp.append(li)\r\n    li.addEventListener('click', () => {\r\n      var nitm = li.textContent\r\n      var currVal\r\n      if (isInput) {\r\n        currVal = toggleElm.value\r\n      } else {\r\n        currVal = toggleElm.textContent\r\n      }\r\n      if (currVal != nitm) {\r\n        if (!li.classList.contains(selectedClass)) {\r\n          var prev = drp.querySelector('.' + selectedClass)\r\n          if (prev) {\r\n            prev.classList.remove(selectedClass)\r\n          }\r\n          li.classList.add(selectedClass)\r\n        }\r\n        if (isInput) {\r\n          toggleElm.value = nitm\r\n        } else {\r\n          toggleElm.textContent = nitm\r\n        }\r\n        toggleElm.dispatchEvent(new window.Event('change'))\r\n        if (typeof actionCallback === 'function') {\r\n          actionCallback(nitm)\r\n        }\r\n      }\r\n\r\n      drp.style.display = 'none'\r\n    })\r\n  })\r\n  drp.style.display = 'none'\r\n\r\n  return swtch\r\n}\r\n\r\nexport function setToggleOnDisplay(viewlk, state) {\r\n  toggleOnDisplay(viewlk, state, getCurrentState())\r\n  registerUpdateEvt(function (newState) {\r\n    toggleOnDisplay(viewlk, state, newState)\r\n  })\r\n}\r\n\r\nexport function baseViewLink(state, update = false) {\r\n  var viewlk = getElm('A', 'nx-view-link')\r\n  viewlk.append(threadTitleElm(state, update))\r\n  return viewlk\r\n}\r\n\r\nexport function threadTitleElm(state, update = false) {\r\n  var sp = getElm('SPAN', 'nx-thread-title')\r\n  sp.textContent = resolveThreadTitle(state)\r\n  if (update) {\r\n    registerUpdateEvt(function (newState) {\r\n      var nTitle = resolveThreadTitle(newState)\r\n      vSplitFlap(sp, nTitle, 15)\r\n    })\r\n  }\r\n\r\n  return sp\r\n}\r\n\r\nexport function lines(text) {\r\n  var dv = getElm('DIV', 'nx-lines')\r\n  if (text) {\r\n    var sp = splitOnLineBreaks(text)\r\n    var ln = []\r\n    sp.forEach((l) => {\r\n      var p = getElm('P')\r\n      p.textContent = l\r\n      ln.push(p)\r\n    })\r\n    dv.append(...ln)\r\n  }\r\n  return dv\r\n}\r\nexport function spinContainer() {\r\n  var container = getElm('DIV', 'nx-loading')\r\n  return container\r\n}\r\n\r\nexport function iconImage(b64, size = 20) {\r\n  var ic = new Image(size, size)\r\n  ic.className = 'nx-icon'\r\n  ic.src = b64\r\n  return ic\r\n}\r\n","import { registerUpdateEvt, triggerUpdate, isStateUnseen, getAltState } from '../shared/NxState.js'\r\nimport { baseViewLink, getElm, setToggleOnDisplay } from '../shared/NxCommons.js'\r\nimport { miniUrl } from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\nimport { vSplitFlap } from '@i-is-as-i-does/valva/src/modules/transitions'\r\n\r\nvar urlStore = {}\r\n\r\nfunction authorMiniUrl(authorUrl) {\r\n  if (!urlStore[authorUrl]) {\r\n    urlStore[authorUrl] = miniUrl(authorUrl)\r\n  }\r\n  return urlStore[authorUrl]\r\n}\r\n\r\nfunction toggleUnseen(viewlk, state) {\r\n  if (viewlk.classList.contains('nx-on-display')) {\r\n    viewlk.classList.remove('nx-unseen')\r\n    viewlk.lastChild.textContent = ''\r\n  } else if (isStateUnseen(state)) {\r\n    viewlk.classList.add('nx-unseen')\r\n    viewlk.lastChild.textContent = '*'\r\n  }\r\n}\r\n\r\nexport function authorHandle(state, update = false) {\r\n  var hnd = getElm('SPAN', 'nx-handle')\r\n  if (state.srcData) {\r\n    hnd.textContent = state.srcData.author.handle\r\n  }\r\n  if (update) {\r\n    registerUpdateEvt(function (newState) {\r\n      vSplitFlap(hnd, newState.srcData.author.handle, 25)\r\n    }, true)\r\n  }\r\n  return hnd\r\n}\r\n\r\nexport function authorUrl(state, update = false) {\r\n  var authorlksp = getElm('SPAN', 'nx-author-url')\r\n\r\n  var urlBrck = []\r\n  ;['[', ']'].forEach((bracket) => {\r\n    var brsp = getElm('SPAN', 'nx-author-url-brackets')\r\n    brsp.textContent = bracket\r\n    urlBrck.push(brsp)\r\n  })\r\n  var urla = getElm('A', 'nx-external-link')\r\n  urla.target = '_blank'\r\n  var hrf = ''\r\n  if (state.srcData) {\r\n    hrf = state.srcData.author.url\r\n  }\r\n  urla.href = hrf\r\n\r\n  if (state.srcData) {\r\n    urla.textContent = authorMiniUrl(state.srcData.author.url)\r\n  }\r\n\r\n  authorlksp.append(urlBrck[0], urla, urlBrck[1])\r\n\r\n  if (update) {\r\n    registerUpdateEvt(function (newState) {\r\n      urla.href = newState.srcData.author.url\r\n      vSplitFlap(urla, authorMiniUrl(newState.srcData.author.url), 25)\r\n    }, true)\r\n  }\r\n  return authorlksp\r\n}\r\n\r\nexport function setToggleUnseen(viewlk, state) {\r\n  viewlk.append(getElm('SPAN', 'nx-new-tag'))\r\n  toggleUnseen(viewlk, state)\r\n  registerUpdateEvt(function () {\r\n    toggleUnseen(viewlk, state)\r\n  })\r\n}\r\n\r\nexport function viewLink(state, update = false) {\r\n  var viewlk = baseViewLink(state, update)\r\n  if (state.threadId !== '/') {\r\n    setToggleOnDisplay(viewlk, state)\r\n    setToggleUnseen(viewlk, state)\r\n  }\r\n\r\n  viewlk.addEventListener('click', () => {\r\n    triggerUpdate(state)\r\n  })\r\n  return viewlk\r\n}\r\n\r\nexport function authorIndexLink(state, update = false) {\r\n  var auth = getElm('A', 'nx-author-link')\r\n  auth.append(authorHandle(state, update))\r\n\r\n  var newState = getAltState(state, '/', -1)\r\n  setToggleOnDisplay(auth, newState)\r\n\r\n  auth.addEventListener('click', function () {\r\n    triggerUpdate(newState, '/')\r\n  })\r\n\r\n  return auth\r\n}\r\n","/* Jack Js | (c) 2021 I-is-as-I-does | MIT License */\r\n\r\nexport function nonRenderedElmHeight (elm) {\r\n  var clone = elm.cloneNode(true)\r\n  clone.style.visibility = 'hidden'\r\n  document.append(clone)\r\n  var height = clone.offsetHeight\r\n  document.removeChild(clone)\r\n  return height\r\n}\r\n\r\nexport function elmHasStyle (elm, property) {\r\n  if (\r\n    elm.getAttribute('style') &&\r\n    elm.getAttribute('style').indexOf(property + ':') !== -1\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\n// @doc: strenghts = 1,2,3\r\nexport function cssExtract (strength = 2) {\r\n  var s = {\r\n    tags: [],\r\n    ids: [],\r\n    classes: [],\r\n    combos: []\r\n  }\r\n  var fs = ''\r\n  var loopcall = function (elms, prev = ' ') {\r\n    Array.from(elms).forEach((elm) => {\r\n      var tag = elm.tagName.toLowerCase()\r\n      var nprev\r\n      if (strength > 2) {\r\n        nprev = prev + tag\r\n      }\r\n\r\n      if (!s.tags.includes(tag)) {\r\n        s.tags.push(tag)\r\n      }\r\n      if (strength > 2 && !s.tags.includes(nprev)) {\r\n        s.tags.push(nprev)\r\n      }\r\n      if (elm.id) {\r\n        s.ids.push('#' + elm.id)\r\n      }\r\n      if (elm.classList.length) {\r\n        elm.classList.forEach((classn) => {\r\n          if (!s.classes.includes('.' + classn)) {\r\n            s.classes.push('.' + classn)\r\n          }\r\n          if (strength > 1 && !s.combos.includes(tag + '.' + classn)) {\r\n            s.combos.push(tag + '.' + classn)\r\n          }\r\n          if (strength > 2 && !s.combos.includes(nprev + '.' + classn)) {\r\n            s.combos.push(nprev + '.' + classn)\r\n          }\r\n          if (elm.id && !s.combos.includes('#' + elm.id + '.' + classn)) {\r\n            s.combos.push('#' + elm.id + '.' + classn)\r\n          }\r\n        })\r\n      }\r\n      if (tag !== 'html' && elm.children.length) {\r\n        loopcall(elm.children, tag + ' ')\r\n      }\r\n    })\r\n  }\r\n\r\n  setTimeout(function () {\r\n    loopcall([document.querySelector('html'), document.body])\r\n    for (const [k, v] of Object.entries(s)) {\r\n      fs += '/*' + k + '*/\\r\\n'\r\n      v.forEach((itm) => {\r\n        fs += itm + ' {\\r\\n}\\r\\n'\r\n      })\r\n    }\r\n    var outputElm = document.createElement('TEXTAREA')\r\n    outputElm.textContent = fs\r\n    document.body.append(outputElm)\r\n  }, 3000)\r\n}\r\n\r\nexport function autoScrollToBottom (elm) {\r\n  elm.scrollIntoView({\r\n    block: 'end',\r\n    behavior: 'smooth'\r\n  })\r\n}\r\nexport function autoScrollToTop (elm) {\r\n  elm.scrollIntoView({\r\n    block: 'start',\r\n    behavior: 'smooth'\r\n  })\r\n}\r\n","import { vShow, vHide, vPlace } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport {\r\n  blockWrap,\r\n  getElm,\r\n  setHistoryControls,\r\n  toggleNavEnd,\r\n  setToggleOnDisplay,\r\n  baseViewLink,\r\n} from '../shared/NxCommons.js'\r\nimport { authorIndexLink, authorUrl } from './NxIdent.js'\r\nimport { autoScrollToBottom } from '@i-is-as-i-does/jack-js/src/modules/Style.js'\r\nimport { registerUpdateEvt, triggerUpdate } from '../shared/NxState.js'\r\n\r\nconst historyMax = 100\r\nvar isHistoryEvent = false\r\nvar historyList = null\r\nvar historyElm = null\r\n\r\nvar historyState = {\r\n  dataUrl: null,\r\n  srcData: null,\r\n  threadId: '/',\r\n  threadIndex: -1,\r\n}\r\n\r\nvar histCtrls = {\r\n  ctrls: {\r\n    prev: { symbol: '<', elm: null },\r\n    next: { symbol: '>', elm: null },\r\n  },\r\n  position: 0,\r\n  count: 1,\r\n}\r\n\r\nfunction historyNav() {\r\n  var wrp = getElm('DIV', 'nx-history-nav')\r\n  setHistoryControls(histCtrls, function (ctrl, pos) {\r\n    var target = historyList.children[pos + 1].querySelector('.nx-thread-title')\r\n    target.click()\r\n  })\r\n  wrp.append(histCtrls.ctrls['prev'].elm, historyToggleElm(), histCtrls.ctrls['next'].elm)\r\n  return wrp\r\n}\r\nfunction historyToggleElm() {\r\n  var tggl = getElm('A', 'nx-history-toggle')\r\n  tggl.textContent = '≚'\r\n  tggl.addEventListener('click', () => {\r\n    if (tggl.textContent == '≙') {\r\n      tggl.textContent = '≚'\r\n      tggl.classList.remove('nx-active')\r\n      vHide(historyElm, 'ease', 200)\r\n    } else {\r\n      tggl.textContent = '≙'\r\n      tggl.classList.add('nx-active')\r\n      vShow(historyElm, 'ease', 200)\r\n      autoScrollToBottom(historyList)\r\n    }\r\n  })\r\n  return tggl\r\n}\r\n\r\nfunction setHistoryListElm(state) {\r\n  historyList = getElm('UL', 'nx-history-list')\r\n  var first = getElm('LI')\r\n  first.textContent = '...'\r\n  historyList.append(first)\r\n  if (state && state.srcData) {\r\n    historyState = state\r\n    historyList.append(historyItm(state, 0))\r\n  }\r\n  historyElm = getElm('DIV', 'nx-history-drawer')\r\n  historyElm.append(historyList)\r\n  historyElm.style.display = 'none'\r\n  registerUpdateEvt(function (newState, skipHistoryUpdate) {\r\n    historyEvent(newState, skipHistoryUpdate)\r\n  })\r\n}\r\n\r\nfunction historyEvent(state, skipHistoryUpdate) {\r\n  if (\r\n    !skipHistoryUpdate &&\r\n    !isHistoryEvent &&\r\n    (state.dataUrl !== historyState.dataUrl || state.threadId !== historyState.threadId)\r\n  ) {\r\n    historyState = state\r\n    if (histCtrls.count > historyMax) {\r\n      historyList.children[1].remove()\r\n    } else {\r\n      histCtrls.count++\r\n    }\r\n\r\n    histCtrls.position = histCtrls.count - 1\r\n    var itm = historyItm(state, histCtrls.position)\r\n    vPlace(historyList, itm, false, 'ease', 200,function () {\r\n      autoScrollToBottom(historyList)\r\n    })\r\n    toggleNavEnd(histCtrls)\r\n  }\r\n}\r\n\r\nfunction viewElms(state, pos) {\r\n  return [authorIndexLink(state, false), authorUrl(state, false), historyViewLink(state, pos)]\r\n}\r\n\r\nfunction historyItm(state, pos) {\r\n  var itm = document.createElement('LI')\r\n  itm.append(...viewElms(state, pos))\r\n  return itm\r\n}\r\n\r\nfunction historyViewLink(state, pos) {\r\n  var viewlk = baseViewLink(state, false)\r\n  setToggleOnDisplay(viewlk, state)\r\n\r\n  viewlk.addEventListener('click', () => {\r\n    isHistoryEvent = true\r\n    triggerUpdate(state, true)\r\n    histCtrls.position = pos\r\n    isHistoryEvent = false\r\n  })\r\n  return viewlk\r\n}\r\n\r\nexport function historyBlock(state) {\r\n  setHistoryListElm(state)\r\n  return blockWrap('history', [historyNav(), historyElm], false)\r\n}\r\n","import {\r\n  vPlace,\r\n  vReplace,\r\n  vHide,\r\n} from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport { getAltState, registerUpdateEvt } from '../shared/NxState.js'\r\nimport { authorHandle, authorUrl, viewLink } from './NxIdent.js'\r\nimport { blockWrap, getElm, lines } from '../shared/NxCommons.js'\r\n\r\nvar indexList = null\r\n\r\nfunction aboutElm(state) {\r\n  var ab = getElm('DIV', 'nx-about-author')\r\n\r\n  ab.append(aboutLines(state))\r\n  registerUpdateEvt(function (newState) {\r\n    vReplace(ab.firstChild, aboutLines(newState), 200)\r\n  }, true)\r\n  return ab\r\n}\r\n\r\nfunction aboutLines(state) {\r\n  var text = null\r\n  if (state.srcData && state.srcData.author.about) {\r\n    text = state.srcData.author.about\r\n  }\r\n  return lines(text)\r\n}\r\n\r\nfunction setIndexList(state) {\r\n  indexList = getElm('UL')\r\n  if (state.srcData) {\r\n    var items = state.srcData.index\r\n\r\n    if (items.length) {\r\n      for (var i = 0; i < items.length; i++) {\r\n        indexList.append(indexLi(state, items[i], i))\r\n      }\r\n    }\r\n  }\r\n  registerUpdateEvt(function (newState) {\r\n    changeThreadsList(newState)\r\n  }, true)\r\n}\r\n\r\nfunction indexLi(state, id, index) {\r\n  var altState = getAltState(state, id, index)\r\n\r\n  var li = getElm('LI')\r\n  li.append(viewLink(altState, false))\r\n  return li\r\n}\r\n\r\nfunction changeThreadsList(state) {\r\n  var childr = indexList.childNodes\r\n  var items = state.srcData.index\r\n  var nwlen = items.length\r\n\r\n  var chlen = childr.length\r\n\r\n  var count = 0\r\n  if (chlen) {\r\n    var rmv = function (child) {\r\n      vHide(child, 'ease', 200, function () {\r\n        child.remove()\r\n      })\r\n    }\r\n    for (var x = 0; x < chlen; x++) {\r\n      if (nwlen > x) {\r\n        var nlink = indexLi(state, items[x], x)\r\n        vReplace(childr[x], nlink, 200)\r\n        count++\r\n      } else {\r\n        rmv(childr[x])\r\n      }\r\n    }\r\n  }\r\n  if (count < nwlen) {\r\n    for (var y = count; y < nwlen; y++) {\r\n      vPlace(indexList, indexLi(state, items[y], y), false, 'ease', 200)\r\n    }\r\n  }\r\n}\r\n\r\nfunction indexHeader(state) {\r\n  var header = getElm('DIV', 'nx-index-header')\r\n  header.append(authorHandle(state, true), authorUrl(state, true), aboutElm(state))\r\n  return header\r\n}\r\n\r\nfunction indexBlock(state) {\r\n  setIndexList(state)\r\n  return blockWrap('threads-list', [indexList])\r\n}\r\n\r\nexport function mainIndexBlock(state) {\r\n  var mainBlock = getElm('DIV', 'nx-main-block nx-index')\r\n  var blocks = [indexHeader(state), indexBlock(state)]\r\n  mainBlock.append(...blocks)\r\n  return mainBlock\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { defaultIO } from '../base/NxDefaults.js'\r\n\r\nexport function getSnippet (src, style = null, scriptSrc = null, lang = null) {\r\n  // @doc does NOT validate arguments;\r\n  var datalang = ''\r\n  if (lang) {\r\n    datalang = ' data-lang=\"' + lang + '\"'\r\n  }\r\n  var datastyle = ''\r\n  if (style) {\r\n    datastyle = ' data-style=\"' + style + '\"'\r\n  }\r\n  if (!scriptSrc) {\r\n    scriptSrc = defaultIO\r\n  }\r\n  return `<div id=\"Nexus\" data-src=\"${src}\"${datastyle}${datalang}></div>\r\n<script src=\"${scriptSrc}\"></script>`\r\n}\r\n","export const appIO = 'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/js/NxIO.js'\r\nexport const appDefaultCss =\r\n  'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NxIO.min.css'\r\nexport const legacyDefaultCss = [\r\n  'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NexusI.min.css'\r\n]\r\n","export const copyB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA0IDQgTCA0IDI0IEwgMTEgMjQgTCAxMSAyMiBMIDYgMjIgTCA2IDYgTCAxOCA2IEwgMTggNyBMIDIwIDcgTCAyMCA0IFogTSAxMiA4IEwgMTIgMjggTCAyOCAyOCBMIDI4IDggWiBNIDE0IDEwIEwgMjYgMTAgTCAyNiAyNiBMIDE0IDI2IFoiLz48L3N2Zz4=`\r\nexport const downloadB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNSA0IEwgMTUgMjAuNTYyNSBMIDkuNzE4NzUgMTUuMjgxMjUgTCA4LjI4MTI1IDE2LjcxODc1IEwgMTUuMjgxMjUgMjMuNzE4NzUgTCAxNiAyNC40MDYyNSBMIDE2LjcxODc1IDIzLjcxODc1IEwgMjMuNzE4NzUgMTYuNzE4NzUgTCAyMi4yODEyNSAxNS4yODEyNSBMIDE3IDIwLjU2MjUgTCAxNyA0IFogTSA3IDI2IEwgNyAyOCBMIDI1IDI4IEwgMjUgMjYgWiIvPjwvc3ZnPg==`\r\nexport const saveB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA1IDUgTCA1IDI3IEwgMjcgMjcgTCAyNyA5LjU5Mzc1IEwgMjYuNzE4NzUgOS4yODEyNSBMIDIyLjcxODc1IDUuMjgxMjUgTCAyMi40MDYyNSA1IFogTSA3IDcgTCAxMCA3IEwgMTAgMTMgTCAyMiAxMyBMIDIyIDcuNDM3NSBMIDI1IDEwLjQzNzUgTCAyNSAyNSBMIDIzIDI1IEwgMjMgMTYgTCA5IDE2IEwgOSAyNSBMIDcgMjUgWiBNIDEyIDcgTCAxNiA3IEwgMTYgOSBMIDE4IDkgTCAxOCA3IEwgMjAgNyBMIDIwIDExIEwgMTIgMTEgWiBNIDExIDE4IEwgMjEgMTggTCAyMSAyNSBMIDExIDI1IFoiLz48L3N2Zz4=`\r\nexport const newB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA2IDMgTCA2IDI5IEwgMjYgMjkgTCAyNiA5LjU5Mzc1IEwgMjUuNzE4NzUgOS4yODEyNSBMIDE5LjcxODc1IDMuMjgxMjUgTCAxOS40MDYyNSAzIFogTSA4IDUgTCAxOCA1IEwgMTggMTEgTCAyNCAxMSBMIDI0IDI3IEwgOCAyNyBaIE0gMjAgNi40Mzc1IEwgMjIuNTYyNSA5IEwgMjAgOSBaIi8+PC9zdmc+`\r\nexport const openB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA1IDMgTCA1IDI3LjgxMjUgTCA1Ljc4MTI1IDI3Ljk2ODc1IEwgMTcuNzgxMjUgMzAuNDY4NzUgTCAxOSAzMC43MTg3NSBMIDE5IDI4IEwgMjUgMjggTCAyNSAxNS40Mzc1IEwgMjYuNzE4NzUgMTMuNzE4NzUgTCAyNyAxMy40MDYyNSBMIDI3IDMgWiBNIDE0LjEyNSA1IEwgMjUgNSBMIDI1IDEyLjU2MjUgTCAyMy4yODEyNSAxNC4yODEyNSBMIDIzIDE0LjU5Mzc1IEwgMjMgMjYgTCAxOSAyNiBMIDE5IDE3LjA5Mzc1IEwgMTguNzE4NzUgMTYuNzgxMjUgTCAxNyAxNS4wNjI1IEwgMTcgNS43MTg3NSBaIE0gNyA1LjI4MTI1IEwgMTUgNy4yODEyNSBMIDE1IDE1LjkwNjI1IEwgMTUuMjgxMjUgMTYuMjE4NzUgTCAxNyAxNy45Mzc1IEwgMTcgMjguMjgxMjUgTCA3IDI2LjE4NzUgWiIvPjwvc3ZnPg==`\r\nexport const resetB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiAzIEMgMTIgMyA4LjQgNC43OTkyMTg3IDYgNy42OTkyMTg4IEwgNiA0IEwgNCA0IEwgNCAxMiBMIDEyIDEyIEwgMTIgMTAgTCA2LjgwMDc4MTIgMTAgQyA4LjgwMDc4MTIgNyAxMi4xIDUgMTYgNSBDIDIyLjEgNSAyNyA5LjkgMjcgMTYgQyAyNyAyMi4xIDIyLjEgMjcgMTYgMjcgQyA5LjkgMjcgNSAyMi4xIDUgMTYgTCAzIDE2IEMgMyAyMy4yIDguOCAyOSAxNiAyOSBDIDIzLjIgMjkgMjkgMjMuMiAyOSAxNiBDIDI5IDguOCAyMy4yIDMgMTYgMyB6Ii8+PC9zdmc+`\r\nexport const previewB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiA4IEMgNy42NjQwNjMgOCAxLjI1IDE1LjM0Mzc1IDEuMjUgMTUuMzQzNzUgTCAwLjY1NjI1IDE2IEwgMS4yNSAxNi42NTYyNSBDIDEuMjUgMTYuNjU2MjUgNy4wOTc2NTYgMjMuMzI0MjE5IDE0Ljg3NSAyMy45Mzc1IEMgMTUuMjQ2MDk0IDIzLjk4NDM3NSAxNS42MTcxODggMjQgMTYgMjQgQyAxNi4zODI4MTMgMjQgMTYuNzUzOTA2IDIzLjk4NDM3NSAxNy4xMjUgMjMuOTM3NSBDIDI0LjkwMjM0NCAyMy4zMjQyMTkgMzAuNzUgMTYuNjU2MjUgMzAuNzUgMTYuNjU2MjUgTCAzMS4zNDM3NSAxNiBMIDMwLjc1IDE1LjM0Mzc1IEMgMzAuNzUgMTUuMzQzNzUgMjQuMzM1OTM4IDggMTYgOCBaIE0gMTYgMTAgQyAxOC4yMDMxMjUgMTAgMjAuMjM0Mzc1IDEwLjYwMTU2MyAyMiAxMS40MDYyNSBDIDIyLjYzNjcxOSAxMi40NjA5MzggMjMgMTMuNjc1NzgxIDIzIDE1IEMgMjMgMTguNjEzMjgxIDIwLjI4OTA2MyAyMS41ODIwMzEgMTYuNzgxMjUgMjEuOTY4NzUgQyAxNi43NjE3MTkgMjEuOTcyNjU2IDE2LjczODI4MSAyMS45NjQ4NDQgMTYuNzE4NzUgMjEuOTY4NzUgQyAxNi40ODA0NjkgMjEuOTgwNDY5IDE2LjI0MjE4OCAyMiAxNiAyMiBDIDE1LjczNDM3NSAyMiAxNS40NzY1NjMgMjEuOTg0Mzc1IDE1LjIxODc1IDIxLjk2ODc1IEMgMTEuNzEwOTM4IDIxLjU4MjAzMSA5IDE4LjYxMzI4MSA5IDE1IEMgOSAxMy42OTUzMTMgOS4zNTE1NjMgMTIuNDgwNDY5IDkuOTY4NzUgMTEuNDM3NSBMIDkuOTM3NSAxMS40Mzc1IEMgMTEuNzE4NzUgMTAuNjE3MTg4IDEzLjc3MzQzOCAxMCAxNiAxMCBaIE0gMTYgMTIgQyAxNC4zNDM3NSAxMiAxMyAxMy4zNDM3NSAxMyAxNSBDIDEzIDE2LjY1NjI1IDE0LjM0Mzc1IDE4IDE2IDE4IEMgMTcuNjU2MjUgMTggMTkgMTYuNjU2MjUgMTkgMTUgQyAxOSAxMy4zNDM3NSAxNy42NTYyNSAxMiAxNiAxMiBaIE0gNy4yNSAxMi45Mzc1IEMgNy4wOTM3NSAxMy42MDkzNzUgNyAxNC4yODUxNTYgNyAxNSBDIDcgMTYuNzUzOTA2IDcuNSAxOC4zOTQ1MzEgOC4zNzUgMTkuNzgxMjUgQyA1Ljg1NTQ2OSAxOC4zMjQyMTkgNC4xMDU0NjkgMTYuNTg1OTM4IDMuNTMxMjUgMTYgQyA0LjAxMTcxOSAxNS41MDc4MTMgNS4zNTE1NjMgMTQuMjAzMTI1IDcuMjUgMTIuOTM3NSBaIE0gMjQuNzUgMTIuOTM3NSBDIDI2LjY0ODQzOCAxNC4yMDMxMjUgMjcuOTg4MjgxIDE1LjUwNzgxMyAyOC40Njg3NSAxNiBDIDI3Ljg5NDUzMSAxNi41ODU5MzggMjYuMTQ0NTMxIDE4LjMyNDIxOSAyMy42MjUgMTkuNzgxMjUgQyAyNC41IDE4LjM5NDUzMSAyNSAxNi43NTM5MDYgMjUgMTUgQyAyNSAxNC4yODUxNTYgMjQuOTA2MjUgMTMuNjAxNTYzIDI0Ljc1IDEyLjkzNzUgWiIvPjwvc3ZnPg==`\r\nexport const undoB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxMi43ODEyNSA1LjI4MTI1IEwgNC43ODEyNSAxMy4yODEyNSBMIDQuMDkzNzUgMTQgTCA0Ljc4MTI1IDE0LjcxODc1IEwgMTIuNzgxMjUgMjIuNzE4NzUgTCAxNC4yMTg3NSAyMS4yODEyNSBMIDcuOTM3NSAxNSBMIDIxIDE1IEMgMjMuNzUzOTA2IDE1IDI2IDE3LjI0NjA5NCAyNiAyMCBMIDI2IDI3IEwgMjggMjcgTCAyOCAyMCBDIDI4IDE2LjE1NjI1IDI0Ljg0Mzc1IDEzIDIxIDEzIEwgNy45Mzc1IDEzIEwgMTQuMjE4NzUgNi43MTg3NSBaIi8+PC9zdmc+`\r\nexport const redoB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxOS4yMTg3NSA1LjI4MTI1IEwgMTcuNzgxMjUgNi43MTg3NSBMIDI0LjA2MjUgMTMgTCAxMSAxMyBDIDcuMTU2MjUgMTMgNCAxNi4xNTYyNSA0IDIwIEwgNCAyNyBMIDYgMjcgTCA2IDIwIEMgNiAxNy4yNDYwOTQgOC4yNDYwOTQgMTUgMTEgMTUgTCAyNC4wNjI1IDE1IEwgMTcuNzgxMjUgMjEuMjgxMjUgTCAxOS4yMTg3NSAyMi43MTg3NSBMIDI3LjIxODc1IDE0LjcxODc1IEwgMjcuOTA2MjUgMTQgTCAyNy4yMTg3NSAxMy4yODEyNSBaIi8+PC9zdmc+`\r\nexport const editB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAyMy45MDYyNSAzLjk2ODc1IEMgMjIuODU5Mzc1IDMuOTY4NzUgMjEuODEyNSA0LjM3NSAyMSA1LjE4NzUgTCA1LjE4NzUgMjEgTCA1LjEyNSAyMS4zMTI1IEwgNC4wMzEyNSAyNi44MTI1IEwgMy43MTg3NSAyOC4yODEyNSBMIDUuMTg3NSAyNy45Njg3NSBMIDEwLjY4NzUgMjYuODc1IEwgMTEgMjYuODEyNSBMIDI2LjgxMjUgMTEgQyAyOC40Mzc1IDkuMzc1IDI4LjQzNzUgNi44MTI1IDI2LjgxMjUgNS4xODc1IEMgMjYgNC4zNzUgMjQuOTUzMTI1IDMuOTY4NzUgMjMuOTA2MjUgMy45Njg3NSBaIE0gMjMuOTA2MjUgNS44NzUgQyAyNC40MTAxNTYgNS44NzUgMjQuOTE3OTY5IDYuMTA1NDY5IDI1LjQwNjI1IDYuNTkzNzUgQyAyNi4zNzg5MDYgNy41NjY0MDYgMjYuMzc4OTA2IDguNjIxMDk0IDI1LjQwNjI1IDkuNTkzNzUgTCAyNC42ODc1IDEwLjI4MTI1IEwgMjEuNzE4NzUgNy4zMTI1IEwgMjIuNDA2MjUgNi41OTM3NSBDIDIyLjg5NDUzMSA2LjEwNTQ2OSAyMy40MDIzNDQgNS44NzUgMjMuOTA2MjUgNS44NzUgWiBNIDIwLjMxMjUgOC43MTg3NSBMIDIzLjI4MTI1IDExLjY4NzUgTCAxMS4xODc1IDIzLjc4MTI1IEMgMTAuNTMxMjUgMjIuNSA5LjUgMjEuNDY4NzUgOC4yMTg3NSAyMC44MTI1IFogTSA2LjkzNzUgMjIuNDM3NSBDIDguMTM2NzE5IDIyLjkyMTg3NSA5LjA3ODEyNSAyMy44NjMyODEgOS41NjI1IDI1LjA2MjUgTCA2LjI4MTI1IDI1LjcxODc1IFoiLz48L3N2Zz4=`\r\nexport const invalidB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA3LjIxODc1IDUuNzgxMjUgTCA1Ljc4MTI1IDcuMjE4NzUgTCAxNC41NjI1IDE2IEwgNS43ODEyNSAyNC43ODEyNSBMIDcuMjE4NzUgMjYuMjE4NzUgTCAxNiAxNy40Mzc1IEwgMjQuNzgxMjUgMjYuMjE4NzUgTCAyNi4yMTg3NSAyNC43ODEyNSBMIDE3LjQzNzUgMTYgTCAyNi4yMTg3NSA3LjIxODc1IEwgMjQuNzgxMjUgNS43ODEyNSBMIDE2IDE0LjU2MjUgWiIvPjwvc3ZnPg==`\r\nexport const validB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAyOC4yODEyNSA2LjI4MTI1IEwgMTEgMjMuNTYyNSBMIDMuNzE4NzUgMTYuMjgxMjUgTCAyLjI4MTI1IDE3LjcxODc1IEwgMTAuMjgxMjUgMjUuNzE4NzUgTCAxMSAyNi40MDYyNSBMIDExLjcxODc1IDI1LjcxODc1IEwgMjkuNzE4NzUgNy43MTg3NSBaIi8+PC9zdmc+`\r\nexport const upB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiA0LjA5Mzc1IEwgMTUuMjgxMjUgNC43ODEyNSBMIDYuNzgxMjUgMTMuMjgxMjUgTCA4LjIxODc1IDE0LjcxODc1IEwgMTUgNy45Mzc1IEwgMTUgMjggTCAxNyAyOCBMIDE3IDcuOTM3NSBMIDIzLjc4MTI1IDE0LjcxODc1IEwgMjUuMjE4NzUgMTMuMjgxMjUgTCAxNi43MTg3NSA0Ljc4MTI1IFoiLz48L3N2Zz4=`\r\nexport const downB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNSA0IEwgMTUgMjQuMDYyNSBMIDguMjE4NzUgMTcuMjgxMjUgTCA2Ljc4MTI1IDE4LjcxODc1IEwgMTUuMjgxMjUgMjcuMjE4NzUgTCAxNiAyNy45MDYyNSBMIDE2LjcxODc1IDI3LjIxODc1IEwgMjUuMjE4NzUgMTguNzE4NzUgTCAyMy43ODEyNSAxNy4yODEyNSBMIDE3IDI0LjA2MjUgTCAxNyA0IFoiLz48L3N2Zz4=`\r\n","import { copyToClipboard } from '@i-is-as-i-does/jack-js/src/modules/Stock.js'\r\nimport { vHide, vShow, vTempToggle } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport { blockWrap, getElm, iconImage } from '../shared/NxCommons.js'\r\nimport { registerTranslElm } from '@i-is-as-i-does/nexus-core/src/transl/NxElmTranslate.js'\r\nimport { concatSrc, registerUpdateEvt } from '../shared/NxState.js'\r\nimport { getLang } from '@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js'\r\nimport { getSnippet } from '@i-is-as-i-does/nexus-core/src/data/NxSnippet.js'\r\nimport { appDefaultCss, appIO } from '../shared/NxCdn.js'\r\nimport { copyB64 } from '../shared/NxIcons.js'\r\n\r\nvar drawerElm = null\r\nvar editMode = false\r\nvar currentStyle = null\r\n\r\nfunction actionLink(action, text) {\r\n  var lk = getElm('A', 'nx-source-' + action)\r\n  lk.textContent = text\r\n  return lk\r\n}\r\n\r\nfunction resolveSrc(state) {\r\n  var src\r\n  if (editMode) {\r\n    src = '#editing'\r\n  } else {\r\n    src = concatSrc(state)\r\n  }\r\n  return src\r\n}\r\n\r\nfunction linkContent(state) {\r\n  if (state.dataUrl) {\r\n    return resolveSrc(state)\r\n  }\r\n  return ''\r\n}\r\n\r\nfunction toolTip(className, text) {\r\n  var tooltip = getElm('SPAN', className)\r\n  tooltip.textContent = text\r\n  tooltip.style.opacity = 0\r\n  tooltip.hidden = true\r\n  registerTranslElm(tooltip, text)\r\n  return tooltip\r\n}\r\n\r\nfunction toggleLink() {\r\n  var text = '</>'\r\n  var altText = '< />'\r\n  var lk = actionLink('snippets', text)\r\n\r\n  lk.addEventListener('click', () => {\r\n    if (lk.textContent == altText) {\r\n      lk.textContent = text\r\n      lk.classList.remove('nx-active')\r\n      vHide(drawerElm, 'ease', 200)\r\n    } else {\r\n      lk.textContent = altText\r\n      lk.classList.add('nx-active')\r\n      vShow(drawerElm, 'ease', 100, function () {\r\n        drawerElm.scrollIntoView({\r\n          block: 'end',\r\n          behavior: 'smooth',\r\n          inline: 'nearest',\r\n        })\r\n      })\r\n    }\r\n  })\r\n  return lk\r\n}\r\n\r\nfunction linkSource(state) {\r\n  return codeElm('json', textAreaElm(state, linkContent))\r\n}\r\n\r\nfunction snippetsBundle(state) {\r\n  drawerElm = getElm('DIV', 'nx-source-drawer')\r\n  drawerElm.append(linkSource(state), embedSnippet(state))\r\n  drawerElm.style.display = 'none'\r\n\r\n  var tgg = getElm('DIV', 'nx-source-toggle')\r\n  var snippetLink = toggleLink()\r\n  tgg.append(snippetLink)\r\n\r\n  return [tgg, drawerElm]\r\n}\r\n\r\nfunction textAreaElm(state, callback) {\r\n  var snpInp = getElm('TEXTAREA')\r\n  snpInp.spellcheck = false\r\n  snpInp.textContent = callback(state)\r\n\r\n  registerUpdateEvt(function (newState) {\r\n    snpInp.textContent = callback(newState)\r\n  })\r\n  return snpInp\r\n}\r\n\r\nfunction copyLink(snpElm) {\r\n  var copyLk = getElm('A', 'nx-source-link')\r\n  var copyIc = iconImage(copyB64, 16)\r\n\r\n  copyLk.append(copyIc)\r\n  var copyTooltip = toolTip('nx-source-copy-tooltip', 'c/c')\r\n  copyLk.append(copyTooltip)\r\n\r\n  copyLk.addEventListener('click', () =>\r\n    copyToClipboard(snpElm.textContent, () => {\r\n      vTempToggle(copyTooltip, 'fade', 1000, 200)\r\n    })\r\n  )\r\n  return copyLk\r\n}\r\n\r\nfunction codeElm(name, elm) {\r\n  var snp = getElm('DIV', 'nx-' + name + '-snippet')\r\n  snp.append(elm, copyLink(elm))\r\n  return snp\r\n}\r\n\r\nfunction embedSnippet(state) {\r\n  return codeElm('embed', textAreaElm(state, embedContent))\r\n}\r\n\r\nfunction embedContent(state) {\r\n  if (editMode) {\r\n    return '#editing'\r\n  }\r\n  if (state.dataUrl) {\r\n    return getSnippet(resolveSrc(state), currentStyle, appIO, getLang())\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function sourceBlock(state, currentStyleUrl = null, editionSource = false) {\r\n  if (editionSource) {\r\n    editMode = true\r\n  }\r\n  if (!currentStyleUrl) {\r\n    currentStyleUrl = appDefaultCss\r\n  } else if (currentStyleUrl !== appDefaultCss) {\r\n    currentStyle = currentStyleUrl\r\n  }\r\n  return blockWrap('source', snippetsBundle(state), false)\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { conciseUrl, oembedLink, oembedResponse } from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\nimport { waitForElmInDOM } from '@i-is-as-i-does/jack-js/src/modules/Help.js'\r\nimport { logErr } from '../logs/NxLog.js'\r\n\r\nimport { registerOembedResponse, getStoredOembedResponse } from '../storg/NxMemory.js'\r\nimport { supportedOembedMedia } from '../validt/NxSpecs.js'\r\n\r\nconst mediaReadyEvent = new Event('mediaReady')\r\n\r\nexport function dispatchMediaReady (resolvedElm, parentElm) {\r\n  waitForElmInDOM(resolvedElm.tagName, parentElm).then(() => {\r\n    parentElm.dispatchEvent(mediaReadyEvent)\r\n  })\r\n}\r\n\r\nexport function placeMedia (url, parentElm, mediaElm) {\r\n  if (mediaElm.tagName !== 'A') {\r\n    var loadEvent = 'load'\r\n    var srcElm = mediaElm\r\n    if (['VIDEO', 'AUDIO'].includes(mediaElm.tagName)) {\r\n      loadEvent = 'loadedmetadata'\r\n      if (mediaElm.tagName === 'VIDEO ') {\r\n        srcElm = mediaElm.firstChild\r\n      }\r\n    }\r\n    mediaElm.addEventListener(loadEvent, function () {\r\n      dispatchMediaReady(mediaElm, parentElm)\r\n    })\r\n    srcElm.addEventListener('error', function () {\r\n      logErr('Unable to load requested media', url)\r\n      var fallback = pageElm(url)\r\n      mediaElm.replaceWith(fallback)\r\n      dispatchMediaReady(fallback, parentElm)\r\n    })\r\n    srcElm.src = url\r\n  } else {\r\n    if(!mediaElm.textContent){\r\n      mediaElm.textContent = conciseUrl(url, true)\r\n    }\r\n    dispatchMediaReady(mediaElm, parentElm)\r\n    mediaElm.href = url\r\n  }\r\n  parentElm.append(mediaElm)\r\n}\r\n\r\nexport function setMediaUrl (srcElm, attrb = 'src', url = null) {\r\n  if (url) {\r\n    srcElm.setAttribute(attrb, url)\r\n  }\r\n}\r\n\r\nexport function pageElm (url = null) {\r\n  var mediaElm = document.createElement('A')\r\n  mediaElm.target = '_blank'\r\n  if(url){\r\n    mediaElm.textContent = conciseUrl(url, true)\r\n    mediaElm.setAttribute('href', url)\r\n  }\r\n  return mediaElm\r\n}\r\n\r\nexport function videoElm (url = null) {\r\n  var mediaElm = document.createElement('VIDEO')\r\n  mediaElm.setAttribute('controls', true)\r\n  var srcElm = document.createElement('SOURCE')\r\n  mediaElm.append(srcElm)\r\n  setMediaUrl(srcElm, 'src', url)\r\n  return mediaElm\r\n}\r\n\r\nexport function audioElm (url = null) {\r\n  var mediaElm = document.createElement('AUDIO')\r\n  mediaElm.setAttribute('controls', true)\r\n  setMediaUrl(mediaElm, 'src', url)\r\n  return mediaElm\r\n}\r\n\r\nexport function imgElm (url = null) {\r\n  var mediaElm = document.createElement('IMG')\r\n  setMediaUrl(mediaElm, 'src', url)\r\n  return mediaElm\r\n}\r\n\r\nexport function iframeElm (url = null) {\r\n  var mediaElm = document.createElement('IFRAME')\r\n  mediaElm.scrolling = 'no'\r\n  mediaElm.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'\r\n  mediaElm.allowfullscreen = true\r\n  setMediaUrl(mediaElm, 'src', url)\r\n  return mediaElm\r\n}\r\n\r\nexport function mediaElm (type, url = null) {\r\n  if (supportedOembedMedia.includes(type)) {\r\n    type = 'iframe'\r\n  }\r\n  var f\r\n  switch (type) {\r\n    case 'image':\r\n      f = imgElm\r\n      break\r\n    case 'video':\r\n      f = videoElm\r\n      break\r\n    case 'audio':\r\n      f = audioElm\r\n      break\r\n    case 'iframe':\r\n      f = iframeElm\r\n      break\r\n    default:\r\n      f = pageElm\r\n  }\r\n  return f(url)\r\n}\r\n\r\nexport function resolveEmbedMediaData (url, type) {\r\n  var iframeUrl = getStoredOembedResponse(url)\r\n  var success = function () {\r\n    return { type: type, url: iframeUrl }\r\n  }\r\n  var fallback = function () {\r\n    return { type: 'page', url: url }\r\n  }\r\n  if (iframeUrl) {\r\n    return Promise.resolve(success())\r\n  }\r\n  var link = oembedLink(url, type, 720)\r\n  if (!link) {\r\n    return Promise.resolve(fallback())\r\n  }\r\n  return oembedResponse(link).then(response => {\r\n    iframeUrl = response.html.split('src=\"')[1].split('\"')[0]\r\n    registerOembedResponse(url, iframeUrl)\r\n    return success()\r\n  }).catch((err) => {\r\n    logErr('Failed to resolved oembed media', { url: url, err: err.message })\r\n    return fallback()\r\n  })\r\n}\r\n\r\nexport function resolveEmbedMedia (url, type, parentElm) {\r\n  resolveEmbedMediaData(url, type).then(result => {\r\n    placeMedia(result.url, parentElm, mediaElm(result.type))\r\n  })\r\n}\r\n\r\nexport function resolveMedia (url, type, parentElm) {\r\n  if (supportedOembedMedia.includes(type)) {\r\n    resolveEmbedMedia(url, type, parentElm)\r\n  } else {\r\n    placeMedia(url, parentElm, mediaElm(type))\r\n  }\r\n}\r\n\r\nexport function preResolveViewMedia (view) {\r\n  if(view.data.content.media.type === 'page'){\r\n    view.resolved.media = true\r\n    return Promise.resolve(view)\r\n  }\r\n  var host = document.createElement('DIV')\r\n  host.style.display = 'none'\r\n  document.body.append(host)\r\n  var handleResult = function () {\r\n    if (host.firstChild.tagName === 'A' && view.data.content.media.type !== 'page') {\r\n      view.data.content.media.type = 'page'\r\n    } else if (host.firstChild.tagName === 'IFRAME') {\r\n      view.data.content.media.url = host.firstChild.src\r\n    }\r\n    host.remove()\r\n    view.resolved.media = true\r\n    return view\r\n  }\r\n  var promise = new Promise(function (resolve) {\r\n    host.addEventListener('mediaReady', resolve)\r\n  }).then(handleResult)\r\n  resolveMedia(view.data.content.media.url, view.data.content.media.type, host)\r\n  return promise\r\n}\r\n","import { threadTextElm } from './NxThread.js'\r\nimport { getElm } from '../shared/NxCommons.js'\r\nimport { resolveMedia } from '@i-is-as-i-does/nexus-core/src/data/NxMedia.js'\r\n\r\nfunction threadMediaElm(threadData, countReady) {\r\n  var mediaContainer = getElm('DIV', 'nx-media')\r\n\r\n  var mediaWrap = getElm('DIV')\r\n  mediaContainer.append(mediaWrap)\r\n\r\n  var captionElm = null\r\n  if (threadData.content.media.caption) {\r\n    captionElm = threadTextElm(threadData, ['content', 'media', 'caption'])\r\n    mediaContainer.append(captionElm)\r\n  }\r\n\r\n  mediaWrap.addEventListener('mediaReady', function () {\r\n    if (mediaWrap.firstChild.tagName === 'A' && threadData.content.media.type !== 'page') {\r\n      threadData.content.media.type = 'page'\r\n    }\r\n    mediaWrap.className = 'nx-' + threadData.content.media.type + '-media'\r\n    if (countReady !== null) {\r\n      countReady()\r\n    }\r\n  })\r\n  resolveMedia(threadData.content.media.url, threadData.content.media.type, mediaWrap)\r\n  return mediaContainer\r\n}\r\n\r\nexport function mediaElm(threadData, countReady = null) {\r\n  var mediadiv = getElm('DIV', 'nx-content-media')\r\n  mediadiv.append(threadMediaElm(threadData, countReady))\r\n  return mediadiv\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nexport class Spinner {\r\n  constructor(spinContainer, spinStates = [], speed = 100) {\r\n    this.spinContainer = spinContainer\r\n    if(!spinStates.length){\r\n        spinStates = [\"\", \"/\", \"–\", \"\\\\\", \"|\"]\r\n    } else if(spinStates[0] !== ''){\r\n        spinStates.unshift('')\r\n    }\r\n    this.spinStates = spinStates\r\n    this.speed = speed\r\n    this.spinPosition = -1\r\n  }\r\n\r\n  endSpin() {\r\n    this.spinPosition = -1\r\n  }\r\n  \r\n  startSpin() {\r\n    this.spinPosition = 0\r\n    var f = window.setInterval(function(){\r\n        if (this.spinPosition === -1) {\r\n            this.spinContainer.textContent = ''\r\n            clearInterval(f)\r\n          } else {\r\n            this.spinContainer.textContent = this.spinStates[this.spinPosition]\r\n            if (this.spinPosition === (this.spinStates.length - 1)) {\r\n              this.spinPosition = 1\r\n            } else {\r\n              this.spinPosition++\r\n            }\r\n          }\r\n    }.bind(this), this.speed)\r\n  }\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\nimport { isValidHttpUrl } from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\nimport { splitCurrentUrl } from '../base/NxRequest.js'\r\nimport { splitUrlAndId } from '../validt/NxStamper.js'\r\n\r\nexport function threadView (thread, url) {\r\n  return {\r\n    src: url + '#' + thread.id,\r\n    data: thread,\r\n    nested: [],\r\n    resolved: { nested: false, media: false }\r\n  }\r\n}\r\n\r\nexport function authorView (nxdata, url) {\r\n  return {\r\n    src: url,\r\n    data: nxdata.author\r\n  }\r\n}\r\n\r\nexport function selectedThreadsViews (nxdata, url, ids) {\r\n  var viewstore = {\r\n    views: { threads: [] },\r\n    list: [],\r\n    failed: ids,\r\n    confirmed: []\r\n  }\r\n  nxdata.threads.forEach((thread) => {\r\n    var idx = ids.indexOf(thread.id) \r\n    if (idx !== -1) {\r\n      var view = threadView(thread, url)\r\n      viewstore.views.threads.push(view)\r\n      viewstore.list.push(view.src)\r\n      viewstore.confirmed.push(thread.id)\r\n      viewstore.failed.splice(idx,1)\r\n    }\r\n  })\r\n  return viewstore\r\n}\r\n\r\nexport function allThreadsViews (nxdata, url) {\r\n  var viewstore = {\r\n    views: { threads: [] },\r\n    list: []\r\n  }\r\n  nxdata.threads.forEach(thread => {\r\n    var view = threadView(thread, url)\r\n    viewstore.views.threads.push(view)\r\n    viewstore.list.push(view.src)\r\n  })\r\n  return viewstore\r\n}\r\n\r\nexport function addAuthorView (nxdata, url, viewstore) {\r\n  viewstore.views.author = authorView(nxdata, url)\r\n}\r\n\r\nexport function authorAndThreadsViews (nxdata, url) {\r\n  var viewstore = allThreadsViews(nxdata, url)\r\n  addAuthorView(nxdata, url, viewstore)\r\n  return viewstore\r\n}\r\n\r\nexport function authorAndselectedThreadsViews (nxdata, url, ids) {\r\n  var viewstore = selectedThreadsViews(nxdata, url, ids)\r\n  addAuthorView(nxdata, url, viewstore)\r\n  return viewstore\r\n}\r\n\r\nexport function getView (viewstore, src) {\r\n  if (src !== viewstore.views.author.src) {\r\n    var index = viewstore.list.indexOf(src)\r\n    if (index !== -1) {\r\n    return viewstore.views.threads[index]\r\n    }\r\n  }\r\n  return viewstore.views.author\r\n}\r\n\r\nexport function addViewToHistory (src, replace = false) {\r\n  var url = splitCurrentUrl.url\r\n  if(isValidHttpUrl(url)){\r\n    var id = splitUrlAndId(src).id\r\n    if (id) {\r\n      url += '#' + id\r\n    }\r\n    if (replace) {\r\n      window.history.replaceState({ nexus: src }, document.title, url)\r\n    } else {\r\n      window.history.pushState({ nexus: src }, document.title, url)\r\n    }\r\n  }\r\n}\r\n\r\nexport function listenToHistoryChange (callback) {\r\n  window.onpopstate = function (event) {\r\n    if (event.state && event.state.nexus) {\r\n      callback(event.state.nexus)\r\n    }\r\n  }\r\n}\r\n\r\nexport function processFirstView (request, viewstore, forceId = null) {\r\n  if (request.id) {\r\n    var ids = [forceId, request.id]\r\n    for (var i = 0; i < 2; i++) {\r\n      var index = viewstore.list.indexOf(request.url + '#' + ids[i])\r\n      if (index !== -1) {\r\n        return viewstore.views.threads[index]\r\n      }\r\n    }\r\n  }\r\n  return viewstore.views.author\r\n}\r\n\r\nexport function extendInitData (seed, forceId = null) {\r\n    seed.viewstore = authorAndThreadsViews(seed.nxdata, seed.request.url)\r\n    seed.firstview = processFirstView(seed.request, seed.viewstore, forceId)\r\n    addViewToHistory(seed.firstview.src, true)\r\n    return seed\r\n}\r\n","/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */\r\n\r\nimport { getStoredLinkedMaps, registerLinkedMaps } from '../storg/NxMemory.js'\r\nimport { splitUrlAndId } from '../validt/NxStamper.js'\r\nimport { getSrcData } from '../load/NxSrc.js'\r\nimport { logErr } from '../logs/NxLog.js'\r\nimport { authorAndselectedThreadsViews } from './NxViews.js'\r\n\r\nexport function buildLinkedInstances (thread, exclude = []) {\r\n  // @doc instances = {url:[...ids] }\r\n  var instances = {}\r\n\r\n  for(var i=0; i < thread.linked.length; i++){\r\n    if (!exclude.includes(thread.linked[i])) {\r\n      var split = splitUrlAndId(thread.linked[i])\r\n      if (!exclude.includes(split.url)) {\r\n        if(!Object.prototype.hasOwnProperty.call(instances, split.url)){\r\n          instances[split.url] = []\r\n        } \r\n        if(split.id){\r\n          instances[split.url].push(split.id)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return instances\r\n}\r\n\r\n\r\nexport function getLinkedInstances (src, thread, exclude = [], noCache = false) {\r\n  var store = { instances: null, register: false }\r\n  if(!noCache){\r\n    store.instances = getStoredLinkedMaps(src)\r\n  }\r\n  if (store.instances === null) {\r\n    store.instances = buildLinkedInstances(thread, exclude)\r\n    store.register = true\r\n  }\r\n  return store\r\n}\r\n\r\n\r\nexport function resolveLinkedViews (view, exclude = [], noCache = false) {\r\n  var store = getLinkedInstances(view.src, view.data, exclude, noCache)\r\n  var register = store.register\r\n  var confirmedInstances = {}\r\n  const promises = []\r\n  for(let [url, ids] of Object.entries(store.instances)){\r\n    var promise = getSrcData(url).then(nxdata => {\r\n      var viewstore = authorAndselectedThreadsViews(nxdata, url, ids)\r\n      if (!register && viewstore.failed.length) {\r\n        register = true\r\n        logErr('Linked threads could not be resolved', viewstore.failed.join(', '))\r\n      }\r\n      view.nested.push({views : viewstore.views, list: viewstore.list})\r\n      confirmedInstances[url] = viewstore.confirmed\r\n    }).catch(() => {\r\n      if (!register){\r\n        register = true\r\n      }\r\n      logErr('Linked source could not be resolved', url)\r\n    })\r\n    promises.push(promise)\r\n  }\r\n\r\n  return Promise.all(promises).then(() => { \r\n    if (!noCache && register) {\r\n      registerLinkedMaps(view.src, confirmedInstances)\r\n    }\r\n    view.resolved.nested = true\r\n    return view\r\n  })\r\n}\r\n","import { isNonEmptyStr } from '@i-is-as-i-does/jack-js/src/modules/Check.js'\r\nimport {\r\n  vHide,\r\n  vShow,\r\n  vPlace,\r\n  vReplace\r\n} from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport { getAltState, registerUpdateEvt, resolveState } from '../shared/NxState.js'\r\nimport { authorIndexLink, authorUrl, viewLink } from './NxIdent.js'\r\nimport { mediaElm } from './NxMedia.js'\r\nimport {\r\n  blockWrap,\r\n  getElm,\r\n  landmarkElm,\r\n  lines,\r\n  setHistoryControls,\r\n  threadTitleElm,\r\n  toggleNavEnd,\r\n  spinContainer,\r\n} from '../shared/NxCommons.js'\r\nimport { logErr } from '@i-is-as-i-does/nexus-core/src/logs/NxLog.js'\r\nimport { Spinner } from '@i-is-as-i-does/nexus-core/src/data/NxSpin.js'\r\nimport { getLinkedInstances } from '@i-is-as-i-does/nexus-core/src/data/NxNest.js'\r\nimport { registerLinkedMaps } from '@i-is-as-i-does/nexus-core/src/storg/NxMemory'\r\n\r\nvar inEditMode = false\r\nvar forceUpdate = false\r\n\r\nvar threadBlocks\r\n\r\nvar currentElm\r\nvar descrpElm\r\nvar contentElm\r\nvar distantNav\r\n\r\nvar slider\r\nvar linked = []\r\n\r\nvar spinElm\r\nvar spinner\r\nvar ready = 0\r\n\r\nvar linkedCtrls = {\r\n  ctrls: {\r\n    prev: { symbol: '⊼', elm: null },\r\n    next: { symbol: '⊻', elm: null },\r\n  },\r\n  position: 0,\r\n  count: 0,\r\n}\r\n\r\nvar distantLandmark\r\n\r\nfunction setDistantLandmark() {\r\n  distantLandmark = landmarkElm('distant')\r\n  distantLandmark.style.display = 'none'\r\n}\r\n\r\nfunction setSpinner() {\r\n  spinElm = spinContainer()\r\n  spinner = new Spinner(spinElm)\r\n}\r\n\r\nfunction countReady() {\r\n  ready++\r\n  if (ready === 2) {\r\n    spinner.endSpin()\r\n    spinElm.style.display = 'none'\r\n    if (linked.length) {\r\n      linkedCtrls.count = linked.length\r\n      toggleNavEnd(linkedCtrls)\r\n      setFirstDistantContent(linked.length > 1)\r\n    }\r\n    vShow(threadBlocks, 'ease', 200)\r\n  }\r\n}\r\n\r\nfunction updateThreadBlocks(state) {\r\n  var newThreadData = resolveThreadData(state)\r\n  vHide(threadBlocks, 'ease', 200, function () {\r\n    if (newThreadData) {\r\n      spinner.startSpin()\r\n      ready = 0\r\n      spinElm.style.display = 'block'\r\n    }\r\n\r\n    resetDistantLinks(state.dataUrl, newThreadData)\r\n\r\n    var newContent = threadContent(newThreadData, false)\r\n    var newDescrpTxt = threadTextElm(newThreadData, ['description'])\r\n    descrpElm.firstChild.replaceWith(newDescrpTxt)\r\n    contentElm.firstChild.replaceWith(newContent)\r\n  })\r\n}\r\n\r\nfunction descriptionElm(threadData) {\r\n  descrpElm = getElm('DIV', 'nx-thread-description')\r\n  descrpElm.append(threadTextElm(threadData, ['description']))\r\n  return descrpElm\r\n}\r\n\r\nfunction resolveThreadData(state) {\r\n  var threadData = null\r\n  if (state && state.threadIndex > -1) {\r\n    threadData = state.srcData.threads[state.threadIndex]\r\n  }\r\n  return threadData\r\n}\r\nfunction distantThreadBlock(dataUrl, threadData) {\r\n  setDistantLandmark()\r\n  setDistantSlider()\r\n  resolveLinkedThreads(dataUrl, threadData)\r\n  return blockWrap('distant', [slider], distantLandmark)\r\n}\r\n\r\nfunction localThreadBlock(threadData) {\r\n  setContentElm(threadData)\r\n  return blockWrap('local', [contentElm], landmarkElm('local'))\r\n}\r\n\r\nfunction setContentElm(threadData) {\r\n  contentElm = getElm('DIV', 'nx-local-content')\r\n  contentElm.append(threadContent(threadData, false))\r\n}\r\n\r\nfunction showDistantNav() {\r\n  distantNav.style.visibility = 'visible'\r\n}\r\n\r\nfunction hideDistantNav() {\r\n  distantNav.style.visibility = 'hidden'\r\n}\r\n\r\nfunction resetDistantLinks(dataUrl, threadData) {\r\n  hideDistantNav()\r\n  toggleDistantLandmark(false)\r\n  removeDistantContent(false)\r\n\r\n  linked = []\r\n  linkedCtrls.position = 0\r\n  linkedCtrls.count = 0\r\n  toggleNavEnd(linkedCtrls)\r\n\r\n  resolveLinkedThreads(dataUrl, threadData)\r\n}\r\n\r\nfunction resolveLinkedThreads(dataUrl, threadData) {\r\n  if (threadData && threadData.linked.length) {\r\n    setLinkedItems(dataUrl, threadData)\r\n  } else {\r\n    countReady()\r\n  }\r\n}\r\n\r\nfunction removeDistantContent(transition = false) {\r\n  var prevElm = currentElm.firstChild\r\n  if (prevElm) {\r\n    if (transition) {\r\n      vHide(prevElm, 'ease', 200, function () {\r\n        prevElm.remove()\r\n      })\r\n    } else {\r\n      prevElm.remove()\r\n    }\r\n  }\r\n}\r\n\r\nfunction setFirstDistantContent(showNav = false) {\r\n  toggleDistantLandmark(true)\r\n  if (showNav) {\r\n    showDistantNav()\r\n  }\r\n  currentElm.append(linked[0])\r\n}\r\n\r\nfunction setCurrentLink() {\r\n  if (linked.length) {\r\n    var nw = linked[linkedCtrls.position]\r\n\r\n    if (currentElm.firstChild) {\r\n      vReplace(currentElm.firstChild, nw, 200)\r\n    } else {\r\n      vPlace(currentElm, nw, false, 'ease', 200, callb)\r\n    }\r\n  } else {\r\n    removeDistantContent(true)\r\n  }\r\n}\r\n\r\nfunction distantNavElm() {\r\n  distantNav = getElm('NAV', 'nx-distant-nav')\r\n  distantNav.append(linkedCtrls.ctrls['prev'].elm, currentElm, linkedCtrls.ctrls['next'].elm)\r\n  hideDistantNav()\r\n  return distantNav\r\n}\r\n\r\nfunction setDistantSlider() {\r\n  slider = getElm('DIV')\r\n  currentElm = getElm('DIV', 'nx-distant-link')\r\n  setHistoryControls(linkedCtrls, setCurrentLink)\r\n  toggleNavEnd(linkedCtrls)\r\n  slider.append(distantNavElm(), currentElm)\r\n}\r\nfunction linkedElm(distantState) {\r\n  var elms = [authorIndexLink(distantState, false), authorUrl(distantState, false)]\r\n  if (distantState.threadId !== '/') {\r\n    elms.push(viewLink(distantState, false), threadContent(resolveThreadData(distantState), true))\r\n  }\r\n  var elm = getElm('DIV')\r\n  elm.append(...elms)\r\n  return elm\r\n}\r\n\r\nfunction toggleDistantLandmark(hasLinks) {\r\n  var hidden = distantLandmark.style.display === 'none'\r\n  if (hasLinks && hidden) {\r\n    distantLandmark.style.display = 'block'\r\n  } else if (!hasLinks && !hidden) {\r\n    distantLandmark.style.display = 'none'\r\n  }\r\n}\r\n\r\nfunction noLinkedCache(){\r\nif(inEditMode || forceUpdate){\r\n  return true\r\n}\r\nreturn false\r\n}\r\n\r\nfunction setLinkedItems(dataUrl, threadData) {\r\n  var key = dataUrl + '#' + threadData.id\r\n  var store = getLinkedInstances(key, threadData, [], noLinkedCache())\r\n  var register = store.register\r\n  var confirmedInstances = {}\r\n  var indexes = []\r\n  const promises = []\r\n  for (let [url, ids] of Object.entries(store.instances)) {\r\n    var prc = resolveState(url, '/', true)\r\n      .then((distantState) => {\r\n        confirmedInstances[url] = []\r\n        if (ids.length) {\r\n          ids.forEach((id) => {\r\n            var threadIndex = distantState.srcData.index.indexOf(id)\r\n            if (threadIndex !== -1) {\r\n              confirmedInstances[url].push(id)\r\n              var nDistantState = getAltState(distantState, id, threadIndex)\r\n              linked.push(linkedElm(nDistantState))\r\n            } else {\r\n              register = true\r\n              logErr('Linked thread could not be resolved', id)\r\n            }\r\n          })\r\n        }\r\n        if (!confirmedInstances[url].length) {\r\n          indexes.push(linkedElm(distantState))\r\n        }\r\n      })\r\n      .catch(() => {\r\n        register = true\r\n        logErr('Linked source could not be resolved', url)\r\n      })\r\n    promises.push(prc)\r\n  }\r\n\r\n  Promise.all(promises).then(() => {\r\n    if (register) {\r\n      registerLinkedMaps(key, confirmedInstances)\r\n    }\r\n    if (indexes.length) {\r\n      linked = linked.concat(indexes)\r\n    }\r\n    countReady()\r\n  })\r\n}\r\n\r\nfunction threadContent(threadData, isDistant = false) {\r\n  var dv = getElm('DIV', 'nx-content')\r\n  var callb = null\r\n  if (!isDistant) {\r\n    callb = countReady\r\n  }\r\n  var callbsent = false\r\n  if (threadData) {\r\n    var elms = [dateElm(threadData), contentBody(threadData)]\r\n    if (\r\n      threadData.content.media &&\r\n      threadData.content.media.url &&\r\n      threadData.content.media.url.length\r\n    ) {\r\n      callbsent = true\r\n      elms.push(mediaElm(threadData, callb))\r\n    }\r\n    dv.append(...elms)\r\n  }\r\n  if (!callbsent && callb !== null) {\r\n    callb()\r\n  }\r\n  return dv\r\n}\r\n\r\nfunction contentBody(threadData) {\r\n  var bodydiv = getElm('DIV', 'nx-content-body')\r\n  bodydiv.append(\r\n    threadTextElm(threadData, ['content', 'main']),\r\n    threadTextElm(threadData, ['content', 'aside'])\r\n  )\r\n  return bodydiv\r\n}\r\n\r\nfunction dateElm(threadData) {\r\n  var datediv = getElm('DIV', 'nx-content-meta')\r\n  var rdate = threadTextElm(threadData, ['content', 'timestamp'])\r\n  datediv.append(rdate)\r\n  return datediv\r\n}\r\n\r\nfunction threadFieldText(threadData, ref = []) {\r\n  if (threadData) {\r\n    var data = Object.assign({}, threadData)\r\n    for (var r = 0; r < ref.length; r++) {\r\n      data = data[ref[r]]\r\n    }\r\n    if (isNonEmptyStr(data)) {\r\n       if (['description', 'main', 'aside', 'caption'].includes(ref[ref.length - 1])) {\r\n        data = lines(data)\r\n      }\r\n      return data\r\n    }\r\n  }\r\n  return ''\r\n}\r\n\r\nfunction threadHeader(state, threadData) {\r\n  var header = getElm('DIV', 'nx-thread-header')\r\n  header.append(threadTitleElm(state, true), descriptionElm(threadData))\r\n  return header\r\n}\r\n\r\nfunction localAndDistantBlocks(dataUrl, threadData) {\r\n  threadBlocks = getElm('DIV', 'nx-thread-blocks')\r\n  threadBlocks.style.display = 'none'\r\n  threadBlocks.append(localThreadBlock(threadData), distantThreadBlock(dataUrl, threadData))\r\n\r\n  return threadBlocks\r\n}\r\n\r\nexport function threadTextElm(threadData, ref) {\r\n  var dv = getElm('DIV', 'nx-' + ref.join('-'))\r\n  dv.append(threadFieldText(threadData, ref))\r\n  return dv\r\n}\r\n\r\nexport function mainThreadBlock(state, editMode) {\r\n\r\n  inEditMode = editMode\r\n  var threadData = resolveThreadData(state)\r\n\r\n  var mainBlock = getElm('DIV', 'nx-main-block nx-thread')\r\n  setSpinner()\r\n\r\n  if (threadData) {\r\n    spinner.startSpin()\r\n  }\r\n  var blocks = [\r\n    threadHeader(state, threadData),\r\n    spinElm,\r\n    localAndDistantBlocks(state.dataUrl, threadData),\r\n  ]\r\n\r\n  mainBlock.append(...blocks)\r\n\r\n  registerUpdateEvt(function (newState, skip, forceTrigger) {\r\n    forceUpdate = forceTrigger\r\n    updateThreadBlocks(newState)\r\n  })\r\n\r\n  return mainBlock\r\n}\r\n","import { historyBlock } from './NxHistory.js'\r\nimport { mainIndexBlock } from './NxIndex.js'\r\nimport { appHeader, instanceWrap, serviceWrap } from '../shared/NxCommons.js'\r\nimport { sourceBlock } from './NxSource.js'\r\nimport { mainThreadBlock } from './NxThread.js'\r\n\r\nexport function readerElms(seed) {\r\n  return instanceWrap(appHeader(), [\r\n    serviceWrap(\r\n      [historyBlock(seed.state)],\r\n      [mainIndexBlock(seed.state), mainThreadBlock(seed.state, seed.editMode)],\r\n      [sourceBlock(seed.state, seed.styleUrl, seed.editMode)],\r\n      'reader'\r\n    ),\r\n  ])\r\n}\r\n","import { itemsMinMax } from '@i-is-as-i-does/nexus-core/src/validt/NxSpecs'\r\nimport { getElm } from '../shared/NxCommons.js'\r\n\r\nexport function addBtn() {\r\n  var btn = getElm('BUTTON', 'nx-add-link')\r\n  btn.type = 'button'\r\n  btn.textContent = '+'\r\n  return btn\r\n}\r\n\r\nexport function toggleAddBtn(btn, haystack, itemsKey) {\r\n  var disabled = false\r\n  if (itemsMinMax[itemsKey][1] <= haystack.length) {\r\n    disabled = true\r\n  }\r\n  if (btn.disabled !== disabled) {\r\n    btn.classList.toggle('nx-disabled')\r\n    btn.disabled = disabled\r\n  }\r\n}\r\n","import { replaceDiacritics } from '@i-is-as-i-does/jack-js/src/modules/Help.js'\r\nimport { supportedOembedMedia } from '@i-is-as-i-does/nexus-core/src/validt/NxSpecs'\r\n\r\nexport const mediaGuessMap = {\r\n  image: ['jpg', 'jpeg', 'gif', 'svg', 'png', 'webp'],\r\n  video: ['mp4', 'webm'],\r\n  audio: ['mp3'],\r\n}\r\n\r\nexport const autoUpdateEvt = new CustomEvent('AutoUpdate')\r\nexport const stateChangeEvt = new CustomEvent('StateChange')\r\nexport const threadChangeEvt = new CustomEvent('ThreadChange')\r\nexport const updownEvt = new CustomEvent('IndexChange')\r\n\r\nexport function toggleDisabled(elm, disabled = false) {\r\n  var hasDisbClass = elm.classList.contains('nx-disabled')\r\n  if (!disabled && hasDisbClass) {\r\n    elm.classList.remove('nx-disabled')\r\n  } else if (disabled && !hasDisbClass) {\r\n    elm.classList.add('nx-disabled')\r\n  }\r\n}\r\n\r\nexport function resolveMediaType(val) {\r\n  for (var p = 0; p < supportedOembedMedia.length; p++) {\r\n    if (val.includes(supportedOembedMedia[p])) {\r\n      return supportedOembedMedia[p]\r\n    }\r\n  }\r\n  var ext = val.split('.').pop()\r\n  for (let [type, exts] of Object.entries(mediaGuessMap)) {\r\n    if (exts.includes(ext)) {\r\n      return type\r\n    }\r\n  }\r\n\r\n  return 'page'\r\n}\r\n\r\nexport function convertToId(title) {\r\n  return replaceDiacritics(title)\r\n    .trim()\r\n    .replace(/[^A-Za-z0-9]+/g, '-')\r\n    .replace(/(^-|-$)+/g, '')\r\n}\r\n\r\nexport function isUnique(haystack, needle, excludeIdx) {\r\n  if (haystack.indexOf(needle) !== -1) {\r\n    for (var c = 0; c < haystack.length; c++) {\r\n      if (c !== excludeIdx && haystack[c] === needle) {\r\n        return false\r\n      }\r\n    }\r\n  }\r\n  return true\r\n}\r\n\r\nexport function uniqueId(idsList, id, idx) {\r\n  id = convertToId(id)\r\n  if (!isUnique(idsList, id, idx)) {\r\n    var sp = id.split('-')\r\n    var last = sp.pop()\r\n    var incr\r\n    if (!isNaN(last)) {\r\n      incr = parseInt(last)\r\n      incr++\r\n    } else {\r\n      sp.push(last)\r\n      incr = 1\r\n    }\r\n    id = sp.join('-')\r\n    while (idsList.includes(id + '-' + incr)) {\r\n      incr++\r\n    }\r\n    id += '-' + incr\r\n  }\r\n  return id\r\n}\r\n","import { randomInt, randomString } from '@i-is-as-i-does/jack-js/src/modules/Help.js'\r\nimport { appUrl } from '@i-is-as-i-does/nexus-core/src/validt/NxSpecs.js'\r\n\r\nexport function newState(data, url = 'nexus.json', id = '/', idx = -1) {\r\n  return {\r\n    dataUrl: url,\r\n    srcData: data,\r\n    threadId: id,\r\n    threadIndex: idx,\r\n  }\r\n}\r\n\r\nexport function newData() {\r\n  var randomId = randomString(10)\r\n  return {\r\n    nexus: appUrl,\r\n    author: {\r\n      handle: 'Anonymous-' + randomInt(100, 999),\r\n      about: '',\r\n      url: 'http://',\r\n    },\r\n    threads: [newThread(randomId)],\r\n    index: [randomId],\r\n  }\r\n}\r\n\r\nexport function newThread(randomId) {\r\n  return {\r\n    id: randomId,\r\n    title: randomId,\r\n    description: '...',\r\n    content: {\r\n      timestamp: new Date().toISOString().split('T')[0],\r\n      main: '...',\r\n      aside: '',\r\n      media: {\r\n        url: '',\r\n        type: '',\r\n        caption: '',\r\n      },\r\n    },\r\n    linked: [],\r\n  }\r\n}\r\n","import { getThreadsList, loadSrcFile } from '@i-is-as-i-does/nexus-core/src/load/NxSrc'\r\nimport { logErr } from '@i-is-as-i-does/nexus-core/src/logs/NxLog'\r\nimport { registerEditData } from '@i-is-as-i-does/nexus-core/src/storg/NxMemory'\r\nimport { validData } from '@i-is-as-i-does/nexus-core/src/validt/NxStamper'\r\nimport { getElm, iconImage, setHistoryControls, toggleNavEnd } from '../shared/NxCommons.js'\r\nimport {\r\n  downloadB64,\r\n  newB64,\r\n  openB64,\r\n  redoB64,\r\n  resetB64,\r\n  saveB64,\r\n  undoB64,\r\n} from '../shared/NxIcons.js'\r\nimport { getTxt } from '@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate'\r\nimport { vSplitFlap } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport { stateChangeEvt, toggleDisabled } from './NxEditCommons.js'\r\nimport { newData, newState } from './NxEditStarters.js'\r\n\r\nexport class NxEditMenu {\r\n  constructor(EditState) {\r\n    this.EditState = EditState\r\n    this._setMenu()\r\n  }\r\n\r\n  getMenuElms() {\r\n    return this.menu\r\n  }\r\n\r\n  setLastAction(callback, bypass = false) {\r\n    if (!this.resetting || bypass) {\r\n      this.lastAction.act = callback\r\n      this.actCtrls.count = 2\r\n      this.actCtrls.position = 1\r\n      toggleNavEnd(this.actCtrls)\r\n      this.toggleSaveBtn(false)\r\n    }\r\n  }\r\n  setResetting(bool) {\r\n    this.resetting = bool\r\n  }\r\n\r\n  toggleSaveBtn(disabled = false) {\r\n      toggleDisabled(this.saveBtn, disabled)\r\n  }\r\n  _displayFeedback(msg) {\r\n    var txt = getTxt(msg)\r\n    if (this.feedbackrun) {\r\n      clearTimeout(this.feedbackrun)\r\n    }\r\n    vSplitFlap(this.actionFdbck, txt, 25)\r\n    this.feedbackrun = setTimeout(\r\n      function () {\r\n        vSplitFlap(this.actionFdbck, '', 25)\r\n      }.bind(this),\r\n      1500 + txt.length * 20\r\n    )\r\n  }\r\n\r\n  _resetData(data, url) {\r\n    var prvState = this.EditState.getJsonState()\r\n    if (data === null) {\r\n      data = newData()\r\n    }\r\n    var state = newState(data, url)\r\n    if (state.srcData.threads.length) {\r\n      state.threadIndex = 0\r\n      state.threadId = state.srcData.threads[0].id\r\n    }\r\n    var nxtState = JSON.stringify(state)\r\n    var act = function (redo) {\r\n      this.resetting = true\r\n      var nstate\r\n      if (redo) {\r\n        nstate = nxtState\r\n      } else {\r\n        nstate = prvState\r\n      }\r\n  \r\n      this.EditState.setNewState(nstate)\r\n      this.menu.dispatchEvent(stateChangeEvt)\r\n      this.filename = this.EditState.resolveFilename()\r\n      this.resetting = false\r\n    }.bind(this)\r\n    act(true)\r\n    this.setLastAction(act, true)\r\n  }\r\n\r\n  _setActionFeedback() {\r\n    this.feedbackrun = null\r\n    this.actionFdbck = getElm('SPAN', 'nx-action-feedback')\r\n  }\r\n\r\n  _setDownloadBtn() {\r\n    this.filename = 'nexus.json'\r\n    this.dlBtn = getElm('A', 'nx-download')\r\n    this.dlBtn.append(iconImage(downloadB64, 20))\r\n    this.dlBtn.addEventListener(\r\n      'click',\r\n      function () {\r\n        var data = Object.assign({}, this.EditState.state.srcData)\r\n        delete data.index\r\n        var check = validData(data)\r\n        if (!check) {\r\n          this._displayFeedback('Invalid Nexus data')\r\n        }\r\n        data = JSON.stringify(data, undefined, 2)\r\n        var dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(data)\r\n        var anchor = getElm('A')\r\n        anchor.setAttribute('href', dataStr)\r\n        anchor.setAttribute('download', 'nexus.json')\r\n        document.body.appendChild(anchor)\r\n        anchor.click()\r\n        anchor.remove()\r\n      }.bind(this)\r\n    )\r\n  }\r\n\r\n  _setNewDocumenBtn() {\r\n    this.newBtn = getElm('A', 'nx-new')\r\n    this.newBtn.append(iconImage(newB64, 20))\r\n    this.newBtn.addEventListener(\r\n      'click',\r\n      function () {\r\n        this._resetData(newData(), 'nexus.json')\r\n      }.bind(this)\r\n    )\r\n  }\r\n\r\n  _setOpenBtn() {\r\n    this._setFileInput()\r\n    this.openBtn = getElm('A', 'nx-open-file')\r\n    this.openBtn.append(iconImage(openB64, 20))\r\n    this.openBtn.addEventListener(\r\n      'click',\r\n      function () {\r\n        this.fileInput.click()\r\n      }.bind(this)\r\n    )\r\n    this.openWrap = getElm('SPAN')\r\n    this.openWrap.append(this.fileInput, this.openBtn)\r\n  }\r\n\r\n  _setFileInput() {\r\n    this.fileInput = getElm('INPUT')\r\n    this.fileInput.type = 'file'\r\n    this.fileInput.accept = 'application/json'\r\n    this.fileInput.addEventListener(\r\n      'change',\r\n      function (evt) {\r\n        var filename = evt.target.files[0].name\r\n        loadSrcFile(evt, true)\r\n          .then((fdata) => {\r\n            fdata.index = getThreadsList(fdata)\r\n            this._resetData(fdata, filename)\r\n          })\r\n          .catch((err) => {\r\n            logErr(err.message)\r\n            this._displayFeedback('Invalid source')\r\n          })\r\n        this.fileInput.value = ''\r\n      }.bind(this)\r\n    )\r\n    this.fileInput.style.display = 'none'\r\n  }\r\n\r\n  _setSaveBtn() {\r\n    this.saveBtn = getElm('A', 'nx-save')\r\n    this.saveBtn.append(iconImage(saveB64, 20))\r\n    this.toggleSaveBtn(true)\r\n    this.saveBtn.addEventListener(\r\n        'click',\r\n        function () {\r\n          if (!this.saveBtn.classList.contains('nx-disabled')) {\r\n            registerEditData(this.EditState.cacheName, this.EditState.state.srcData)\r\n            this._displayFeedback('saved')\r\n            this.toggleSaveBtn(true)\r\n            this._setResetStatus()\r\n          }\r\n        }.bind(this)\r\n      )\r\n  }\r\n\r\n  _setResetStatus() {\r\n    var disb = true\r\n    if (this.EditState.originData !== JSON.stringify(this.EditState.state.srcData)) {\r\n      disb = false\r\n    }\r\n    toggleDisabled(this.resetBtn, disb)\r\n  }\r\n\r\n  _setResetBtn() {\r\n    this.resetBtn = getElm('A', 'nx-reset')\r\n    this.resetBtn.append(iconImage(resetB64, 20))\r\n\r\n    this._setResetStatus()\r\n    this.resetBtn.addEventListener(\r\n      'click',\r\n      function () {\r\n        if (!this.resetBtn.classList.contains('nx-disabled')) {\r\n          this._resetData(JSON.parse(this.EditState.originData), this.EditState.originUrl)\r\n          toggleDisabled(this.resetBtn, true)\r\n        }\r\n      }.bind(this)\r\n    )\r\n  }\r\n\r\n  _setEditNav() {\r\n    this._setActionFeedback()\r\n    this._setResetBtn()\r\n    this._setNewDocumenBtn()\r\n    this._setOpenBtn()\r\n    this._setSaveBtn()\r\n    this._setDownloadBtn()\r\n\r\n    this.editLinks = getElm('DIV')\r\n    this.editLinks.append(this.resetBtn, this.newBtn, this.openWrap, this.saveBtn, this.dlBtn)\r\n    this.editNav = getElm('DIV', 'nx-edit-nav')\r\n    this.editNav.append(this.actionFdbck, this.editLinks)\r\n  }\r\n\r\n  _setEditActions() {\r\n    this.resetting = false\r\n    this.lastAction = { act: null }\r\n    this.actCtrls = {\r\n      ctrls: {\r\n        prev: { symbol: undoB64, elm: null },\r\n        next: { symbol: redoB64, elm: null },\r\n      },\r\n      position: 0,\r\n      count: 1,\r\n    }\r\n    this.editActions = getElm('DIV', 'nx-edit-actions nx-history-nav')\r\n    setHistoryControls(this.actCtrls, this._triggerUndoRedo.bind(this), true)\r\n    this.editActions.append(this.actCtrls.ctrls['prev'].elm, this.actCtrls.ctrls['next'].elm)\r\n  }\r\n\r\n  _triggerUndoRedo(ctrl) {\r\n    this.lastAction.act(ctrl === 'next')\r\n    this.toggleSaveBtn(false)\r\n  }\r\n\r\n  _setMenu() {\r\n    this._setEditNav()\r\n    this._setEditActions()\r\n    this.menu = getElm('DIV', 'nx-edit-menu')\r\n    this.menu.append(this.editNav, this.editActions)\r\n  }\r\n}\r\n","import { getSrcData } from '@i-is-as-i-does/nexus-core/src/load/NxSrc'\r\nimport { getTxt } from '@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate'\r\nimport { registerTranslElm } from '@i-is-as-i-does/nexus-core/src/transl/NxElmTranslate'\r\nimport {\r\n  charMinMax,\r\n  idPattern,\r\n  supportedMediaTypes,\r\n  urlPattern,\r\n} from '@i-is-as-i-does/nexus-core/src/validt/NxSpecs'\r\nimport { isValidUrl } from '@i-is-as-i-does/nexus-core/src/validt/NxStamper'\r\nimport { getElm, iconImage, selectDropDown } from '../shared/NxCommons'\r\nimport { invalidB64, validB64 } from '../shared/NxIcons'\r\nimport { isUnique, uniqueId } from './NxEditCommons'\r\n\r\nexport class NxInputsFactory {\r\n  constructor(EditState, EditMenu) {\r\n    this.EditState = EditState\r\n    this.EditMenu = EditMenu\r\n  }\r\n\r\n  inputElm(ref, callback = null, store = null) {\r\n    var idents = this._fieldIdents(ref)\r\n    var inp = this._resolveInput(idents, ref)\r\n\r\n    var lb = this._baseLabel(idents.alias)\r\n    var indc = getElm('SPAN', 'nx-edit-indication')\r\n    var fdbck = this._invalidSp()\r\n    lb.append(indc, fdbck)\r\n    this._setConditions(idents, inp, indc)\r\n\r\n    if (store) {\r\n      store[idents.field] = inp\r\n    }\r\n    var wrap = this._wrapInput(idents, inp, lb)\r\n\r\n    this._setInputEvt(ref, inp, fdbck, callback)\r\n    this._inputEvtHandler(ref, inp, fdbck, callback)\r\n\r\n    return wrap\r\n  }\r\n\r\n  _setConditions(idents, inp, indc) {\r\n    switch (idents.field) {\r\n      case 'url':\r\n        indc.textContent = '[http]'\r\n        inp.pattern = urlPattern\r\n        break\r\n      case 'linked':\r\n        indc.textContent = '[http]'\r\n        inp.pattern = urlPattern\r\n        break\r\n      case 'id':\r\n        indc.textContent = '[A-Za-z0-9-][3-36]'\r\n        inp.pattern = idPattern\r\n        break\r\n      case 'type':\r\n        inp.pattern = '(' + supportedMediaTypes.join('|') + ')'\r\n        break\r\n      case 'timestamp':\r\n        break\r\n      default:\r\n        var minmax = charMinMax[idents.field]\r\n        indc.textContent = '[' + minmax[0] + '-' + minmax[1] + ']'\r\n        inp.setAttribute('maxlength', minmax[1])\r\n        inp.setAttribute('minlength', minmax[0])\r\n    }\r\n  }\r\n\r\n  _wrapInput(idents, inp, lb) {\r\n    var wrap = getElm('DIV', 'nx-edit-input nx-edit-' + idents.parent + '-' + idents.field)\r\n    wrap.append(lb)\r\n    if (idents.field === 'type') {\r\n      wrap.append(this._typeDropDown(inp))\r\n    } else {\r\n      wrap.append(inp)\r\n    }\r\n    return wrap\r\n  }\r\n\r\n  _typeDropDown(inp) {\r\n    var items = supportedMediaTypes\r\n    return selectDropDown(items, inp, null, 'nx-edit-media-type-select')\r\n  }\r\n\r\n  _fieldIdents(ref) {\r\n    var idents = {}\r\n    var pos = ref.length - 1\r\n    if (ref[pos - 1] === 'linked') {\r\n      pos--\r\n    }\r\n    idents.field = ref[pos]\r\n    pos--\r\n    if (ref[pos - 1] === 'threads') {\r\n      pos--\r\n    }\r\n    idents.parent = ref[pos]\r\n    idents.alias = idents.field\r\n    if (idents.field === 'linked') {\r\n      idents.alias = 'url'\r\n    }\r\n    return idents\r\n  }\r\n\r\n  _isLongTextInput(idents) {\r\n    return ['about', 'description', 'main', 'aside', 'caption'].includes(idents.field)\r\n  }\r\n\r\n  _isRequired(idents) {\r\n    return ['handle', 'title', 'main', 'id', 'url', 'type', 'timestamp', 'linked'].includes(\r\n      idents.field\r\n    )\r\n  }\r\n\r\n  _resolveInput(idents, ref) {\r\n    var val = this.EditState.getValue(ref)\r\n    var inp\r\n    if (this._isLongTextInput(idents)) {\r\n      inp = this._textareaInput(val)\r\n    } else if (idents.field == 'timestamp') {\r\n      inp = this._dateInput(val)\r\n    } else {\r\n      inp = this._textInput(val)\r\n    }\r\n    inp.classList.add('nx-edit-input')\r\n\r\n    var hook = ref.join('-')\r\n    inp.id = hook\r\n    inp.name = hook\r\n    if (this._isRequired(idents)) {\r\n      inp.required = true\r\n    }\r\n    return inp\r\n  }\r\n\r\n  _textInput(val) {\r\n    var inp = getElm('INPUT', 'nx-edit-text')\r\n    inp.type = 'text'\r\n    inp.value = val\r\n    return inp\r\n  }\r\n\r\n  _textareaInput(val) {\r\n    var inp = getElm('TEXTAREA', 'nx-edit-textarea')\r\n    inp.textContent = val\r\n    return inp\r\n  }\r\n  _dateInput(val) {\r\n    var inp = getElm('INPUT', 'nx-edit-date')\r\n    inp.type = 'datetime-local'\r\n    inp.value = val\r\n    return inp\r\n  }\r\n\r\n  _baseLabel(field) {\r\n    var lb = getElm('LABEL', 'nx-edit-label')\r\n    lb.for = field\r\n    var title = getElm('SPAN', 'nx-edit-title')\r\n    title.textContent = getTxt(field)\r\n    registerTranslElm(title, field)\r\n    lb.append(title)\r\n    return lb\r\n  }\r\n\r\n  _invalidSp() {\r\n    var sp = getElm('SPAN', 'nx-edit-feedback')\r\n    sp.append(iconImage(invalidB64))\r\n    return sp\r\n  }\r\n\r\n  _inputEvtHandler(ref, inp, fdbck, callback) {\r\n    var valid = inp.checkValidity()\r\n    var validPromise = null\r\n\r\n    if ((valid && ref.includes('url')) || ref.includes('linked')) {\r\n      valid = isValidUrl(inp.value)\r\n      if (valid && ref.includes('linked')) {\r\n        valid = isUnique(\r\n          this.EditState.getLinkedUrls(ref[1]),\r\n          inp.value,\r\n          this.EditState.getLinkedThreadIdx(ref[1], ref[3])\r\n        )\r\n        if (valid) {\r\n          validPromise = getSrcData(inp.value)\r\n            .then(() => {\r\n              return true\r\n            })\r\n            .catch(() => {\r\n              return false\r\n            })\r\n        }\r\n      }\r\n    } else if (ref.includes('id')) {\r\n      var nId = uniqueId(\r\n        this.EditState.getIdsList(),\r\n        inp.value,\r\n        this.EditState.getThreadIdx(ref[1])\r\n      )\r\n      if (nId !== inp.value) {\r\n        inp.value = nId\r\n      }\r\n      valid = true\r\n    }\r\n\r\n    if (validPromise === null) {\r\n      validPromise = Promise.resolve(valid)\r\n    }\r\n\r\n    validPromise.then((isValid) => {\r\n      this.EditState.setNewValue(ref, inp.value)\r\n      this._setFeedbackIcon(fdbck, isValid)\r\n      \r\n      if (typeof callback === 'function') {\r\n        callback(inp, isValid)\r\n      }\r\n    })\r\n  }\r\n\r\n  _setFeedbackIcon(fdbck, valid) {\r\n    var icsrc = invalidB64\r\n    if (valid) {\r\n      icsrc = validB64\r\n    }\r\n    fdbck.firstChild.src = icsrc\r\n  }\r\n\r\n  _setInputEvt(ref, inp, fdbck, callback) {\r\n    var undone = ''\r\n    var prev = inp.value\r\n    inp.addEventListener('focus', function () {\r\n      prev = inp.value\r\n    })\r\n    inp.addEventListener('AutoUpdate', function () {\r\n      this._inputEvtHandler(ref, inp, fdbck, callback)\r\n    }.bind(this))\r\n    inp.addEventListener(\r\n      'change',\r\n      function () {\r\n        this._inputEvtHandler(ref, inp, fdbck, callback)\r\n          var act = function (redo) {\r\n            if (redo) {\r\n              inp.value = undone\r\n            } else {\r\n              undone = inp.value\r\n              inp.value = prev\r\n            }\r\n            this._inputEvtHandler(ref, inp, fdbck, callback)\r\n          }.bind(this)\r\n          this.EditMenu.setLastAction(act)\r\n      }.bind(this)\r\n    )\r\n  }\r\n}\r\n","import { getElm, landmarkElm } from '../shared/NxCommons'\r\nimport { autoUpdateEvt, resolveMediaType } from './NxEditCommons'\r\n\r\nexport class NxLocalFormFactory {\r\n  constructor(InputsFactory) {\r\n    this.InputsFactory = InputsFactory\r\n  }\r\n\r\n  newThreadLocalForm(ident, indexElm) {\r\n    var form = getElm('FORM', 'nx-thread-local-form')\r\n    var fieldset1 = this._localFieldSet1(ident, indexElm)\r\n    var fieldset2 = this._localFieldSet2(ident)\r\n    var fieldset3 = this._localFieldSet3(ident)\r\n\r\n    form.append(\r\n      landmarkElm('local thread'),\r\n      fieldset1,\r\n      landmarkElm('content'),\r\n      fieldset2,\r\n      landmarkElm('media'),\r\n      fieldset3\r\n    )\r\n    return form\r\n  }\r\n\r\n  _localFieldSet1(ident, indexElm) {\r\n    var fieldset1 = getElm('FIELDSET')\r\n\r\n    var titleCallback = function (inp) {\r\n      var targ = indexElm.querySelector('.nx-thread-title')\r\n      if (targ.textContent !== inp.value) {\r\n        targ.textContent = inp.value\r\n      }\r\n    }\r\n    fieldset1.append(this.InputsFactory.inputElm(['threads', ident, 'id']))\r\n    fieldset1.append(this.InputsFactory.inputElm(['threads', ident, 'title'], titleCallback))\r\n    fieldset1.append(this.InputsFactory.inputElm(['threads', ident, 'description']))\r\n    return fieldset1\r\n  }\r\n\r\n  _localFieldSet2(ident) {\r\n    var fieldset2 = getElm('FIELDSET')\r\n    var fields = ['timestamp', 'main', 'aside']\r\n    fields.forEach((field) => {\r\n      fieldset2.append(this.InputsFactory.inputElm(['threads', ident, 'content', field]))\r\n    })\r\n    return fieldset2\r\n  }\r\n\r\n  _localFieldSet3(ident) {\r\n    var fieldset3 = getElm('FIELDSET')\r\n\r\n    var store = { type:null }\r\n    var typeInp = this.InputsFactory.inputElm(['threads', ident, 'content', 'media', 'type'], null, store)\r\n    var typeCallback = function (inp, valid) {\r\n      if (valid) {\r\n        var guessedType = resolveMediaType(inp.value)\r\n        if(store.type.value !== guessedType){\r\n          store.type.value = guessedType\r\n          var prev = typeInp.querySelector('.nx-selected')\r\n          if(prev){\r\n            prev.classList.remove('nx-selected')\r\n          }\r\n          typeInp.querySelector('[data-item=' + guessedType + ']').classList.add('nx-selected')\r\n          store.type.dispatchEvent(autoUpdateEvt)\r\n        }\r\n      }\r\n    }.bind(this)\r\n    fieldset3.append(\r\n      this.InputsFactory.inputElm(['threads', ident, 'content', 'media', 'url'], typeCallback)\r\n    )\r\n    fieldset3.append(typeInp)\r\n    fieldset3.append(this.InputsFactory.inputElm(['threads', ident, 'content', 'media', 'caption']))\r\n    return fieldset3\r\n  }\r\n}\r\n","import { randomString } from '@i-is-as-i-does/jack-js/src/modules/Help'\r\nimport {\r\n  vHide,\r\n  vShow,\r\n  vPlace,\r\n} from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport {\r\n  appHeaderWithLang,\r\n  baseViewLink,\r\n  blockWrap,\r\n  getElm,\r\n  iconImage,\r\n  instanceWrap,\r\n  landmarkElm,\r\n  serviceWrap,\r\n} from '../shared/NxCommons'\r\nimport { downB64, upB64 } from '../shared/NxIcons'\r\nimport { addBtn, toggleAddBtn } from './NxAddBtn'\r\nimport { threadChangeEvt, toggleDisabled, updownEvt } from './NxEditCommons'\r\nimport { NxEditMenu } from './NxEditMenu'\r\nimport { newThread } from './NxEditStarters'\r\nimport { NxInputsFactory } from './NxInputsFactory'\r\nimport { NxLocalFormFactory } from './NxLocalFormFactory'\r\n\r\nexport class NxEditInstance {\r\n  constructor(EditState) {\r\n    this.EditState = EditState\r\n\r\n    this._setContainers()\r\n    this._setBtnSrc()\r\n\r\n    this._setMenu()\r\n\r\n    this._setFactories()\r\n    this._setAddThreadBtn()\r\n    this._setFormsInputs()\r\n\r\n    this._setFormBlocks()\r\n    this._setServiceElms()\r\n  }\r\n\r\n  getInstanceElms() {\r\n    return this.instanceElms\r\n  }\r\n\r\n  _setBtnSrc() {\r\n    this.btnSrc = {\r\n      up: upB64,\r\n      down: downB64,\r\n    }\r\n  }\r\n\r\n  _setContainers() {\r\n    this.containers = {\r\n      author: getElm('FORM', 'nx-edit-author'),\r\n      index: getElm('UL', 'nx-edit-index'),\r\n      local: getElm('UL', 'nx-edit-local'),\r\n      distant: getElm('UL', 'nx-edit-distant'),\r\n    }\r\n  }\r\n\r\n  _setMenu() {\r\n    this.EditMenu = new NxEditMenu(this.EditState)\r\n    this.menu = this.EditMenu.getMenuElms()\r\n    this.menu.addEventListener('StateChange', this._resetFormCallback.bind(this))\r\n  }\r\n\r\n  _setFactories() {\r\n    this.InputsFactory = new NxInputsFactory(this.EditState, this.EditMenu)\r\n    this.LocalFormFactory = new NxLocalFormFactory(this.InputsFactory)\r\n  }\r\n\r\n  _setAddThreadBtn() {\r\n    this.addThreadBtn = addBtn()\r\n    toggleAddBtn(this.addThreadBtn, this.EditState.getIdsList(), 'threads')\r\n    this.addThreadBtn.addEventListener('click', this._addThreadHandler.bind(this))\r\n  }\r\n\r\n  _setServiceElms() {\r\n    var indexMain = getElm('DIV', 'nx-main-block nx-index')\r\n    indexMain.append(this.formBlocks.author, this.formBlocks.index)\r\n    var threadMain = getElm('DIV', 'nx-main-block nx-thread')\r\n    threadMain.append(this.formBlocks.local, this.formBlocks.distant)\r\n\r\n    this.instanceElms = instanceWrap(appHeaderWithLang(), [\r\n      serviceWrap([this.menu], [indexMain, threadMain], [], 'edit'),\r\n    ])\r\n  }\r\n\r\n  _setFormBlocks() {\r\n    this.formBlocks = {\r\n      author: blockWrap('author', [this.containers.author], landmarkElm('author')),\r\n      index: blockWrap(\r\n        'threads-list',\r\n        [this.containers.index, this.addThreadBtn],\r\n        landmarkElm('threads')\r\n      ),\r\n      local: blockWrap('local', [this.containers.local], false),\r\n      distant: blockWrap('distant', [this.containers.distant], false),\r\n    }\r\n  }\r\n\r\n  _resetFormCallback() {\r\n\r\n    Object.values(this.containers).forEach((container, i) => {\r\n      var childr = Array.from(container.childNodes)\r\n      var isLastp = i === 3\r\n      var lastc = childr.length - 1\r\n      childr.forEach((child, c) => {\r\n        vHide(child, 'fade', 200, function(){\r\n          child.remove()\r\n          if (isLastp && c === lastc) {\r\n            this._setFormsInputs()\r\n          }\r\n        }.bind(this))\r\n      })\r\n    })\r\n  }\r\n\r\n  _setFormsInputs() {\r\n    this._setAuthorInputs()\r\n    this._setThreadsInputs()\r\n  }\r\n\r\n  _setAuthorInputs() {\r\n    var fields = ['handle', 'url', 'about']\r\n    fields.forEach((field) => {\r\n      var inpt = this.InputsFactory.inputElm(['author', field])\r\n      inpt.style.display = 'none'\r\n      this.containers.author.append(inpt)\r\n      vShow(inpt, 'fade', 200)\r\n    })\r\n  }\r\n\r\n  _setThreadsInputs() {\r\n    var items = this.EditState.getIdsList()\r\n    if (items.length) {\r\n      var isLast = false\r\n      for (var i = 0; i < items.length; i++) {\r\n        if (i === items.length - 1) {\r\n          isLast = true\r\n        }\r\n        this._setThread(items[i], i, isLast)\r\n      }\r\n    }\r\n  }\r\n\r\n  _setThread(id, idx, isLast = false) {\r\n    var ident = this.EditState.newIdent(id, idx)\r\n    var elms = this._newThreadLis(ident)\r\n    for (let [name, elm] of Object.entries(elms)) {\r\n      if (elm.style.display !== 'none') {\r\n        elm.style.display = 'none'\r\n        var type = 'ease'\r\n          if (name === 'local') {\r\n            type = 'fade'\r\n          } \r\n        vPlace(this.containers[name], elm, false, type, 200)\r\n      } else {\r\n        this.containers[name].append(elm)\r\n      }\r\n     \r\n      if (isLast && name === \"index\" && (idx - 1) !== -1) {\r\n          this.containers.index.childNodes[idx - 1].dispatchEvent(updownEvt)\r\n      }\r\n    }\r\n  }\r\n\r\n  _newThreadLis(ident) {\r\n    var elms = {}\r\n\r\n    elms.distant = this._threadLi(ident)\r\n    elms.local = this._threadLi(ident)\r\n    elms.index = this._indexLi(ident)\r\n\r\n    elms.distant.append(this._threadDistantForm(ident))\r\n    elms.local.append(this.LocalFormFactory.newThreadLocalForm(ident, elms.index))\r\n\r\n    this._setdeleteThreadElm(elms, ident)\r\n    return elms\r\n  }\r\n\r\n  _addThreadHandler() {\r\n    if (!this.addThreadBtn.disabled) {\r\n      var randomId = randomString(10)\r\n      var idx = this.EditState.getThreadsCount()\r\n      this.EditState.pushThread(newThread(randomId))\r\n      this._setThread(randomId, idx, true)\r\n      this.EditMenu.toggleSaveBtn(false)\r\n      toggleAddBtn(this.addThreadBtn, this.EditState.getIdsList(), 'threads')\r\n    }\r\n  }\r\n\r\n  _linkInput(addLinkBtn, form, ident, i) {\r\n    var lkident = this.EditState.registerLinkedThread(ident, i)\r\n\r\n    var linkwrap = getElm('DIV', 'nx-edit-distant-link')\r\n    var store = { linked: null }\r\n    var elm = this.InputsFactory.inputElm(['threads', ident, 'linked', lkident], null, store)\r\n    var dltBtn = this._baseDeleteLinkBtn()\r\n    var delwrap = getElm('DIV', 'nx-distant-link-action')\r\n    delwrap.append(dltBtn)\r\n\r\n    dltBtn.addEventListener('click', () => {\r\n      var act = function (redo) {\r\n        var linked = this.EditState.getLinkedUrls(ident)\r\n        if (redo) {\r\n          vHide(linkwrap, 'ease', 200, function () {\r\n            linkwrap.remove()\r\n          })\r\n          this.EditState.removeLinkedThread(ident, lkident)\r\n        } else {\r\n          var lidx = this.EditState.getLinkedThreadIdx(ident, lkident)\r\n          var isLast = lidx === linked.length\r\n          this.EditState.insertLinkedThread(ident, lkident, store.linked.value)\r\n          if (isLast) {\r\n            vPlace(form, linkwrap, false, 'ease', 200)\r\n          } else {\r\n            var nextSibling = form.childNodes[lidx]\r\n            form.insertBefore(linkwrap, nextSibling)\r\n            vShow(linkwrap, 'ease', 200)\r\n          }\r\n        }\r\n        toggleAddBtn(addLinkBtn, linked, 'linked')\r\n      }.bind(this)\r\n      this.EditMenu.setLastAction(act)\r\n      act(true)\r\n    })\r\n    linkwrap.append(elm, delwrap)\r\n    return linkwrap\r\n  }\r\n\r\n  _threadDistantForm(ident) {\r\n    var form = getElm('FORM', 'nx-thread-distant-form')\r\n    var addLinkBtn = addBtn()\r\n    toggleAddBtn(addLinkBtn, this.EditState.getLinkedUrls(ident), 'linked')\r\n    addLinkBtn.addEventListener('click', () => {\r\n      if (!addLinkBtn.disabled) {\r\n        this.EditState.pushLinkedThread(ident, '')\r\n        vPlace(form, this._linkInput(addLinkBtn, form, ident, this.EditState.getLinkedUrlsCount(ident) - 1),false, 'ease', 200)\r\n        toggleAddBtn(addLinkBtn, this.EditState.getLinkedUrls(ident), 'linked')\r\n      }\r\n    })\r\n    var linkedCount = this.EditState.getLinkedUrlsCount(ident)\r\n    if (linkedCount) {\r\n      var elms = []\r\n      for (var i = 0; i < linkedCount; i++) {\r\n        var elm = this._linkInput(addLinkBtn, form, ident, i)\r\n        elms.push(elm)\r\n      }\r\n      form.append(...elms)\r\n    }\r\n\r\n    var formCnt = getElm('DIV')\r\n    formCnt.append(landmarkElm('linked threads'), form, addLinkBtn)\r\n\r\n    return formCnt\r\n  }\r\n\r\n  _threadLi(ident) {\r\n    var li = getElm('LI')\r\n\r\n    if (!this.EditState.isCurrentId(ident)) {\r\n      li.style.display = 'none'\r\n    }\r\n    li.addEventListener(\r\n      'ThreadChange',\r\n      function () {\r\n        if (this.EditState.isCurrentId(ident)) {\r\n          setTimeout(function () {\r\n            vShow(li, 'ease', 200)\r\n          }, 200)\r\n        } else {\r\n          vHide(li, 'ease', 200)\r\n        }\r\n      }.bind(this)\r\n    )\r\n    return li\r\n  }\r\n\r\n  _setdeleteThreadElm(elms, ident) {\r\n    var btn = getElm('BUTTON', 'nx-delete-thread')\r\n    btn.type = 'button'\r\n    btn.textContent = '-'\r\n\r\n    btn.addEventListener(\r\n      'click',\r\n      function () {\r\n        this._deleteEvent(elms, ident)\r\n      }.bind(this)\r\n    )\r\n    elms.index.append(btn)\r\n  }\r\n\r\n\r\n  _deleteEvent(elms, ident) {\r\n    var threadData = Object.assign({}, this.EditState.getThreadData(ident))\r\n    var act = function (redo) {\r\n      var idx = this.EditState.getThreadIdx(ident)\r\n      var len = this.EditState.getThreadsCount()\r\n\r\n      if (redo) {\r\n\r\n        this.EditState.removeThread(ident)\r\n\r\n        Object.values(elms).forEach((elm) => {\r\n          vHide(elm, 'ease', 200, function () {\r\n            elm.remove()\r\n          })\r\n        })\r\n     \r\n        if (len > 1) {\r\n          var sibling = null\r\n\r\n          if (idx === 0) {\r\n            sibling = elms.index.nextSibling\r\n          } else if (idx === len - 1) {\r\n            sibling = elms.index.previousSibling\r\n          }\r\n          if(sibling){\r\n            sibling.dispatchEvent(updownEvt)\r\n\r\n          }\r\n        }\r\n\r\n        if (this.EditState.isCurrentId(ident)) {\r\n          elms.distant.dispatchEvent(threadChangeEvt)\r\n          elms.local.dispatchEvent(threadChangeEvt)\r\n        }\r\n      } else {\r\n        this.EditState.insertThread(ident, threadData)\r\n        if (idx <= len - 1) {\r\n          var next = this.containers.index.childNodes[idx]\r\n          this.containers.index.insertBefore(elms.index, next)\r\n          if (idx === 0) {\r\n            next.dispatchEvent(updownEvt)\r\n          }\r\n        } else {\r\n          this.containers.index.append(elms.index)\r\n          if (len > 1) {\r\n            elms.index.previousSibling.dispatchEvent(updownEvt)\r\n          }\r\n        }\r\n\r\n        this.containers.local.append(elms.local)\r\n        this.containers.distant.append(elms.distant)\r\n\r\n        vShow(elms.index, 'ease', 200)\r\n        elms.index.firstChild.click()\r\n      }\r\n      toggleAddBtn(this.addThreadBtn, this.EditState.getIdsList(), 'threads')\r\n    }.bind(this)\r\n    this.EditMenu.setLastAction(act)\r\n    act(true)\r\n  }\r\n\r\n  _indexLi(ident) {\r\n    var elm = getElm('LI')\r\n    elm.dataset.ident = ident\r\n    elm.append(this._indexLink(ident))\r\n    this._setMoveBtns(elm, ident)\r\n    return elm\r\n  }\r\n\r\n  _indexLink(ident) {\r\n    var itemState = this.EditState.getAltEditState(ident)\r\n    var indLk = baseViewLink(itemState, false)\r\n    if (this.EditState.isCurrentId(ident)) {\r\n      indLk.classList.add('nx-on-display')\r\n    }\r\n\r\n    indLk.addEventListener('click', () => {\r\n      if (!this.EditState.isCurrentId(ident)) {\r\n        this.EditState.changeCurrentThread(ident)\r\n        var prev = this.containers.index.querySelector('.nx-on-display')\r\n        if (prev) {\r\n          prev.classList.remove('nx-on-display')\r\n        }\r\n        indLk.classList.add('nx-on-display')\r\n        this.containers.local.childNodes.forEach((lchild) => {\r\n          lchild.dispatchEvent(threadChangeEvt)\r\n        })\r\n        this.containers.distant.childNodes.forEach((dchild) => {\r\n          dchild.dispatchEvent(threadChangeEvt)\r\n        })\r\n      }\r\n    })\r\n\r\n    return indLk\r\n  }\r\n\r\n  _toggleActiveBtn(ident, btn) {\r\n    if (this.EditState.isFirstThread(ident)) {\r\n      toggleDisabled(btn['up'], true)\r\n    } else {\r\n      toggleDisabled(btn['up'], false)\r\n    }\r\n    if (this.EditState.isLastThread(ident)) {\r\n      toggleDisabled(btn['down'], true)\r\n    } else {\r\n      toggleDisabled(btn['down'], false)\r\n    }\r\n  }\r\n\r\n  _permuteThread(goingUp, goingDown) {\r\n    this.containers.index.removeChild(goingUp)\r\n    this.containers.index.insertBefore(goingUp, goingDown)\r\n    goingDown.dispatchEvent(updownEvt)\r\n    goingUp.dispatchEvent(updownEvt)\r\n  }\r\n\r\n  _moveItemHandler(li, it, ident) {\r\n    var act = function (redo) {\r\n      var isUp = it == 'up'\r\n      if (!redo) {\r\n        isUp = !isUp\r\n      }\r\n      var sibling\r\n      if (isUp && !this.EditState.isFirstThread(ident)) {\r\n        sibling = li.previousSibling\r\n        this.EditState.moveThread(ident, sibling.dataset.ident, true)\r\n        this._permuteThread(li, sibling)\r\n      } else if (!isUp && !this.EditState.isLastThread(ident)) {\r\n        sibling = li.nextSibling\r\n        this.EditState.moveThread(ident, sibling.dataset.ident, false)\r\n        this._permuteThread(sibling, li)\r\n      }\r\n    }.bind(this)\r\n\r\n    this.EditMenu.setLastAction(act)\r\n    act(true)\r\n  }\r\n\r\n  _setMoveBtns(li, ident) {\r\n    var dv = getElm('DIV', 'nx-edit-move')\r\n    var btn = {\r\n      up: null,\r\n      down: null,\r\n    }\r\n    li.addEventListener(\r\n      'IndexChange',\r\n      function () {\r\n        this._toggleActiveBtn(ident, btn)\r\n      }.bind(this)\r\n    )\r\n    Object.keys(btn).forEach((it) => {\r\n      btn[it] = getElm('A', 'nx-edit-move-' + it)\r\n      btn[it].append(iconImage(this.btnSrc[it], 16))\r\n      dv.append(btn[it])\r\n\r\n      btn[it].addEventListener(\r\n        'click',\r\n        function () {\r\n          this._moveItemHandler(li, it, ident)\r\n        }.bind(this)\r\n      )\r\n    })\r\n    this._toggleActiveBtn(ident, btn)\r\n    li.append(dv)\r\n  }\r\n\r\n  _baseDeleteLinkBtn() {\r\n    var btn = getElm('BUTTON', 'nx-delete-link')\r\n    btn.type = 'button'\r\n    btn.textContent = '-'\r\n    return btn\r\n  }\r\n}\r\n","import { vShow, vHide } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport { getElm, iconImage } from '../shared/NxCommons.js'\r\nimport { editB64, previewB64 } from '../shared/NxIcons.js'\r\n\r\nexport class NxEditSwitch {\r\n  constructor(editInst, readerInst, readerUpdatePromise) {\r\n    this.editInst = editInst\r\n    this.readerInst = readerInst\r\n\r\n    this.readerUpdatePromise = readerUpdatePromise\r\n\r\n    this.previewOn = false\r\n    this._setSwitchBtn()\r\n  }\r\n\r\n  getSwitchBtn() {\r\n    return this.switchBtn\r\n  }\r\n\r\n  _instanceSwitch() {\r\n    this.previewOn = !this.previewOn\r\n\r\n    if (this.previewOn) {\r\n      vHide(this.editInst, 'fade', 200,  function () {\r\n        this.readerUpdatePromise().then(()=> {\r\n          this.switchBtn.firstChild.src = editB64\r\n          vShow(this.readerInst, 'fade', 200)\r\n        })\r\n      }.bind(this))\r\n    } else {\r\n      vHide(this.readerInst, 'fade', 200,  function () {\r\n        this.switchBtn.firstChild.src = previewB64\r\n        vShow(this.editInst, 'fade', 200)\r\n      }.bind(this))\r\n    }\r\n  }\r\n\r\n  _setSwitchBtn() {\r\n    this.switchBtn = getElm('A', 'nx-edit-switch')\r\n    this.switchBtn.append(iconImage(previewB64, 25))\r\n\r\n    this.switchBtn.addEventListener('click', this._instanceSwitch.bind(this))\r\n  }\r\n}\r\n","import { randomString, replaceDiacritics } from '@i-is-as-i-does/jack-js/src/modules/Help'\r\nimport { getQuery } from '@i-is-as-i-does/nexus-core/src/base/NxHost'\r\nimport { getThreadsList } from '@i-is-as-i-does/nexus-core/src/load/NxSrc'\r\nimport { getStoredEditData, registerEditData } from '@i-is-as-i-does/nexus-core/src/storg/NxMemory'\r\nimport { getAltState } from '../shared/NxState'\r\nimport { newState, newData } from './NxEditStarters'\r\n\r\nexport class NxEditState {\r\n  constructor(state) {\r\n    var tag = 'new'\r\n    var url = 'nexus.json'\r\n    var useState = false\r\n\r\n    if (getQuery('edit')) {\r\n      tag = 'current'\r\n      if(state){\r\n        if(state.dataUrl){\r\n          url = state.dataUrl\r\n        }   \r\n        if(state.srcData){\r\n          useState = true\r\n        }\r\n      }   \r\n    }\r\n\r\n    this.cacheName = tag+\"#\"+url\r\n    this.originUrl = url\r\n    var data = getStoredEditData(this.cacheName)\r\n    var register = false\r\n\r\n    if(data === null){\r\n      register = true\r\n      if(useState){\r\n        data = state.srcData\r\n      } else {\r\n        data = newData()\r\n      }\r\n    }\r\n\r\n    if (!data.index) {\r\n      register = true\r\n      data.index = getThreadsList(data)\r\n    }\r\n    if(register){\r\n      registerEditData(this.cacheName, data)\r\n    }\r\n\r\n    var origin = data\r\n    if (useState) {\r\n      origin = state.srcData\r\n    }\r\n    this.originData = JSON.stringify(origin)\r\n\r\n    var id = '/'\r\n    var idx = -1\r\n    if(useState && state.threadId !== '/' && data.index.includes(state.threadId)){\r\n      id = state.threadId\r\n      idx = data.index.indexOf(state.threadId)\r\n    } else if(data.threads.length){\r\n      id = data.threads[0].id\r\n      idx = 0\r\n    }\r\n\r\n    this.state = newState(data, url, id, idx)\r\n    this.threadsMap = {} // @doc originIdx: { id: currentId, idx: currentIdx, linked :{}}\r\n  }\r\n\r\n  /* whole state methods */\r\n\r\n  getState() {\r\n    return this.state\r\n  }\r\n\r\n  getOriginData() {\r\n    return this.originData\r\n  }\r\n\r\n  getJsonState() {\r\n    return JSON.stringify(this.state)\r\n  }\r\n\r\n  getAltEditState(ident) {\r\n    return getAltState(this.state, this.getThreadId(ident), this.getThreadIdx(ident))\r\n  }\r\n\r\n  setNewState(jsonState) {\r\n    this.state = Object.assign({}, JSON.parse(jsonState))\r\n  }\r\n\r\n  /* form methods */\r\n\r\n  setAuthorValue(ref, value) {\r\n    if (!this.state.srcData.author) {\r\n      this.state.srcData.author = {}\r\n    }\r\n    this.state.srcData.author[ref[1]] = value\r\n  }\r\n\r\n  setThreadIndex(ident) {\r\n    if (!this.state.srcData.threads) {\r\n      this.state.srcData.threads = []\r\n    } else {\r\n      var idx = this.getThreadIdx(ident)\r\n      if (typeof this.state.srcData.threads[idx] === 'undefined') {\r\n        this.state.srcData.threads[idx] = {}\r\n      }\r\n    }\r\n  }\r\n\r\n  setThreadId(ref, value) {\r\n    this.threadsMap[ref[1]].id = value\r\n    var idx = this.getThreadIdx(ref[1])\r\n    this.state.srcData.index[idx] = value\r\n    this.state.srcData.threads[idx].id = value\r\n  }\r\n\r\n  setThreadInfo(ref, value) {\r\n    var idx = this.getThreadIdx(ref[1])\r\n    this.state.srcData.threads[idx][ref[2]] = value\r\n  }\r\n\r\n  setContentValue(ref, value) {\r\n    var idx = this.getThreadIdx(ref[1])\r\n    if (!this.state.srcData.threads[idx].content) {\r\n      this.state.srcData.threads[idx].content = {}\r\n    }\r\n    if (ref[3] !== 'media') {\r\n      this.state.srcData.threads[idx].content[ref[3]] = value\r\n      return\r\n    }\r\n    if (!this.state.srcData.threads[idx].content.media) {\r\n      this.state.srcData.threads[idx].content.media = {}\r\n    }\r\n    this.state.srcData.threads[idx].content.media[ref[4]] = value\r\n  }\r\n\r\n  setLinkedValue(ref, value) {\r\n    var idx = this.getThreadIdx(ref[1])\r\n    if (!this.state.srcData.threads[idx].linked) {\r\n      this.state.srcData.threads[idx].linked = [value]\r\n    } else {\r\n      var lidx = this.getLinkedThreadIdx(ref[1], ref[3])\r\n      this.state.srcData.threads[idx].linked[lidx] = value\r\n    }\r\n  }\r\n\r\n  setNewValue(ref, value) {\r\n    if (this.state.srcData === null) {\r\n      this.state.srcData = {}\r\n      this.state.srcData.index = []\r\n    }\r\n    if (ref[0] === 'author') {\r\n      return this.setAuthorValue(ref, value)\r\n    }\r\n    this.setThreadIndex(ref[1])\r\n\r\n    if (ref[2] === 'id') {\r\n      return this.setThreadId(ref, value)\r\n    }\r\n    if (!['linked', 'content'].includes(ref[2])) {\r\n      return this.setThreadInfo(ref, value)\r\n    }\r\n\r\n    if (ref[2] === 'content') {\r\n      return this.setContentValue(ref, value)\r\n    }\r\n    this.setLinkedValue(ref, value)\r\n  }\r\n\r\n  getValue(ref) {\r\n    if (this.state.srcData) {\r\n      if (ref[0] === 'author') {\r\n        return this.state.srcData.author[ref[1]]\r\n      }\r\n      var idx = this.getThreadIdx(ref[1])\r\n      if (!['linked', 'content'].includes(ref[2])) {\r\n        return this.state.srcData.threads[idx][ref[2]]\r\n      }\r\n      if (ref[2] === 'content') {\r\n        if (ref[3] !== 'media') {\r\n          return this.state.srcData.threads[idx].content[ref[3]]\r\n        }\r\n        return this.state.srcData.threads[idx].content.media[ref[4]]\r\n      }\r\n      var lidx = this.getLinkedThreadIdx(ref[1], ref[3])\r\n      return this.state.srcData.threads[idx].linked[lidx]\r\n    }\r\n    return ''\r\n  }\r\n\r\n  /* state infos methods */\r\n\r\n  getThreadId(ident) {\r\n    return this.threadsMap[ident].id\r\n  }\r\n\r\n  getThreadIdx(ident) {\r\n    var idx = this.threadsMap[ident].idx\r\n    var count = this.getThreadsCount()\r\n    if (idx >= count) {\r\n      idx = count - 1\r\n      this.threadsMap[ident].idx = idx\r\n      if (this.isCurrentId(ident)) {\r\n        this.state.threadIndex = idx\r\n      }\r\n    }\r\n    return idx\r\n  }\r\n\r\n  getIdsList() {\r\n    return this.state.srcData.index\r\n  }\r\n\r\n  getThreadsCount() {\r\n    return this.state.srcData.index.length\r\n  }\r\n\r\n  getCurrentThreadId() {\r\n    return this.state.threadId\r\n  }\r\n\r\n  getCurrentThreadIdx() {\r\n    return this.state.threadIndex\r\n  }\r\n\r\n  isCurrentId(ident) {\r\n    return this.threadsMap[ident].id === this.state.threadId\r\n  }\r\n\r\n  resolveFilename(){\r\n    var filename = 'nexus.json'\r\n    if(this.state.dataUrl && this.state.dataUrl !== filename){\r\n      var sp = this.state.dataUrl.split('/').filter(it => it)\r\n      if(sp.length){\r\n        filename = sp.pop()\r\n        if(filename.slice(-5) !== '.json'){\r\n          filename += '.json'\r\n        }\r\n        filename = replaceDiacritics(filename)\r\n      }\r\n    }\r\n    return filename\r\n  }\r\n\r\n\r\n  /* specific thread methods */\r\n\r\n  unsetCurrentThread() {\r\n    this.state.threadId = '/'\r\n    this.state.threadIndex = -1\r\n  }\r\n\r\n  isFirstThread(ident) {\r\n    return this.getThreadIdx(ident) === 0\r\n  }\r\n\r\n  isLastThread(ident) {\r\n    return this.getThreadIdx(ident) + 1 === this.getThreadsCount()\r\n  }\r\n\r\n  getThreadData(ident) {\r\n    var idx = this.getThreadIdx(ident)\r\n    var threadData = this.state.srcData.threads[idx]\r\n    if (!threadData) {\r\n      this.state.srcData.threads[idx] = {}\r\n    }\r\n    return threadData\r\n  }\r\n\r\n  removeThread(ident) {\r\n    var idx = this.getThreadIdx(ident)\r\n    this.state.srcData.index.splice(idx, 1)\r\n    this.state.srcData.threads.splice(idx, 1)\r\n\r\n    if (!this.isLastThread(ident)) {\r\n      for (let [k, v] of Object.entries(this.threadsMap)) {\r\n        if (v.idx > idx) {\r\n          this.threadsMap[k].idx = v.idx - 1\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.isCurrentId(ident)) {\r\n      this.unsetCurrentThread()\r\n    } else if (this.state.threadIndex > idx) {\r\n      this.state.threadIndex--\r\n    }\r\n  }\r\n\r\n  insertThread(ident, threadData) {\r\n    if (this.isLastThread(ident)) {\r\n      this.pushThread(threadData)\r\n    } else {\r\n      var idx = this.getThreadIdx(ident)\r\n      this.state.srcData.index.splice(idx, 0, threadData.id)\r\n      this.state.srcData.threads.splice(idx, 0, threadData)\r\n      for (let [k, v] of Object.entries(this.threadsMap)) {\r\n        if (v.id !== threadData.id && v.idx >= idx) {\r\n          this.threadsMap[k].idx = v.idx + 1\r\n        }\r\n      }\r\n      if (this.state.threadIndex >= idx) {\r\n        this.state.threadIndex++\r\n      }\r\n    }\r\n  }\r\n\r\n  newIdent(id, idx) {\r\n    var ident = randomString(21)\r\n    this.threadsMap[ident] = { id: id, idx: idx, linked: {} }\r\n    return ident\r\n  }\r\n\r\n  changeCurrentThread(ident) {\r\n    this.state.threadId = this.getThreadId(ident)\r\n    this.state.threadIndex = this.getThreadIdx(ident)\r\n  }\r\n\r\n  moveThread(ident, siblingIdent, up = false) {\r\n    var from = this.getThreadIdx(ident)\r\n    var to = from + 1\r\n    if (up) {\r\n      to = from - 1\r\n    }\r\n    this.state.srcData.index.splice(to, 0, this.state.srcData.index.splice(from, 1)[0])\r\n    this.state.srcData.threads.splice(to, 0, this.state.srcData.threads.splice(from, 1)[0])\r\n    this.threadsMap[ident].idx = to\r\n    this.threadsMap[siblingIdent].idx = from\r\n\r\n    if (this.isCurrentId(ident)) {\r\n      this.state.threadIndex = to\r\n    } else if (this.isCurrentId(siblingIdent)) {\r\n      this.state.threadIndex = from\r\n    }\r\n  }\r\n\r\n  pushThread(threadData) {\r\n    this.state.srcData.threads.push(threadData)\r\n    this.state.srcData.index.push(threadData.id)\r\n  }\r\n\r\n  /* linked threads methods */\r\n\r\n  getLinkedThreadIdx(ident, lkident) {\r\n    var idx = this.threadsMap[ident].linked[lkident].idx\r\n    var count = this.getLinkedUrlsCount(ident)\r\n    if (idx >= count) {\r\n      idx = count - 1\r\n      this.threadsMap[ident].linked[lkident].idx = idx\r\n    }\r\n    return idx\r\n  }\r\n\r\n  getLinkedUrls(ident) {\r\n    var threadData = this.getThreadData(ident)\r\n    if (!Object.prototype.hasOwnProperty.call(threadData, 'linked')) {\r\n      var idx = this.getThreadIdx(ident)\r\n      this.state.srcData.threads[idx].linked = []\r\n      return []\r\n    }\r\n    return threadData.linked\r\n  }\r\n\r\n  getLinkedUrlsCount(ident) {\r\n    return this.getLinkedUrls(ident).length\r\n  }\r\n\r\n  registerLinkedThread(ident, linkIdx) {\r\n    var lkident = randomString(21)\r\n    this.threadsMap[ident].linked[lkident] = { idx: linkIdx }\r\n    return lkident\r\n  }\r\n\r\n  isLastLinkedThread(ident, lkident) {\r\n    return this.getLinkedThreadIdx(ident, lkident) === this.getLinkedUrlsCount(ident) - 1\r\n  }\r\n\r\n  removeLinkedThread(ident, lkident) {\r\n    var tidx = this.getThreadIdx(ident)\r\n    var lidx = this.getLinkedThreadIdx(ident, lkident)\r\n    if (lidx === this.getLinkedUrlsCount(ident) - 1) {\r\n      this.state.srcData.threads[tidx].linked.pop()\r\n    } else {\r\n      this.state.srcData.threads[tidx].linked.splice(lidx, 1)\r\n      for (let [k, v] of Object.entries(this.threadsMap[ident].linked)) {\r\n        if (v.idx > lidx) {\r\n          this.threadsMap[ident].linked[k].idx = v.idx - 1\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  pushLinkedThread(ident, value) {\r\n    var idx = this.getThreadIdx(ident)\r\n    if(!this.state.srcData.threads[idx].linked){\r\n      this.state.srcData.threads[idx].linked = []\r\n    }\r\n      this.state.srcData.threads[idx].linked.push(value)\r\n  }\r\n\r\n  insertLinkedThread(ident, lkident, value) {\r\n    if (this.isLastLinkedThread(ident, lkident)) {\r\n      this.pushLinkedThread(ident, value)\r\n    } else {\r\n      var tidx = this.getThreadIdx(ident)\r\n      var lidx = this.getLinkedThreadIdx(ident, lkident)\r\n      this.state.srcData.threads[tidx].linked.splice(lidx, 0, value)\r\n      for (let [k, v] of Object.entries(this.threadsMap[ident].linked)) {\r\n        if (v.idx >= lidx && k !== lkident) {\r\n          this.threadsMap[ident].linked[k].idx = v.idx + 1\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { readerElms } from '../reader/NxReader.js'\r\nimport { getElm } from '../shared/NxCommons.js'\r\nimport { NxEditInstance } from './NxEditInstance.js'\r\nimport { NxEditSwitch } from './NxEditSwitch.js'\r\nimport { triggerUpdate } from '../shared/NxState.js'\r\nimport { NxEditState } from './NxEditState.js'\r\n\r\nexport function editorElms(seed) {\r\n  var EditState = new NxEditState(seed.state)\r\n  var EditInstance = new NxEditInstance(EditState)\r\n\r\n  var editInst = EditInstance.getInstanceElms()\r\n\r\n  var readerSeed = {\r\n    editMode: true,\r\n    state: Object.assign({}, EditState.getState()),\r\n  }\r\n  var readerInst = readerElms(readerSeed)\r\n  readerInst.style.display = 'none'\r\n\r\n  var readerUpdatePromise = function () {\r\n   triggerUpdate(EditState.state, true, true)\r\n   return new Promise(function(resolve) {\r\n    setTimeout(resolve, 100);\r\n})\r\n  }\r\n  var EditSwitch = new NxEditSwitch(editInst, readerInst, readerUpdatePromise)\r\n  var switchBtn = EditSwitch.getSwitchBtn()\r\n\r\n  var editor = getElm('DIV', 'nx-editor')\r\n  editor.append(editInst, readerInst, switchBtn)\r\n\r\n  return editor\r\n}\r\n","import { initAll, retrieveNxElm } from '@i-is-as-i-does/nexus-core/src/load/NxInit.js'\r\nimport { getQuery } from '@i-is-as-i-does/nexus-core/src/base/NxHost.js'\r\nimport { setOriginLang } from '@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js'\r\nimport { logErr } from '@i-is-as-i-does/nexus-core/src/logs/NxLog.js'\r\nimport { dataToState, setOriginState, triggerUpdate } from './NxState.js'\r\nimport { editorElms } from './../editor/NxEditor.js'\r\nimport { readerElms } from './../reader/NxReader.js'\r\nimport { errorPrgr } from './NxCommons.js'\r\nimport { appDefaultCss, legacyDefaultCss } from './NxCdn.js'\r\nimport { getSrcDocData } from '@i-is-as-i-does/nexus-core/src/load/NxSrc.js'\r\nimport { vHide, vShow } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\n\r\nfunction mountApp(nxElm, appElm) {\r\n  var host = document.createElement('DIV')\r\n  host.className = 'nx'\r\n  host.append(appElm)\r\n  nxElm.append(host)\r\n  return host;\r\n}\r\n\r\nfunction updateHost(host, appElm){\r\n  vHide(host, 'ease', 200, function(){\r\n    host.textContent = ''\r\n    host.append(appElm)\r\n    vShow(host, 'ease', 200)\r\n  })\r\n}\r\n\r\nexport function init() {\r\n  var feedback = errorPrgr();\r\n  feedback.classList.add('nx-instance');\r\n  \r\n  initAll({\r\n    appDefaultLang: 'en',\r\n    appDefaultCss: appDefaultCss,\r\n    appDefaultCssAliases: legacyDefaultCss,\r\n  })\r\n    .then((seed) => {\r\n      setOriginLang(seed.request.lang)\r\n      seed.state = dataToState(seed.request.url, seed.request.id, seed.nxdata)\r\n      setOriginState(seed.state)\r\n      var elm\r\n      seed.editMode = false\r\n      if (getQuery('edit') || getQuery('new')) {\r\n        seed.editMode = true\r\n         elm = editorElms(seed)\r\n      } else {\r\n         elm = readerElms(seed)\r\n      }\r\n    var host = mountApp(seed.nxelm, elm)\r\n    var on = true;\r\n\r\n    seed.nxelm.addEventListener('change', function () {\r\n      if (seed.nxelm.dataset.srcdoc) {\r\n        var nxdata = getSrcDocData(seed.nxelm.dataset.srcdoc, seed.request.mode === 'editor')\r\n        if (nxdata) {\r\n          seed.nxdata = nxdata\r\n          seed.state = dataToState(seed.request.url, seed.request.id, seed.nxdata)\r\n          triggerUpdate(seed.state, true, true)\r\n          if(!on){\r\n            on = true\r\n            updateHost(host, elm)\r\n          }\r\n\r\n        } else if(on) {\r\n          on = false\r\n          updateHost(host, feedback)\r\n        }\r\n      }\r\n    })\r\n\r\n    }).catch((err) => {\r\n      logErr(err.message)\r\n      mountApp(retrieveNxElm(), feedback)\r\n    })\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","(function () { \r\n    import('./shared/NxStart.js').then(NxStart => {\r\n        NxStart.init()\r\n    })\r\n  })();"],"names":[],"sourceRoot":""}