{"version":3,"file":"js/NxIORead.js","mappings":";;;;;;;;;;;;;;;;;;AAAuF;AAQxD;AAC0B;AACwB;AACV;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,wBAAwB;AACpC,YAAY,wBAAwB;AACpC,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,YAAY,4DAAM;AAClB,EAAE,yEAAkB;AACpB;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,aAAa,4DAAM;AACnB;AACA;AACA;AACA;AACA;AACA,MAAM,wFAAK;AACX,MAAM;AACN;AACA;AACA,MAAM,wFAAK;AACX,MAAM,iGAAkB;AACxB;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,gBAAgB,4DAAM;AACtB,cAAc,4DAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,4DAAM;AACrB;AACA;AACA,EAAE,sEAAiB;AACnB;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,IAAI,yFAAM;AACV,MAAM,iGAAkB;AACxB,KAAK;AACL,IAAI,mEAAY;AAChB;AACA;AACA;AACA;AACA,UAAU,4DAAe,gBAAgB,sDAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,kEAAY;AAC3B,EAAE,yEAAkB;AACpB;AACA;AACA;AACA,IAAI,kEAAa;AACjB;AACA;AACA,GAAG;AACH;AACA;AACA;AACO;AACP;AACA,SAAS,+DAAS;AAClB;;;;;;;;;;;;;;;;;;;;;;;;AC9HmG;AAClB;AACW;AACxB;AACM;AAC1E;AACA;AACA;AACA;AACA,YAAY,gGAAa;AACzB;AACA,UAAU,mFAAO;AACjB,IAAI,6FAAS;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,SAAS,iEAAa;AAC1B;AACA;AACA;AACA;AACA;AACO;AACP,YAAY,4DAAM;AAClB;AACA;AACA;AACA;AACA,IAAI,qEAAiB;AACrB,MAAM,yFAAU;AAChB,KAAK;AACL;AACA;AACA;AACA;AACO;AACP,mBAAmB,4DAAM;AACzB;AACA;AACA,GAAG;AACH,eAAe,4DAAM;AACrB;AACA;AACA,GAAG;AACH,aAAa,4DAAM;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,qEAAiB;AACrB;AACA,MAAM,0FAAU;AAChB,KAAK;AACL;AACA;AACA;AACA;AACO;AACP,gBAAgB,4DAAM;AACtB;AACA,EAAE,sEAAiB;AACnB;AACA,GAAG;AACH;AACA;AACO;AACP,eAAe,kEAAY;AAC3B;AACA,IAAI,wEAAkB;AACtB;AACA;AACA;AACA;AACA,IAAI,iEAAa;AACjB,GAAG;AACH;AACA;AACA;AACO;AACP,aAAa,4DAAM;AACnB;AACA;AACA,iBAAiB,+DAAW;AAC5B,EAAE,yEAAkB;AACpB;AACA;AACA,IAAI,kEAAa;AACjB,GAAG;AACH;AACA;AACA;;;;;;;;;;;;;;;;;;;ACrGyD;AACY;AACL;AACC;AACjE;AACA;AACA;AACA;AACA,WAAW,4DAAM;AACjB;AACA;AACA,EAAE,sEAAiB;AACnB,IAAI,2FAAQ;AACZ,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,2DAAK;AACd;AACA;AACA;AACA,cAAc,4DAAM;AACpB;AACA;AACA;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA;AACA;AACA,EAAE,qEAAiB;AACnB;AACA,GAAG;AACH;AACA;AACA;AACA,iBAAiB,+DAAW;AAC5B;AACA,WAAW,4DAAM;AACjB,YAAY,qDAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,uFAAK;AACX;AACA,OAAO;AACP;AACA,oBAAoB,WAAW;AAC/B;AACA;AACA,QAAQ,2FAAQ;AAChB;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA,wBAAwB,WAAW;AACnC,MAAM,wFAAM;AACZ;AACA;AACA;AACA;AACA;AACA,eAAe,4DAAM;AACrB,gBAAgB,yDAAY,eAAe,sDAAS;AACpD;AACA;AACA;AACA;AACA;AACA,SAAS,+DAAS;AAClB;AACA;AACO;AACP,kBAAkB,4DAAM;AACxB;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;ACpG6C;AACE;AAC8B;AAC7E;AACA;AACA,uBAAuB,4DAAM;AAC7B;AACA,kBAAkB,4DAAM;AACxB;AACA;AACA;AACA;AACA,iBAAiB,2DAAa;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE,6FAAY;AACd;AACA;AACA;AACO;AACP,iBAAiB,4DAAM;AACvB;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACjC6C;AACA;AACgC;AAClC;AACI;AAC/C;AACO;AACP,SAAS,kEAAY,CAAC,+DAAS;AAC/B,IAAI,iEAAW;AACf,OAAO,2DAAY;AACnB,OAAO,2DAAc,cAAc,6DAAe;AAClD,OAAO,yDAAW;AAClB;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACf8E;AACc;AACvB;AACsB;AACxB;AACe;AACL;AACpB;AACX;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,4DAAM;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,UAAU,6DAAS;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,4DAAM;AACtB;AACA;AACA;AACA,EAAE,2GAAiB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,wFAAK;AACX,MAAM;AACN;AACA;AACA,MAAM,wFAAK;AACX;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,4DAAM;AACpB;AACA;AACA;AACA,YAAY,4DAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,4DAAM;AACrB;AACA;AACA;AACA,EAAE,sEAAiB;AACnB;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,eAAe,4DAAM;AACrB,eAAe,+DAAS,CAAC,uDAAO;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,6FAAe;AACnB,MAAM,8FAAW;AACjB,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,YAAY,4DAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,4FAAU,kCAAkC,mDAAK,EAAE,iGAAO;AACrE;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,sBAAsB,2DAAa;AACnC,IAAI,6BAA6B,2DAAa;AAC9C;AACA;AACA,SAAS,+DAAS;AAClB;;;;;;;;;;;;;;;;;;;;;;;;;;AChJ4E;AAMnB;AAC0B;AAChB;AAC5B;AAUR;AACsC;AACE;AACW;AACA;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,wBAAwB;AACpC,YAAY,wBAAwB;AACpC,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,iEAAW;AAC/B;AACA;AACA;AACA;AACA,YAAY,mEAAa;AACzB,gBAAgB,kFAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,mEAAY;AAClB;AACA;AACA,IAAI,uFAAK;AACT;AACA;AACA;AACA;AACA;AACA,EAAE,wFAAK;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,cAAc,4DAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,+DAAS;AAClB;AACA;AACA;AACA;AACA,SAAS,+DAAS,wBAAwB,iEAAW;AACrD;AACA;AACA;AACA,eAAe,4DAAM;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,mEAAY;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,uFAAK;AACX;AACA,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,0FAAQ;AACd,MAAM;AACN,MAAM,wFAAM;AACZ;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,eAAe,4DAAM;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,4DAAM;AACjB,eAAe,4DAAM;AACrB,EAAE,yEAAkB;AACpB,EAAE,mEAAY;AACd;AACA;AACA;AACA,cAAc,4DAAe,uBAAuB,sDAAS;AAC7D;AACA,cAAc,qDAAQ;AACtB;AACA,YAAY,4DAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,iGAAkB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,gEAAY;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,+DAAW;AAC7C;AACA,cAAc;AACd;AACA,cAAc,qFAAM;AACpB;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,QAAQ,qFAAM;AACd,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,MAAM,iGAAkB;AACxB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,WAAW,4DAAM;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,qDAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,4DAAM;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,4DAAM;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,oBAAoB,gBAAgB;AACpC;AACA;AACA,QAAQ,2FAAa;AACrB;AACA;AACA,QAAQ;AACR,eAAe,2DAAK;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,4DAAM;AACrB,gBAAgB,oEAAc;AAC9B;AACA;AACA;AACA;AACA,iBAAiB,4DAAM;AACvB;AACA;AACA;AACA;AACA;AACA;AACO;AACP,WAAW,4DAAM;AACjB;AACA;AACA;AACA;AACO;AACP;AACA;AACA,kBAAkB,4DAAM;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,sEAAiB;AACnB;AACA,GAAG;AACH;AACA;AACA;;;;;;;;;;;;;;;;;AC9WO;AACA;AACP;AACO;AACP;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACL4E;AACX;AAID;AAKC;AACQ;AACM;AACF;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,iGAAO;AAC9B;AACA,IAAI,2GAAiB;AACrB;AACA;AACA,MAAM,0GAAgB;AACtB,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,oFAAM;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA,uBAAuB,gGAAM;AAC7B,EAAE,2GAAiB;AACnB;AACA;AACA;AACO;AACP;AACA,MAAM,2FAAW;AACjB;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACO;AACP,iCAAiC,4DAAe;AAChD,EAAE,+DAAiB;AACnB;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA,IAAI,8DAAiB;AACrB;AACA,MAAM,6FAAU;AAChB,KAAK;AACL;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,aAAa,8FAAiB;AAC9B;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxSO,oCAAoC;AACpC,wCAAwC;AACxC,oCAAoC;AACpC,mCAAmC;AACnC,oCAAoC;AACpC,qCAAqC;AACrC,uCAAuC;AACvC,oCAAoC;AACpC,oCAAoC;AACpC,oCAAoC;AACpC,uCAAuC;AACvC,qCAAqC;AACrC,kCAAkC;AAClC,oCAAoC;;;;;;;;;;;;;;;;;;;;;;;;ACb2C;AACd;AACgB;AACnB;AACX;AACN;AACA;AACV;AACkB;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,EAAE,sFAAO;AACT;AACA,mBAAmB,oDAAa;AAChC,0BAA0B,uDAAgB;AAC1C,GAAG;AACH;AACA,MAAM,uGAAa;AACnB,mBAAmB,wDAAW;AAC9B,MAAM,4DAAc;AACpB;AACA;AACA,UAAU,uFAAQ,YAAY,uFAAQ;AACtC;AACA,eAAe,+DAAU;AACzB,QAAQ;AACR,eAAe,+DAAU;AACzB;AACA;AACA,KAAK;AACL,MAAM,oFAAM;AACZ,eAAe,4FAAa,IAAI,wDAAS;AACzC,KAAK;AACL;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxCyF;AAIhC;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,WAAW,uGAAqB;AAChC;AACA;AACA;AACA;AACO;AACP,eAAe,4FAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACO;AACP,SAAS,wFAAU;AACnB;AACA,GAAG;AACH;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,MAAM,qGAAmB;AACzB;AACA;AACA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,iCAAiC;AACjC;AACA;AACA;AACA;AACA","sources":["webpack://nexus-io/./src/reader/NxHistory.js","webpack://nexus-io/./src/reader/NxIdent.js","webpack://nexus-io/./src/reader/NxIndex.js","webpack://nexus-io/./src/reader/NxMedia.js","webpack://nexus-io/./src/reader/NxReader.js","webpack://nexus-io/./src/reader/NxSource.js","webpack://nexus-io/./src/reader/NxThread.js","webpack://nexus-io/./src/shared/NxCdn.js","webpack://nexus-io/./src/shared/NxCommons.js","webpack://nexus-io/./src/shared/NxIcons.js","webpack://nexus-io/./src/shared/NxStart.js","webpack://nexus-io/./src/shared/NxState.js"],"sourcesContent":["import { vShow, vHide, vPlace } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport {\r\n  blockWrap,\r\n  getElm,\r\n  setHistoryControls,\r\n  toggleNavEnd,\r\n  setToggleOnDisplay,\r\n  baseViewLink,\r\n} from '../shared/NxCommons.js'\r\nimport { authorIndexLink, authorUrl } from './NxIdent.js'\r\nimport { autoScrollToBottom } from '@i-is-as-i-does/jack-js/src/modules/Style.js'\r\nimport { registerUpdateEvt, triggerUpdate } from '../shared/NxState.js'\r\n\r\nconst historyMax = 100\r\nvar isHistoryEvent = false\r\nvar historyList = null\r\nvar historyElm = null\r\n\r\nvar historyState = {\r\n  dataUrl: null,\r\n  srcData: null,\r\n  threadId: '/',\r\n  threadIndex: -1,\r\n}\r\n\r\nvar histCtrls = {\r\n  ctrls: {\r\n    prev: { symbol: '<', elm: null },\r\n    next: { symbol: '>', elm: null },\r\n  },\r\n  position: 0,\r\n  count: 1,\r\n}\r\n\r\nfunction historyNav() {\r\n  var wrp = getElm('DIV', 'nx-history-nav')\r\n  setHistoryControls(histCtrls, function (ctrl, pos) {\r\n    var target = historyList.children[pos + 1].querySelector('.nx-thread-title')\r\n    target.click()\r\n  })\r\n  wrp.append(histCtrls.ctrls['prev'].elm, historyToggleElm(), histCtrls.ctrls['next'].elm)\r\n  return wrp\r\n}\r\nfunction historyToggleElm() {\r\n  var tggl = getElm('A', 'nx-history-toggle')\r\n  tggl.textContent = '≚'\r\n  tggl.addEventListener('click', () => {\r\n    if (tggl.textContent == '≙') {\r\n      tggl.textContent = '≚'\r\n      tggl.classList.remove('nx-active')\r\n      vHide(historyElm, 'ease', 200)\r\n    } else {\r\n      tggl.textContent = '≙'\r\n      tggl.classList.add('nx-active')\r\n      vShow(historyElm, 'ease', 200)\r\n      autoScrollToBottom(historyList)\r\n    }\r\n  })\r\n  return tggl\r\n}\r\n\r\nfunction setHistoryListElm(state) {\r\n  historyList = getElm('UL', 'nx-history-list')\r\n  var first = getElm('LI')\r\n  first.textContent = '...'\r\n  historyList.append(first)\r\n  if (state && state.srcData) {\r\n    historyState = state\r\n    historyList.append(historyItm(state, 0))\r\n  }\r\n  historyElm = getElm('DIV', 'nx-history-drawer')\r\n  historyElm.append(historyList)\r\n  historyElm.style.display = 'none'\r\n  registerUpdateEvt(function (newState, skipHistoryUpdate) {\r\n    historyEvent(newState, skipHistoryUpdate)\r\n  })\r\n}\r\n\r\nfunction historyEvent(state, skipHistoryUpdate) {\r\n  if (\r\n    !skipHistoryUpdate &&\r\n    !isHistoryEvent &&\r\n    (state.dataUrl !== historyState.dataUrl || state.threadId !== historyState.threadId)\r\n  ) {\r\n    historyState = state\r\n    if (histCtrls.count > historyMax) {\r\n      historyList.children[1].remove()\r\n    } else {\r\n      histCtrls.count++\r\n    }\r\n\r\n    histCtrls.position = histCtrls.count - 1\r\n    var itm = historyItm(state, histCtrls.position)\r\n    vPlace(historyList, itm, false, 'ease', 200,function () {\r\n      autoScrollToBottom(historyList)\r\n    })\r\n    toggleNavEnd(histCtrls)\r\n  }\r\n}\r\n\r\nfunction viewElms(state, pos) {\r\n  return [authorIndexLink(state, false), authorUrl(state, false), historyViewLink(state, pos)]\r\n}\r\n\r\nfunction historyItm(state, pos) {\r\n  var itm = document.createElement('LI')\r\n  itm.append(...viewElms(state, pos))\r\n  return itm\r\n}\r\n\r\nfunction historyViewLink(state, pos) {\r\n  var viewlk = baseViewLink(state, false)\r\n  setToggleOnDisplay(viewlk, state)\r\n\r\n  viewlk.addEventListener('click', () => {\r\n    isHistoryEvent = true\r\n    triggerUpdate(state, true)\r\n    histCtrls.position = pos\r\n    isHistoryEvent = false\r\n  })\r\n  return viewlk\r\n}\r\n\r\nexport function historyBlock(state) {\r\n  setHistoryListElm(state)\r\n  return blockWrap('history', [historyNav(), historyElm], false)\r\n}\r\n","import { registerUpdateEvt, triggerUpdate, isStateUnseen, getAltState } from '../shared/NxState.js'\r\nimport { baseViewLink, getElm, setToggleOnDisplay } from '../shared/NxCommons.js'\r\nimport { getStoredItem, storeItem } from '@i-is-as-i-does/nexus-core/src/storg/NxStorage.js'\r\nimport { miniUrl } from '@i-is-as-i-does/jack-js/src/modules/Web.js'\r\nimport { vSplitFlap } from '@i-is-as-i-does/valva/src/modules/transitions'\r\n\r\nvar urlStore = {}\r\n\r\nfunction authorMiniUrl(authorUrl) {\r\n  var url = getStoredItem(authorUrl, 'local', urlStore, false)\r\n  if (!url) {\r\n    url = miniUrl(authorUrl)\r\n    storeItem(authorUrl, url, 'local', urlStore, false)\r\n  }\r\n  return url\r\n}\r\n\r\nfunction toggleUnseen(viewlk, state) {\r\n  if (viewlk.classList.contains('nx-on-display')) {\r\n    viewlk.classList.remove('nx-unseen')\r\n    viewlk.lastChild.textContent = ''\r\n  } else if (isStateUnseen(state)) {\r\n    viewlk.classList.add('nx-unseen')\r\n    viewlk.lastChild.textContent = '*'\r\n  }\r\n}\r\n\r\nexport function authorHandle(state, update = false) {\r\n  var hnd = getElm('SPAN', 'nx-handle')\r\n  if (state.srcData) {\r\n    hnd.textContent = state.srcData.author.handle\r\n  }\r\n  if (update) {\r\n    registerUpdateEvt(function (newState) {\r\n      vSplitFlap(hnd, newState.srcData.author.handle, 25)\r\n    }, true)\r\n  }\r\n  return hnd\r\n}\r\n\r\nexport function authorUrl(state, update = false) {\r\n  var authorlksp = getElm('SPAN', 'nx-author-url')\r\n\r\n  var urlBrck = []\r\n  ;['[', ']'].forEach((bracket) => {\r\n    var brsp = getElm('SPAN', 'nx-author-url-brackets')\r\n    brsp.textContent = bracket\r\n    urlBrck.push(brsp)\r\n  })\r\n  var urla = getElm('A', 'nx-external-link')\r\n  urla.target = '_blank'\r\n  var hrf = ''\r\n  if (state.srcData) {\r\n    hrf = state.srcData.author.url\r\n  }\r\n  urla.href = hrf\r\n\r\n  if (state.srcData) {\r\n    urla.textContent = authorMiniUrl(state.srcData.author.url)\r\n  }\r\n\r\n  authorlksp.append(urlBrck[0], urla, urlBrck[1])\r\n\r\n  if (update) {\r\n    registerUpdateEvt(function (newState) {\r\n      urla.href = newState.srcData.author.url\r\n      vSplitFlap(urla, authorMiniUrl(newState.srcData.author.url), 25)\r\n    }, true)\r\n  }\r\n  return authorlksp\r\n}\r\n\r\nexport function setToggleUnseen(viewlk, state) {\r\n  viewlk.append(getElm('SPAN', 'nx-new-tag'))\r\n  toggleUnseen(viewlk, state)\r\n  registerUpdateEvt(function () {\r\n    toggleUnseen(viewlk, state)\r\n  })\r\n}\r\n\r\nexport function viewLink(state, update = false) {\r\n  var viewlk = baseViewLink(state, update)\r\n  if (state.threadId !== '/') {\r\n    setToggleOnDisplay(viewlk, state)\r\n    setToggleUnseen(viewlk, state)\r\n  }\r\n\r\n  viewlk.addEventListener('click', () => {\r\n    triggerUpdate(state)\r\n  })\r\n  return viewlk\r\n}\r\n\r\nexport function authorIndexLink(state, update = false) {\r\n  var auth = getElm('A', 'nx-author-link')\r\n  auth.append(authorHandle(state, update))\r\n\r\n  var newState = getAltState(state, '/', -1)\r\n  setToggleOnDisplay(auth, newState)\r\n\r\n  auth.addEventListener('click', function () {\r\n    triggerUpdate(newState, '/')\r\n  })\r\n\r\n  return auth\r\n}\r\n","import {\r\n  vPlace,\r\n  vReplace,\r\n  vHide,\r\n} from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport { getAltState, registerUpdateEvt } from '../shared/NxState.js'\r\nimport { authorHandle, authorUrl, viewLink } from './NxIdent.js'\r\nimport { blockWrap, getElm, lines } from '../shared/NxCommons.js'\r\n\r\nvar indexList = null\r\n\r\nfunction aboutElm(state) {\r\n  var ab = getElm('DIV', 'nx-about-author')\r\n\r\n  ab.append(aboutLines(state))\r\n  registerUpdateEvt(function (newState) {\r\n    vReplace(ab.firstChild, aboutLines(newState), 200)\r\n  }, true)\r\n  return ab\r\n}\r\n\r\nfunction aboutLines(state) {\r\n  var text = null\r\n  if (state.srcData && state.srcData.author.about) {\r\n    text = state.srcData.author.about\r\n  }\r\n  return lines(text)\r\n}\r\n\r\nfunction setIndexList(state) {\r\n  indexList = getElm('UL')\r\n  if (state.srcData) {\r\n    var items = state.srcData.index\r\n\r\n    if (items.length) {\r\n      for (var i = 0; i < items.length; i++) {\r\n        indexList.append(indexLi(state, items[i], i))\r\n      }\r\n    }\r\n  }\r\n  registerUpdateEvt(function (newState) {\r\n    changeThreadsList(newState)\r\n  }, true)\r\n}\r\n\r\nfunction indexLi(state, id, index) {\r\n  var altState = getAltState(state, id, index)\r\n\r\n  var li = getElm('LI')\r\n  li.append(viewLink(altState, false))\r\n  return li\r\n}\r\n\r\nfunction changeThreadsList(state) {\r\n  var childr = indexList.childNodes\r\n  var items = state.srcData.index\r\n  var nwlen = items.length\r\n\r\n  var chlen = childr.length\r\n\r\n  var count = 0\r\n  if (chlen) {\r\n    var rmv = function (child) {\r\n      vHide(child, 'ease', 200, function () {\r\n        child.remove()\r\n      })\r\n    }\r\n    for (var x = 0; x < chlen; x++) {\r\n      if (nwlen > x) {\r\n        var nlink = indexLi(state, items[x], x)\r\n        vReplace(childr[x], nlink, 200)\r\n        count++\r\n      } else {\r\n        rmv(childr[x])\r\n      }\r\n    }\r\n  }\r\n  if (count < nwlen) {\r\n    for (var y = count; y < nwlen; y++) {\r\n      vPlace(indexList, indexLi(state, items[y], y), false, 'ease', 200)\r\n    }\r\n  }\r\n}\r\n\r\nfunction indexHeader(state) {\r\n  var header = getElm('DIV', 'nx-index-header')\r\n  header.append(authorHandle(state, true), authorUrl(state, true), aboutElm(state))\r\n  return header\r\n}\r\n\r\nfunction indexBlock(state) {\r\n  setIndexList(state)\r\n  return blockWrap('threads-list', [indexList])\r\n}\r\n\r\nexport function mainIndexBlock(state) {\r\n  var mainBlock = getElm('DIV', 'nx-main-block nx-index')\r\n  var blocks = [indexHeader(state), indexBlock(state)]\r\n  mainBlock.append(...blocks)\r\n  return mainBlock\r\n}\r\n","import { threadTextElm } from './NxThread.js'\r\nimport { getElm } from '../shared/NxCommons.js'\r\nimport { resolveMedia } from '@i-is-as-i-does/nexus-core/src/data/NxMedia.js'\r\n\r\nfunction threadMediaElm(threadData, countReady) {\r\n  var mediaContainer = getElm('DIV', 'nx-media')\r\n\r\n  var mediaWrap = getElm('DIV')\r\n  mediaContainer.append(mediaWrap)\r\n\r\n  var captionElm = null\r\n  if (threadData.content.media.caption) {\r\n    captionElm = threadTextElm(threadData, ['content', 'media', 'caption'])\r\n    mediaContainer.append(captionElm)\r\n  }\r\n\r\n  mediaWrap.addEventListener('mediaReady', function () {\r\n    if (mediaWrap.firstChild.tagName === 'A' && threadData.content.media.type !== 'page') {\r\n      threadData.content.media.type = 'page'\r\n    }\r\n    mediaWrap.className = 'nx-' + threadData.content.media.type + '-media'\r\n    if (countReady !== null) {\r\n      countReady()\r\n    }\r\n  })\r\n  resolveMedia(threadData.content.media.url, threadData.content.media.type, mediaWrap)\r\n  return mediaContainer\r\n}\r\n\r\nexport function mediaElm(threadData, countReady = null) {\r\n  var mediadiv = getElm('DIV', 'nx-content-media')\r\n  mediadiv.append(threadMediaElm(threadData, countReady))\r\n  return mediadiv\r\n}\r\n","import { historyBlock } from './NxHistory.js'\r\nimport { mainIndexBlock } from './NxIndex.js'\r\nimport { appHeader, instanceWrap, serviceWrap } from '../shared/NxCommons.js'\r\nimport { sourceBlock } from './NxSource.js'\r\nimport { mainThreadBlock } from './NxThread.js'\r\n\r\nexport function readerElms(seed) {\r\n  return instanceWrap(appHeader(), [\r\n    serviceWrap(\r\n      [historyBlock(seed.state)],\r\n      [mainIndexBlock(seed.state), mainThreadBlock(seed.state)],\r\n      [sourceBlock(seed.state, seed.styleUrl, seed.editMode)],\r\n      'reader'\r\n    ),\r\n  ])\r\n}\r\n","import { copyToClipboard } from '@i-is-as-i-does/jack-js/src/modules/Stock.js'\r\nimport { vHide, vShow, vTempToggle } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport { blockWrap, getElm, iconImage } from '../shared/NxCommons.js'\r\nimport { registerTranslElm } from '@i-is-as-i-does/nexus-core/src/transl/NxElmTranslate.js'\r\nimport { concatSrc, registerUpdateEvt } from '../shared/NxState.js'\r\nimport { getLang } from '@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js'\r\nimport { getSnippet } from '@i-is-as-i-does/nexus-core/src/data/NxSnippet.js'\r\nimport { appDefaultCss, appIO } from '../shared/NxCdn.js'\r\nimport { copyB64 } from '../shared/NxIcons.js'\r\n\r\nvar drawerElm = null\r\nvar editMode = false\r\nvar currentStyle = null\r\n\r\nfunction actionLink(action, text) {\r\n  var lk = getElm('A', 'nx-source-' + action)\r\n  lk.textContent = text\r\n  return lk\r\n}\r\n\r\nfunction resolveSrc(state) {\r\n  var src\r\n  if (editMode) {\r\n    src = '#editing'\r\n  } else {\r\n    src = concatSrc(state)\r\n  }\r\n  return src\r\n}\r\n\r\nfunction linkContent(state) {\r\n  if (state.dataUrl) {\r\n    return resolveSrc(state)\r\n  }\r\n  return ''\r\n}\r\n\r\nfunction toolTip(className, text) {\r\n  var tooltip = getElm('SPAN', className)\r\n  tooltip.textContent = text\r\n  tooltip.style.opacity = 0\r\n  tooltip.hidden = true\r\n  registerTranslElm(tooltip, text)\r\n  return tooltip\r\n}\r\n\r\nfunction toggleLink() {\r\n  var text = '</>'\r\n  var altText = '< />'\r\n  var lk = actionLink('snippets', text)\r\n\r\n  lk.addEventListener('click', () => {\r\n    if (lk.textContent == altText) {\r\n      lk.textContent = text\r\n      lk.classList.remove('nx-active')\r\n      vHide(drawerElm, 'ease', 200)\r\n    } else {\r\n      lk.textContent = altText\r\n      lk.classList.add('nx-active')\r\n      vShow(drawerElm, 'ease', 100, function () {\r\n        drawerElm.scrollIntoView({\r\n          block: 'end',\r\n          behavior: 'smooth',\r\n          inline: 'nearest',\r\n        })\r\n      })\r\n    }\r\n  })\r\n  return lk\r\n}\r\n\r\nfunction linkSource(state) {\r\n  return codeElm('json', textAreaElm(state, linkContent))\r\n}\r\n\r\nfunction snippetsBundle(state) {\r\n  drawerElm = getElm('DIV', 'nx-source-drawer')\r\n  drawerElm.append(linkSource(state), embedSnippet(state))\r\n  drawerElm.style.display = 'none'\r\n\r\n  var tgg = getElm('DIV', 'nx-source-toggle')\r\n  var snippetLink = toggleLink()\r\n  tgg.append(snippetLink)\r\n\r\n  return [tgg, drawerElm]\r\n}\r\n\r\nfunction textAreaElm(state, callback) {\r\n  var snpInp = getElm('TEXTAREA')\r\n  snpInp.spellcheck = false\r\n  snpInp.textContent = callback(state)\r\n\r\n  registerUpdateEvt(function (newState) {\r\n    snpInp.textContent = callback(newState)\r\n  })\r\n  return snpInp\r\n}\r\n\r\nfunction copyLink(snpElm) {\r\n  var copyLk = getElm('A', 'nx-source-link')\r\n  var copyIc = iconImage(copyB64, 16)\r\n\r\n  copyLk.append(copyIc)\r\n  var copyTooltip = toolTip('nx-source-copy-tooltip', 'c/c')\r\n  copyLk.append(copyTooltip)\r\n\r\n  copyLk.addEventListener('click', () =>\r\n    copyToClipboard(snpElm.textContent, () => {\r\n      vTempToggle(copyTooltip, 'fade', 1000, 200)\r\n    })\r\n  )\r\n  return copyLk\r\n}\r\n\r\nfunction codeElm(name, elm) {\r\n  var snp = getElm('DIV', 'nx-' + name + '-snippet')\r\n  snp.append(elm, copyLink(elm))\r\n  return snp\r\n}\r\n\r\nfunction embedSnippet(state) {\r\n  return codeElm('embed', textAreaElm(state, embedContent))\r\n}\r\n\r\nfunction embedContent(state) {\r\n  if (editMode) {\r\n    return '#editing'\r\n  }\r\n  if (state.dataUrl) {\r\n    return getSnippet(resolveSrc(state), currentStyle, appIO, getLang())\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function sourceBlock(state, currentStyleUrl = null, editionSource = false) {\r\n  if (editionSource) {\r\n    editMode = true\r\n  }\r\n  if (!currentStyleUrl) {\r\n    currentStyleUrl = appDefaultCss\r\n  } else if (currentStyleUrl !== appDefaultCss) {\r\n    currentStyle = currentStyleUrl\r\n  }\r\n  return blockWrap('source', snippetsBundle(state), false)\r\n}\r\n","import { isNonEmptyStr } from '@i-is-as-i-does/jack-js/src/modules/Check.js'\r\nimport {\r\n  vHide,\r\n  vShow,\r\n  vPlace,\r\n  vReplace\r\n} from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\nimport { getAltState, registerUpdateEvt, resolveState } from '../shared/NxState.js'\r\nimport { authorIndexLink, authorUrl, viewLink } from './NxIdent.js'\r\nimport { mediaElm } from './NxMedia.js'\r\nimport {\r\n  blockWrap,\r\n  getElm,\r\n  landmarkElm,\r\n  lines,\r\n  setHistoryControls,\r\n  threadTitleElm,\r\n  toggleNavEnd,\r\n  spinContainer,\r\n} from '../shared/NxCommons.js'\r\nimport { logErr } from '@i-is-as-i-does/nexus-core/src/logs/NxLog.js'\r\nimport { Spinner } from '@i-is-as-i-does/nexus-core/src/data/NxSpin.js'\r\nimport { getLinkedInstances } from '@i-is-as-i-does/nexus-core/src/data/NxNest.js'\r\nimport { registerLinkedMaps } from '@i-is-as-i-does/nexus-core/src/storg/NxMemory'\r\nvar threadBlocks\r\n\r\nvar currentElm\r\nvar descrpElm\r\nvar contentElm\r\nvar distantNav\r\n\r\nvar slider\r\nvar linked = []\r\n\r\nvar spinElm\r\nvar spinner\r\nvar ready = 0\r\n\r\nvar linkedCtrls = {\r\n  ctrls: {\r\n    prev: { symbol: '⊼', elm: null },\r\n    next: { symbol: '⊻', elm: null },\r\n  },\r\n  position: 0,\r\n  count: 0,\r\n}\r\n\r\nvar distantLandmark\r\n\r\nfunction setDistantLandmark() {\r\n  distantLandmark = landmarkElm('distant')\r\n  distantLandmark.style.display = 'none'\r\n}\r\n\r\nfunction setSpinner() {\r\n  spinElm = spinContainer()\r\n  spinner = new Spinner(spinElm)\r\n}\r\n\r\nfunction countReady() {\r\n  ready++\r\n  if (ready === 2) {\r\n    spinner.endSpin()\r\n    spinElm.style.display = 'none'\r\n    if (linked.length) {\r\n      linkedCtrls.count = linked.length\r\n      toggleNavEnd(linkedCtrls)\r\n      setFirstDistantContent(linked.length > 1)\r\n    }\r\n    vShow(threadBlocks, 'ease', 200)\r\n  }\r\n}\r\n\r\nfunction updateThreadBlocks(state) {\r\n  var newThreadData = resolveThreadData(state)\r\n  vHide(threadBlocks, 'ease', 200, function () {\r\n    if (newThreadData) {\r\n      spinner.startSpin()\r\n      ready = 0\r\n      spinElm.style.display = 'block'\r\n    }\r\n\r\n    resetDistantLinks(state.dataUrl, newThreadData)\r\n\r\n    var newContent = threadContent(newThreadData, false)\r\n    var newDescrpTxt = threadTextElm(newThreadData, ['description'])\r\n    descrpElm.firstChild.replaceWith(newDescrpTxt)\r\n    contentElm.firstChild.replaceWith(newContent)\r\n  })\r\n}\r\n\r\nfunction descriptionElm(threadData) {\r\n  descrpElm = getElm('DIV', 'nx-thread-description')\r\n  descrpElm.append(threadTextElm(threadData, ['description']))\r\n  return descrpElm\r\n}\r\n\r\nfunction resolveThreadData(state) {\r\n  var threadData = null\r\n  if (state && state.threadIndex > -1) {\r\n    threadData = state.srcData.threads[state.threadIndex]\r\n  }\r\n  return threadData\r\n}\r\nfunction distantThreadBlock(dataUrl, threadData) {\r\n  setDistantLandmark()\r\n  setDistantSlider()\r\n  resolveLinkedThreads(dataUrl, threadData)\r\n  return blockWrap('distant', [slider], distantLandmark)\r\n}\r\n\r\nfunction localThreadBlock(threadData) {\r\n  setContentElm(threadData)\r\n  return blockWrap('local', [contentElm], landmarkElm('local'))\r\n}\r\n\r\nfunction setContentElm(threadData) {\r\n  contentElm = getElm('DIV', 'nx-local-content')\r\n  contentElm.append(threadContent(threadData, false))\r\n}\r\n\r\nfunction showDistantNav() {\r\n  distantNav.style.visibility = 'visible'\r\n}\r\n\r\nfunction hideDistantNav() {\r\n  distantNav.style.visibility = 'hidden'\r\n}\r\n\r\nfunction resetDistantLinks(dataUrl, threadData) {\r\n  hideDistantNav()\r\n  toggleDistantLandmark(false)\r\n  removeDistantContent(false)\r\n\r\n  linked = []\r\n  linkedCtrls.position = 0\r\n  linkedCtrls.count = 0\r\n  toggleNavEnd(linkedCtrls)\r\n\r\n  resolveLinkedThreads(dataUrl, threadData)\r\n}\r\n\r\nfunction resolveLinkedThreads(dataUrl, threadData) {\r\n  if (threadData && threadData.linked.length) {\r\n    setLinkedItems(dataUrl, threadData)\r\n  } else {\r\n    countReady()\r\n  }\r\n}\r\n\r\nfunction removeDistantContent(transition = false) {\r\n  var prevElm = currentElm.firstChild\r\n  if (prevElm) {\r\n    if (transition) {\r\n      vHide(prevElm, 'ease', 200, function () {\r\n        prevElm.remove()\r\n      })\r\n    } else {\r\n      prevElm.remove()\r\n    }\r\n  }\r\n}\r\n\r\nfunction setFirstDistantContent(showNav = false) {\r\n  toggleDistantLandmark(true)\r\n  if (showNav) {\r\n    showDistantNav()\r\n  }\r\n  currentElm.append(linked[0])\r\n}\r\n\r\nfunction setCurrentLink() {\r\n  if (linked.length) {\r\n    var nw = linked[linkedCtrls.position]\r\n\r\n    if (currentElm.firstChild) {\r\n      vReplace(currentElm.firstChild, nw, 200)\r\n    } else {\r\n      vPlace(currentElm, nw, false, 'ease', 200, callb)\r\n    }\r\n  } else {\r\n    removeDistantContent(true)\r\n  }\r\n}\r\n\r\nfunction distantNavElm() {\r\n  distantNav = getElm('NAV', 'nx-distant-nav')\r\n  distantNav.append(linkedCtrls.ctrls['prev'].elm, currentElm, linkedCtrls.ctrls['next'].elm)\r\n  hideDistantNav()\r\n  return distantNav\r\n}\r\n\r\nfunction setDistantSlider() {\r\n  slider = getElm('DIV')\r\n  currentElm = getElm('DIV', 'nx-distant-link')\r\n  setHistoryControls(linkedCtrls, setCurrentLink)\r\n  toggleNavEnd(linkedCtrls)\r\n  slider.append(distantNavElm(), currentElm)\r\n}\r\nfunction linkedElm(distantState) {\r\n  var elms = [authorIndexLink(distantState, false), authorUrl(distantState, false)]\r\n  if (distantState.threadId !== '/') {\r\n    elms.push(viewLink(distantState, false), threadContent(resolveThreadData(distantState), true))\r\n  }\r\n  var elm = getElm('DIV')\r\n  elm.append(...elms)\r\n  return elm\r\n}\r\n\r\nfunction toggleDistantLandmark(hasLinks) {\r\n  var hidden = distantLandmark.style.display === 'none'\r\n  if (hasLinks && hidden) {\r\n    distantLandmark.style.display = 'block'\r\n  } else if (!hasLinks && !hidden) {\r\n    distantLandmark.style.display = 'none'\r\n  }\r\n}\r\n\r\nfunction setLinkedItems(dataUrl, threadData) {\r\n  var key = dataUrl + '#' + threadData.id\r\n  var store = getLinkedInstances(key, threadData)\r\n\r\n  var register = store.register\r\n  var confirmedInstances = {}\r\n  var indexes = []\r\n  const promises = []\r\n  for (let [url, ids] of Object.entries(store.instances)) {\r\n    var prc = resolveState(url, '/', true)\r\n      .then((distantState) => {\r\n        confirmedInstances[url] = []\r\n        if (ids.length) {\r\n          ids.forEach((id) => {\r\n            var threadIndex = distantState.srcData.index.indexOf(id)\r\n            if (threadIndex !== -1) {\r\n              confirmedInstances[url].push(id)\r\n              var nDistantState = getAltState(distantState, id, threadIndex)\r\n              linked.push(linkedElm(nDistantState))\r\n            } else {\r\n              register = true\r\n              logErr('Linked thread could not be resolved', id)\r\n            }\r\n          })\r\n        }\r\n        if (!confirmedInstances[url].length) {\r\n          indexes.push(linkedElm(distantState))\r\n        }\r\n      })\r\n      .catch(() => {\r\n        register = true\r\n        logErr('Linked source could not be resolved', url)\r\n      })\r\n    promises.push(prc)\r\n  }\r\n\r\n  Promise.all(promises).then(() => {\r\n    if (register) {\r\n      registerLinkedMaps(key, confirmedInstances)\r\n    }\r\n    if (indexes.length) {\r\n      linked = linked.concat(indexes)\r\n    }\r\n    countReady()\r\n  })\r\n}\r\n\r\nfunction threadContent(threadData, isDistant = false) {\r\n  var dv = getElm('DIV', 'nx-content')\r\n  var callb = null\r\n  if (!isDistant) {\r\n    callb = countReady\r\n  }\r\n  var callbsent = false\r\n  if (threadData) {\r\n    var elms = [dateElm(threadData), contentBody(threadData)]\r\n    if (\r\n      threadData.content.media &&\r\n      threadData.content.media.url &&\r\n      threadData.content.media.url.length\r\n    ) {\r\n      callbsent = true\r\n      elms.push(mediaElm(threadData, callb))\r\n    }\r\n    dv.append(...elms)\r\n  }\r\n  if (!callbsent && callb !== null) {\r\n    callb()\r\n  }\r\n  return dv\r\n}\r\n\r\nfunction contentBody(threadData) {\r\n  var bodydiv = getElm('DIV', 'nx-content-body')\r\n  bodydiv.append(\r\n    threadTextElm(threadData, ['content', 'main']),\r\n    threadTextElm(threadData, ['content', 'aside'])\r\n  )\r\n  return bodydiv\r\n}\r\n\r\nfunction dateElm(threadData) {\r\n  var datediv = getElm('DIV', 'nx-content-meta')\r\n  var rdate = threadTextElm(threadData, ['content', 'timestamp'])\r\n  datediv.append(rdate)\r\n  return datediv\r\n}\r\n\r\nfunction threadFieldText(threadData, ref = []) {\r\n  if (threadData) {\r\n    var data = Object.assign({}, threadData)\r\n    for (var r = 0; r < ref.length; r++) {\r\n      data = data[ref[r]]\r\n    }\r\n    if (isNonEmptyStr(data)) {\r\n      if (ref.includes('timestamp') && data.includes('T')) {\r\n        data = data.replace('T', ' ')\r\n      } else if (['description', 'main', 'aside', 'caption'].includes(ref[ref.length - 1])) {\r\n        data = lines(data)\r\n      }\r\n      return data\r\n    }\r\n  }\r\n  return ''\r\n}\r\n\r\nfunction threadHeader(state, threadData) {\r\n  var header = getElm('DIV', 'nx-thread-header')\r\n  header.append(threadTitleElm(state, true), descriptionElm(threadData))\r\n  return header\r\n}\r\n\r\nfunction localAndDistantBlocks(dataUrl, threadData) {\r\n  threadBlocks = getElm('DIV', 'nx-thread-blocks')\r\n  threadBlocks.style.display = 'none'\r\n  threadBlocks.append(localThreadBlock(threadData), distantThreadBlock(dataUrl, threadData))\r\n\r\n  return threadBlocks\r\n}\r\n\r\nexport function threadTextElm(threadData, ref) {\r\n  var dv = getElm('DIV', 'nx-' + ref.join('-'))\r\n  dv.append(threadFieldText(threadData, ref))\r\n  return dv\r\n}\r\n\r\nexport function mainThreadBlock(state) {\r\n  var threadData = resolveThreadData(state)\r\n\r\n  var mainBlock = getElm('DIV', 'nx-main-block nx-thread')\r\n  setSpinner()\r\n\r\n  if (threadData) {\r\n    spinner.startSpin()\r\n  }\r\n  var blocks = [\r\n    threadHeader(state, threadData),\r\n    spinElm,\r\n    localAndDistantBlocks(state.dataUrl, threadData),\r\n  ]\r\n\r\n  mainBlock.append(...blocks)\r\n\r\n  registerUpdateEvt(function (newState) {\r\n    updateThreadBlocks(newState)\r\n  })\r\n\r\n  return mainBlock\r\n}\r\n","export const appIO = 'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/js/NxIO.js'\r\nexport const appDefaultCss =\r\n  'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NxIO.min.css'\r\nexport const legacyDefaultCss = [\r\n  'https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NexusI.min.css'\r\n]\r\n","import { isCssLoaded } from '@i-is-as-i-does/nexus-core/src/load/NxStyle.js'\r\nimport { getCurrentState, registerUpdateEvt } from './NxState.js'\r\nimport {\r\n  registerTranslElm,\r\n  triggerTranslate,\r\n} from '@i-is-as-i-does/nexus-core/src/transl/NxElmTranslate.js'\r\nimport {\r\n  getAvailableLangs,\r\n  getLang,\r\n  getTxt,\r\n} from '@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js'\r\nimport { appUrl } from '@i-is-as-i-does/nexus-core/src/validt/NxSpecs.js'\r\nimport { splitOnLineBreaks } from '@i-is-as-i-does/jack-js/src/modules/Help.js'\r\nimport { vSplitFlap } from '@i-is-as-i-does/valva/src/modules/transitions.js'\r\n\r\nfunction resolveThreadTitle(state) {\r\n  var threadTitle = '/'\r\n  if (state && state.threadIndex !== -1 && state.srcData.threads[state.threadIndex]) {\r\n    threadTitle = state.srcData.threads[state.threadIndex].title\r\n    if (threadTitle) {\r\n      return threadTitle\r\n    }\r\n  }\r\n  return threadTitle\r\n}\r\n\r\nfunction toggleOnDisplay(viewlk, givenState, newState) {\r\n  if (\r\n    newState.dataUrl &&\r\n    givenState.dataUrl === newState.dataUrl &&\r\n    givenState.threadId == newState.threadId\r\n  ) {\r\n    viewlk.classList.add('nx-on-display')\r\n  } else {\r\n    viewlk.classList.remove('nx-on-display')\r\n  }\r\n}\r\n\r\nfunction langDropDown() {\r\n  var toggle = getElm('P')\r\n  toggle.textContent = getLang()\r\n  return selectDropDown(\r\n    getAvailableLangs(),\r\n    toggle,\r\n    function (nlang) {\r\n      triggerTranslate(nlang)\r\n    },\r\n    'nx-lang-switch'\r\n  )\r\n}\r\n\r\nfunction appLink() {\r\n  var link = getElm('A', 'nx-app-link nx-external-link')\r\n  link.target = '_blank'\r\n  link.href = appUrl\r\n  link.title = 'Nexus'\r\n  link.textContent = 'Nexus'\r\n  return link\r\n}\r\n\r\nfunction appMain(serviceElms) {\r\n  var main = getElm('MAIN')\r\n  main.append(...serviceElms)\r\n  return main\r\n}\r\n\r\nexport function appHeader() {\r\n  var header = getElm('HEADER')\r\n  header.append(appLink())\r\n  return header\r\n}\r\n\r\nexport function appHeaderWithLang() {\r\n  var header = appHeader()\r\n  header.append(langDropDown())\r\n  return header\r\n}\r\n\r\nexport function getElm(tag, classList) {\r\n  var elm = document.createElement(tag)\r\n  if (classList) {\r\n    elm.className = classList\r\n  }\r\n  return elm\r\n}\r\n\r\nexport function instanceWrap(appHeader, serviceElms) {\r\n  var inst = getElm('DIV', 'nx-instance')\r\n  inst.append(appHeader, appMain(serviceElms))\r\n  return inst\r\n}\r\n\r\nexport function serviceWrap(navElms, mainElms, footerElms = [], service = 'reader') {\r\n  var wrap = getElm('DIV', 'nx-' + service)\r\n  var nav = getElm('NAV')\r\n  nav.append(...navElms)\r\n  var bd = getElm('SECTION')\r\n  bd.append(...mainElms)\r\n  wrap.append(nav, bd)\r\n  if (footerElms.length) {\r\n    var footer = getElm('FOOTER')\r\n    footer.append(...footerElms)\r\n    wrap.append(footer)\r\n  }\r\n  return wrap\r\n}\r\n\r\nexport function blockWrap(blockName, contentElms = null, landmark = null) {\r\n  var dv = getElm('DIV', 'nx-' + blockName + ' nx-block')\r\n  if (landmark) {\r\n    dv.append(landmark)\r\n  }\r\n  if (contentElms) {\r\n    dv.append(...contentElms)\r\n  }\r\n  return dv\r\n}\r\n\r\nexport function landmarkElm(name) {\r\n  var lndmrk = getElm('SPAN', 'nx-landmark nx-landmark-' + name.replace(' ', '-'))\r\n  lndmrk.textContent = getTxt(name)\r\n  registerTranslElm(lndmrk, name)\r\n  return lndmrk\r\n}\r\n\r\nexport function errorPrgr() {\r\n  var p = getElm('P')\r\n  if (isCssLoaded()) {\r\n    p.className = 'nx-error'\r\n  } else {\r\n    p.style.margin = '0 auto'\r\n    p.style.fontFamily = '\"Courier New\", Courier, monospace'\r\n    p.style.fontSize = '13px'\r\n  }\r\n\r\n  p.textContent = '—/ — '\r\n  return p\r\n}\r\n\r\nexport function toggleNavEnd(map) {\r\n  if (map.position > 0) {\r\n    map.ctrls['prev'].elm.classList.remove('nx-nav-end')\r\n  } else {\r\n    map.ctrls['prev'].elm.classList.add('nx-nav-end')\r\n  }\r\n  if (map.position < map.count - 1) {\r\n    map.ctrls['next'].elm.classList.remove('nx-nav-end')\r\n  } else {\r\n    map.ctrls['next'].elm.classList.add('nx-nav-end')\r\n  }\r\n}\r\n\r\nexport function setHistoryControls(map, triggerCallback, imgAsSymbol = false) {\r\n  Object.keys(map.ctrls).forEach((ctrl) => {\r\n    map.ctrls[ctrl].elm = getElm('A', 'nx-nav-ctrl nx-nav-end')\r\n    if (imgAsSymbol) {\r\n      map.ctrls[ctrl].elm.append(iconImage(map.ctrls[ctrl].symbol))\r\n    } else {\r\n      map.ctrls[ctrl].elm.textContent = map.ctrls[ctrl].symbol\r\n    }\r\n    map.ctrls[ctrl].elm.addEventListener('click', function () {\r\n      if (!map.ctrls[ctrl].elm.classList.contains('nx-nav-end')) {\r\n        if (ctrl === 'next') {\r\n          map.position++\r\n        } else {\r\n          map.position--\r\n        }\r\n        triggerCallback(ctrl, map.position)\r\n        toggleNavEnd(map)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nexport function selectDropDown(list, toggleElm, actionCallback = null, switchClass = null) {\r\n  var selectedClass = 'nx-selected'\r\n  toggleElm.classList.add('nx-select-toggle')\r\n  var isInput = toggleElm.tagName == 'INPUT'\r\n  var firstValue\r\n  if (isInput) {\r\n    toggleElm.setAttribute('autocomplete', 'off')\r\n    firstValue = toggleElm.value\r\n  } else {\r\n    firstValue = toggleElm.textContent\r\n  }\r\n\r\n  var drp = getElm('UL', 'nx-select-list')\r\n\r\n  var swtch = getElm('DIV', 'nx-select')\r\n  if (switchClass) {\r\n    swtch.classList.add(switchClass)\r\n  }\r\n  swtch.append(toggleElm, drp)\r\n\r\n  toggleElm.addEventListener('click', () => {\r\n    var styl = 'none'\r\n    if (drp.style.display == styl) {\r\n      styl = 'block'\r\n    }\r\n    drp.style.display = styl\r\n  })\r\n\r\n  list.forEach((itm) => {\r\n    var li = getElm('LI')\r\n    li.textContent = itm\r\n    li.dataset.item = itm\r\n    if (itm == firstValue) {\r\n      li.classList.add(selectedClass)\r\n    }\r\n\r\n    drp.append(li)\r\n    li.addEventListener('click', () => {\r\n      var nitm = li.textContent\r\n      var currVal\r\n      if (isInput) {\r\n        currVal = toggleElm.value\r\n      } else {\r\n        currVal = toggleElm.textContent\r\n      }\r\n      if (currVal != nitm) {\r\n        if (!li.classList.contains(selectedClass)) {\r\n          var prev = drp.querySelector('.' + selectedClass)\r\n          if (prev) {\r\n            prev.classList.remove(selectedClass)\r\n          }\r\n          li.classList.add(selectedClass)\r\n        }\r\n        if (isInput) {\r\n          toggleElm.value = nitm\r\n        } else {\r\n          toggleElm.textContent = nitm\r\n        }\r\n        toggleElm.dispatchEvent(new window.Event('change'))\r\n        if (typeof actionCallback === 'function') {\r\n          actionCallback(nitm)\r\n        }\r\n      }\r\n\r\n      drp.style.display = 'none'\r\n    })\r\n  })\r\n  drp.style.display = 'none'\r\n\r\n  return swtch\r\n}\r\n\r\nexport function setToggleOnDisplay(viewlk, state) {\r\n  toggleOnDisplay(viewlk, state, getCurrentState())\r\n  registerUpdateEvt(function (newState) {\r\n    toggleOnDisplay(viewlk, state, newState)\r\n  })\r\n}\r\n\r\nexport function baseViewLink(state, update = false) {\r\n  var viewlk = getElm('A', 'nx-view-link')\r\n  viewlk.append(threadTitleElm(state, update))\r\n  return viewlk\r\n}\r\n\r\nexport function threadTitleElm(state, update = false) {\r\n  var sp = getElm('SPAN', 'nx-thread-title')\r\n  sp.textContent = resolveThreadTitle(state)\r\n  if (update) {\r\n    registerUpdateEvt(function (newState) {\r\n      var nTitle = resolveThreadTitle(newState)\r\n      vSplitFlap(sp, nTitle, 15)\r\n    })\r\n  }\r\n\r\n  return sp\r\n}\r\n\r\nexport function lines(text) {\r\n  var dv = getElm('DIV', 'nx-lines')\r\n  if (text) {\r\n    var sp = splitOnLineBreaks(text)\r\n    var ln = []\r\n    sp.forEach((l) => {\r\n      var p = getElm('P')\r\n      p.textContent = l\r\n      ln.push(p)\r\n    })\r\n    dv.append(...ln)\r\n  }\r\n  return dv\r\n}\r\nexport function spinContainer() {\r\n  var container = getElm('DIV', 'nx-loading')\r\n  return container\r\n}\r\n\r\nexport function iconImage(b64, size = 20) {\r\n  var ic = new Image(size, size)\r\n  ic.className = 'nx-icon'\r\n  ic.src = b64\r\n  return ic\r\n}\r\n","export const copyB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA0IDQgTCA0IDI0IEwgMTEgMjQgTCAxMSAyMiBMIDYgMjIgTCA2IDYgTCAxOCA2IEwgMTggNyBMIDIwIDcgTCAyMCA0IFogTSAxMiA4IEwgMTIgMjggTCAyOCAyOCBMIDI4IDggWiBNIDE0IDEwIEwgMjYgMTAgTCAyNiAyNiBMIDE0IDI2IFoiLz48L3N2Zz4=`\r\nexport const downloadB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNSA0IEwgMTUgMjAuNTYyNSBMIDkuNzE4NzUgMTUuMjgxMjUgTCA4LjI4MTI1IDE2LjcxODc1IEwgMTUuMjgxMjUgMjMuNzE4NzUgTCAxNiAyNC40MDYyNSBMIDE2LjcxODc1IDIzLjcxODc1IEwgMjMuNzE4NzUgMTYuNzE4NzUgTCAyMi4yODEyNSAxNS4yODEyNSBMIDE3IDIwLjU2MjUgTCAxNyA0IFogTSA3IDI2IEwgNyAyOCBMIDI1IDI4IEwgMjUgMjYgWiIvPjwvc3ZnPg==`\r\nexport const saveB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA1IDUgTCA1IDI3IEwgMjcgMjcgTCAyNyA5LjU5Mzc1IEwgMjYuNzE4NzUgOS4yODEyNSBMIDIyLjcxODc1IDUuMjgxMjUgTCAyMi40MDYyNSA1IFogTSA3IDcgTCAxMCA3IEwgMTAgMTMgTCAyMiAxMyBMIDIyIDcuNDM3NSBMIDI1IDEwLjQzNzUgTCAyNSAyNSBMIDIzIDI1IEwgMjMgMTYgTCA5IDE2IEwgOSAyNSBMIDcgMjUgWiBNIDEyIDcgTCAxNiA3IEwgMTYgOSBMIDE4IDkgTCAxOCA3IEwgMjAgNyBMIDIwIDExIEwgMTIgMTEgWiBNIDExIDE4IEwgMjEgMTggTCAyMSAyNSBMIDExIDI1IFoiLz48L3N2Zz4=`\r\nexport const newB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA2IDMgTCA2IDI5IEwgMjYgMjkgTCAyNiA5LjU5Mzc1IEwgMjUuNzE4NzUgOS4yODEyNSBMIDE5LjcxODc1IDMuMjgxMjUgTCAxOS40MDYyNSAzIFogTSA4IDUgTCAxOCA1IEwgMTggMTEgTCAyNCAxMSBMIDI0IDI3IEwgOCAyNyBaIE0gMjAgNi40Mzc1IEwgMjIuNTYyNSA5IEwgMjAgOSBaIi8+PC9zdmc+`\r\nexport const openB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA1IDMgTCA1IDI3LjgxMjUgTCA1Ljc4MTI1IDI3Ljk2ODc1IEwgMTcuNzgxMjUgMzAuNDY4NzUgTCAxOSAzMC43MTg3NSBMIDE5IDI4IEwgMjUgMjggTCAyNSAxNS40Mzc1IEwgMjYuNzE4NzUgMTMuNzE4NzUgTCAyNyAxMy40MDYyNSBMIDI3IDMgWiBNIDE0LjEyNSA1IEwgMjUgNSBMIDI1IDEyLjU2MjUgTCAyMy4yODEyNSAxNC4yODEyNSBMIDIzIDE0LjU5Mzc1IEwgMjMgMjYgTCAxOSAyNiBMIDE5IDE3LjA5Mzc1IEwgMTguNzE4NzUgMTYuNzgxMjUgTCAxNyAxNS4wNjI1IEwgMTcgNS43MTg3NSBaIE0gNyA1LjI4MTI1IEwgMTUgNy4yODEyNSBMIDE1IDE1LjkwNjI1IEwgMTUuMjgxMjUgMTYuMjE4NzUgTCAxNyAxNy45Mzc1IEwgMTcgMjguMjgxMjUgTCA3IDI2LjE4NzUgWiIvPjwvc3ZnPg==`\r\nexport const resetB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiAzIEMgMTIgMyA4LjQgNC43OTkyMTg3IDYgNy42OTkyMTg4IEwgNiA0IEwgNCA0IEwgNCAxMiBMIDEyIDEyIEwgMTIgMTAgTCA2LjgwMDc4MTIgMTAgQyA4LjgwMDc4MTIgNyAxMi4xIDUgMTYgNSBDIDIyLjEgNSAyNyA5LjkgMjcgMTYgQyAyNyAyMi4xIDIyLjEgMjcgMTYgMjcgQyA5LjkgMjcgNSAyMi4xIDUgMTYgTCAzIDE2IEMgMyAyMy4yIDguOCAyOSAxNiAyOSBDIDIzLjIgMjkgMjkgMjMuMiAyOSAxNiBDIDI5IDguOCAyMy4yIDMgMTYgMyB6Ii8+PC9zdmc+`\r\nexport const previewB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiA4IEMgNy42NjQwNjMgOCAxLjI1IDE1LjM0Mzc1IDEuMjUgMTUuMzQzNzUgTCAwLjY1NjI1IDE2IEwgMS4yNSAxNi42NTYyNSBDIDEuMjUgMTYuNjU2MjUgNy4wOTc2NTYgMjMuMzI0MjE5IDE0Ljg3NSAyMy45Mzc1IEMgMTUuMjQ2MDk0IDIzLjk4NDM3NSAxNS42MTcxODggMjQgMTYgMjQgQyAxNi4zODI4MTMgMjQgMTYuNzUzOTA2IDIzLjk4NDM3NSAxNy4xMjUgMjMuOTM3NSBDIDI0LjkwMjM0NCAyMy4zMjQyMTkgMzAuNzUgMTYuNjU2MjUgMzAuNzUgMTYuNjU2MjUgTCAzMS4zNDM3NSAxNiBMIDMwLjc1IDE1LjM0Mzc1IEMgMzAuNzUgMTUuMzQzNzUgMjQuMzM1OTM4IDggMTYgOCBaIE0gMTYgMTAgQyAxOC4yMDMxMjUgMTAgMjAuMjM0Mzc1IDEwLjYwMTU2MyAyMiAxMS40MDYyNSBDIDIyLjYzNjcxOSAxMi40NjA5MzggMjMgMTMuNjc1NzgxIDIzIDE1IEMgMjMgMTguNjEzMjgxIDIwLjI4OTA2MyAyMS41ODIwMzEgMTYuNzgxMjUgMjEuOTY4NzUgQyAxNi43NjE3MTkgMjEuOTcyNjU2IDE2LjczODI4MSAyMS45NjQ4NDQgMTYuNzE4NzUgMjEuOTY4NzUgQyAxNi40ODA0NjkgMjEuOTgwNDY5IDE2LjI0MjE4OCAyMiAxNiAyMiBDIDE1LjczNDM3NSAyMiAxNS40NzY1NjMgMjEuOTg0Mzc1IDE1LjIxODc1IDIxLjk2ODc1IEMgMTEuNzEwOTM4IDIxLjU4MjAzMSA5IDE4LjYxMzI4MSA5IDE1IEMgOSAxMy42OTUzMTMgOS4zNTE1NjMgMTIuNDgwNDY5IDkuOTY4NzUgMTEuNDM3NSBMIDkuOTM3NSAxMS40Mzc1IEMgMTEuNzE4NzUgMTAuNjE3MTg4IDEzLjc3MzQzOCAxMCAxNiAxMCBaIE0gMTYgMTIgQyAxNC4zNDM3NSAxMiAxMyAxMy4zNDM3NSAxMyAxNSBDIDEzIDE2LjY1NjI1IDE0LjM0Mzc1IDE4IDE2IDE4IEMgMTcuNjU2MjUgMTggMTkgMTYuNjU2MjUgMTkgMTUgQyAxOSAxMy4zNDM3NSAxNy42NTYyNSAxMiAxNiAxMiBaIE0gNy4yNSAxMi45Mzc1IEMgNy4wOTM3NSAxMy42MDkzNzUgNyAxNC4yODUxNTYgNyAxNSBDIDcgMTYuNzUzOTA2IDcuNSAxOC4zOTQ1MzEgOC4zNzUgMTkuNzgxMjUgQyA1Ljg1NTQ2OSAxOC4zMjQyMTkgNC4xMDU0NjkgMTYuNTg1OTM4IDMuNTMxMjUgMTYgQyA0LjAxMTcxOSAxNS41MDc4MTMgNS4zNTE1NjMgMTQuMjAzMTI1IDcuMjUgMTIuOTM3NSBaIE0gMjQuNzUgMTIuOTM3NSBDIDI2LjY0ODQzOCAxNC4yMDMxMjUgMjcuOTg4MjgxIDE1LjUwNzgxMyAyOC40Njg3NSAxNiBDIDI3Ljg5NDUzMSAxNi41ODU5MzggMjYuMTQ0NTMxIDE4LjMyNDIxOSAyMy42MjUgMTkuNzgxMjUgQyAyNC41IDE4LjM5NDUzMSAyNSAxNi43NTM5MDYgMjUgMTUgQyAyNSAxNC4yODUxNTYgMjQuOTA2MjUgMTMuNjAxNTYzIDI0Ljc1IDEyLjkzNzUgWiIvPjwvc3ZnPg==`\r\nexport const undoB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxMi43ODEyNSA1LjI4MTI1IEwgNC43ODEyNSAxMy4yODEyNSBMIDQuMDkzNzUgMTQgTCA0Ljc4MTI1IDE0LjcxODc1IEwgMTIuNzgxMjUgMjIuNzE4NzUgTCAxNC4yMTg3NSAyMS4yODEyNSBMIDcuOTM3NSAxNSBMIDIxIDE1IEMgMjMuNzUzOTA2IDE1IDI2IDE3LjI0NjA5NCAyNiAyMCBMIDI2IDI3IEwgMjggMjcgTCAyOCAyMCBDIDI4IDE2LjE1NjI1IDI0Ljg0Mzc1IDEzIDIxIDEzIEwgNy45Mzc1IDEzIEwgMTQuMjE4NzUgNi43MTg3NSBaIi8+PC9zdmc+`\r\nexport const redoB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxOS4yMTg3NSA1LjI4MTI1IEwgMTcuNzgxMjUgNi43MTg3NSBMIDI0LjA2MjUgMTMgTCAxMSAxMyBDIDcuMTU2MjUgMTMgNCAxNi4xNTYyNSA0IDIwIEwgNCAyNyBMIDYgMjcgTCA2IDIwIEMgNiAxNy4yNDYwOTQgOC4yNDYwOTQgMTUgMTEgMTUgTCAyNC4wNjI1IDE1IEwgMTcuNzgxMjUgMjEuMjgxMjUgTCAxOS4yMTg3NSAyMi43MTg3NSBMIDI3LjIxODc1IDE0LjcxODc1IEwgMjcuOTA2MjUgMTQgTCAyNy4yMTg3NSAxMy4yODEyNSBaIi8+PC9zdmc+`\r\nexport const editB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAyMy45MDYyNSAzLjk2ODc1IEMgMjIuODU5Mzc1IDMuOTY4NzUgMjEuODEyNSA0LjM3NSAyMSA1LjE4NzUgTCA1LjE4NzUgMjEgTCA1LjEyNSAyMS4zMTI1IEwgNC4wMzEyNSAyNi44MTI1IEwgMy43MTg3NSAyOC4yODEyNSBMIDUuMTg3NSAyNy45Njg3NSBMIDEwLjY4NzUgMjYuODc1IEwgMTEgMjYuODEyNSBMIDI2LjgxMjUgMTEgQyAyOC40Mzc1IDkuMzc1IDI4LjQzNzUgNi44MTI1IDI2LjgxMjUgNS4xODc1IEMgMjYgNC4zNzUgMjQuOTUzMTI1IDMuOTY4NzUgMjMuOTA2MjUgMy45Njg3NSBaIE0gMjMuOTA2MjUgNS44NzUgQyAyNC40MTAxNTYgNS44NzUgMjQuOTE3OTY5IDYuMTA1NDY5IDI1LjQwNjI1IDYuNTkzNzUgQyAyNi4zNzg5MDYgNy41NjY0MDYgMjYuMzc4OTA2IDguNjIxMDk0IDI1LjQwNjI1IDkuNTkzNzUgTCAyNC42ODc1IDEwLjI4MTI1IEwgMjEuNzE4NzUgNy4zMTI1IEwgMjIuNDA2MjUgNi41OTM3NSBDIDIyLjg5NDUzMSA2LjEwNTQ2OSAyMy40MDIzNDQgNS44NzUgMjMuOTA2MjUgNS44NzUgWiBNIDIwLjMxMjUgOC43MTg3NSBMIDIzLjI4MTI1IDExLjY4NzUgTCAxMS4xODc1IDIzLjc4MTI1IEMgMTAuNTMxMjUgMjIuNSA5LjUgMjEuNDY4NzUgOC4yMTg3NSAyMC44MTI1IFogTSA2LjkzNzUgMjIuNDM3NSBDIDguMTM2NzE5IDIyLjkyMTg3NSA5LjA3ODEyNSAyMy44NjMyODEgOS41NjI1IDI1LjA2MjUgTCA2LjI4MTI1IDI1LjcxODc1IFoiLz48L3N2Zz4=`\r\nexport const invalidB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA3LjIxODc1IDUuNzgxMjUgTCA1Ljc4MTI1IDcuMjE4NzUgTCAxNC41NjI1IDE2IEwgNS43ODEyNSAyNC43ODEyNSBMIDcuMjE4NzUgMjYuMjE4NzUgTCAxNiAxNy40Mzc1IEwgMjQuNzgxMjUgMjYuMjE4NzUgTCAyNi4yMTg3NSAyNC43ODEyNSBMIDE3LjQzNzUgMTYgTCAyNi4yMTg3NSA3LjIxODc1IEwgMjQuNzgxMjUgNS43ODEyNSBMIDE2IDE0LjU2MjUgWiIvPjwvc3ZnPg==`\r\nexport const validB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAyOC4yODEyNSA2LjI4MTI1IEwgMTEgMjMuNTYyNSBMIDMuNzE4NzUgMTYuMjgxMjUgTCAyLjI4MTI1IDE3LjcxODc1IEwgMTAuMjgxMjUgMjUuNzE4NzUgTCAxMSAyNi40MDYyNSBMIDExLjcxODc1IDI1LjcxODc1IEwgMjkuNzE4NzUgNy43MTg3NSBaIi8+PC9zdmc+`\r\nexport const upB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiA0LjA5Mzc1IEwgMTUuMjgxMjUgNC43ODEyNSBMIDYuNzgxMjUgMTMuMjgxMjUgTCA4LjIxODc1IDE0LjcxODc1IEwgMTUgNy45Mzc1IEwgMTUgMjggTCAxNyAyOCBMIDE3IDcuOTM3NSBMIDIzLjc4MTI1IDE0LjcxODc1IEwgMjUuMjE4NzUgMTMuMjgxMjUgTCAxNi43MTg3NSA0Ljc4MTI1IFoiLz48L3N2Zz4=`\r\nexport const downB64 = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNSA0IEwgMTUgMjQuMDYyNSBMIDguMjE4NzUgMTcuMjgxMjUgTCA2Ljc4MTI1IDE4LjcxODc1IEwgMTUuMjgxMjUgMjcuMjE4NzUgTCAxNiAyNy45MDYyNSBMIDE2LjcxODc1IDI3LjIxODc1IEwgMjUuMjE4NzUgMTguNzE4NzUgTCAyMy43ODEyNSAxNy4yODEyNSBMIDE3IDI0LjA2MjUgTCAxNyA0IFoiLz48L3N2Zz4=`\r\n","import { initAll, retrieveNxElm } from '@i-is-as-i-does/nexus-core/src/load/NxInit.js'\r\nimport { getQuery } from '@i-is-as-i-does/nexus-core/src/base/NxHost.js'\r\nimport { setOriginLang } from '@i-is-as-i-does/nexus-core/src/transl/NxCoreTranslate.js'\r\nimport { logErr } from '@i-is-as-i-does/nexus-core/src/logs/NxLog.js'\r\nimport { dataToState, setOriginState } from './NxState.js'\r\nimport { editorElms } from './../editor/NxEditor.js'\r\nimport { readerElms } from './../reader/NxReader.js'\r\nimport { errorPrgr } from './NxCommons.js'\r\nimport { appDefaultCss, legacyDefaultCss } from './NxCdn.js'\r\n\r\nfunction mountApp(nxElm, appElm) {\r\n  var host = document.createElement('DIV')\r\n  host.className = 'nx'\r\n  host.append(appElm)\r\n  nxElm.append(host)\r\n}\r\n\r\nexport function init() {\r\n  initAll({\r\n    appDefaultLang: 'en',\r\n    appDefaultCss: appDefaultCss,\r\n    appDefaultCssAliases: legacyDefaultCss,\r\n  })\r\n    .then((seed) => {\r\n      setOriginLang(seed.request.lang)\r\n      seed.state = dataToState(seed.request.url, seed.request.id, seed.nxdata)\r\n      setOriginState(seed.state)\r\n      var elm\r\n      seed.editMode = false\r\n      if (getQuery('edit') || getQuery('new')) {\r\n        seed.editMode = true\r\n         elm = editorElms(seed)\r\n      } else {\r\n         elm = readerElms(seed)\r\n      }\r\n     mountApp(seed.nxelm, elm)\r\n    }).catch((err) => {\r\n      logErr(err.message)\r\n      mountApp(retrieveNxElm(), errorPrgr())\r\n    })\r\n}\r\n","import { getSrcData, getThreadsList } from '@i-is-as-i-does/nexus-core/src/load/NxSrc.js'\r\nimport {\r\n  isThreadContentUnseen,\r\n  registerThreadVisit,\r\n} from '@i-is-as-i-does/nexus-core/src/storg/NxMemory.js'\r\n\r\nvar currentState = {\r\n  dataUrl: null,\r\n  srcData: null,\r\n  threadId: '/',\r\n  threadIndex: -1,\r\n}\r\n\r\nvar updateStore = { onChange: [], onSrcChange: [] }\r\n\r\nfunction triggerCallbacks(state, triggerAll, skipHistoryUpdate) {\r\n  var ks = ['onChange']\r\n  if (triggerAll) {\r\n    ks.push('onSrcChange')\r\n  }\r\n\r\n  ks.forEach((k) => {\r\n    if (updateStore[k].length) {\r\n      updateStore[k].forEach((callback) => {\r\n        callback(state, skipHistoryUpdate)\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nexport function concatSrc(state) {\r\n  var src = state.dataUrl\r\n  if (state.threadId !== '/') {\r\n    src += '#' + state.threadId\r\n  }\r\n  return src\r\n}\r\n\r\nexport function getTimestamp(state) {\r\n  if (state.threadIndex !== -1 && state.srcData.threads && state.threadIndex < state.srcData.threads.length) {\r\n    return state.srcData.threads[state.threadIndex].content.timestamp\r\n  }\r\n  return null\r\n}\r\n\r\nexport function isStateUnseen(state) {\r\n  var timestamp = getTimestamp(state)\r\n  if(timestamp){\r\n    return isThreadContentUnseen(concatSrc(state), timestamp)\r\n  }\r\n  return false\r\n}\r\n\r\nexport function dataToState(dataUrl, threadId, data, acceptNoId = false) {\r\n  data.index = getThreadsList(data)\r\n  var state = {\r\n    dataUrl: dataUrl,\r\n    threadId: threadId,\r\n    srcData: data,\r\n    threadIndex: data.index.indexOf(threadId),\r\n  }\r\n\r\n  if (state.threadIndex === -1) {\r\n    if (acceptNoId) {\r\n      if (state.threadId !== '/') {\r\n        state.threadId = '/'\r\n      }\r\n    } else {\r\n      setDefaultThread(state)\r\n    }\r\n  }\r\n  return state\r\n}\r\n\r\nexport function setDefaultThread(state) {\r\n  state.threadIndex = 0\r\n  state.threadId = state.srcData.index[0]\r\n}\r\n\r\nexport function resolveState(dataUrl, threadId, acceptNoId = false) {\r\n  return getSrcData(dataUrl).then((data) => {\r\n    return dataToState(dataUrl, threadId, data, acceptNoId)\r\n  })\r\n}\r\n\r\nexport function registerUpdateEvt(callback, onSrcChange = false) {\r\n  var k = 'onChange'\r\n  if (onSrcChange) {\r\n    k = 'onSrcChange'\r\n  }\r\n  updateStore[k].push(callback)\r\n}\r\n\r\nexport function triggerUpdate(state, skipHistoryUpdate = false, forceTrigger = false) {\r\n  var srcChanged = state.dataUrl != currentState.dataUrl\r\n\r\n  if (forceTrigger || srcChanged || state.threadId != currentState.threadId) {\r\n    if (!skipHistoryUpdate) {\r\n      registerThreadVisit(concatSrc(currentState), getTimestamp(currentState))\r\n    }\r\n\r\n    var resetIndex = srcChanged || forceTrigger\r\n    currentState = Object.assign({}, state)\r\n\r\n    triggerCallbacks(state, resetIndex, skipHistoryUpdate)\r\n  }\r\n}\r\n\r\nexport function getCurrentState() {\r\n  return currentState\r\n}\r\n\r\nexport function setOriginState(state) {\r\n  if (!currentState.dataUrl) {\r\n    currentState = state\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function getAltState(state, nId, nIndex) {\r\n  var altState = Object.assign({}, state)\r\n\r\n  altState.threadId = nId\r\n  altState.threadIndex = nIndex\r\n  return altState\r\n}\r\n"],"names":[],"sourceRoot":""}